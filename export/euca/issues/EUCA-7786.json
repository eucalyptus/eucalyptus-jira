{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"24567","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567","key":"EUCA-7786","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12105","id":"12105","description":"Eucalyptus 3.4.0","name":"3.4.0","archived":false,"released":true,"releaseDate":"2013-10-24"}],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10308","value":"Managed-NOVLAN","id":"10308"}],"customfield_11400":null,"customfield_10302":null,"customfield_10104":["com.atlassian.greenhopper.service.sprint.Sprint@8e43e8b[id=29,rapidViewId=64,state=CLOSED,name=3.4 Sprint 6,goal=<null>,startDate=2013-10-09T15:36:36.638Z,endDate=2013-10-21T15:36:00.000Z,completeDate=2013-10-24T18:46:44.066Z,sequence=29]"],"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10303":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"customfield_10105":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10101","value":"No","id":"10101"},"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10200","value":"High","id":"10200"},"customfield_10703":null,"customfield_10308":null,"resolutiondate":"2013-10-11T11:54:12.516-0500","customfield_10704":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-7786/watchers","watchCount":5,"isWatching":false},"lastViewed":null,"created":"2013-10-08T00:11:52.270-0500","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/1","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"customfield_12400":null,"customfield_12201":null,"customfield_12600":"{repository={count=2, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":2,\"lastUpdated\":\"2013-10-10T13:28:10.000-0500\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":2,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10300":null,"customfield_10102":null,"labels":[],"customfield_10301":null,"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12105","id":"12105","description":"Eucalyptus 3.4.0","name":"3.4.0","archived":false,"released":true,"releaseDate":"2013-10-24"}],"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"updated":"2014-06-16T16:15:01.724-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10003","id":"10003","name":"Cluster Controller"}],"timeoriginalestimate":null,"description":"After performing a warm upgrade from 3.3.2 to 3.4.0 no instances are able to access metadata. Restarting the CC again fixes the problem.\r\n\r\nTo reproduce:\r\n1. Install 3.3.2 system and start instances.\r\n2. Perform package upgrade to 3.4.0 and start services.\r\n3. SSH into instances and attempt to access metadata.\r\n\r\nRule missing from the nat table:\r\n{code}\r\nDNAT       tcp  --  anywhere             169.254.169.254     tcp dpt:http to:192.168.2.3:8773\r\n{code}\r\n\r\nIP Tables post-upgrade:\r\n{code}\r\n[root@c-4 ~]# iptables -L\r\nChain INPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\n\r\nChain FORWARD (policy DROP)\r\ntarget     prot opt source               destination         \r\nEUCA_COUNTERS_OUT  all  --  anywhere             anywhere            \r\nEUCA_COUNTERS_IN  all  --  anywhere             anywhere            \r\nACCEPT     all  --  anywhere             anywhere            ctstate ESTABLISHED \r\nACCEPT     all  --  anywhere            !172.16.0.0/16       \r\n/Xn12A5USrYQ2G/npxnPpQ==  all  --  anywhere             anywhere            \r\nACCEPT     all  --  172.16.244.0/27      172.16.244.0/27     \r\n\r\nChain OUTPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\n\r\nChain /Xn12A5USrYQ2G/npxnPpQ== (1 references)\r\ntarget     prot opt source               destination         \r\nACCEPT     tcp  --  anywhere             172.16.244.0/27     tcp dpt:ssh \r\n\r\nChain EUCA_COUNTERS_IN (1 references)\r\ntarget     prot opt source               destination         \r\n           all  --  anywhere             172.16.0.0/16       \r\n           all  --  anywhere             172.16.244.19       \r\n           all  --  anywhere             172.16.244.25       \r\n           all  --  anywhere             172.16.244.29       \r\n\r\nChain EUCA_COUNTERS_OUT (1 references)\r\ntarget     prot opt source               destination         \r\n           all  --  172.16.0.0/16        anywhere            \r\n           all  --  172.16.244.19        anywhere            \r\n           all  --  172.16.244.25        anywhere            \r\n           all  --  172.16.244.29        anywhere            \r\n[root@c-4 ~]# iptables -t nat -L\r\nChain PREROUTING (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nDNAT       all  --  anywhere             192.168.2.102       to:172.16.244.19 \r\nDNAT       all  --  anywhere             192.168.2.101       to:172.16.244.25 \r\nDNAT       all  --  anywhere             192.168.2.100       to:172.16.244.29 \r\n\r\nChain POSTROUTING (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nSNAT       all  --  172.16.244.29        anywhere            to:192.168.2.100 \r\nSNAT       all  --  172.16.244.25        anywhere            to:192.168.2.101 \r\nSNAT       all  --  172.16.244.19        anywhere            to:192.168.2.102 \r\nMASQUERADE  all  --  172.16.0.0/16       !172.16.0.0/16       \r\n\r\nChain OUTPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nDNAT       all  --  anywhere             192.168.2.102       to:172.16.244.19 \r\nDNAT       all  --  anywhere             192.168.2.101       to:172.16.244.25 \r\nDNAT       all  --  anywhere             192.168.2.100       to:172.16.244.29\r\n{code}\r\n\r\nMetadata IP address is present on the CC's interface:\r\n{code}\r\n[root@c-4 ~]# ip -4 addr show\r\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue state UNKNOWN \r\n    inet 127.0.0.1/8 scope host lo\r\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\r\n    inet 169.254.169.254/32 scope link eth0\r\n    inet 192.168.2.4/24 brd 192.168.2.255 scope global eth0\r\n    inet 172.16.244.1/27 brd 172.16.244.31 scope global eth0\r\n    inet 192.168.2.102/32 scope global eth0\r\n    inet 192.168.2.101/32 scope global eth0\r\n    inet 192.168.2.100/32 scope global eth0\r\n{code}\r\n","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/17371","id":"17371","filename":"sosreport-cc-20131007215546-7683.tar.xz","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-08T13:43:23.385-0500","size":7264616,"mimeType":"application/x-xz","content":"https://eucalyptus.atlassian.net/secure/attachment/17371/sosreport-cc-20131007215546-7683.tar.xz"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/17372","id":"17372","filename":"sosreport-cc-post-upgrade-20131008142506-bfeb.tar.xz","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-08T16:30:28.968-0500","size":10324040,"mimeType":"application/x-xz","content":"https://eucalyptus.atlassian.net/secure/attachment/17372/sosreport-cc-post-upgrade-20131008142506-bfeb.tar.xz"}],"summary":"Instances cannot access metadata after warm upgrade","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":"3_*:*_1_*:*_17809451_*|*_10001_*:*_2_*:*_82004158_*|*_10002_*:*_1_*:*_71844226_*|*_10000_*:*_1_*:*_46801230_*|*_10006_*:*_1_*:*_0_*|*_10003_*:*_1_*:*_82881191","customfield_12100":"0|i025un:","customfield_10001":"2013-10-08T18:27:16.623-0500","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_12500":null,"customfield_10400":null,"customfield_11600":["chuck(chuck)","dmitrii(dmitrii)","mspaulding(mspaulding)"],"customfield_10116":null,"customfield_10117":null,"environment":"Eucalyptus 3.4.0-0.0.1600.20131008git148411fc\r\n\r\nMachine 1: CLC Walrus\r\nMachine 2: CC SC\r\nMachine 3: NC\r\n","customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55158","id":"55158","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"body":"Response when attempting to access metadata:\r\n{code}\r\n[ec2-user@euca-172-16-244-25 ~]$ curl http://169.254.169.254\r\ncurl: (7) couldn't connect to host\r\n{code}\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-08T00:15:29.597-0500","updated":"2013-10-08T00:15:29.597-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55235","id":"55235","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"body":"Attached sosreport for the CC/SC.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-08T13:43:23.390-0500","updated":"2013-10-08T13:43:23.390-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55276","id":"55276","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"body":"Previous sosreport was taken prior to the upgrade. It looks like the problem occurs here:\r\n\r\n{code}\r\n2013-10-07 21:35:41 DEBUG 000018473 http_get_timeout         | downloading /tmp/euca-clcnet-uIHxHZ\r\n2013-10-07 21:35:41 DEBUG 000018473 http_get_timeout         | from http://192.168.2.3:8773/latest/network-topology\r\n2013-10-07 21:35:41 DEBUG 000018473 http_get_timeout         | writing GET output to /tmp/euca-clcnet-uIHxHZ\r\n2013-10-07 21:35:42 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (2/60)\r\n2013-10-07 21:35:43 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (3/60)\r\n2013-10-07 21:35:43 DEBUG 000018472 isConfigModified         | file=//etc/eucalyptus/eucalyptus.conf current mtime=1381193786, stored mtime=0\r\n2013-10-07 21:35:44 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (4/60)\r\n2013-10-07 21:35:45 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (5/60)\r\n2013-10-07 21:35:46 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (6/60)\r\n2013-10-07 21:35:47 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (7/60)\r\n2013-10-07 21:35:48 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (8/60)\r\n2013-10-07 21:35:49 DEBUG 000018391 doEnableService          | waiting for monitor to re-initialize (9/60)\r\n2013-10-07 21:35:50 DEBUG 000018473 http_get_timeout         | wrote 183 bytes in 1 writes\r\n2013-10-07 21:35:50 DEBUG 000018473 http_get_timeout         | saved image in /tmp/euca-clcnet-uIHxHZ\r\n2013-10-07 21:35:50 DEBUG 000018473 monitor_thread           | maintaining network state\r\n2013-10-07 21:35:50 DEBUG 000018473 maintainNetworkState     | maintaining metadata redirect and tunnel health\r\n2013-10-07 21:35:50 DEBUG 000018473 maintainNetworkState     | CCcloudIp=192.168.2.3 VNETcloudIp=0.0.0.0\r\n2013-10-07 21:35:50  WARN 000018473 vnetUnsetMetadataRedirec | cloudIp is not yet set, not installing redirect rule\r\n2013-10-07 21:35:50 DEBUG 000018473 vnetApplySingleTableRule | applying single table (nat) rule (-A PREROUTING -d 169.254.169.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.3:8773)\r\n2013-10-07 21:35:50 DEBUG 000018364 doDescribeResources      | invoked: userId=eucalyptus, vmLen=18\r\n2013-10-07 21:35:50 DEBUG 000018364 init_thread              | init=1 0x7fdf09e8b000 0x7fde876ca000 0x7fdebe32b000 0x7fdebe125000\r\n2013-10-07 21:35:50  WARN 000018364 vnetInitTunnels          | in MANAGED-NOVLAN mode, priv interface 'eth0' must be a bridge, tunneling disabled\r\n2013-10-07 21:35:50 DEBUG 000018364 doDescribeResources      | resources summary ({avail/max}): m1.small{0/0} t1.micro{0/0} m1.medium{0/0} c1.medium{0/0} m1.large{0/0}\r\n2013-10-07 21:35:50 DEBUG 000018365 init_thread              | init=1 0x7fdf09e8b000 0x7fde876ca000 0x7fdebe32b000 0x7fdebe125000\r\n{code}\r\n\r\nI've attach another sosreport that is post-upgrade.\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-08T16:30:28.972-0500","updated":"2013-10-08T16:30:28.972-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55286","id":"55286","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"Yep. Based on this snapshot, the NAT rule was installed. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-08T18:27:16.623-0500","updated":"2013-10-08T18:27:16.623-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55292","id":"55292","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"Ok... I found where we disabled the metadata service... Question is what was the call path\r\n\r\n{noformat}\r\n2013-10-07 21:56:40 DEBUG 000018368 doDescribePublicAddresse | invoked: userId=eucalyptus\r\n2013-10-07 21:56:41 DEBUG 000018364 init_thread              | init=1 0x7fdf09e8b000 0x7fde876ca000 0x7fdebe32b000 0x7fdebe125000\r\n2013-10-07 21:56:41  WARN 000018364 vnetInitTunnels          | in MANAGED-NOVLAN mode, priv interface 'eth0' must be a bridge, tunneling disabled\r\n2013-10-07 21:56:41 DEBUG 000018364 doShutdownService        | invoked: userId=admin\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetApplySingleTableRule | applying single table (nat) rule (-D PREROUTING -d 169.254.169.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.3:8773)\r\n2013-10-07 21:56:41 DEBUG 000018473 clean_network_state      | running command '///usr/lib/eucalyptus/euca_rootwrap ip addr del 192.168.2.100/32 dev eth0'\r\n2013-10-07 21:56:41 DEBUG 000018473 clean_network_state      | running command '///usr/lib/eucalyptus/euca_rootwrap ip addr del 192.168.2.101/32 dev eth0'\r\n2013-10-07 21:56:41 DEBUG 000018473 clean_network_state      | running command '///usr/lib/eucalyptus/euca_rootwrap ip addr del 192.168.2.102/32 dev eth0'\r\n2013-10-07 21:56:41 DEBUG 000018473 safekillfile             | calling safekill with pid 20818\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetApplySingleTableRule | applying single table (filter) rule (-D FORWARD -s 172.16.244.0/27 -d 172.16.244.0/27 -j ACCEPT)\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetDelGatewayIP         | removing gateway IP: 172.16.244.1\r\n2013-10-07 21:56:41 DEBUG 000018473 hash_b64enc_string       | in=069842047593d4995211-b2d6-455d-bd17-84951920f771\r\n2013-10-07 21:56:41 DEBUG 000018473 hash_b64enc_string       | in=069842047593d4995211-b2d6-455d-bd17-84951920f771\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetApplySingleTableRule | applying single table (filter) rule (-L /Xn12A5USrYQ2G/npxnPpQ== -n)\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetDeleteChain          | params: userName=069842047593, netName=d4995211-b2d6-455d-bd17-84951920f771, rc=0\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetApplySingleTableRule | applying single table (filter) rule (-D FORWARD -j /Xn12A5USrYQ2G/npxnPpQ==)\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetDeleteChain          | duplicate rule found, removing others: 0/10\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetApplySingleTableRule | applying single table (filter) rule (-D FORWARD -j /Xn12A5USrYQ2G/npxnPpQ==)\r\n2013-10-07 21:56:41 DEBUG 000018473 vnetDeleteChain          | vnetDeleteChain(): flushing 'filter' table\r\n{noformat}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-08T18:51:57.986-0500","updated":"2013-10-08T18:51:57.986-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55332","id":"55332","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"Currently working on it. This seems to be related with a failed \"disable service\" request received by the CC from CLC...","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-09T11:55:10.992-0500","updated":"2013-10-09T11:55:10.992-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55359","id":"55359","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"OK, I found the problem.\r\n\r\nThe CC restarted after upgrade at 21:35 and the rule got installed. At 21:40 the CC re-restored the network and wiped out the NAT rules which flushed the redirect rule and we only apply this rule when CLC IP changed. Since we already had learned the CLC IP, we are not re-installing it… BUG...\r\n\r\n{noformat}\r\n2013-10-07 21:40:10 DEBUG 000018473 restoreNetworkState      | restarting iptables\r\n2013-10-07 21:40:10 DEBUG 000018473 vnetApplySingleTableRule | applying single table (filter) rule (-F)\r\n2013-10-07 21:40:10 DEBUG 000018473 vnetApplySingleTableRule | applying single table (nat) rule (-F)\r\n{noformat}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-09T16:21:45.865-0500","updated":"2013-10-09T16:21:45.865-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55364","id":"55364","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"[~dmitrii], can you do a code review of the following code changes (commit ID 4d0dd7d0fbd5e24c6d520a12cf59e7d0bc4a923b)...\r\n\r\nBasically, during network restoration \"restoreNetworkState()\" we flushed the IPT and never re-install the metadata redirect rule if we had previous knowledge of the CLC:\r\n{noformat}\r\n    if (!strcmp(vnetconfig->mode, NETMODE_MANAGED) || !strcmp(vnetconfig->mode, NETMODE_MANAGED_NOVLAN)) {\r\n        // restore iptables state, if internal iptables state exists\r\n        LOGDEBUG(\"restarting iptables\\n\");\r\n        // Currently only called when CC is enabled\r\n        if ((rc = vnetIptReInit(vnetconfig, TRUE)) != EUCA_OK) {\r\n            LOGERROR(\"cannot restore iptables state\\n\");\r\n            ret = 1;\r\n        }\r\n=========== new code here ===========\r\n        // if we have the cloudIp set, re-install the Metadata Rule\r\n        if (vnetconfig->cloudIp) {\r\n            if ((rc = vnetSetMetadataRedirect(vnetconfig)) != 0) {\r\n                LOGERROR(\"Fail to re-install metadata redirect. rc=%d\\n\", rc);\r\n            }\r\n        }\r\n===================================\r\n        // re-create all active networks (bridges, vlan<->bridge mappings)\r\n        LOGDEBUG(\"restarting networks\\n\");\r\n        for (i = 2; i < NUMBER_OF_VLANS; i++) {\r\n            if (vnetconfig->networks[i].active) {\r\n                char *brname = NULL;\r\n                LOGDEBUG(\"found active network: %d\\n\", i);\r\n                rc = vnetStartNetwork(vnetconfig, i, NULL, vnetconfig->users[i].userName, vnetconfig->users[i].netName, &brname);\r\n                if (rc) {\r\n                    LOGDEBUG(\"failed to reactivate network: %d\", i);\r\n                }\r\n                EUCA_FREE(brname);\r\n            }\r\n        }\r\n\r\n    }\r\n{noformat}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-09T16:55:27.104-0500","updated":"2013-10-09T16:55:27.104-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55422","id":"55422","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"body":"Looks good to me, [~chuck]!","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-10T12:52:51.332-0500","updated":"2013-10-10T12:52:51.332-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55438","id":"55438","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"[~mclark]\r\n\r\nI believe the best way to validate the fix is to run some instances and:\r\n\r\n1) stop both CC and NC once the instance is running\r\n2) start the CC\r\n3) wait 10 minutes\r\n4) using iptables-save confirm that we do have the metadata redirect rule installed\r\n5) start the NC\r\n6) looking at the CC log, wait to see the following message:\r\n\"syncNetworkState(): network sync implies network restore is necessary\"\r\n7) Confirm that the metadata redirect rule is still installed\r\n\r\nthe problem seem to occur when we are doing a network sync...","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-10T13:33:17.639-0500","updated":"2013-10-10T13:33:17.639-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24567/comment/55632","id":"55632","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"body":"Thanks [~chuck]. I used the above procedure on a build that contains the bug to verify that the steps reproduce the problem. I then updated to a build that includes the fix to verify that it is fixed.\r\n\r\nState of IP tables prior to stopping services:\r\n{code}\r\n*nat\r\n:PREROUTING ACCEPT [26142:1581016]\r\n:POSTROUTING ACCEPT [22300:1339488]\r\n:OUTPUT ACCEPT [22290:1338728]\r\n-A PREROUTING -d 192.168.2.100/32 -j DNAT --to-destination 172.16.211.78 \r\n-A PREROUTING -d 192.168.2.102/32 -j DNAT --to-destination 172.16.211.88 \r\n-A PREROUTING -d 192.168.2.101/32 -j DNAT --to-destination 172.16.211.79 \r\n-A PREROUTING -d 169.254.169.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.3:8773 \r\n-A POSTROUTING -s 172.16.211.79/32 -j SNAT --to-source 192.168.2.101 \r\n-A POSTROUTING -s 172.16.211.88/32 -j SNAT --to-source 192.168.2.102 \r\n-A POSTROUTING -s 172.16.211.78/32 -j SNAT --to-source 192.168.2.100 \r\n-A POSTROUTING -s 172.16.0.0/16 ! -d 172.16.0.0/16 -j MASQUERADE \r\n-A OUTPUT -d 192.168.2.100/32 -j DNAT --to-destination 172.16.211.78 \r\n-A OUTPUT -d 192.168.2.102/32 -j DNAT --to-destination 172.16.211.88 \r\n-A OUTPUT -d 192.168.2.101/32 -j DNAT --to-destination 172.16.211.79 \r\nCOMMIT\r\n{code}\r\n\r\nState of IP Tables after step 3:\r\n\r\n{code}\r\n*nat\r\n:PREROUTING ACCEPT [26333:1592396]\r\n:POSTROUTING ACCEPT [22372:1343891]\r\n:OUTPUT ACCEPT [22361:1343055]\r\n-A PREROUTING -d 169.254.169.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.3:8773 \r\n-A POSTROUTING -s 172.16.0.0/16 ! -d 172.16.0.0/16 -j MASQUERADE \r\nCOMMIT\r\n{code}\r\n\r\nWaited for syncNetworkState message:\r\n\r\n{code}\r\n/var/log/eucalyptus/cc.log:2013-10-11 09:48:13 DEBUG 000006331 syncNetworkState         | syncNetworkState(): syncing public/private IP mapping ground truth with local state\r\n/var/log/eucalyptus/cc.log:2013-10-11 09:48:19 DEBUG 000006331 syncNetworkState         | syncNetworkState(): syncing public/private IP mapping ground truth with local state\r\n{code}\r\n\r\nIP Tables state after NC service start:\r\n\r\n{code}\r\n*nat\r\n:PREROUTING ACCEPT [26581:1607281]\r\n:POSTROUTING ACCEPT [22585:1356923]\r\n:OUTPUT ACCEPT [22574:1356087]\r\n-A PREROUTING -d 169.254.169.254/32 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.3:8773 \r\n-A PREROUTING -d 192.168.2.101/32 -j DNAT --to-destination 172.16.211.79 \r\n-A PREROUTING -d 192.168.2.100/32 -j DNAT --to-destination 172.16.211.78 \r\n-A PREROUTING -d 192.168.2.102/32 -j DNAT --to-destination 172.16.211.88 \r\n-A POSTROUTING -s 172.16.211.88/32 -j SNAT --to-source 192.168.2.102 \r\n-A POSTROUTING -s 172.16.211.78/32 -j SNAT --to-source 192.168.2.100 \r\n-A POSTROUTING -s 172.16.211.79/32 -j SNAT --to-source 192.168.2.101 \r\n-A POSTROUTING -s 172.16.0.0/16 ! -d 172.16.0.0/16 -j MASQUERADE \r\n-A OUTPUT -d 192.168.2.101/32 -j DNAT --to-destination 172.16.211.79 \r\n-A OUTPUT -d 192.168.2.100/32 -j DNAT --to-destination 172.16.211.78 \r\n-A OUTPUT -d 192.168.2.102/32 -j DNAT --to-destination 172.16.211.88 \r\nCOMMIT\r\n{code}\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mspaulding","name":"mspaulding","key":"mspaulding","accountId":"557058:fa0a9514-613e-4c4f-8872-2880096382a5","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/49cba835af4c73beefe1c9c630cb2021?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmspaulding%26avatarId%3D13100%26noRedirect%3Dtrue"},"displayName":"Matt Spaulding","active":false,"timeZone":"America/Los_Angeles"},"created":"2013-10-11T11:53:22.246-0500","updated":"2013-10-11T11:53:42.074-0500"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-7786/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}