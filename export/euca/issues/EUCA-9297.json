{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"29454","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454","key":"EUCA-9297","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"customfield_11001":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14203","id":"14203","description":"Eucalyptus 3.4.3","name":"3.4.3","archived":false,"released":true,"releaseDate":"2014-07-11"}],"aggregatetimespent":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/7","id":"7","description":"Signifies completion of tasks, info requests, etc.","name":"Completed"},"customfield_10311":null,"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"customfield_11400":null,"customfield_10302":null,"customfield_10104":[],"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10105":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10101","value":"No","id":"10101"},"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10200","value":"High","id":"10200"},"customfield_10703":null,"customfield_10308":null,"resolutiondate":"2014-12-08T16:42:48.468-0600","customfield_10704":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-9297/watchers","watchCount":8,"isWatching":false},"created":"2014-05-02T10:27:04.235-0500","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/1","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"customfield_12201":null,"customfield_10300":null,"customfield_12600":"{repository={count=2, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":2,\"lastUpdated\":\"2014-07-03T18:22:41.000-0500\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":2,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10102":null,"labels":[],"customfield_10301":null,"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/13700","id":"13700","description":"Eucalyptus 3.4.2","name":"3.4.2","archived":false,"released":true,"releaseDate":"2014-02-24"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12806","id":"12806","description":"Eucalyptus 4.0.0","name":"4.0.0","archived":false,"released":true,"releaseDate":"2014-05-30"}],"customfield_11901":null,"issuelinks":[{"id":"25334","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/25334","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"outwardIssue":{"id":"29453","key":"EUCA-9296","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29453","fields":{"summary":"volumes leftover in SC database as \"available\" after multiple instances fail to run","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/1","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}},{"id":"24394","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/24394","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"outwardIssue":{"id":"21648","key":"EUCA-6387","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/21648","fields":{"summary":"volume creation often fails with Equallogic ","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}},{"id":"24396","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/24396","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"inwardIssue":{"id":"29453","key":"EUCA-9296","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29453","fields":{"summary":"volumes leftover in SC database as \"available\" after multiple instances fail to run","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/1","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}},{"id":"25278","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/25278","type":{"id":"10400","name":"Subtask","inward":"has a subtask of","outward":"is a subtask of","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10400"},"outwardIssue":{"id":"30713","key":"EUCA-9553","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/30713","fields":{"summary":"Hardening Eucalyptus EBS","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/6","id":"6","description":"A big user story that needs to be broken down. Created by JIRA Software - do not edit or delete.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14807&avatarType=issuetype","name":"Epic","subtask":false,"avatarId":14807}}}},{"id":"24424","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/24424","type":{"id":"10400","name":"Subtask","inward":"has a subtask of","outward":"is a subtask of","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10400"},"outwardIssue":{"id":"27833","key":"EUCA-8829","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/27833","fields":{"summary":"Volume create requests are happening in the asynchronous code path for Run Instance.","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/3","description":"This issue is being actively worked on at the moment by the assignee.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/inprogress.png","name":"In Progress","id":"3","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/1","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"updated":"2014-12-08T16:45:25.784-0600","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10014","id":"10014","name":"Storage Controller"}],"timeoriginalestimate":null,"description":"Hi All,\r\n\r\nI have successfully reproduced the problem described in this ticket on a 3.4.2 cloud same steps followed in 4.0.0 result in exact same failure.\r\n\r\na) First of all find out what is the free space available on the dell EQL according to the SC. This can be easily find out when we grep the cloud-output.log on the SC for text \"Free\" , in my case it was \r\n\r\n{code}\r\n2014-05-01 23:04:05  INFO 000000883 EquallogicProvider       | Free Space on 10.104.2.103 : 2089.79GB  \r\n{code}\r\n\r\nb) Now ssh to the Dell EQL and create a volume large enough that you have only very small  free space left on the EQL device. I created a volume of 1070 GB as the EQL is configured to reserve equal amount of space for snapshot. Meaning I should have around 16GB left on Dell EQL left for volumes now.\r\n\r\n{code}\r\nssh grpadmin@10.104.2.103\r\npassword:\r\n\r\nprcgroup1> volume create delete-me-when-done 1095680\r\nVolume creation succeeded.\r\niSCSI target name is iqn.2001-05.com.equallogic:0-8a0906-aaf1dd504-b290012dd8353\r\n633-delete-me-when-done\r\n{code}\r\n\r\nc) Now check back on the SC to see what it thinks is left as free space on the EQL\r\n\r\n{code}\r\n2014-05-01 23:34:05  INFO 000000883 EquallogicProvider       | Free Space on 10.104.2.103 : 15.83GB    \r\n{code}\r\n\r\nd) I then created 6 instances at 1 go (-n 6 to {{euca-run-instances}} with EBS backed image of size 3GB). That would try to create 18GB of volumes on the SAN. We know the SAN is full so that it cannot create volumes above 15.83GB.\r\n\r\ne) All instances got terminated after a while and this is what was seen via euca-* commands:\r\n\r\n{code}\r\n[odc-f-09:~]euca-describe-instances \r\nRESERVATION\tr-EE8842BD\t030327983824\tdefault\r\nINSTANCE\ti-38904146\temi-39674387\teuca-0-0-0-0.eucalyptus.localhost\teuca-0-0-0-0.eucalyptus.internal\tterminated\tbrian\t0\t\tm1.small\t2014-05-02T06:35:56.473Z\tcc1\t\t\t\tmonitoring-disabled\t0.0.0.0\t0.0.0.0\t\t\tebs\t\t\t\t\thvm\t\t\t\t\t\t\r\nBLOCKDEVICE\t/dev/sda\tvol-2F9740A2\t2014-05-02T06:35:57.187Z\ttrue\t\t\r\nINSTANCE\ti-846842C0\temi-39674387\teuca-0-0-0-0.eucalyptus.localhost\teuca-0-0-0-0.eucalyptus.internal\tterminated\tbrian\t1\t\tm1.small\t2014-05-02T06:35:56.534Z\tcc1\t\t\t\tmonitoring-disabled\t0.0.0.0\t0.0.0.0\t\t\tebs\t\t\t\t\thvm\t\t\t\t\t\t\r\nBLOCKDEVICE\t/dev/sda\tvol-41D4404A\t2014-05-02T06:35:57.442Z\ttrue\t\t\r\nINSTANCE\ti-DC913DBD\temi-39674387\teuca-0-0-0-0.eucalyptus.localhost\teuca-0-0-0-0.eucalyptus.internal\tterminated\tbrian\t2\t\tm1.small\t2014-05-02T06:35:56.575Z\tcc1\t\t\t\tmonitoring-disabled\t0.0.0.0\t0.0.0.0\t\t\tebs\t\t\t\t\thvm\t\t\t\t\t\t\r\nBLOCKDEVICE\t/dev/sda\tvol-671F4296\t2014-05-02T06:35:57.642Z\ttrue\t\t\r\nINSTANCE\ti-D7A93D8F\temi-39674387\teuca-0-0-0-0.eucalyptus.localhost\teuca-0-0-0-0.eucalyptus.internal\tterminated\tbrian\t3\t\tm1.small\t2014-05-02T06:35:56.614Z\tcc1\t\t\t\tmonitoring-disabled\t0.0.0.0\t0.0.0.0\t\t\tebs\t\t\t\t\thvm\t\t\t\t\t\t\r\nBLOCKDEVICE\t/dev/sda\tvol-321F3F5C\t2014-05-02T06:35:57.860Z\ttrue\t\t\r\nINSTANCE\ti-27C13FB7\temi-39674387\teuca-0-0-0-0.eucalyptus.localhost\teuca-0-0-0-0.eucalyptus.internal\tterminated\tbrian\t4\t\tm1.small\t2014-05-02T06:35:56.668Z\tcc1\t\t\t\tmonitoring-disabled\t0.0.0.0\t0.0.0.0\t\t\tebs\t\t\t\t\thvm\t\t\t\t\t\t\r\nBLOCKDEVICE\t/dev/sda\tvol-8F323F82\t2014-05-02T06:35:58.093Z\ttrue\t\t\r\nINSTANCE\ti-26D63DEA\temi-39674387\teuca-0-0-0-0.eucalyptus.localhost\teuca-0-0-0-0.eucalyptus.internal\tterminated\tbrian\t5\t\tm1.small\t2014-05-02T06:35:56.709Z\tcc1\t\t\t\tmonitoring-disabled\t0.0.0.0\t0.0.0.0\t\t\tebs\t\t\t\t\thvm\t\t\t\t\t\t\r\nBLOCKDEVICE\t/dev/sda\tvol-BE903DCC\t2014-05-02T06:35:58.327Z\ttrue\t\r\n{code}\r\n\r\nf) But strange enough there was a totally different view on the CLC about the volumes, please see below:\r\n\r\n{code}\r\n[odc-f-09:~]euca-describe-volumes \r\nVOLUME\tvol-41D4404A\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.246Z\tstandard\t\r\nATTACHMENT\tvol-41D4404A\ti-846842C0\t/dev/sda\tattached\t2014-05-02T06:35:57.442Z\r\nVOLUME\tvol-8F323F82\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.931Z\tstandard\t\r\nATTACHMENT\tvol-8F323F82\ti-27C13FB7\t/dev/sda\tattached\t2014-05-02T06:35:58.093Z\r\nVOLUME\tvol-BE903DCC\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:58.157Z\tstandard\t\r\nATTACHMENT\tvol-BE903DCC\ti-26D63DEA\t/dev/sda\tattached\t2014-05-02T06:35:58.327Z\r\nVOLUME\tvol-2F9740A2\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:56.928Z\tstandard\t\r\nATTACHMENT\tvol-2F9740A2\ti-38904146\t/dev/sda\tattached\t2014-05-02T06:35:57.187Z\r\nVOLUME\tvol-321F3F5C\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.702Z\tstandard\t\r\nATTACHMENT\tvol-321F3F5C\ti-D7A93D8F\t/dev/sda\tattached\t2014-05-02T06:35:57.860Z\r\nVOLUME\tvol-671F4296\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.497Z\tstandard\t\r\nATTACHMENT\tvol-671F4296\ti-DC913DBD\t/dev/sda\tattached\t2014-05-02T06:35:57.642Z\r\n[odc-f-09:~]euca-describe-volumes \r\nVOLUME\tvol-41D4404A\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.246Z\tstandard\t\r\nATTACHMENT\tvol-41D4404A\ti-846842C0\t/dev/sda\tattached\t2014-05-02T06:35:57.442Z\r\nVOLUME\tvol-8F323F82\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.931Z\tstandard\t\r\nATTACHMENT\tvol-8F323F82\ti-27C13FB7\t/dev/sda\tattached\t2014-05-02T06:35:58.093Z\r\nVOLUME\tvol-BE903DCC\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:58.157Z\tstandard\t\r\nATTACHMENT\tvol-BE903DCC\ti-26D63DEA\t/dev/sda\tattached\t2014-05-02T06:35:58.327Z\r\nVOLUME\tvol-2F9740A2\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:56.928Z\tstandard\t\r\nATTACHMENT\tvol-2F9740A2\ti-38904146\t/dev/sda\tattached\t2014-05-02T06:35:57.187Z\r\nVOLUME\tvol-321F3F5C\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.702Z\tstandard\t\r\nATTACHMENT\tvol-321F3F5C\ti-D7A93D8F\t/dev/sda\tattached\t2014-05-02T06:35:57.860Z\r\nVOLUME\tvol-671F4296\t3\tsnap-7EDE3F1D\tcc1\tin-use\t2014-05-02T06:35:57.497Z\tstandard\t\r\nATTACHMENT\tvol-671F4296\ti-DC913DBD\t/dev/sda\tattached\t2014-05-02T06:35:57.642Z\r\n{code}\r\n\r\nNote that the CLC has kept volume records in state {{BUSY}} and {{EXTANT}} when all instances failed to get started. I had expect on failure all instances backing volumes would be deleted by the CLC if an {{abort}} was performed due to failure of creating the next new volume on the backend.\r\n\r\nCLC database and in that {{metadata_volumes}} looks like this:\r\n\r\n{code}\r\neucalyptus_cloud=# select metadata_display_name,metadata_state from metadata_volumes;\r\n metadata_display_name | metadata_state \r\n-----------------------+----------------\r\n vol-2F9740A2          | BUSY\r\n vol-41D4404A          | EXTANT\r\n vol-8F323F82          | BUSY\r\n vol-321F3F5C          | BUSY\r\n vol-671F4296          | EXTANT\r\n vol-BE903DCC          | BUSY\r\n{code}\r\n\r\nSC database and in that {{volumes}} looks like this:\r\n\r\n{code}\r\neucalyptus_storage=# select volume_name,size from volumes where status<>'deleted';\r\n volume_name  | size \r\n--------------+------\r\n vol-41D4404A |    3\r\n vol-671F4296 |    3\r\n(2 rows)\r\n{code}\r\n\r\nBefore I started the operation the cloud had no volumes on it in all the 3 places\r\na) CLC DB\r\nb) SC DB\r\nc) Dell EQL\r\n\r\nNow I am left with this state, where in I have a totally mismatched state information in the CLC and SC databases. \r\n\r\ng) I decided to cleanup the instances by issuing a 2nd terminate to them. As soon as I issued a 2nd terminate to all those instances they vanished off the list in {{euca-describe-instances verbose}} and all the volumes associated to them transitioned state to {{EXTANT}}.\r\n\r\nNow if I try to delete one of the volumes using {{euca-delete-volume}} it fails:\r\n\r\n{code}\r\n[odc-f-09:~]euca-delete-volume vol-8F323F82\r\neuca-delete-volume: error (DeleteVolumeType): com.eucalyptus.ws.EucalyptusRemoteFault: Action:ProblemAction Code:DeleteStorageVolumeType Id:RelatesTo Error: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-8F323F82 scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-8F323F82 scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\n{code}\r\n\r\nAs the volume is not visible to the SC (in its database) it has failed to delete it. These volumes are stuck as {{EXTANT}} now in the CLC database.\r\n\r\nh) Only 2 volumes that are {{vol-41D4404A}} and {{vol-671F4296}} both known to the CLC and the SC can be deleted successfully:\r\n\r\n{code}\r\n[odc-f-09:~]euca-delete-volume vol-41D4404A\r\nVOLUME\tvol-41D4404A\r\n[odc-f-09:~]euca-delete-volume vol-671F4296\r\nVOLUME\tvol-671F4296\r\n{code}\r\n\r\nAfter sometime:\r\n\r\n{code}\r\n[odc-f-09:~]euca-describe-volumes \r\nVOLUME\tvol-41D4404A\t3\tsnap-7EDE3F1D\tcc1\tdeleted\t2014-05-02T06:35:57.246Z\tstandard\t\r\nVOLUME\tvol-8F323F82\t3\tsnap-7EDE3F1D\tcc1\tavailable\t2014-05-02T06:35:57.931Z\tstandard\t\r\nVOLUME\tvol-BE903DCC\t3\tsnap-7EDE3F1D\tcc1\tavailable\t2014-05-02T06:35:58.157Z\tstandard\t\r\nVOLUME\tvol-2F9740A2\t3\tsnap-7EDE3F1D\tcc1\tavailable\t2014-05-02T06:35:56.928Z\tstandard\t\r\nVOLUME\tvol-321F3F5C\t3\tsnap-7EDE3F1D\tcc1\tavailable\t2014-05-02T06:35:57.702Z\tstandard\t\r\nVOLUME\tvol-671F4296\t3\tsnap-7EDE3F1D\tcc1\tdeleted\t2014-05-02T06:35:57.497Z\tstandard\r\n{code}\r\n\r\ni) The rest 4 volumes on the CLC cannot be deleted because they have no corresponding record on the SC anymore:\r\n\r\n{code}\r\n[odc-f-09:~]for i in `euca-describe-volumes | grep available | awk '{print $2}'` ;do euca-delete-volume $i; done\r\neuca-delete-volume: error (DeleteVolumeType): com.eucalyptus.ws.EucalyptusRemoteFault: Action:ProblemAction Code:DeleteStorageVolumeType Id:RelatesTo Error: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-8F323F82 scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-8F323F82 scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\neuca-delete-volume: error (DeleteVolumeType): com.eucalyptus.ws.EucalyptusRemoteFault: Action:ProblemAction Code:DeleteStorageVolumeType Id:RelatesTo Error: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-BE903DCC scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-BE903DCC scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\neuca-delete-volume: error (DeleteVolumeType): com.eucalyptus.ws.EucalyptusRemoteFault: Action:ProblemAction Code:DeleteStorageVolumeType Id:RelatesTo Error: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-2F9740A2 scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-2F9740A2 scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\neuca-delete-volume: error (DeleteVolumeType): com.eucalyptus.ws.EucalyptusRemoteFault: Action:ProblemAction Code:DeleteStorageVolumeType Id:RelatesTo Error: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-321F3F5C scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-321F3F5C scName=cc1 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\n{code}\r\n\r\nIn 4.0.0 following is seen:\r\n\r\na) Ran 1 instance of 1GB size (EBS volume would be created of 1 GB but SAN has free space of only 16MB)\r\n\r\n{code}\r\n# euca-run-instances -k sshlogin -t m1.small emi-f1a5ffff\r\nRESERVATION\tr-dcef7b93\t310812770611\tdefault\r\nINSTANCE\ti-d0f3b69c\temi-f1a5ffff\t\teuca-10-104-3-43.eucalyptus.internal\tpending\tsshlogin\t0\t\tm1.small\t2014-05-02T15:11:36.122Z\tcloud4\t\t\t\tmonitoring-disabled\t10.104.3.43\t10.104.3.43\t\t\tebs\t\t\t\t\thvm\t\t\tsg-eec52aef\t\t\t\r\n{code}\r\n\r\nb) Checked the cloud-output.log on the SC\r\n\r\n{code}\r\n2014-05-02 08:11:36  INFO | Processing CreateStorageVolume request for volume vol-47c22a8e\r\n2014-05-02 08:11:36  INFO | Creating backend volume vol-47c22a8e mapping to vol-47c22a8e from backend snapshot snap-accd7c0a mapping to snap-accd7c0a\r\n2014-05-02 08:11:50 ERROR | com.eucalyptus.util.EucalyptusCloudException: Unable to create volume: vol-47c22a8e from snapshot: snap-accd7c0a\r\n2014-05-02 08:11:51 ERROR | com.eucalyptus.util.EucalyptusCloudException: verify: false\r\n2014-05-02 08:11:51  WARN | Failed volume, cleaning it: vol-47c22a8e\r\n2014-05-02 08:11:51  INFO | Cleaning failed volume vol-47c22a8e\r\n2014-05-02 08:11:51  INFO | Deleting backend volume vol-47c22a8e mapping to vol-47c22a8e\r\n2014-05-02 08:11:52  WARN | Failed volume, cleaning it: vol-47c22a8e\r\n2014-05-02 08:11:52  INFO | Cleaning failed volume vol-47c22a8e\r\n2014-05-02 08:11:52  INFO | Deleting backend volume vol-47c22a8e mapping to vol-47c22a8e\r\n2014-05-02 08:11:58 ERROR | Volume not found: vol-47c22a8e\r\n2014-05-02 08:12:02 ERROR | Volume not found: vol-47c22a8e\r\n2014-05-02 08:12:02 ERROR | Unable to clean failed volume: vol-47c22a8e\r\n2014-05-02 08:12:40 ERROR | com.eucalyptus.util.EucalyptusCloudException: verify: false\r\n{code}\r\n\r\nc) Checked the cloud-output.log on the CLC\r\n\r\n{code}\r\n2014-05-02 08:11:35  INFO | Found authorized clusters: [cc1]\r\n2014-05-02 08:11:35  INFO | Availability: cc1 -> 8\r\n2014-05-02 08:11:35  INFO | Availability: cc1 -> 8\r\n2014-05-02 08:11:36  INFO | :1399043496084:Address:ADDRESS_STATE:TOP:Address 10.104.3.22 arn:aws:euare:000000000001:user/nobody available 0.0.0.0  AddressTransition system:unallocated->impending(true)\r\n2014-05-02 08:12:07 ERROR | java.lang.IndexOutOfBoundsException: Index: 0, Size: 0\r\njava.lang.IndexOutOfBoundsException: Index: 0, Size: 0\r\n\tat java.util.ArrayList.rangeCheck(ArrayList.java:635)\r\n\tat java.util.ArrayList.get(ArrayList.java:411)\r\n\tat com.eucalyptus.cloud.run.ClusterAllocator.waitForVolume(ClusterAllocator.java:613)\r\n\tat com.eucalyptus.cloud.run.ClusterAllocator.makeVmTypeInfo(ClusterAllocator.java:511)\r\n\tat com.eucalyptus.cloud.run.ClusterAllocator.setupVmMessages(ClusterAllocator.java:473)\r\n\tat com.eucalyptus.cloud.run.ClusterAllocator.<init>(ClusterAllocator.java:241)\r\n\tat com.eucalyptus.cloud.run.ClusterAllocator.<init>(ClusterAllocator.java:162)\r\n\tat com.eucalyptus.cloud.run.ClusterAllocator$SubmitAllocation$1.call(ClusterAllocator.java:201)\r\n\tat com.eucalyptus.cloud.run.ClusterAllocator$SubmitAllocation$1.call(ClusterAllocator.java:197)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\r\n\tat com.eucalyptus.system.Threads$Queue.run(Threads.java:684)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\r\n\tat java.lang.Thread.run(Thread.java:744)\r\n2014-05-02 08:12:07 ERROR | java.lang.IndexOutOfBoundsException: Index: 0, Size: 0\r\n2014-05-02 08:12:07  WARN | Aborting resource token: ResourceToken:i-d0f3b69c:resources=TypedContext:{com.eucalyptus.util.TypedKey(NetworkResources)=[com.eucalyptus.compute.common.network.PublicIPResource(), com.eucalyptus.compute.common.network.PrivateIPResource()]}\r\n2014-05-02 08:12:07  INFO | :1399043527717:Address:ADDRESS_STATE:TOP:Address 10.104.3.22  AddressTransition unallocating:impending->unallocated(true)\r\n2014-05-02 08:12:07 ERROR | java.util.NoSuchElementException: example: [VmInstance networkConfig=null vmId=null bootRecord=null usageStats=null launchRecord=null runtimeState=null transientVolumeState=null placement=null expiration=null privateNetwork=null networkGroups=[] networkGroupIds=[] networkIndex=null tags=null ownerUserId=null ownerUserName=null ownerAccountNumber=null uniqueName=null ownerFullNameCached=null state=null lastState=null stateChangeStack=null displayName=i-d0f3b69c id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\n2014-05-02 08:12:07  INFO | :1399043527853:StatefulMessageSet:VM_STARTING:START:31.641s\r\n2014-05-02 08:12:07  INFO | :1399043527853:StatefulMessageSet:VM_STARTING:START:TRANSITION:CREATE_VOLS\r\n2014-05-02 08:12:07  INFO | :1399043527853:StatefulMessageSet:VM_STARTING:CREATE_VOLS:31.641s\r\n2014-05-02 08:12:07  INFO | :1399043527853:StatefulMessageSet:VM_STARTING:CREATE_VOLS:TRANSITION:CREATE_IGROUPS\r\n2014-05-02 08:12:07  INFO | :1399043527854:StatefulMessageSet:VM_STARTING:CREATE_IGROUPS:31.642s\r\n2014-05-02 08:12:07  INFO | :1399043527854:StatefulMessageSet:VM_STARTING:CREATE_IGROUPS:TRANSITION:CREATE_NETWORK\r\n2014-05-02 08:12:07  INFO | :1399043527854:StatefulMessageSet:VM_STARTING:CREATE_NETWORK:31.642s\r\n2014-05-02 08:12:07  INFO | :1399043527854:StatefulMessageSet:VM_STARTING:CREATE_NETWORK:TRANSITION:CREATE_NETWORK_RULES\r\n2014-05-02 08:12:07  INFO | :1399043527854:StatefulMessageSet:VM_STARTING:CREATE_NETWORK_RULES:31.642s\r\n2014-05-02 08:12:07  INFO | :1399043527854:StatefulMessageSet:VM_STARTING:CREATE_NETWORK_RULES:TRANSITION:CREATE_VMS\r\n2014-05-02 08:12:07  INFO | :1399043527855:StatefulMessageSet:VM_STARTING:CREATE_VMS:31.643s\r\n2014-05-02 08:12:07  INFO | :1399043527855:StatefulMessageSet:VM_STARTING:CREATE_VMS:TRANSITION:UPDATE_RESOURCES\r\n2014-05-02 08:12:07  INFO | :1399043527855:StatefulMessageSet:VM_STARTING:UPDATE_RESOURCES:31.643s\r\n2014-05-02 08:12:07  INFO | :1399043527855:StatefulMessageSet:VM_STARTING:UPDATE_RESOURCES:TRANSITION:ATTACH_VOLS\r\n2014-05-02 08:12:07  INFO | :1399043527855:StatefulMessageSet:VM_STARTING:ATTACH_VOLS:31.643s\r\n2014-05-02 08:12:07  INFO | :1399043527855:StatefulMessageSet:VM_STARTING:ATTACH_VOLS:TRANSITION:ASSIGN_ADDRESSES\r\n2014-05-02 08:12:07  INFO | :1399043527856:StatefulMessageSet:VM_STARTING:ASSIGN_ADDRESSES:31.644s\r\n2014-05-02 08:12:07  INFO | :1399043527856:StatefulMessageSet:VM_STARTING:ASSIGN_ADDRESSES:TRANSITION:FINISHED\r\n2014-05-02 08:12:07  INFO | :1399043527856:StatefulMessageSet:VM_START_COMPLETED:31.644s\r\n{code}\r\n\r\nd) Checked the volume ({{vol-47c22a8e}} state according to SC and CLC, found it to be {{EXTANT}} on CLC and no record on SC\r\n\r\n{code}\r\n# euca-describe-volumes \r\nVOLUME\tvol-47c22a8e\t1\tsnap-accd7c0a\tcloud4\tavailable\t2014-05-02T15:11:36.241Z\tstandard\t\r\nVOLUME\tvol-68cdb559\t1\t\tcloud4\tavailable\t2014-05-02T10:47:47.382Z\tstandard\r\n{code}\r\n\r\non SC \r\n\r\n{code}\r\neucalyptus_storage=# select * from volumes where status<>'deleted';\r\n                id                |   creation_timestamp    |  last_update_timestamp  |          metadata_perm_uuid          | version |       create_time       | deletio\r\nn_time | sc_name | size | snapshot_id |  status   | volume_user_name | volume_name  | zone \r\n----------------------------------+-------------------------+-------------------------+--------------------------------------+---------+-------------------------+--------\r\n-------+---------+------+-------------+-----------+------------------+--------------+------\r\n 8ae8815445bc46970145bc8c12450011 | 2014-05-02 03:47:47.525 | 2014-05-02 03:47:59.057 | 6b89f5cf-9f7b-492d-8fcc-12b70583639c |       1 | 2014-05-02 03:47:47.525 |        \r\n       | cloud4  |    1 |             | available | eucalyptus       | vol-68cdb559 | \r\n(1 row)\r\n{code}\r\n\r\non CLC\r\n{code}\r\neucalyptus_cloud=# select metadata_display_name,metadata_state from metadata_volumes;\r\n metadata_display_name | metadata_state \r\n-----------------------+----------------\r\n vol-68cdb559          | EXTANT\r\n vol-47c22a8e          | EXTANT\r\n(2 rows)\r\n{code}\r\n\r\ne) Trying to delete the volume by {{euca-delete-volume}} gives same error as seen on 3.4.2:\r\n\r\n{code}\r\n# euca-delete-volume vol-47c22a8e\r\neuca-delete-volume: error (DeleteStorageVolumeType): Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-47c22a8e scName=cloud4 size=null status=null createTime=null zone=null snapshotId=null deletionTime=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\n{code}\r\n\r\nf) Packages used to reproduce the problem\r\n\r\n{code}\r\n# rpm -qa | grep euca\r\neucalyptus-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-admin-tools-4.0.0-0.0.970.20140502gitc2126db3.el6.noarch\r\neucalyptus-load-balancer-image-1.0.4-0.198.140429git81659ff.el6.x86_64\r\neucalyptus-sos-plugins-0.1.5-0.el6.noarch\r\neuca2ools-3.1.0-0.0.175.20140428git352d96ea.el6.noarch\r\neucalyptus-common-java-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-cloud-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-enterprise-storage-san-equallogic-libs-4.0.0-0.0.965.20140502git91d4a3ec.el6.x86_64\r\neucalyptus-imaging-worker-image-1.0.0-0.158.140501gitf1cc69f.el6.x86_64\r\neucalyptus-common-java-libs-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-osg-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-cc-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-sc-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-blockdev-utils-4.0.0-0.0.970.20140502gitc2126db3.el6.x86_64\r\neucalyptus-enterprise-storage-san-equallogic-4.0.0-0.0.965.20140502git91d4a3ec.el6.x86_64\r\n{code}\r\n\r\ng) CLC/UFS/Walrus - 1 , CC/SC - 1 , NC - 1 , Network Mode - EDGE\r\n\r\nPlease let me know if you have any questions.\r\n\r\nCheers!\r\nDeependra\r\n","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"volumes leftover in SC/CLC database as \"available\" after instance fail to run due to low space on SAN","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dshekhawat","name":"dshekhawat","key":"dshekhawat","accountId":"557058:dc10d216-39f8-4d84-a5ff-7d4daf8a44ed","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue"},"displayName":"Deependra Shekhawat","active":false,"timeZone":"Asia/Kolkata"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dshekhawat","name":"dshekhawat","key":"dshekhawat","accountId":"557058:dc10d216-39f8-4d84-a5ff-7d4daf8a44ed","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/7cda271db1cec24c198fdfb42ec8a8ae?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddshekhawat%26avatarId%3D15400%26noRedirect%3Dtrue"},"displayName":"Deependra Shekhawat","active":false,"timeZone":"Asia/Kolkata"},"customfield_12100":"0|i02o8n:","customfield_10000":"3_*:*_2_*:*_302764279_*|*_10001_*:*_2_*:*_3666882864_*|*_10000_*:*_1_*:*_8327232_*|*_10006_*:*_1_*:*_0_*|*_10003_*:*_2_*:*_776866520","aggregateprogress":{"progress":0,"total":0},"customfield_10001":"2014-06-10T22:18:32.001-0500","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["dshekhawat(dshekhawat)","lbiasi(lbiasi)","sjones(sjones)","tjcramer(tjcramer)","tony(tony)","zhill(zhill)"],"customfield_10116":null,"customfield_10117":null,"environment":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-9297/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72244","id":"72244","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tjcramer","name":"tjcramer","key":"tjcramer","accountId":"557058:e076cf45-80ca-4b67-befb-7b0c21f32739","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue"},"displayName":"Tim Cramer","active":true,"timeZone":"America/Los_Angeles"},"body":"[~zhill], as per a conversation with [~sjones] and [~decker], this issue has already been addressed in 3.4.3 (and will be in 4.0.1). \r\nCan you check the related tickets and close them if that's the case, and then simply put this one into QA for 3.4.3?  Thanks.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tjcramer","name":"tjcramer","key":"tjcramer","accountId":"557058:e076cf45-80ca-4b67-befb-7b0c21f32739","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/65e7a5c18fc469f1978f6367993c3bf0?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtjcramer%26avatarId%3D10401%26noRedirect%3Dtrue"},"displayName":"Tim Cramer","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-10T22:18:32.001-0500","updated":"2014-06-10T22:18:32.001-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72259","id":"72259","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"I may have duplicated this issue with EUCA-9501. The expected behaviour with the fix for that issue in place is that any volumes known only to the CLC can be manually deleted.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-11T11:49:38.450-0500","updated":"2014-06-11T11:49:38.450-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72295","id":"72295","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"body":"[~tjcramer], I don't think we're getting to EUCA-8829 in a point release. [~decker], am I mistaken? The scope for such a change would be 4.1 or later.\r\n\r\nEUCA-6387, I don't believe that is either in progress or slated for 4.0.1. I filed a new ticket related to it to better handle capacity checks.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-11T19:30:30.968-0500","updated":"2014-06-11T19:30:30.968-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72738","id":"72738","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"In reproducing this I have seen that when the SAN runs out of space for the required operations, then the volumes that could not be created get stuck in \"creating state\" and cannot be deleted.\r\n\r\nThe steps to reproduce are the same as originally described.  In my scenario The SAN had just over 6GB free and I tried to launch 3x 3GB EBS instances. The instances fail to launch(expected) 2 volumes are created but the third is left in creating state.\r\n\r\n\r\n{code}\r\nVOLUME\tvol-54FA4031\t3\tsnap-C08140E6\tPARTI00\tavailable\t2014-06-20T16:44:55.722Z\tstandard\r\nVOLUME\tvol-52A43BCB\t3\tsnap-C08140E6\tPARTI00\tcreating\t2014-06-20T16:44:55.958Z\tstandard\r\nVOLUME\tvol-DC474342\t3\tsnap-C08140E6\tPARTI00\tavailable\t2014-06-20T16:44:55.843Z\tstandard\r\n{code}\r\n\r\nCLC DB\r\n{code}\r\neucalyptus_cloud=# select metadata_display_name,metadata_state,metadata_state_change_stack from metadata_volumes;\r\n metadata_display_name | metadata_state |                                       metadata_state_change_stack\r\n-----------------------+----------------+----------------------------------------------------------------------------------------------------------\r\n vol-54FA4031          | EXTANT         | com.eucalyptus.system.Threads.currentStackRange(Threads.java:577)                                       +\r\n                       |                | com.eucalyptus.system.Threads.currentStackString(Threads.java:585)                                      +\r\n                       |                | com.eucalyptus.entities.AbstractStatefulPersistent.setState(AbstractStatefulPersistent.java:114)        +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent$1.apply(Volumes.java:296)                         +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent$1.apply(Volumes.java:229)                         +\r\n                       |                | com.eucalyptus.entities.Entities$TransactionalFunction.apply(Entities.java:1169)                        +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.volumeStateUpdate(Volumes.java:326)               +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.update(Volumes.java:215)                          +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.call(Volumes.java:189)                            +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.call(Volumes.java:168)                            +\r\n                       |                | java.util.concurrent.FutureTask.run(FutureTask.java:262)                                                +\r\n                       |                | com.eucalyptus.system.Threads$Queue.run(Threads.java:682)                                               +\r\n                       |                | java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)                                 +\r\n                       |                | java.util.concurrent.FutureTask.run(FutureTask.java:262)                                                +\r\n                       |                | java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)                         +\r\n                       |                | java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\r\n vol-52A43BCB          | GENERATING     | com.eucalyptus.system.Threads.currentStackRange(Threads.java:577)                                       +\r\n                       |                | com.eucalyptus.system.Threads.currentStackString(Threads.java:585)                                      +\r\n                       |                | com.eucalyptus.entities.AbstractStatefulPersistent.setState(AbstractStatefulPersistent.java:114)        +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent$1.apply(Volumes.java:296)                         +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent$1.apply(Volumes.java:229)                         +\r\n                       |                | com.eucalyptus.entities.Entities$TransactionalFunction.apply(Entities.java:1169)                        +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.volumeStateUpdate(Volumes.java:326)               +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.update(Volumes.java:215)                          +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.call(Volumes.java:189)                            +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.call(Volumes.java:168)                            +\r\n                       |                | java.util.concurrent.FutureTask.run(FutureTask.java:262)                                                +\r\n                       |                | com.eucalyptus.system.Threads$Queue.run(Threads.java:682)                                               +\r\n                       |                | java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)                                 +\r\n                       |                | java.util.concurrent.FutureTask.run(FutureTask.java:262)                                                +\r\n                       |                | java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)                         +\r\n                       |                | java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\r\n vol-DC474342          | EXTANT         | com.eucalyptus.system.Threads.currentStackRange(Threads.java:577)                                       +\r\n                       |                | com.eucalyptus.system.Threads.currentStackString(Threads.java:585)                                      +\r\n                       |                | com.eucalyptus.entities.AbstractStatefulPersistent.setState(AbstractStatefulPersistent.java:114)        +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent$1.apply(Volumes.java:296)                         +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent$1.apply(Volumes.java:229)                         +\r\n                       |                | com.eucalyptus.entities.Entities$TransactionalFunction.apply(Entities.java:1169)                        +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.volumeStateUpdate(Volumes.java:326)               +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.update(Volumes.java:215)                          +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.call(Volumes.java:189)                            +\r\n                       |                | com.eucalyptus.blockstorage.Volumes$VolumeUpdateEvent.call(Volumes.java:168)                            +\r\n                       |                | java.util.concurrent.FutureTask.run(FutureTask.java:262)                                                +\r\n                       |                | com.eucalyptus.system.Threads$Queue.run(Threads.java:682)                                               +\r\n                       |                | java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)                                 +\r\n                       |                | java.util.concurrent.FutureTask.run(FutureTask.java:262)                                                +\r\n                       |                | java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)                         +\r\n                       |                | java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\r\n(3 rows)\r\n{code}\r\n\r\nSC DB\r\n{code}\r\neucalyptus_storage=# select * from volumes where status<>'deleted';\r\n                id                |   creation_timestamp    |  last_update_timestamp  |          metadata_perm_uuid          | version |       create_time       | sc_name | size |  snapshot_id  |  status   | volume_user_name | volume_name  | zone\r\n----------------------------------+-------------------------+-------------------------+--------------------------------------+---------+-------------------------+---------+------+---------------+-----------+------------------+--------------+------\r\n 8aef81bd46b0f20a0146ba2aa64c00fa | 2014-06-20 09:44:55.756 | 2014-06-20 09:45:12.17  | af98d319-ce6c-4d69-8b52-943a8d0c4a28 |       1 | 2014-06-20 09:44:55.756 | PARTI00 |    3 | snap-C08140E6 | available |                  | vol-54FA4031 |\r\n 8aef81bd46b0f20a0146ba2aa6bc00fd | 2014-06-20 09:44:55.868 | 2014-06-20 09:45:21.597 | 36c20654-b1af-4cef-97a3-fe9b64b1f508 |       1 | 2014-06-20 09:44:55.868 | PARTI00 |    3 | snap-C08140E6 | available |                  | vol-DC474342 |\r\n(2 rows)\r\n{code}\r\n\r\nTrying to delete the volume (I have deleted the other 2 already)\r\n{code}\r\n[root@c-26 ~]# euca-describe-volumes\r\nVOLUME\tvol-52A43BCB\t3\tsnap-C08140E6\tPARTI00\tcreating\t2014-06-20T16:44:55.958Z\tstandard\r\n[root@c-26 ~]# euca-delete-volume vol-52A43BCB\r\neuca-delete-volume: error (DeleteVolumeType): Delete volume request failed because of: Failed to send message DeleteStorageVolumeType to service StorageInternal because: Component that caused exception is: DefaultJavaComponent{StorageInternal.component}. Message payload is of type: DeleteStorageVolumeType\r\n{code}\r\n\r\n\r\nCloud-output log is filling with same GENERATING status messages (and see the failures where I tried to delete)\r\n{code}\r\n2014-06-20 09:53:04 DEBUG 000000994 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:53:14 DEBUG 000000995 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:53:24 DEBUG 000000996 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:53:34 DEBUG 000000997 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:53:44 DEBUG 000000966 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:53:54 DEBUG 000000967 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:54:04 DEBUG 000000968 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:54:14 DEBUG 000000969 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:54:24 DEBUG 000000970 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:54:34 DEBUG 000000971 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:54:44 DEBUG 000000972 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:54:54 DEBUG 000000973 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:55:04 DEBUG 000000974 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:55:14 DEBUG 000000975 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:55:24 DEBUG 000000976 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:55:34 DEBUG 000000977 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:55:44 DEBUG 000000978 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:55:54 DEBUG 000000979 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:56:04 DEBUG 000000980 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:56:14 DEBUG 000000981 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:56:24 DEBUG 000000982 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:56:34 DEBUG 000000983 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:56:44 DEBUG 000000984 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:56:54 DEBUG 000000985 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:56:59  INFO 000152653 BlockStorageController   | Processing DeleteStorageVolume request for volume vol-52A43BCB\r\n2014-06-20 09:56:59 ERROR 000152653 BlockStorageController   | Error marking volume vol-52A43BCB for deletion: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-52A43BCB scName=PARTI00 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\n2014-06-20 09:57:04 DEBUG 000000986 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:57:14 DEBUG 000000987 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:57:24 DEBUG 000000988 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:57:34 DEBUG 000000989 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:57:44 DEBUG 000000990 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:57:54 DEBUG 000000991 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:58:04 DEBUG 000000992 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:58:14 DEBUG 000000993 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:58:14  INFO 000152757 BlockStorageController   | Processing DeleteStorageVolume request for volume vol-52A43BCB\r\n2014-06-20 09:58:14 ERROR 000152757 BlockStorageController   | Error marking volume vol-52A43BCB for deletion: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-52A43BCB scName=PARTI00 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\n2014-06-20 09:58:24 DEBUG 000000994 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:58:34 DEBUG 000000995 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:58:44 DEBUG 000000996 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:58:47  INFO 000152757 BlockStorageController   | Processing DeleteStorageVolume request for volume vol-52A43BCB\r\n2014-06-20 09:58:47 ERROR 000152757 BlockStorageController   | Error marking volume vol-52A43BCB for deletion: Get unique failed for VolumeInfo using example: [VolumeInfo userName=null volumeId=vol-52A43BCB scName=PARTI00 size=null status=null createTime=null zone=null snapshotId=null attachmentTokens=null id=null version=null creationTimestamp=null lastUpdateTimestamp=null naturalId=null]\r\n2014-06-20 09:58:54 DEBUG 000000997 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:59:04 DEBUG 000000966 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:59:14 DEBUG 000000967 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:59:24 DEBUG 000000968 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:59:34 DEBUG 000000969 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:59:44 DEBUG 000000970 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n2014-06-20 09:59:54 DEBUG 000000971 Volumes                  | VolumeStateUpdate: PARTI00 vol-52A43BCB GENERATING 2014-06-20 09:44:55.958 end-state GENERATING\r\n{code}\r\n\r\nInstalled Packages\r\nName        : eucalyptus\r\nArch        : x86_64\r\nVersion     : 3.4.2\r\nRelease     : 0.0.555.20140617git96293fb1.el6","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2014-06-20T11:54:57.332-0500","updated":"2014-06-20T12:01:27.448-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72744","id":"72744","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"Somewhat related to EUCA-9296. Difference here is that the SAN runs out of space for the operation.  Also worth mentioning ARCH-91 here since that seems relevant to these types of scenarios (check for resources before run instances)","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2014-06-20T13:11:10.549-0500","updated":"2014-06-20T13:11:10.549-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72753","id":"72753","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"body":"I will take a look. I suspect a mismatch between the CLC and SC for handling asynchronous state updates from creating->failed.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-20T15:07:43.331-0500","updated":"2014-06-20T15:07:43.331-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72773","id":"72773","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"body":"Based on conversation with [~tony], he reproduced the failure with batches of instances. I will investigate both multi-instance reservations and single reservations.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-21T13:36:52.690-0500","updated":"2014-06-21T13:36:52.690-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72807","id":"72807","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"body":"I think I have a root cause and a fix. It looks like on capacity issues the SC cleans up 'failed' volumes after sending the Describe response to the CLC, but the CLC never gets the 'failed' state update and then the SC never resends it because it gets cleaned up.\r\n\r\nI have a fix and am doing manual testing now. Will run through QA tomorrow if all goes well.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-23T04:29:16.918-0500","updated":"2014-06-23T05:08:34.477-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72847","id":"72847","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"body":"Found the root cause of the issue:\r\n\r\nIn the SC, when it gets a DescribeStorageVolumes request it populates the request with all volumes, including those in the 'failed' state. However, just before sending the response it runs some cleanup logic (including deleting the volume record) on volumes in the 'failed' state. This does not affect the response itself, but means that the SC will ever only send one response that includes a failed volume state.\r\n\r\nIn ClusterAllocator, the waitForVolume(volId) method calls DescribeStorageVolumes repeatedly outside of the normal volume state update duty cycle (executed in Volumes.java) in order to get the state of the volume quickly. It disregards all results other than the volume that thread is waiting for, which proceed in order of the instance requests.\r\n\r\nThese behaviors combined have the affect of causing the SC to stop reporting 'failed' volumes almost immediately if they are the root volume for an ebs instance. Volumes that fail on ebs-instance creation can then be stuck in 'creating' state for 2 hours until the CLC timeout logic cleans them up.\r\n\r\nThe fix:\r\nIn the SC DescribeStorageVolumes handler, I added a single line to only invoke the cleanup logic if the failed volume record is older than 10 minutes (this can be tuned with groovy later, but didn't want to introduce DB changes in a point release). This allows the CLC to get the updated state during the normal duty cycle and invoke the state updates to correctly mark the state for volume on the CLC.\r\n\r\nWill commit tomorrow.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-24T01:55:28.953-0500","updated":"2014-06-24T01:55:28.953-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72849","id":"72849","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"body":"In maint/3.4/testing branch now.\r\n\r\nCorrectly updates volume states to 'failed' when they fail in creation due to anything (capacity or otherwise). Fixes the issue with the SC doing cleanup too fast. Default time to keep a failed record in SC is now 10 minutes.\r\n\r\nI created a testing proxy for the SC to easily fake capacity of any backend. See this [How-To|https://eucalyptus.atlassian.net/wiki/display/STOR/Using+StorageManagerTestingProxy+to+fake+EBS+device+capacity+constraints] for info. It should make testing this condition very easy.\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-06-24T03:13:37.762-0500","updated":"2014-06-24T03:13:37.762-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/72934","id":"72934","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"Fix Verified.\r\n\r\nManual tested exact scenario using the FakeCapacity proxy as well as an actual full SAN.  Also manual tested ops. EBS stress has been running without any failures for almost 24 hrs and continues to run. I feel confident there are no regressions and this is ready for release.\r\n\r\nInstalled Packages\r\nName        : eucalyptus\r\nArch        : x86_64\r\nVersion     : 3.4.3\r\nRelease     : 0.0.560.20140624git77dcc088.el6","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2014-06-26T11:14:25.089-0500","updated":"2014-06-26T11:14:25.089-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/29454/comment/80135","id":"80135","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lbiasi","name":"lbiasi","key":"lbiasi","accountId":"557058:daaebf52-3713-4e4f-a29b-79f55aed32c9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue"},"displayName":"Leslie Biasi","active":false,"timeZone":"US/Central"},"body":"3.4.3 release 7/11/2014","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lbiasi","name":"lbiasi","key":"lbiasi","accountId":"557058:daaebf52-3713-4e4f-a29b-79f55aed32c9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue"},"displayName":"Leslie Biasi","active":false,"timeZone":"US/Central"},"created":"2014-12-08T16:42:48.476-0600","updated":"2014-12-08T16:42:48.476-0600"}],"maxResults":12,"total":12,"startAt":0},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}