{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"34390","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/34390","key":"EUCA-10444","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/7","id":"7","description":"A user story. Created by JIRA Software - do not edit or delete.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14815&avatarType=issuetype","name":"Story","subtask":false,"avatarId":14815},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"customfield_11001":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14801","id":"14801","description":"Eucalyptus 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2015-10-22"}],"aggregatetimespent":null,"customfield_10310":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/7","id":"7","description":"Signifies completion of tasks, info requests, etc.","name":"Completed"},"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"customfield_10311":null,"customfield_11400":null,"customfield_12800":null,"customfield_10104":["com.atlassian.greenhopper.service.sprint.Sprint@32cf7b15[id=111,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 3,goal=<null>,startDate=2015-04-10T01:30:24.326Z,endDate=2015-04-30T01:30:00.000Z,completeDate=2015-05-01T16:00:21.046Z,sequence=111]"],"customfield_10303":null,"customfield_10105":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":null,"customfield_10703":null,"customfield_10704":null,"resolutiondate":"2015-10-26T16:24:06.476-0500","customfield_10308":null,"customfield_10705":null,"customfield_10309":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10444/watchers","watchCount":3,"isWatching":false},"lastViewed":null,"created":"2015-01-21T16:57:05.223-0600","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12201":null,"customfield_12600":"{repository={count=1, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":1,\"lastUpdated\":\"2015-04-10T21:59:13.000-0500\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":1,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10102":null,"labels":[],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[],"customfield_11901":null,"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"updated":"2016-06-06T16:24:35.009-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"As a cloud administrator I would like a \"global\" STS service so I can use temporary credentials across my federated clouds.\r\n\r\nAcceptance criteria:\r\nGiven temporary credentials obtained from the \"home\" cloud and service endpoints for each region, when I consume services in those regions via the supplied endpoints using the temporary credentials then service access succeeds or fails according to the applicable policies.","customfield_13000":null,"customfield_13200":null,"customfield_11300":"EUCA-10334","customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"IAMGLOB : Global STS service","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"customfield_12100":"0|i032if:","customfield_10000":"3_*:*_1_*:*_197560359_*|*_10000_*:*_1_*:*_448077_*|*_10001_*:*_1_*:*_6826676932_*|*_10003_*:*_1_*:*_6519512484_*|*_10006_*:*_1_*:*_0","aggregateprogress":{"progress":0,"total":0},"customfield_10001":"2015-06-27T12:13:43.068-0500","customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_10004":8.0,"customfield_12500":null,"customfield_10116":null,"customfield_11600":["hspencer(hspencer)","lbiasi(lbiasi)","sjones(sjones)"],"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/34390/comment/85016","id":"85016","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"STS session, role and impersonation tokens now support region federation.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-04-13T01:15:10.586-0500","updated":"2015-04-13T01:15:10.586-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/34390/comment/88471","id":"88471","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"Confirmed issue has been fixed with the use case of a cross-account role accessing OSG buckets on each region.\r\n\r\nEucalyptus Version: {{4.2.0-0.0.23586.540.20150623git1ad8a4a.el6}}\r\n\r\n*Steps*\r\n\r\n# Set up federated cloud (4 regions; 2 multi-cluster, 2 single cluster)\r\n{code}\r\n# euca-describe-regions\r\nREGION\tace-hood\thttp://compute.g-19-05.autoqa.qa1.eucalyptus-systems.com:8773/\r\nREGION\tbig-krit\thttp://compute.d-34.autoqa.qa1.eucalyptus-systems.com:8773/\r\nREGION\tbob\thttp://compute.g-05-06.autoqa.qa1.eucalyptus-systems.com:8773/\r\nREGION\tghostface-killah\thttp://compute.g-12-10.autoqa.qa1.eucalyptus-systems.com:8773/\r\n{code}\r\n#* [region big-krit|http://jenkins.qa1.eucalyptus-systems.com/job/Quick%20Launch%20Master/466/]\r\n#* [region ghostface-killah|http://jenkins.qa1.eucalyptus-systems.com/job/Quick%20Launch%20Master/465/]\r\n#* [region bob|http://jenkins.qa1.eucalyptus-systems.com/job/Quick%20Launch%20Master/464/]\r\n#* [region ace-hood|http://jenkins.qa1.eucalyptus-systems.com/job/Quick%20Launch%20Master/463/]\r\n# On ace-hood region, downloaded cloud admin (eucalyptus/admin) credentials, then created 'development-operations' and 'engineering' accounts:\r\n{code}\r\n# euare-accountcreate -a development-operations\r\ndevelopment-operations\t001310814050\r\n# euare-accountcreate -a engineering\r\nengineering\t001629234344\r\n{code}\r\n# Downloaded credentials creds for development-operations/admin and engineering/admin user, and placed them in corresponding directories.\r\n# Sourced engineering/admin user, and created a non-admin user:\r\n{code}\r\n# euare-usercreate -k -u method-man\r\nAKIABLFFYTAN6K3NEHDG\r\nAYohbGNkjyF3MSO8oH7cq4kyX7sSWyN4BTJHUEmv\r\n{code}\r\n# Sourced development-operations/admin creds, created the following trust policy, then created a role using the trust policy:\r\n{code}\r\n# cat trust-policy-devops-eng.json\r\n{\r\n \"Version\": \"2012-10-17\",\r\n \"Statement\": [{\r\n \"Effect\": \"Allow\",\r\n \"Principal\": {\"AWS\": \"arn:aws:iam::001629234344:user/method-man\"},\r\n \"Action\": \"sts:AssumeRole\"\r\n }]\r\n}\r\n\r\n# euare-rolecreate --role-name engineering-s3-access -f trust-policy-devops-eng.json\r\n# euare-rolelistbypath\r\narn:aws:iam::001310814050:role/engineering-s3-access\r\n{code}\r\n# Created an IAM access policy for OSG, and attached it to the 'engineering-s3-access' role:\r\n{code}\r\n# cat s3-devops-role-access.json\r\n{\r\n  \"Version\": \"2012-10-17\",\r\n  \"Statement\": [\r\n    {\r\n      \"Sid\": \"s3-access\",\r\n      \"Action\": \"s3:*\",\r\n      \"Effect\": \"Allow\",\r\n      \"Resource\": \"arn:aws:s3:::*\",\r\n      \"Resource\": \"arn:aws:s3:::*/*\"\r\n    }\r\n  ]\r\n}\r\n\r\n# euare-roleuploadpolicy --role-name engineering-s3-access --policy-name s3-access --policy-document s3-devops-role-access.json\r\n# euare-rolelistpolicies --role-name engineering-s3-access -v\r\ns3-access\r\n{\r\n  \"Version\": \"2012-10-17\",\r\n  \"Statement\": [\r\n    {\r\n      \"Sid\": \"s3-access\",\r\n      \"Action\": \"s3:*\",\r\n      \"Effect\": \"Allow\",\r\n      \"Resource\": \"arn:aws:s3:::*\",\r\n      \"Resource\": \"arn:aws:s3:::*/*\"\r\n    }\r\n  ]\r\n}\r\n\r\nIsTruncated: false\r\n{code}\r\n# Sourced engineering/admin creds, created 'web-admins' group, added 'method-man' user to group:\r\n{code}\r\n# euare-userlistbypath\r\narn:aws:iam::001629234344:user/admin\r\narn:aws:iam::001629234344:user/method-man\r\n# euare-groupcreate -g web-admins\r\n# euare-groupadduser -g web-admins -u method-man\r\n# euare-grouplistbypath\r\ngroups\r\n   arn:aws:iam::001629234344:group/web-admins\r\n{code}\r\n# Created IAM access for 'web-admins' members to assume 'engineering-s3-access' role, then attached it to 'web-admins' group:\r\n{code}\r\n# cat eng-weblogs-devops-s3-role.json\r\n{\r\n \"Statement\": [\r\n {\r\n \"Sid\": \"Stmt1417531456446\",\r\n \"Action\": [\r\n \"sts:AssumeRole\"\r\n ],\r\n \"Effect\": \"Allow\",\r\n \"Resource\": \"arn:aws:iam::001310814050:role/engineering-s3-access\"\r\n }\r\n ]\r\n}\r\n# euare-groupuploadpolicy --policy-name devops-eng-role-s3-access -g web-admins --policy-document eng-weblogs-devops-s3-role.json\r\n# euare-grouplistpolicies -g web-admins -v\r\ndevops-eng-role-s3-access\r\n{\r\n \"Statement\": [\r\n {\r\n \"Sid\": \"Stmt1417531456446\",\r\n \"Action\": [\r\n \"sts:AssumeRole\"\r\n ],\r\n \"Effect\": \"Allow\",\r\n \"Resource\": \"arn:aws:iam::001310814050:role/engineering-s3-access\"\r\n }\r\n ]\r\n}\r\n{code}\r\n# Sourced development-operations/admin creds\r\n# Did a clone of s3cmd repository from Github\r\n{code}\r\n# git clone https://github.com/s3tools/s3cmd.git\r\n{code}\r\n# Created configuration file for s3cfg\r\n{code}\r\n# ./s3cmd/s3cmd --configure\r\n\r\nEnter new values or accept defaults in brackets with Enter.\r\nRefer to user manual for detailed description of all options.\r\n\r\nAccess key and Secret key are your identifiers for Amazon S3. Leave them empty for using the env variables.\r\nAccess Key [AKIAB7EQYNDJSARHDMFT]:\r\nSecret Key [HFFHt7cDV3x3i0AUCLXTRK5VTSPwZWbGtBmHFrbS]:\r\nDefault Region [US]:\r\n\r\nEncryption password is used to protect your files from reading\r\nby unauthorized persons while in transfer to S3\r\nEncryption password:\r\nPath to GPG program [/usr/bin/gpg]:\r\n\r\nWhen using secure HTTPS protocol all communication with Amazon S3\r\n[default]\r\nservers is protected from 3rd party eavesdropping. This method is\r\ncloudfront_host = cloudfront.amazonaws.com\r\nslower than plain HTTP, and can only be proxied with Python 2.7 or newer\r\n[default]\r\nUse HTTPS protocol [No]:\r\n[default]\r\n\r\n[default]\r\nOn some networks all internet access must go through a HTTP proxy.\r\nTry setting it here if you can't connect to S3 directly\r\nHTTP Proxy server name:\r\n\r\nNew settings:\r\n  Access Key: AKIAB7EQYNDJSARHDMFT\r\n  Secret Key: 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\r\n  Default Region: US\r\n  Encryption password:\r\n  Path to GPG program: /usr/bin/gpg\r\n  Use HTTPS protocol: False\r\n  HTTP Proxy server name:\r\n  HTTP Proxy server port: 0\r\n\r\nTest access with supplied credentials? [Y/n] n\r\n\r\nSave settings? [y/N] y\r\nConfiguration saved to '/root/.s3cfg'\r\n{code}\r\n# Made copies of s3cmd configuration file for each region, and updated {{host_base}} and {{host_bucket}} to point to associated region:\r\n{code}\r\n# mv .s3cfg .s3cfg-devops-ace-hood\r\n# cp .s3cfg-devops-ace-hood .s3cfg-devops-big-krit\r\n# cp .s3cfg-devops-ace-hood .s3cfg-devops-bob\r\n# cp .s3cfg-devops-ace-hood .s3cfg-devops-ghostface-killah\r\n{code}\r\n# Created buckets on a couple of regions, and listed bucket created for each region:\r\n{code}\r\n# ./s3cmd/s3cmd --config=.s3cfg-devops-ghostface-killah --signature-v2 ls\r\n2015-06-26 03:51  s3://redis-logs\r\n# ./s3cmd/s3cmd --config=.s3cfg-devops-bob --signature-v2 ls\r\n2015-06-26 02:11  s3://apache-logs\r\n# ./s3cmd/s3cmd --config=.s3cfg-devops-big-krit --signature-v2 ls\r\n2015-06-26 03:49  s3://mongodb-logs\r\n# ./s3cmd/s3cmd --config=.s3cfg-devops-ace-hood --signature-v2 ls\r\n2015-06-26 02:10  s3://nginx-logs\r\n{code}\r\n# Installed ipython, python-pip\r\n# Used pip to make sure the latest version of boto was installed\r\n{code}\r\n# pip install --upgrade boto\r\nRequirement already up-to-date: boto in /usr/lib/python2.6/site-packages\r\nCleaning up...\r\n# pip list boto | grep boto\r\nboto (2.38.0)\r\n{code}\r\n# Started ipython session, then used native region (ace-hood) to confirm cross-account role allowed listing of buckets across all regions:\r\n{code}\r\n# ipython\r\nPython 2.6.6 (r266:84292, Jan 22 2014, 09:42:36)\r\nType \"copyright\", \"credits\" or \"license\" for more information.\r\n\r\nIPython 0.13.2 -- An enhanced Interactive Python.\r\n?         -> Introduction and overview of IPython's features.\r\n%quickref -> Quick reference.\r\nhelp      -> Python's own help system.\r\nobject?   -> Details about 'object', use 'object??' for extra details.\r\n\r\nIn [1]: import boto\r\n\r\nIn [2]: from boto.sts import STSConnection\r\n\r\nIn [3]: from boto.s3.connection import S3Connection\r\n\r\nIn [4]: from boto.s3.connection import OrdinaryCallingFormat\r\n\r\nIn [5]: STSConnection.DefaultRegionEndpoint = 'tokens.g-19-05.autoqa.qa1.eucalyptus-systems.com'\r\n\r\nIn [6]: sts_connection = STSConnection(aws_access_key_id=\"AKIABLFFYTAN6K3NEHDG\", aws_secret_access_key=\"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\", is_secure=False, port=\"8773\")\r\n\r\nIn [7]: assumedRoleObject = sts_connection.assume_role(role_arn=\"arn:aws:iam::001310814050:role/engineering-s3-access\", role_session_name=\"eng-method-man-s3-access\")\r\n\r\nIn [8]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-19-05.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [9]: s3.get_all_buckets()\r\nOut[9]: [<Bucket: nginx-logs>]\r\n\r\nIn [10]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.d-34.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [11]: s3.get_all_buckets()\r\nOut[11]: [<Bucket: mongodb-logs>]\r\n\r\nIn [12]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-05-06.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [13]: s3.get_all_buckets()\r\nOut[13]: [<Bucket: apache-logs>]\r\n\r\nIn [14]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-12-10.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [15]: s3.get_all_buckets()\r\nOut[15]: [<Bucket: redis-logs>]\r\n{code}\r\n# Once that was confirmed, repeated the test across the each region (i.e. grabbing STS creds, then listing buckets for each region):\r\n{code}\r\n# ipython\r\nPython 2.6.6 (r266:84292, Jan 22 2014, 09:42:36)\r\nType \"copyright\", \"credits\" or \"license\" for more information.\r\n\r\nIPython 0.13.2 -- An enhanced Interactive Python.\r\n?         -> Introduction and overview of IPython's features.\r\n%quickref -> Quick reference.\r\nhelp      -> Python's own help system.\r\nobject?   -> Details about 'object', use 'object??' for extra details.\r\n\r\nIn [1]: import boto\r\n\r\nIn [2]: from boto.sts import STSConnection\r\n\r\nIn [3]: from boto.s3.connection import S3Connection\r\n\r\nIn [4]: from boto.s3.connection import OrdinaryCallingFormat\r\n\r\nIn [5]: STSConnection.DefaultRegionEndpoint = 'tokens.d-34.autoqa.qa1.eucalyptus-systems.com'\r\n\r\nIn [6]: sts_connection = STSConnection(aws_access_key_id=\"AKIABLFFYTAN6K3NEHDG\", aws_secret_access_key=\"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\", is_secure=False, port=\"8773\")\r\n\r\nIn [7]: assumedRoleObject = sts_connection.assume_role(role_arn=\"arn:aws:iam::001310814050:role/engineering-s3-access\", role_session_name=\"eng-method-man-s3-access\")\r\n\r\nIn [8]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-19-05.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [9]: s3.get_all_buckets()\r\nOut[9]: [<Bucket: nginx-logs>]\r\n\r\nIn [10]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.d-34.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [11]: s3.get_all_buckets()\r\nOut[11]: [<Bucket: mongodb-logs>]\r\n\r\nIn [12]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-05-06.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [13]: s3.get_all_buckets()\r\nOut[13]: [<Bucket: apache-logs>]\r\n\r\nIn [14]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-12-10.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [15]: s3.get_all_buckets()\r\nOut[15]: [<Bucket: redis-logs>]\r\n\r\nIn [16]: STSConnection.DefaultRegionEndpoint = 'tokens.g-05-06.autoqa.qa1.eucalyptus-systems.com'\r\n\r\nIn [17]: sts_connection = STSConnection(aws_access_key_id=\"AKIABLFFYTAN6K3NEHDG\", aws_secret_access_key=\"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\", is_secure=False, port=\"8773\")\r\n\r\nIn [18]: assumedRoleObject = sts_connection.assume_role(role_arn=\"arn:aws:iam::001310814050:role/engineering-s3-access\", role_session_name=\"eng-method-man-s3-access\")\r\nIn [19]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-19-05.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [20]: s3.get_all_buckets()\r\nOut[20]: [<Bucket: nginx-logs>]\r\n\r\nIn [21]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.d-34.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [22]: s3.get_all_buckets()\r\nOut[22]: [<Bucket: mongodb-logs>]\r\n\r\nIn [23]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-05-06.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [24]: s3.get_all_buckets()\r\nOut[24]: [<Bucket: apache-logs>]\r\n\r\nIn [25]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-12-10.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [26]: s3.get_all_buckets()\r\nOut[26]: [<Bucket: redis-logs>]\r\n\r\nIn [27]: STSConnection.DefaultRegionEndpoint = 'tokens.g-12-10.autoqa.qa1.eucalyptus-systems.com'\r\n\r\nIn [28]: sts_connection = STSConnection(aws_access_key_id=\"AKIABLFFYTAN6K3NEHDG\", aws_secret_access_key=\"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\", is_secure=False, port=\"8773\")\r\n\r\nIn [29]: assumedRoleObject = sts_connection.assume_role(role_arn=\"arn:aws:iam::001310814050:role/engineering-s3-access\", role_session_name=\"eng-method-man-s3-access\")\r\nIn [30]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-19-05.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [31]: s3.get_all_buckets()\r\nOut[31]: [<Bucket: nginx-logs>]\r\n\r\nIn [32]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.d-34.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [33]: s3.get_all_buckets()\r\nOut[33]: [<Bucket: mongodb-logs>]\r\n\r\nIn [34]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-05-06.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [35]: s3.get_all_buckets()\r\nOut[35]: [<Bucket: apache-logs>]\r\n\r\nIn [36]: s3 = S3Connection(aws_access_key_id=assumedRoleObject.credentials.access_key, aws_secret_access_key=assumedRoleObject.credentials.secret_key, security_token=assumedRoleObject.credentials.session_token, host='objectstorage.g-12-10.autoqa.qa1.eucalyptus-systems.com', is_secure=False, port=8773, calling_format=OrdinaryCallingFormat())\r\n\r\nIn [37]: s3.get_all_buckets()\r\nOut[37]: [<Bucket: redis-logs>]\r\n\r\nIn [38]: quit()\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-06-27T12:13:43.068-0500","updated":"2015-06-27T12:13:43.068-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/34390/comment/94720","id":"94720","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lbiasi","name":"lbiasi","key":"lbiasi","accountId":"557058:daaebf52-3713-4e4f-a29b-79f55aed32c9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue"},"displayName":"Leslie Biasi","active":false,"timeZone":"US/Central"},"body":"Released in 4.2","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lbiasi","name":"lbiasi","key":"lbiasi","accountId":"557058:daaebf52-3713-4e4f-a29b-79f55aed32c9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue"},"displayName":"Leslie Biasi","active":false,"timeZone":"US/Central"},"created":"2015-10-26T16:24:06.482-0500","updated":"2015-10-26T16:24:06.482-0500"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10444/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}