{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"40519","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/40519","key":"EUCA-11912","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":null,"resolution":null,"customfield_10311":null,"customfield_11401":null,"customfield_11400":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10104":[],"customfield_10302":null,"customfield_10303":null,"customfield_10105":null,"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10202","value":"Low","id":"10202"},"customfield_10703":null,"resolutiondate":null,"customfield_10308":null,"customfield_10704":null,"customfield_10309":null,"customfield_10705":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-11912/watchers","watchCount":2,"isWatching":false},"created":"2016-01-20T11:29:54.358-0600","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/4","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"customfield_12201":null,"customfield_10102":null,"customfield_10300":null,"customfield_12600":"{}","customfield_10301":null,"labels":[],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/15501","id":"15501","description":"Eucalyptus 4.1.2","name":"4.1.2","archived":false,"released":true,"releaseDate":"2015-07-30"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/16401","id":"16401","description":"Eucalyptus 4.2.1","name":"4.2.1","archived":false,"released":true,"releaseDate":"2015-12-07"}],"customfield_11901":null,"issuelinks":[],"assignee":null,"updated":"2016-01-25T12:09:02.393-0600","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10001","description":"This issue has been validated/reproduced, but has not been prioritized yet.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Confirmed","id":"10001","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10010","id":"10010","name":"Node Controller"}],"timeoriginalestimate":null,"description":"User is seeing the following error in the Node Controller logs (nc.log):\r\n{code}\r\n2016-01-15 03:22:45 WARN 000049287 init | MAX_MEM value is set to 230000MB that is greater than the amount of physical memory: -256MB\r\n{code}\r\n\r\nThere are two errors in this code, one is the reporting of the physical memory. The second is that the memory modification done in handlers_kvm.c is never applied (It saves 256MB for the host).\r\n\r\nFrom handlers.c:\r\n{code}\r\n    // now that hypervisor-specific initializers have discovered mem_max and cores_max,\r\n    // adjust the values based on configuration parameters, if any\r\n    if (nc_state.config_max_mem) {\r\n        if (nc_state.config_max_mem > nc_state.mem_max)\r\n            LOGWARN(\"MAX_MEM value is set to %lldMB that is greater than the amount of physical memory: %lldMB\\n\", nc_state.config_max_mem, nc_state.mem_max);\r\n        nc_state.mem_max = nc_state.config_max_mem;\r\n    } else {\r\n        nc_state.mem_max = nc_state.phy_max_mem;\r\n    }\r\n{code}\r\n\r\nbefore the above code is executed the handlers_kvm::doInitialize() method is called and this snippet of code is run:\r\n{code}\r\n    GET_VALUE(\"total_memory\", nc->phy_max_mem);\r\n    EUCA_FREE(s);\r\n\r\n    // we leave 256M to the host\r\n    nc->mem_max -= 256;\r\n{code}\r\n\r\nThis is where the mem_max == -256 is coming from. \r\n\r\nThe code should look like the following, to get the original intent of the code:\r\n\r\n{code}\r\nhandlers_kvm.c\r\n320    GET_VALUE(\"total_memory\", nc->phy_max_mem);\r\n321    EUCA_FREE(s);\r\n322\r\n323    // we leave 256M to the host\r\n324    nc->phy_max_mem -= 256;\r\n\r\nhandlers.c:\r\n2499    // now that hypervisor-specific initializers have discovered phy_max_mem and cores_max,\r\n2500    // adjust the values based on configuration parameters, if any\r\n2501    if (nc_state.config_max_mem) {\r\n2502        if (nc_state.config_max_mem > nc_state.phy_max_mem)\r\n2503            LOGWARN(\"MAX_MEM value is set to %lldMB that is greater than the amount of physical memory: %lldMB\\n\", nc_state.config_max_mem, nc_state.phy_max_mem);\r\n2504        nc_state.mem_max = nc_state.config_max_mem;\r\n2505    } else {\r\n2506        nc_state.mem_max = nc_state.phy_max_mem;\r\n2507    }\r\n\r\n{code}\r\n\r\nPriority is set to Minor as it is a mostly cosmetic defect and the MAX_MEM setting does get applied. ","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[],"summary":"Incorrect physical memory warning on the NC when setting a MAX_MEM value","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":null,"customfield_12100":"0|i03l5z:","customfield_10001":null,"customfield_10002":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10000","value":"Customer Affecting","id":"10000"}],"customfield_10200":null,"customfield_10003":null,"customfield_12500":null,"customfield_10400":null,"customfield_11600":["sgraham(sgraham)"],"customfield_10116":null,"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"progress":{"progress":0,"total":0},"customfield_11806":null,"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-11912/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}