{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"54806","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806","key":"EUCA-13233","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"customfield_11001":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18601","id":"18601","description":"Eucalyptus 4.4.1","name":"4.4.1","archived":false,"released":true,"releaseDate":"2017-05-09"}],"aggregatetimespent":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/12601","value":"CentOS 7","id":"12601"}],"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/12401","value":"VPC-MIDO","id":"12401"}],"customfield_11400":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10302":null,"customfield_10104":["com.atlassian.greenhopper.service.sprint.Sprint@285c8069[id=148,rapidViewId=118,state=CLOSED,name=5.0 Sprint 1,goal=,startDate=2017-03-16T04:00:04.312Z,endDate=2017-04-06T04:00:00.000Z,completeDate=2017-04-07T18:58:06.909Z,sequence=148]"],"customfield_10105":null,"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"resolutiondate":"2017-04-20T14:52:27.942-0500","customfield_10704":null,"customfield_10308":null,"customfield_10705":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13233/watchers","watchCount":6,"isWatching":false},"created":"2017-02-14T15:45:37.625-0600","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12400":null,"customfield_12201":null,"customfield_10300":null,"customfield_12600":"{repository={count=1, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":1,\"lastUpdated\":\"2017-03-31T18:58:56.000-0500\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":1,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10102":null,"labels":["CustomerAffecting","NeedsKnownIssue"],"customfield_10301":null,"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18100","id":"18100","description":"Eucalyptus 4.4.0","name":"4.4.0","archived":false,"released":true,"releaseDate":"2017-03-07"}],"issuelinks":[{"id":"49104","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/49104","type":{"id":"10600","name":"Bonfire Testing","inward":"discovered while testing","outward":"testing discovered","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10600"},"inwardIssue":{"id":"48808","key":"EUCA-12779","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/48808","fields":{"summary":"ELB: takes too long for instance to be InService ","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"updated":"2017-04-20T14:52:59.862-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10006","description":"A fix has been committed, and will be part of the next release","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Release Pending","id":"10006","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11500","id":"11500","name":"ELB","description":"Load Balancing"}],"timeoriginalestimate":null,"customfield_13000":null,"description":"*Assessment*\r\n\r\nWhile verifying EUCA-12779, it was noticed that when the ELB had 1 out of 3 back-end instances registered with an {{InService}} state, any query against the ELB returned a 503. Eventually, a 200 code was returned:\r\n{code}\r\n[root@h-04 ~]# euform-describe-stacks --region devops-admin@\r\nSTACK\tEUCA12779Stack\tCREATE_COMPLETE\t\tCloudFormation template to deploy an instance and a 3 availability zone ELB, Nginx deployment on Eucalyptus VPC cloud\t2017-02-14T18:54:21.619Z\r\nPARAMETER\tImageId\t\temi-63ef779d\r\nPARAMETER\tKeyName\t\tdevops-admin\r\nPARAMETER\tEndPoint\t\thttp://cloudformation.e-32.autoqa.qa1.eucalyptus-systems.com:8773/\r\nPARAMETER\tInstanceType\t\tm1.medium\r\nPARAMETER\tMinSize\t\t3\r\nPARAMETER\tMaxSize\t\t6\r\nOUTPUT\tInstanceId\ti-61c22b22\r\nOUTPUT\tElasticIP\t10.116.152.80\r\nOUTPUT\tAllocationID\teipalloc-26c21e26\r\nOUTPUT\tNetworkInterfaceId\teni-b36e2132\r\nOUTPUT\tEIPAssociationId\teipassoc-d7a00541\r\nOUTPUT\tAccessLogBucket\teuca12779stack-s3loggingbucket-tmrw0xsa26rcp\r\nOUTPUT\tELBURL\thttp://EUCA12779-NginxELB-CTX1C5AMLUG9K-000727120439.lb.e-32.autoqa.qa1.eucalyptus-systems.com\r\n[root@h-04 ~]# eulb-describe-lbs --region devops-admin@\r\nLOAD_BALANCER\tEUCA12779-NginxELB-CTX1C5AMLUG9K\tEUCA12779-NginxELB-CTX1C5AMLUG9K-000727120439.lb.e-32.autoqa.qa1.eucalyptus-systems.com\t2017-02-14T18:54:32.700Z\tinternet-facing\r\n[root@h-04 ~]# eulb-describe-instance-health EUCA12779-NginxELB-CTX1C5AMLUG9K --region devops-admin@\r\nINSTANCE\ti-6aaebf28\tOutOfService\r\nINSTANCE\ti-a8a39e87\tOutOfService\r\nINSTANCE\ti-6125e4a4\tInService\r\n[root@h-04 ~]# curl -I http://EUCA12779-NginxELB-CTX1C5AMLUG9K-000727120439.lb.e-32.autoqa.qa1.eucalyptus-systems.com\r\nHTTP/1.1 503 Service Unavailable\r\nContent-Length: 0\r\nConnection: close\r\n[root@h-04 ~]# curl -I http://EUCA12779-NginxELB-CTX1C5AMLUG9K-000727120439.lb.e-32.autoqa.qa1.eucalyptus-systems.com\r\nHTTP/1.1 503 Service Unavailable\r\nContent-Length: 0\r\nConnection: close\r\n[root@h-04 ~]# curl -I http://EUCA12779-NginxELB-CTX1C5AMLUG9K-000727120439.lb.e-32.autoqa.qa1.eucalyptus-systems.com\r\nHTTP/1.1 503 Service Unavailable\r\nContent-Length: 0\r\nConnection: close\r\n[root@h-04 ~]# curl -I http://EUCA12779-NginxELB-CTX1C5AMLUG9K-000727120439.lb.e-32.autoqa.qa1.eucalyptus-systems.com\r\nHTTP/1.1 503 Service Unavailable\r\nContent-Length: 0\r\nConnection: close\r\n[root@h-04 ~]# curl -I http://EUCA12779-NginxELB-CTX1C5AMLUG9K-000727120439.lb.e-32.autoqa.qa1.eucalyptus-systems.com\r\nHTTP/1.1 200 OK\r\nServer: nginx/1.10.0 (Ubuntu)\r\nDate: Tue, 14 Feb 2017 18:57:42 GMT\r\nContent-Type: text/html\r\nContent-Length: 424469\r\nLast-Modified: Tue, 14 Feb 2017 18:56:32 GMT\r\nETag: \"58a352e0-67a15\"\r\nAccept-Ranges: bytes\r\n\r\n{code}\r\n\r\n*Steps*\r\n\r\n# Set up Eucalyptus VPC cloud with multiple availability zones - [hspencer-400-maint-4.4|http://jenkins.qa1.eucalyptus-systems.com/job/Quick%20Launch%20Maint_4.4/400/]\r\n# Using linked {{cfn-elb-multiaz-accesslog-cloudwatch-instance-vpc.json}} template, create stack\r\n# After stack reaches {{CREATE_COMPLETE}}, list the instance health of the ELB. Once one of the instances reaches {{InService}}, query the ELB DNS URL.","customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/39304","id":"39304","filename":"cfn-elb-multiaz-accesslog-cloudwatch-instance-vpc.json","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-14T15:45:31.199-0600","size":22001,"mimeType":"application/json","content":"https://eucalyptus.atlassian.net/secure/attachment/39304/cfn-elb-multiaz-accesslog-cloudwatch-instance-vpc.json"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/42002","id":"42002","filename":"cfn-elb-twoaz-accesslog-cloudwatch-instance-vpc.json","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-18T22:06:18.918-0500","size":20423,"mimeType":"application/json","content":"https://eucalyptus.atlassian.net/secure/attachment/42002/cfn-elb-twoaz-accesslog-cloudwatch-instance-vpc.json"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/42012","id":"42012","filename":"EUCA13233-curl-test.txt","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-20T14:52:59.553-0500","size":156177,"mimeType":"text/plain","content":"https://eucalyptus.atlassian.net/secure/attachment/42012/EUCA13233-curl-test.txt"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/42001","id":"42001","filename":"EUCA13233-curl-test.txt","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-18T21:57:06.398-0500","size":514020,"mimeType":"text/plain","content":"https://eucalyptus.atlassian.net/secure/attachment/42001/EUCA13233-curl-test.txt"}],"summary":"Multi-AZ ELB returns 503 when one out of three backend instances are in 'InService' state","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_12100":"0|i043o3:","customfield_10000":"3_*:*_1_*:*_500401_*|*_10000_*:*_1_*:*_2196321_*|*_10001_*:*_1_*:*_3893890499_*|*_10003_*:*_1_*:*_1712623150_*|*_10006_*:*_1_*:*_0","customfield_10001":"2017-02-14T16:22:13.943-0600","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["dmitrii(dmitrii)","hspencer(hspencer)","spark(spark)","tony(tony)"],"customfield_10116":null,"customfield_10117":null,"environment":"Eucalyptus VPC with multiple availability zones","customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/117621","id":"117621","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"body":"Please, investigate the scope of this problem, [~spark]. Do not pursue a fix unless it is something trivial. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"created":"2017-02-14T16:22:13.943-0600","updated":"2017-02-14T16:22:13.943-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/117626","id":"117626","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"body":"The issue filed here is not very critical, but it is actually related to a more critical issue.\r\n\r\nThe issue is that there are some enabled AZs where there is no registered instances. If cross-zone loadbalancing is turned on (in the test above), eventually all loadbalancers will forward traffics to backend instances and continue to return 200. It takes up to 1 minute until loadbalancers settle.\r\n\r\nThe critical issue is when cross-zone loadbalancing is turned off (default). DNS resolver's response includes haproxy where there is no backend instances registered with it and it returns 503. The fix should be either:\r\n1) include ELB VMs in DNS response only if there are backend instances registered with the AZ, or cross-zone LB is turned on. This fix is easy.\r\n\r\n2) Haproxy in the AZ where there is no registered backend instances should forward traffics to instances in other AZ even if cross-zone AZ is not turned on. A quick test on AWS seems to indicate that this is their implementation.\r\n\r\nI think it is easy and safe to do 1) in 4.4. \r\n[~dmitrii] [~tony] Let me know if you want to include the fix for 4.4. I'll get the fix ready by tomorrow.\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"created":"2017-02-14T19:30:26.219-0600","updated":"2017-02-14T19:30:26.219-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/117660","id":"117660","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"[~spark], does #1 have any impact on EUCA-13236? (could we kill 2 birds with 1 stone)","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2017-02-15T13:16:43.266-0600","updated":"2017-02-15T13:17:04.994-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/117662","id":"117662","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"body":"[~tony] EUCA-13236 is not a bug. It's the expected behavior and not related to this one.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"created":"2017-02-15T13:42:18.201-0600","updated":"2017-02-15T13:42:18.201-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/117664","id":"117664","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"[~spark] and [~dmitrii],\r\n\r\nDo both solutions result in the same behavior? I think ultimately we should have the same behavior as AWS. If the second option gets us AWS behavior then I would push for us to punt this from 4.4.0 and do that fix in 4.4.1. I would hate to do rushed work and vetting of a fix for 4.4.0 then have more work on the same issue in 4.4.1 to deliver the complete solution.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2017-02-15T14:26:32.062-0600","updated":"2017-02-15T14:26:32.062-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/117665","id":"117665","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"body":"Actually there is an issue with approach #1 in single AZ situation. So I agree w/ [~tony]. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"created":"2017-02-15T14:31:25.287-0600","updated":"2017-02-15T14:31:25.287-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/120112","id":"120112","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"body":"[~hspencer] Would you be willing to test the change? The fix was pushed to maint-4.4.\r\nAfter the fix, the expected behavior in both cross-zone LB and non cross-zone:\r\n\r\n1) When an instance is deregistered and the zone has no available instance, the loadbalancer should continue 200 response.\r\n\r\n2) When an instance goes OutOfService (i.e., web server dies, etc), the loadbalancer will temporarily return 503, but eventually return 200 (can take up to 60 seconds).\r\n\r\nAlso it would be great if you can run through comprehensive ELB test, as the change touches the critical path of all ELB functionality (I did my self, but to make sure....)","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"created":"2017-03-31T19:08:44.817-0500","updated":"2017-03-31T19:08:44.817-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/120873","id":"120873","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"[~spark], while confirming the fix, I didn't get the behavior you mentioned in scenario #2.  Correct me if I am wrong, but my ELB had a health check interval of 90 seconds with an unhealthy count of 7 (around 10.5 minutes).  When the instance goes into \"OutOfService\", then I should see in my curl tests the 503 HTTP responses end around 11.5 minutes.  In my testing, I saw 503 HTTP responses for 26 minutes. Steps I followed are below:\r\n\r\n*Eucalyptus Version*\r\n\r\n{{4.4.0-0.25876.33.20170412git5f0e510.el7}}\r\n\r\n*Steps*\r\n\r\n# Deploy Eucalyptus 4.4 VPC cloud with multiple AZs - [hspencer-672-maint-4.4|http://jenkins.qa1.eucalyptus-systems.com/job/Quick%20Launch%20Maint_4.4/672/]\r\n# Create non-eucalyptus account (e.g. {{development-operations}})\r\n{code}\r\n[root@a-16-l ~]# euare-accountcreate -a development-operations -w > .euca/devops-admin.ini\r\n{code}\r\n# Create and import keypair\r\n{code}\r\n[root@a-16-l ~]# ssh-keygen -t rsa -b 4096 -C \"Developement Operations Admin Key\"\r\n[root@a-16-l ~]# euca-import-keypair -f devops-admin-pk.pub devops-admin --region devops-admin@\r\nKEYPAIR\tdevops-admin\tb8:ea:b0:d4:d4:40:26:5f:14:91:ba:a9:05:20:9d:72\r\n{code}\r\n# Bundle, upload and register Ubuntu Xenial Cloud image:\r\n{code}\r\n[root@a-16-l ~]# euca-describe-images --all --region devops-admin@\r\nIMAGE\temi-d64c38f0\tubuntu-xenial-x86_64-hvm-20170413/xenial-server-cloudimg-amd64-disk1.raw.manifest.xml\t000756474874\tavailable\tpublic\tx86_64\tmachine   \t\t\t\tinstance-store\thvm\r\n{code}\r\n# Create stack using linked {{cfn-elb-twoaz-accesslog-cloudwatch-instance-vpc.json}} template:\r\n{code}\r\n[root@a-16-l ~]# euform-create-stack EUCA13233Stack --template-file cfn-elb-twoaz-accesslog-cloudwatch-instance-vpc.json --parameter KeyName=devops-admin --parameter ImageId=emi-d64c38f0 --parameter EndPoint=http://cloudformation.b-34.autoqa.qa1.eucalyptus-systems.com:8773/ --capabilities CAPABILITY_IAM --region devops-admin@\r\narn:aws:cloudformation::000571701517:stack/EUCA13233Stack/eeca5fc5-c058-46fa-8d78-71a36bd4f8fc\r\n[root@a-16-l ~]# euform-describe-stacks --region devops-admin@\r\nSTACK\tEUCA13233Stack\tCREATE_COMPLETE\t\tCloudFormation template to deploy an instance and a 2 availability zone ELB, Nginx deployment on Eucalyptus VPC cloud\t2017-04-18T17:23:44.238Z\r\nPARAMETER\tImageId\t\temi-d64c38f0\r\nPARAMETER\tKeyName\t\tdevops-admin\r\nPARAMETER\tEndPoint\t\thttp://cloudformation.b-34.autoqa.qa1.eucalyptus-systems.com:8773/\r\nPARAMETER\tInstanceType\t\tm1.medium\r\nPARAMETER\tMinSize\t\t2\r\nPARAMETER\tMaxSize\t\t4\r\nOUTPUT\tInstanceId\ti-8162f69d\r\nOUTPUT\tElasticIP\t10.116.131.220\r\nOUTPUT\tAllocationID\teipalloc-36a1ddc0\r\nOUTPUT\tNetworkInterfaceId\teni-bbcf4092\r\nOUTPUT\tEIPAssociationId\teipassoc-64173fdb\r\nOUTPUT\tAccessLogBucket\teuca13233stack-s3loggingbucket-ol3rsvnqknj53\r\nOUTPUT\tELBURL\thttp://EUCA13233-NginxELB-TXQ8W7V0OL8PG-000571701517.lb.b-34.autoqa.qa1.eucalyptus-systems.com\r\n\r\n$ curl -I http://EUCA13233-NginxELB-TXQ8W7V0OL8PG-000571701517.lb.b-34.autoqa.qa1.eucalyptus-systems.com\r\nHTTP/1.1 200 OK\r\nServer: nginx/1.10.0 (Ubuntu)\r\nDate: Tue, 18 Apr 2017 18:07:35 GMT\r\nContent-Type: text/html\r\nContent-Length: 438641\r\nLast-Modified: Tue, 18 Apr 2017 17:28:11 GMT\r\nETag: \"58f64cab-6b171\"\r\nAccept-Ranges: bytes\r\n{code}\r\n# Using AWS CLI, allow '(eucalyptus)loadbalancing' account to write to S3 bucket for access logging:\r\n{code}\r\n[root@a-16-l ~]# aws --endpoint-url=http://s3.b-34.autoqa.qa1.eucalyptus-systems.com:8773/ s3api put-bucket-acl --bucket euca13233stack-s3loggingbucket-ol3rsvnqknj53 --grant-write \"id=000040221969\" --profile devops-admin\r\n[root@a-16-l ~]# aws --endpoint-url=http://s3.b-34.autoqa.qa1.eucalyptus-systems.com:8773/ s3api get-bucket-acl --bucket euca13233stack-s3loggingbucket-ol3rsvnqknj53 --profile devops-admin\r\n{\r\n    \"Owner\": {\r\n        \"DisplayName\": \"development-operations\",\r\n        \"ID\": \"425e50453a405935135a4c515d4e475e4a16191c1e372d57a4d56184bd405436\"\r\n    },\r\n    \"Grants\": [\r\n        {\r\n            \"Grantee\": {\r\n                \"Type\": \"CanonicalUser\",\r\n                \"DisplayName\": \"development-operations\",\r\n                \"ID\": \"425e50453a405935135a4c515d4e475e4a16191c1e372d57a4d56184bd405436\"\r\n            },\r\n            \"Permission\": \"FULL_CONTROL\"\r\n        },\r\n        {\r\n            \"Grantee\": {\r\n                \"Type\": \"CanonicalUser\",\r\n                \"DisplayName\": \"(eucalyptus)loadbalancing\",\r\n                \"ID\": \"2c5f4e5f334747542914253b313809222433205f4b1a2d63c6253263f2851447\"\r\n            },\r\n            \"Permission\": \"WRITE\"\r\n        }\r\n    ]\r\n}\r\n{code}\r\n# Start curl test:\r\n{code}\r\n$ while true; do curl -s -I http://EUCA13233-NginxELB-TXQ8W7V0OL8PG-000571701517.lb.b-34.autoqa.qa1.eucalyptus-systems.com; sleep 1; done > EUCA13233-curl-test.txt\r\n{code}\r\n# Change ASG capacity to one (tests having an ELB across multiple AZ, but one backend instance):\r\n{code}\r\n[root@a-16-l ~]# euscale-update-auto-scaling-group --desired-capacity 1 -m 1 EUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW --region devops-admin@\r\n[root@a-16-l ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\tEUCA13233Stack-LaunchConfig-DTN66XV9CBI6G\tblack-dollar,black-market\tEUCA13233-NginxELB-TXQ8W7V0OL8PG\t1\t4\t1\tDefault\r\nINSTANCE\ti-ce2863fa\tblack-dollar\tInService\tHealthy\tEUCA13233Stack-LaunchConfig-DTN66XV9CBI6G\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\tName\tEUCA13233Stack\ttrue\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\taws:cloudformation:stack-id\tarn:aws:cloudformation::000571701517:stack/EUCA13233Stack/eeca5fc5-c058-46fa-8d78-71a36bd4f8fc\ttrue\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\taws:cloudformation:stack-name\tEUCA13233Stack\ttrue\r\n{code}\r\n# After about 10 minutes, set capacity of ASG to where one instance will be in each AZ:\r\n{code}\r\n[root@a-16-l ~]# euscale-update-auto-scaling-group --desired-capacity 2 -m 2 EUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW --region devops-admin@\r\n[root@a-16-l ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\tEUCA13233Stack-LaunchConfig-DTN66XV9CBI6G\tblack-dollar,black-market\tEUCA13233-NginxELB-TXQ8W7V0OL8PG\t2\t4\t2\tDefault\r\nINSTANCE\ti-13ae04fc\tblack-market\tInService\tHealthy\tEUCA13233Stack-LaunchConfig-DTN66XV9CBI6G\r\nINSTANCE\ti-ce2863fa\tblack-dollar\tInService\tHealthy\tEUCA13233Stack-LaunchConfig-DTN66XV9CBI6G\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\tName\tEUCA13233Stack\ttrue\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\taws:cloudformation:stack-id\tarn:aws:cloudformation::000571701517:stack/EUCA13233Stack/eeca5fc5-c058-46fa-8d78-71a36bd4f8fc\ttrue\r\nTAG\tauto-scaling-group\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\taws:cloudformation:stack-name\tEUCA13233Stack\ttrue\r\n{code}\r\n# SSH into one of the instances and stop nginx (this will trigger instance to go to 'OutOfService' state once it reaches the health-check threshold):\r\n{code}\r\n[root@a-16-l ~]# euca-describe-instances i-13ae04fc --region devops-admin@\r\nRESERVATION\tr-ec545810\t000571701517\tEUCA13233Stack-InstanceSecurityGroup-7VE8M2JVDGFKS\r\nINSTANCE\ti-13ae04fc\temi-d64c38f0\teuca-10-116-131-181.eucalyptus.b-34.autoqa.qa1.eucalyptus-systems.com\teuca-10-0-1-155.eucalyptus.internal\trunning\tdevops-admin\t0\t\tm1.medium\t2017-04-18T21:26:48.610Z\tblack-market\t\t\t\tmonitoring-enabled\t10.116.131.181\t10.0.1.155vpc-4fcaa016\tsubnet-ae27d79b\tinstance-store\t\t\t\t\thvm\t\t5be5fda7-5dcd-41f1-aa5d-0c7a4ba31cce_black-market_1\tsg-309e65ac\t\tx86_64\r\nNETWORKINTERFACE\teni-e884037a\tsubnet-ae27d79b\tvpc-4fcaa016\t000571701517\tin-use\t10.0.1.155\teuca-10-0-1-155.eucalyptus.internal\ttrue\r\nATTACHMENT\t\teni-attach-6bbc7853\t0\tattached\t2017-04-18T21:26:48.614Z\ttrue\r\nASSOCIATION\t10.116.131.181\t\t10.0.1.155\r\nGROUP\tsg-309e65ac\tEUCA13233Stack-InstanceSecurityGroup-7VE8M2JVDGFKS\r\nPRIVATEIPADDRESS\t10.0.1.155\teuca-10-0-1-155.eucalyptus.internal\tprimary\r\nTAG\tinstance\ti-13ae04fc\tName\tEUCA13233Stack\r\nTAG\tinstance\ti-13ae04fc\taws:autoscaling:groupName\tEUCA13233Stack-AutoScalingGroup-GEUKOK9GSYGAW\r\nTAG\tinstance\ti-13ae04fc\taws:cloudformation:logical-id\tAutoScalingGroup\r\nTAG\tinstance\ti-13ae04fc\taws:cloudformation:stack-id\tarn:aws:cloudformation::000571701517:stack/EUCA13233Stack/eeca5fc5-c058-46fa-8d78-71a36bd4f8fc\r\nTAG\tinstance\ti-13ae04fc\taws:cloudformation:stack-name\tEUCA13233Stack\r\n\r\n[root@a-16-l ~]# euca-authorize -P tcp -p ssh sg-309e65ac --region devops-admin@\r\nGROUP\tsg-309e65ac\r\nPERMISSION\tsg-309e65ac\tALLOWS\ttcp\t22\t22\tFROM\tCIDR\t0.0.0.0/0\r\n[root@a-16-l ~]# euca-authorize -P tcp -p ssh --egress sg-309e65ac --region devops-admin@\r\nGROUP\tsg-309e65ac\r\nPERMISSION\tsg-309e65ac\tALLOWS\ttcp\t22\t22\tFROM\tCIDR\t0.0.0.0/0\r\n\r\n[root@a-16-l ~]# ssh -i devops-admin-pk ubuntu@euca-10-116-131-181.eucalyptus.b-34.autoqa.qa1.eucalyptus-systems.com\r\nubuntu@euca-10-0-1-155:~$ sudo service nginx stop\r\nubuntu@euca-10-0-1-155:~$ sudo systemctl status nginx\r\n nginx.service - A high performance web server and a reverse proxy server\r\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\r\n   Active: inactive (dead) since Tue 2017-04-18 21:37:03 UTC; 22s ago\r\n  Process: 3915 ExecStop=/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid (code=exited, status=0/SUCCESS)\r\n Main PID: 3383 (code=exited, status=0/SUCCESS)\r\n\r\nApr 18 21:28:55 euca-10-0-1-155 systemd[1]: Starting A high performance web server and a reverse proxy server...\r\nApr 18 21:28:55 euca-10-0-1-155 systemd[1]: Started A high performance web server and a reverse proxy server.\r\nApr 18 21:37:03 euca-10-0-1-155 systemd[1]: Stopping A high performance web server and a reverse proxy server...\r\nApr 18 21:37:03 euca-10-0-1-155 systemd[1]: Stopped A high performance web server and a reverse proxy server.\r\nubuntu@euca-10-0-1-155:~$ exit\r\n{code}\r\n# Confirm instance goes into 'OutOfService' state:\r\n{code}\r\n[root@a-16-l ~]# eulb-describe-instance-health EUCA13233-NginxELB-TXQ8W7V0OL8PG --region devops-admin@\r\nINSTANCE\ti-13ae04fc\tOutOfService\r\nINSTANCE\ti-ce2863fa\tInService\r\n{code}\r\nLooking at the health check for the ELB:\r\n{code}\r\n[root@a-16-l ~]# eulb-describe-lbs --region devops-admin@ --show-long\r\nLOAD_BALANCER\tEUCA13233-NginxELB-TXQ8W7V0OL8PG\tEUCA13233-NginxELB-TXQ8W7V0OL8PG-000571701517.lb.b-34.autoqa.qa1.eucalyptus-systems.com\t\t\t{interval=90,target=HTTP:80/,timeout=60,healthy-threshold=3,unhealthy-threshold=7}\tblack-market,black-dollar\tsubnet-ae27d79b,subnet-3817b98e\tvpc-4fcaa016\ti-13ae04fc,i-ce2863fa\t{protocol=HTTP,lb-port=80,instance-port=80}\t\t\t\t\t{owner-alias=000571701517,group-name=EUCA13233Stack-LoadBalancerSecurityGroup-PSFAAQBMKFKGW}\t{sg-e2f1da72}\t2017-04-18T17:24:41.686Z\tinternet-facing\r\n{code}\r\nThe instance will take around 10.5 minutes to go to 'OutOfService'.  Based upon the fix, it should take 11.5 minutes for the 503 HTTP responses to end, however, it takes 26 minutes (See attached  EUCA13233-curl-test.txt file).  First 503 HTTP code shows at {{Date: Tue, 18 Apr 2017 21:20:48 GMT}}.  The last one is at {{Date: Tue, 18 Apr 2017 21:46:29 GMT}}. [^cfn-elb-twoaz-accesslog-cloudwatch-instance-vpc.json] ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-18T22:07:33.012-0500","updated":"2017-04-18T22:07:33.012-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/120874","id":"120874","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"body":"[~hspencer] It appears 503 at 21:20:48 is not related to nginx being down (nginx was down 21:37:03 in your log).\r\n{code:java}\r\n   Active: inactive (dead) since Tue 2017-04-18 21:37:03 UTC; 22s ago\r\n{code}\r\n Not sure what caused the initial 503 at 20:48....\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"created":"2017-04-18T23:37:23.442-0500","updated":"2017-04-18T23:37:23.442-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/120877","id":"120877","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"[~hspencer], your packages are a little stale. Besides euca packages, there is also an updated service image with servo v 1.4. Not sure if that would make a difference.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2017-04-19T10:46:49.268-0500","updated":"2017-04-19T10:46:49.268-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54806/comment/120930","id":"120930","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"Nice work [~spark]. Works like a charm.\r\n\r\n*Eucalyptus Version*\r\n\r\n{{4.4.1-0.25878.35.20170413git36456cc.el7}}\r\n\r\n*Steps*\r\n\r\n# Deploy Eucalyptus 4.4.1 VPC cloud with multiple AZs - [hspencer-684-maint-4.4|http://jenkins.qa1.eucalyptus-systems.com/job/Quick%20Launch%20Maint_4.4/684/]\r\n{code}\r\n[root@c-36 ~]# euca-describe-availability-zones\r\nAVAILABILITYZONE\tblack-dollar\tavailable\r\nAVAILABILITYZONE\tblack-market\tavailable\r\n{code}\r\n# Create non-eucalyptus account (e.g. {{development-operations}})\r\n{code}\r\n[root@a-16-l ~]# euare-accountcreate -a development-operations -w > .euca/devops-admin.ini\r\n{code}\r\n# Create and import keypair\r\n{code}\r\n[root@a-16-l ~]# ssh-keygen -t rsa -b 4096 -C \"Developement Operations Admin Key\"\r\n[root@a-16-l ~]# euca-import-keypair -f devops-admin-pk.pub devops-admin --region devops-admin@\r\nKEYPAIR\tdevops-admin\tb8:ea:b0:d4:d4:40:26:5f:14:91:ba:a9:05:20:9d:72\r\n{code}\r\n# Bundle, upload and register Ubuntu Xenial Cloud image:\r\n{code}\r\n[root@c-36 ~]# euca-describe-images --region devops-admin@\r\nIMAGE\temi-53ab4ccc\tubuntu-xenial-x86_64-hvm-20170419/xenial-server-cloudimg-amd64-disk1.raw.manifest.xml\t000294836819\tavailable\tprivate\tx86_64\tmachine\t\t\tinstance-store\thvm\r\n{code}\r\n# Create stack using linked {{cfn-elb-twoaz-accesslog-cloudwatch-instance-vpc.json}} template:\r\n{code}\r\n[root@c-36 ~]# euform-create-stack NginxStack --template-file cfn-elb-twoaz-accesslog-cloudwatch-instance-vpc.json --parameter ImageId=emi-53ab4ccc --parameter KeyName=devops-admin --parameter EndPoint=http://cloudformation.g-15-03.autoqa.qa1.eucalyptus-systems.com:8773/ --capabilities CAPABILITY_IAM --region devops-admin@\r\narn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\r\n\r\n[root@c-36 ~]# euform-describe-stacks --region devops-admin@\r\nSTACK\tNginxStack\tCREATE_COMPLETE\t\tCloudFormation template to deploy an instance and a 2 availability zone ELB, Nginx deployment on Eucalyptus VPC cloud\t2017-04-20T16:11:40.562Z\r\nPARAMETER\tImageId\t\temi-53ab4ccc\r\nPARAMETER\tKeyName\t\tdevops-admin\r\nPARAMETER\tEndPoint\t\thttp://cloudformation.g-15-03.autoqa.qa1.eucalyptus-systems.com:8773/\r\nPARAMETER\tInstanceType\t\tm1.medium\r\nPARAMETER\tMinSize\t\t2\r\nPARAMETER\tMaxSize\t\t4\r\nOUTPUT\tInstanceId\ti-1c4dacd9\r\nOUTPUT\tElasticIP\t10.116.131.5\r\nOUTPUT\tAllocationID\teipalloc-8b3a34e4\r\nOUTPUT\tNetworkInterfaceId\teni-691aacc5\r\nOUTPUT\tEIPAssociationId\teipassoc-ef18858f\r\nOUTPUT\tAccessLogBucket\tnginxstack-s3loggingbucket-yh2gkibzkwsag\r\nOUTPUT\tELBURL\thttp://NginxStac-NginxELB-N6VM9AS0JIGBF-000294836819.lb.g-15-03.autoqa.qa1.eucalyptus-systems.com\r\n\r\n$ curl -I http://NginxStac-NginxELB-N6VM9AS0JIGBF-000294836819.lb.g-15-03.autoqa.qa1.eucalyptus-systems.com\r\nHTTP/1.1 200 OK\r\nServer: nginx/1.10.0 (Ubuntu)\r\nDate: Thu, 20 Apr 2017 16:34:23 GMT\r\nContent-Type: text/html\r\nContent-Length: 428957\r\nLast-Modified: Thu, 20 Apr 2017 16:15:57 GMT\r\nETag: \"58f8debd-68b9d\"\r\nAccept-Ranges: bytes\r\n{code}\r\n# Use AWS CLI to set bucket ACL for '(eucalyptus)loadbalancing' account access:\r\n{code}\r\n[root@c-36 ~]# aws --endpoint-url=http://s3.g-15-03.autoqa.qa1.eucalyptus-systems.com:8773/ s3api put-bucket-acl --bucket nginxstack-s3loggingbucket-yh2gkibzkwsag --grant-write \"id=000049759128\" --profile devops-admin\r\n[root@c-36 ~]# aws --endpoint-url=http://s3.g-15-03.autoqa.qa1.eucalyptus-systems.com:8773/ s3api get-bucket-acl --bucket nginxstack-s3loggingbucket-yh2gkibzkwsag --profile devops-admin\r\n{\r\n    \"Owner\": {\r\n        \"DisplayName\": \"development-operations\",\r\n        \"ID\": \"5e281f323937413c44220273f13151453f1421182d2e442e50634264f3ba7502\"\r\n    },\r\n    \"Grants\": [\r\n        {\r\n            \"Grantee\": {\r\n                \"Type\": \"CanonicalUser\",\r\n                \"DisplayName\": \"development-operations\",\r\n                \"ID\": \"5e281f323937413c44220273f13151453f1421182d2e442e50634264f3ba7502\"\r\n            },\r\n            \"Permission\": \"FULL_CONTROL\"\r\n        },\r\n        {\r\n            \"Grantee\": {\r\n                \"Type\": \"CanonicalUser\",\r\n                \"DisplayName\": \"(eucalyptus)loadbalancing\",\r\n                \"ID\": \"25564ac605910495518102a5926621d21e55da1a601659361136124635a502e5\"\r\n            },\r\n            \"Permission\": \"WRITE\"\r\n        }\r\n    ]\r\n}\r\n{code}\r\n# Start curl test:\r\n{code}\r\n$ while true; do curl -s -I http://NginxStac-NginxELB-N6VM9AS0JIGBF-000294836819.lb.g-15-03.autoqa.qa1.eucalyptus-systems.com; sleep 1; done > EUCA13233-curl-test.txt\r\n{code}\r\n# Change ASG capacity to one (tests having an ELB across multiple AZ, but one backend instance):\r\n{code}\r\n[root@c-36 ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\tblack-dollar,black-market\tNginxStac-NginxELB-N6VM9AS0JIGBF\t24\t2\tDefault\r\nINSTANCE\ti-2628c36d\tblack-dollar\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nINSTANCE\ti-1110ad5f\tblack-market\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tName\tNginxStack\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-name\tNginxStack\ttrue\r\n[root@c-36 ~]# euscale-update-auto-scaling-group NginxStack-AutoScalingGroup-7EIDRVZ3CA91B --desired-capacity 1 -m 1 --region devops-admin@\r\n[root@c-36 ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\tblack-dollar,black-market\tNginxStac-NginxELB-N6VM9AS0JIGBF\t14\t1\tDefault\r\nINSTANCE\ti-2628c36d\tblack-dollar\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nINSTANCE\ti-1110ad5f\tblack-market\tTerminating\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tName\tNginxStack\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-name\tNginxStack\ttrue\r\n[root@c-36 ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\tblack-dollar,black-market\tNginxStac-NginxELB-N6VM9AS0JIGBF\t14\t1\tDefault\r\nINSTANCE\ti-2628c36d\tblack-dollar\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tName\tNginxStack\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-name\tNginxStack\ttrue\r\n{code}\r\n# After about 10 minutes, set capacity of ASG to where one instance will be in each AZ:\r\n{code}\r\n[root@c-36 ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\tblack-dollar,black-market\tNginxStac-NginxELB-N6VM9AS0JIGBF\t24\t2\tDefault\r\nINSTANCE\ti-2628c36d\tblack-dollar\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nINSTANCE\ti-abad8fad\tblack-market\tPending\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tName\tNginxStack\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-name\tNginxStack\ttrue\r\n[root@c-36 ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\tblack-dollar,black-market\tNginxStac-NginxELB-N6VM9AS0JIGBF\t24\t2\tDefault\r\nINSTANCE\ti-2628c36d\tblack-dollar\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nINSTANCE\ti-abad8fad\tblack-market\tPending\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tName\tNginxStack\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-name\tNginxStack\ttrue\r\n[root@c-36 ~]# euscale-describe-auto-scaling-groups --region devops-admin@\r\nAUTO-SCALING-GROUP\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\tblack-dollar,black-market\tNginxStac-NginxELB-N6VM9AS0JIGBF\t24\t2\tDefault\r\nINSTANCE\ti-2628c36d\tblack-dollar\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nINSTANCE\ti-abad8fad\tblack-market\tInService\tHealthy\tNginxStack-LaunchConfig-FU2JMYQDDCTMD\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\tName\tNginxStack\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:logical-id\tAutoScalingGroup\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\ttrue\r\nTAG\tauto-scaling-group\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\taws:cloudformation:stack-name\tNginxStack\ttrue\r\n{code}\r\n# Confirm no 503 errors were returned during instance removal and addition:\r\n{code}\r\n$ grep HTTP EUCA13233-curl-test.txt | awk '{print $2}' | sort | uniq -c\r\n 189 200\r\n{code}\r\n# SSH into one of the instances and stop nginx (this will trigger instance to go to 'OutOfService' state once it reaches the health-check threshold):\r\n{code}\r\n[root@c-36 ~]# euca-describe-instances i-2628c36d --region devops-admin@\r\nRESERVATION\tr-ad2384a7\t000294836819\tNginxStack-InstanceSecurityGroup-VNLFUGEZCPTYU\r\nINSTANCE\ti-2628c36d\temi-53ab4ccc\teuca-10-116-131-206.eucalyptus.g-15-03.autoqa.qa1.eucalyptus-systems.com\teuca-10-0-0-231.eucalyptus.internal\trunning\tdevops-admin\t0\t\tm1.medium\t2017-04-20T16:13:48.270Z\tblack-dollar\t\t\t\tmonitoring-enabled\t10.116.131.206\t10.0.0.231\tvpc-9a629f62\tsubnet-9b559c20\tinstance-store\t\t\t\t\thvm\t\ta40813ad-9461-4b11-9588-74476f541911_black-dollar_1\tsg-bf90c58c\t\t\t\tx86_64\r\nNETWORKINTERFACE\teni-e72e2f05\tsubnet-9b559c20\tvpc-9a629f62\t000294836819\tin-use\t10.0.0.231\teuca-10-0-0-231.eucalyptus.internal\ttrue\r\nATTACHMENT\t\teni-attach-f080a553\t0\tattached\t2017-04-20T16:13:48.272Z\ttrue\r\nASSOCIATION\t10.116.131.206\t\t10.0.0.231\r\nGROUP\tsg-bf90c58c\tNginxStack-InstanceSecurityGroup-VNLFUGEZCPTYU\r\nPRIVATEIPADDRESS\t10.0.0.231\teuca-10-0-0-231.eucalyptus.internal\tprimary\r\nTAG\tinstance\ti-2628c36d\tName\tNginxStack\r\nTAG\tinstance\ti-2628c36d\taws:autoscaling:groupName\tNginxStack-AutoScalingGroup-7EIDRVZ3CA91B\r\nTAG\tinstance\ti-2628c36d\taws:cloudformation:logical-id\tAutoScalingGroup\r\nTAG\tinstance\ti-2628c36d\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\r\nTAG\tinstance\ti-2628c36d\taws:cloudformation:stack-name\tNginxStack\r\n[root@c-36 ~]# euca-describe-groups sg-bf90c58c --region devops-admin@\r\nGROUP\tsg-bf90c58c\t000294836819\tNginxStack-InstanceSecurityGroup-VNLFUGEZCPTYU\tEnable HTTP access on 80 and 443 from ELB.\tvpc-9a629f62\r\nPERMISSION\t000294836819\tNginxStack-InstanceSecurityGroup-VNLFUGEZCPTYU\tALLOWS\ttcp\t443\t443\tFROM\tUSER\t000294836819\tNAME\tNginxStack-LoadBalancerSecurityGroup-PDA8HDX8YMEIB\tID\tsg-b09c8834\tingress\r\nPERMISSION\t000294836819\tNginxStack-InstanceSecurityGroup-VNLFUGEZCPTYU\tALLOWS\ttcp\t80\t80\tFROM\tUSER\t000294836819\tNAME\tNginxStack-LoadBalancerSecurityGroup-PDA8HDX8YMEIB\tID\tsg-b09c8834\tingress\r\nPERMISSION\t000294836819\tNginxStack-InstanceSecurityGroup-VNLFUGEZCPTYU\tALLOWS\t-1\t\t\tTO\tCIDR\t0.0.0.0/0\tegress\r\nTAG\tsecurity-group\tsg-bf90c58c\taws:cloudformation:logical-id\tInstanceSecurityGroup\r\nTAG\tsecurity-group\tsg-bf90c58c\taws:cloudformation:stack-id\tarn:aws:cloudformation::000294836819:stack/NginxStack/76a271b8-a318-4ad3-afd8-b0a7c77a45b9\r\nTAG\tsecurity-group\tsg-bf90c58c\taws:cloudformation:stack-name\tNginxStack\r\n[root@c-36 ~]# euca-authorize -P tcp -p ssh sg-bf90c58c --region devops-admin@\r\nGROUP\tsg-bf90c58c\r\nPERMISSION\tsg-bf90c58c\tALLOWS\ttcp\t22\t22\tFROM\tCIDR\t0.0.0.0/0\r\n[root@c-36 ~]# euca-authorize -P tcp -p ssh --egress sg-bf90c58c --region devops-admin@\r\nGROUP\tsg-bf90c58c\r\nPERMISSION\tsg-bf90c58c\tALLOWS\ttcp\t22\t22\tFROM\tCIDR\t0.0.0.0/0\r\n\r\n[root@c-36 ~]# ssh -i devops-admin-pk ubuntu@euca-10-116-131-206.eucalyptus.g-15-03.autoqa.qa1.eucalyptus-systems.com\r\n\r\nubuntu@euca-10-0-0-231:~$ sudo systemctl status nginx\r\n nginx.service - A high performance web server and a reverse proxy server\r\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\r\n   Active: active (running) since Thu 2017-04-20 16:15:54 UTC; 24min ago\r\n Main PID: 3359 (nginx)\r\n    Tasks: 2\r\n   Memory: 3.7M\r\n      CPU: 322ms\r\n   CGroup: /system.slice/nginx.service\r\n           3359 nginx: master process /usr/sbin/nginx -g daemon on; master_process on\r\n           3360 nginx: worker process\r\n\r\nApr 20 16:15:54 euca-10-0-0-231 systemd[1]: Starting A high performance web server and a reverse proxy server...\r\nApr 20 16:15:54 euca-10-0-0-231 systemd[1]: nginx.service: Failed to read PID from file /run/nginx.pid: Invalid argument\r\nApr 20 16:15:54 euca-10-0-0-231 systemd[1]: Started A high performance web server and a reverse proxy server.\r\nubuntu@euca-10-0-0-231:~$ sudo systemctl stop nginx\r\nubuntu@euca-10-0-0-231:~$ sudo systemctl status nginx\r\n nginx.service - A high performance web server and a reverse proxy server\r\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\r\n   Active: inactive (dead) since Thu 2017-04-20 16:40:22 UTC; 2s ago\r\n  Process: 3940 ExecStop=/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid (code=exited, status=0/SUCCESS)\r\n Main PID: 3359 (code=exited, status=0/SUCCESS)\r\n\r\nApr 20 16:15:54 euca-10-0-0-231 systemd[1]: Starting A high performance web server and a reverse proxy server...\r\nApr 20 16:15:54 euca-10-0-0-231 systemd[1]: nginx.service: Failed to read PID from file /run/nginx.pid: Invalid argument\r\nApr 20 16:15:54 euca-10-0-0-231 systemd[1]: Started A high performance web server and a reverse proxy server.\r\nApr 20 16:40:22 euca-10-0-0-231 systemd[1]: Stopping A high performance web server and a reverse proxy server...\r\nApr 20 16:40:22 euca-10-0-0-231 systemd[1]: Stopped A high performance web server and a reverse proxy server.\r\nubuntu@euca-10-0-0-231:~$ sudo netstat -lpn | grep 80\r\nudp        0      0 0.0.0.0:68              0.0.0.0:*                           806/dhclient\r\nudp6       0      0 fe80::d20d:e7ff:fe2:123 :::*                                2186/ntpd\r\nubuntu@euca-10-0-0-231:~$ sudo netstat -lpn | grep nginx\r\nubuntu@euca-10-0-0-231:~$ exit\r\n{code}\r\n# Wait for about 10 minutes (due to health-check policy defined for the ELB), then verify instance is reaches \"OutOfService\" state:\r\n{code}\r\n[root@c-36 ~]# eulb-describe-instance-health NginxStac-NginxELB-N6VM9AS0JIGBF --region devops-admin@\r\nINSTANCE\ti-abad8fad\tInService\r\nINSTANCE\ti-2628c36d\tOutOfService\r\n{code}\r\n# Confirm 503 HTTP statuses were returned:\r\n{code}\r\neuca-prod-1-82:~ haroldspencerjr$ grep HTTP EUCA13233-curl-test.txt | awk '{print $2}' | sort | uniq -c\r\n 273 200\r\n  10 503\r\n{code}\r\n# Confirm first and last time 503 status was returned.  The time should be less than the health-check set on the ELB plus 1 minute.  (In the verification, the max time was 11.5 minutes):\r\n{code}\r\n[root@c-36 ~]# eulb-describe-lbs --region devops-admin@ --show-long\r\nLOAD_BALANCER\tNginxStac-NginxELB-N6VM9AS0JIGBF\tNginxStac-NginxELB-N6VM9AS0JIGBF-000294836819.lb.g-15-03.autoqa.qa1.eucalyptus-systems.com\t\t\t{interval=90,target=HTTP:80/,timeout=60,healthy-threshold=3,unhealthy-threshold=7}\tblack-market,black-dollar\tsubnet-4cdb2b69,subnet-9b559c20\tvpc-9a629f62\ti-abad8fad\t{protocol=HTTP,lb-port=80,instance-port=80}\t\t\t\t\t{owner-alias=000294836819,group-name=NginxStack-LoadBalancerSecurityGroup-PDA8HDX8YMEIB}\t{sg-b09c8834}\t2017-04-20T16:13:02.956Z\tinternet-facing\r\n\r\n## Checking attached {{EUCA13233-curl-test.txt}} file, first 503 showed up ##\r\n\r\nDate: Thu, 20 Apr 2017 16:40:26 GMT\r\n\r\n## Last 503 displayed ##\r\n\r\nDate: Thu, 20 Apr 2017 16:50:34 GMT\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-04-20T14:52:27.955-0500","updated":"2017-04-20T14:52:27.955-0500"}],"maxResults":11,"total":11,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13233/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}