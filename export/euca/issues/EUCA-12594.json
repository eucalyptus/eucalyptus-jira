{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"46217","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217","key":"EUCA-12594","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/17800","id":"17800","description":"Eucalyptus 4.3.1","name":"4.3.1","archived":false,"released":true,"releaseDate":"2016-12-14"}],"customfield_11001":null,"aggregatetimespent":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/12601","value":"CentOS 7","id":"12601"}],"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/11500","value":"Edge","id":"11500"}],"customfield_11400":null,"customfield_10302":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10104":["com.atlassian.greenhopper.service.sprint.Sprint@368a8c85[id=143,rapidViewId=118,state=CLOSED,name=4.4.0 Sprint 4,goal=,startDate=2016-11-10T19:49:52.166Z,endDate=2016-12-01T01:49:00.000Z,completeDate=2016-12-05T23:35:14.340Z,sequence=143]"],"customfield_10303":null,"customfield_10105":null,"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"resolutiondate":"2016-12-08T13:34:37.008-0600","customfield_10308":null,"customfield_10704":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-12594/watchers","watchCount":12,"isWatching":false},"created":"2016-07-20T03:37:40.134-0500","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"customfield_12400":null,"customfield_12201":null,"customfield_10102":null,"customfield_12600":"{repository={count=2, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":2,\"lastUpdated\":\"2016-12-03T10:42:36.000-0600\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":2,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10300":null,"customfield_10301":null,"labels":["regression"],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/16800","id":"16800","description":"Eucalyptus 4.3.0","name":"4.3.0","archived":false,"released":true,"releaseDate":"2016-08-09"}],"issuelinks":[{"id":"45473","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/45473","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"inwardIssue":{"id":"51026","key":"EUCA-12965","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/51026","fields":{"summary":"Rollback fails due to an ongoing instance migration","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}},{"id":"45600","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/45600","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"inwardIssue":{"id":"44607","key":"EUCA-12468","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/44607","fields":{"summary":"Failed migration due to space limitations should not leave instance's artifacts on destination host","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10001","description":"This issue has been validated/reproduced, but has not been prioritized yet.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Confirmed","id":"10001","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shaon","name":"shaon","key":"shaon","accountId":"557058:1e5e1aa5-5986-4a9e-b9ed-814f7000cd4f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue"},"displayName":"Imran Hossain Shaon","active":true,"timeZone":"America/Los_Angeles"},"updated":"2017-01-05T16:26:49.746-0600","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11504","id":"11504","name":"EC2"}],"timeoriginalestimate":null,"description":"While performing install-fest activity using a newly installed 4.3 cloud, I have noticed instance migration failure in third attempt using same instance.\r\n\r\nIn first attempt, instance migration was successful from Node A  (10.104.1.200)---> Node B (10.104.1.201) without failure and also noticed all the files of  migrated instance got deleted from the source node A (10.104.1.200) after migration.\r\n\r\n{code}\r\nEuca-version on CLC\r\n\r\n[root@odc-d-26 ~]# euca-version \r\neuca2ools 3.3.1 (Yokohama)\r\neucalyptus 4.3.0\r\n[root@odc-d-26 ~]# \r\n10.104.1.199\r\n{code}\r\n\r\nEuca version on 1st NC\r\n\r\n{code}\r\n[root@odc-d-25 i-7ff82db9]# euca-version \r\neuca2ools 3.3.1 (Yokohama)\r\neucalyptus 4.3.0\r\n[root@odc-d-25 i-7ff82db9]# hostname -i\r\n10.104.1.200\r\n[root@odc-d-25 i-7ff82db9]#\r\n{code}\r\n\r\nEuca version on 2nd NC\r\n\r\n{code}\r\n[root@odc-d-24 i-7ff82db9]# euca-version \r\neuca2ools 3.3.1 (Yokohama)\r\neucalyptus 4.3.0\r\n[root@odc-d-24 i-7ff82db9]# hostname -i\r\n10.104.1.201\r\n{code}\r\n\r\nInstance was launched on the  CLC (10.104.1.199).  It  is running on Node A (10.104.1.200) and it is reachable from CLC. \r\n\r\n{code}\r\n[root@odc-d-26 ~]# euca-run-instances -k testlogin emi-a5540bba  \r\nRESERVATION\tr-8a85064d\t000431968616\tdefault\r\nINSTANCE\ti-8eacd211\temi-a5540bba\teuca-10-104-6-205.eucalyptus.installfest.kshaik.cs.prc.eucalyptus-systems.com\teuca-10-105-12\r\n\r\n-83.eucalyptus.internal\tpending\ttestlogin\t0\t\tm1.small\t2016-07-20T06:48:50.422Z\tzone-555\t\t\t\r\n\r\n\tmonitoring-disabled\t10.104.6.205\t10.105.12.83\t\t\tinstance-store\t\t\t\t\thvm\t\t\r\n\r\n\tsg-fa83db5c\t\t    x86_64\r\n[root@odc-d-26 ~]# euserv-describe-node-controllers \r\nNODE  zone-555  10.104.1.200  enabled    \r\nINSTANCE  i-8eacd211      \r\nNODE  zone-555  10.104.1.201  enabled    \r\n\r\n[root@odc-d-26 ~]# ping 10.104.6.205\r\nPING 10.104.6.205 (10.104.6.205) 56(84) bytes of data.\r\n64 bytes from 10.104.6.205: icmp_seq=4 ttl=63 time=0.638 ms\r\n64 bytes from 10.104.6.205: icmp_seq=5 ttl=63 time=0.584 ms\r\n64 bytes from 10.104.6.205: icmp_seq=6 ttl=63 time=0.569 ms\r\n^C\r\n--- 10.104.6.205 ping statistics ---\r\n6 packets transmitted, 3 received, 50% packet loss, time 4999ms\r\nrtt min/avg/max/mdev = 0.569/0.597/0.638/0.029 ms\r\n[root@odc-d-26 ~]#\r\n{code}\r\n\r\nInstance (i-8eacd211) was migrated to destination node successfully in first attempt. The migration activity was completed successfully and the instance was migrated to destination node (10.104.1.201).\r\n\r\n{code}\r\n[root@odc-d-26 ~]# euserv-migrate-instances -i i-8eacd211\r\n[root@odc-d-26 ~]# euserv-describe-node-controllers \r\nNODE  zone-555  10.104.1.200  enabled    \r\n\r\nNODE  zone-555  10.104.1.201  enabled    \r\nINSTANCE  i-8eacd211      \r\n[root@odc-d-26 ~]# \r\n{code}\r\n\r\nInstance folder along with files got deleted from source node (10.104.1.200) after successful migration.\r\n\r\n{code}\r\n[root@odc-d-25 AIDAAJYVO76TMPNFDQ6X3]# ll\r\ntotal 12\r\ndrwx--x--x. 2 eucalyptus eucalyptus 4096 Jul 19 23:41 i-1dc1de49\r\ndrwx--x--x. 2 eucalyptus eucalyptus 4096 Jul 19 23:03 i-690e394d\r\ndrwx--x--x. 2 eucalyptus eucalyptus 4096 Jul 19 23:41 i-7ff82db9\r\n[root@odc-d-25 AIDAAJYVO76TMPNFDQ6X3]#\r\n{code}\r\n\r\nMigrated Instance is running on destination node.\r\n\r\n{code}\r\n[root@odc-d-24 AIDAAJYVO76TMPNFDQ6X3]# virsh list\r\n Id    Name                           State\r\n----------------------------------------------------\r\n 2     i-8eacd211                     running\r\n\r\n[root@odc-d-24 AIDAAJYVO76TMPNFDQ6X3]# cd i-8eacd211/\r\n[root@odc-d-24 i-8eacd211]# ll |wc -l\r\n12\r\n[root@odc-d-24 i-8eacd211]# ll\r\ntotal 5242912\r\n-rw-------. 1 qemu       qemu                0 Jul 20 00:15 console.log\r\n-rw-r-----. 1 qemu       qemu       2148532224 Jul 20 00:16 emi-a5540bba-14e248fa.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Jul 20 00:15 emi-a5540bba-14e248fa.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         21 Jul 20 00:15 emi-a5540bba-14e248fa.sig\r\n-rw-r--r--. 1 eucalyptus eucalyptus       1514 Jul 20 00:15 instance-libvirt.xml\r\n-rw-rw----. 1 eucalyptus eucalyptus       6631 Jul 20 00:21 instance.xml\r\nlrwxrwxrwx. 1 eucalyptus eucalyptus         96 Jul 20 00:15 link-to-vda -> /var/lib/eucalyptus/instances/work/AIDAAJYVO76TMPNFDQ6X3/i-\r\n\r\n8eacd211/emi-a5540bba-14e248fa.blocks\r\nlrwxrwxrwx. 1 eucalyptus eucalyptus         97 Jul 20 00:15 link-to-vdb -> /var/lib/eucalyptus/instances/work/AIDAAJYVO76TMPNFDQ6X3/i-\r\n\r\n8eacd211/prt-03072ext3-11384fdc.blocks\r\n-rw-r-----. 1 qemu       qemu       3221225472 Jul 20 00:16 prt-03072ext3-11384fdc.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Jul 20 00:15 prt-03072ext3-11384fdc.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         37 Jul 20 00:15 prt-03072ext3-11384fdc.sig\r\n[root@odc-d-24 i-8eacd211]#\r\n{code}\r\n\r\nIn second attempt, instance migration was successful  from Node B (10.104.1.201) ---->  Node A (10.104.1.200)  without failure and this time, I can still see the files of migrated instance exist under  /var/lib/eucalyptus/instance/work/AI*/ on the source node controller Node B (10.104.1.201).\r\n\r\n{code}\r\n[root@odc-d-26 ~]# euserv-describe-node-controllers \r\nNODE  zone-555  10.104.1.200  enabled    \r\n\r\nNODE  zone-555  10.104.1.201  enabled    \r\nINSTANCE  i-8eacd211      \r\n[root@odc-d-26 ~]# \r\n\r\n[root@odc-d-26 ~]# euserv-migrate-instances -i i-8eacd211\r\n\r\n[root@odc-d-26 ~]# euserv-describe-node-controllers \r\nNODE  zone-555  10.104.1.200  enabled    \r\nINSTANCE  i-8eacd211      \r\nNODE  zone-555  10.104.1.201  enabled    \r\n\r\n[root@odc-d-26 ~]#\r\n{code}\r\n\r\nI can still see the files exist on source node (10.104.1.201) after instance was migrated to Node A (10.104.1.200).\r\n\r\n{code}\r\n[root@odc-d-24 AIDAAJYVO76TMPNFDQ6X3]# ls\r\ni-1dc1de49  i-690e394d  i-7ff82db9  i-8eacd211\r\n[root@odc-d-24 AIDAAJYVO76TMPNFDQ6X3]# cd i-7ff82db9/\r\n[root@odc-d-24 i-7ff82db9]# ll |wc -l\r\n7\r\n[root@odc-d-24 i-7ff82db9]# ll\r\ntotal 5242908\r\n-rw-r-----. 1 root       root       2148532224 Jul 19 23:36 emi-a5540bba-14e248fa.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Jul 19 23:37 emi-a5540bba-14e248fa.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         21 Jul 19 23:32 emi-a5540bba-14e248fa.sig\r\n-rw-r-----. 1 root       root       3221225472 Jul 19 23:33 prt-03072ext3-11384fdc.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Jul 19 23:37 prt-03072ext3-11384fdc.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         37 Jul 19 23:32 prt-03072ext3-11384fdc.sig\r\n[root@odc-d-24 i-7ff82db9]#\r\n{code}\r\n\r\nAgain I tried to migration same instance from Node A (10.104.1.200) to Node B (10.104.1.201), this time migration was failed with error message  \"could not create backing directory /var/lib/eucalyptus/instances/work/AIDAAJYVO76TMPNFDQ6X3/i-8eacd211\".\r\n\r\nError messages collected from destination node:\r\n\r\n{code}\r\n2016-07-20 00:28:47  INFO 000005000 doMigrateInstances       | migrating 1 instances\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | verifying 1 instance[s] for migration...\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | verifying instance # 0...\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | invoked (action=prepare instance[0].{id=i-8eacd211 src=10.104.1.200 \r\n\r\ndst=10.104.1.201) creds=present\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | verifying 1 instance[s] for migration...\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | verifying instance # 0...\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | [i-8eacd211] proposed migration action 'prepare' (10.104.1.200 > 10.104.1.201) \r\n\r\n[creds=present]\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | [i-8eacd211] processing instance # 0 (10.104.1.200 > 10.104.1.201)\r\n2016-07-20 00:28:47  INFO 000005000 doMigrateInstances       | [i-8eacd211] migration destination preparing 10.104.1.200 > 10.104.1.201 \r\n\r\n[creds=present]\r\n2016-07-20 00:28:47 DEBUG 000005000 doMigrateInstances       | [i-8eacd211] authorizing migration source node 10.104.1.200\r\n2016-07-20 00:28:47 DEBUG 000005000 authorize_migration_keys | [i-8eacd211] migration key authorization command: \r\n\r\n'//usr/lib/eucalyptus/euca_rootwrap //usr/share/eucalyptus/authorize-migration-keys.pl -a 10.104.1.200 e8vvvTmAXFYCZ9GP'\r\n2016-07-20 00:28:47 DEBUG 000005000 authorize_migration_keys | [i-8eacd211] migration key authorization/deauthorization succeeded\r\n2016-07-20 00:28:47 DEBUG 000005000 generate_migration_keys  | [i-8eacd211] regeneration of migration credentials\r\n2016-07-20 00:28:47 DEBUG 000005000 generate_migration_keys  | [i-8eacd211] executing migration key-generator: \r\n\r\n'//usr/lib/eucalyptus/euca_rootwrap //usr/share/eucalyptus/generate-migration-keys.sh 10.104.1.201 e8vvvTmAXFYCZ9GP restart'\r\n2016-07-20 00:28:48 DEBUG 000005000 generate_migration_keys  | [i-8eacd211] migration key generation succeeded\r\n2016-07-20 00:28:48 ERROR 000005000 write_xml_file           | [i-8eacd211] failed to write instance XML to \r\n2016-07-20 00:28:48 ERROR 000005000 create_instance_backing  | [i-8eacd211] could not create backing directory \r\n\r\n/var/lib/eucalyptus/instances/work/AIDAAJYVO76TMPNFDQ6X3/i-8eacd211\r\n2016-07-20 00:28:48 ERROR 000005000 doMigrateInstances       | [i-8eacd211] failed to prepare images for migrating instance (error=1)\r\n2016-07-20 00:28:48 ERROR 000005000 doMigrateInstances       | [i-8eacd211] setting instance to Teardown(cleaning) after destination failure to \r\n\r\nprepare for migration\r\n2016-07-20 00:28:48 DEBUG 000005000 change_state             | [i-8eacd211] state change for instance: Unknown -> Teardown (Teardown)\r\n2016-07-20 00:28:48  INFO 000005000 doMigrateInstances       | [i-8eacd211] no remaining active incoming migrations -- checking to see if there \r\n\r\nare any pending migrations\r\n2016-07-20 00:28:48  INFO 000005000 doMigrateInstances       | [i-8eacd211] no remaining incoming or pending migrations -- deauthorizing all \r\n\r\nmigration client keys\r\n2016-07-20 00:28:48 DEBUG 000005000 authorize_migration_keys | [UNSET] migration key authorization command: '//usr/lib/eucalyptus/euca_rootwrap \r\n\r\n//usr/share/eucalyptus/authorize-migration-keys.pl -D -r  '\r\n2016-07-20 00:28:49 DEBUG 000005000 authorize_migration_keys | [UNSET] migration key authorization/deauthorization succeeded\r\n2016-07-20 00:28:49 ERROR 000005000 ncMigrateInstancesMarsha | failed error=1\r\n{code}\r\n\r\nStill the 4.3 cloud is running on which I performed testing.  Cloud details as follows:\r\n\r\nCLC+WALRUS+SC+CC:10.104.1.199\r\nNC1:10.104.1.200\r\nNC2:10.104.1.201\r\nuser: root\r\npassword: foobar","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=jbreiding","name":"jbreiding","key":"jbreiding","accountId":"557058:2be99265-2170-4b3d-8e28-2f0728ab294e","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue"},"displayName":"jeremy breiding","active":true,"timeZone":"US/Central"},"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"Destination node does not clean all artifacts after instance is migrated out","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=kshaik","name":"kshaik","key":"kshaik","accountId":"557058:c99aa270-2e4b-40a1-a392-ecf800a93a31","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Kasim Shaik","active":true,"timeZone":"US/Central"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=kshaik","name":"kshaik","key":"kshaik","accountId":"557058:c99aa270-2e4b-40a1-a392-ecf800a93a31","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Kasim Shaik","active":true,"timeZone":"US/Central"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":"3_*:*_2_*:*_5416010880_*|*_10000_*:*_1_*:*_132058335_*|*_10001_*:*_2_*:*_6416412317_*|*_10003_*:*_1_*:*_257335356_*|*_10006_*:*_1_*:*_0","customfield_12100":"0|i03vcv:","customfield_10001":"2016-07-20T14:48:34.493-0500","customfield_10002":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10000","value":"Customer Affecting","id":"10000"}],"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["dmitrii(dmitrii)","gholms(gholms)","shaon(shaon)","jbreiding(jbreiding)","kshaik(kshaik)","sgraham(sgraham)","tony(tony)","vasya(vasya)"],"customfield_10116":null,"environment":"Front-end controller (CLC+Walrus+SC+CC), 2 NC's.","customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"progress":{"progress":0,"total":0},"customfield_11806":null,"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-12594/votes","votes":1,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/107139","id":"107139","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=vasya","name":"vasya","key":"vasya","accountId":"557058:1c63481a-0634-4ae7-9004-cb0f143e141f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue"},"displayName":"Vasiliy Kochergin","active":false,"timeZone":"America/Los_Angeles"},"body":"Looks like we had this issue for a while (possibly from the first migration release).","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=vasya","name":"vasya","key":"vasya","accountId":"557058:1c63481a-0634-4ae7-9004-cb0f143e141f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue"},"displayName":"Vasiliy Kochergin","active":false,"timeZone":"America/Los_Angeles"},"created":"2016-07-20T14:48:34.493-0500","updated":"2016-07-20T14:48:34.493-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/107140","id":"107140","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shaon","name":"shaon","key":"shaon","accountId":"557058:1e5e1aa5-5986-4a9e-b9ed-814f7000cd4f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue"},"displayName":"Imran Hossain Shaon","active":true,"timeZone":"America/Los_Angeles"},"body":"[~kshaik], in the description, after second attempt did you want to show the files for {{i-8eacd211}} instead of {{i-7ff82db9}}?\r\n\r\nIn addition to what [~kshaik] said, in the second attempt, NC failed to remove all the artifacts from the current source node (10.104.1.201) when migration was done,\r\n\r\n{noformat}\r\n2016-07-20 00:24:28  INFO 000005088 refresh_instance_info    | [i-8eacd211] migration completed (state='cleaning'), cleaning up\r\n2016-07-20 00:24:28 DEBUG 000005088 change_state             | [i-8eacd211] state change for instance: Running -> Shutoff (Extant)\r\n2016-07-20 00:24:28  INFO 000005088 monitoring_thread        | [i-8eacd211] cleaning up state for instance\r\n2016-07-20 00:24:28 ERROR 000005088 destroy_instance_backing | [i-8eacd211] failed to remove some artifacts in /var/lib/eucalyptus/instances/work/AIDAAJYVO76TMPNFDQ6X3/i-8eacd2\r\n11\r\n2016-07-20 00:24:28 DEBUG 000005088 blobstore_delete_nonblob | [i-8eacd211] removing link-to-vda\r\n2016-07-20 00:24:28 DEBUG 000005088 blobstore_delete_nonblob | [i-8eacd211] removing link-to-vdb\r\n2016-07-20 00:24:28 DEBUG 000005088 blobstore_delete_nonblob | [i-8eacd211] removing instance.xml\r\n2016-07-20 00:24:28 DEBUG 000005088 blobstore_delete_nonblob | [i-8eacd211] removing instance-libvirt.xml\r\n2016-07-20 00:24:28 DEBUG 000005088 blobstore_delete_nonblob | [i-8eacd211] removing console.log\r\n2016-07-20 00:24:28 ERROR 000005088 destroy_instance_backing | [i-8eacd211] failed to remove backing directory /var/lib/eucalyptus/instances/work/AIDAAJYVO76TMPNFDQ6X3/i-8eacd211\r\n2016-07-20 00:24:28 DEBUG 000005088 change_state             | [i-8eacd211] state change for instance: Shutoff -> Teardown (Teardown)\r\n{noformat}\r\n\r\nAfter the second migration, the leftover files may have wrong permission, owned by 'root' instead of 'eucalyptus'?\r\n{code}\r\n# ll /var/lib/eucalyptus/instances/work/AIDAAJYVO76TMPNFDQ6X3/i-8eacd211/\r\ntotal 5242900\r\n-rw-r-----. 1 root       root       2148532224 Jul 20 00:16 emi-a5540bba-14e248fa.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Jul 20 00:24 emi-a5540bba-14e248fa.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         21 Jul 20 00:15 emi-a5540bba-14e248fa.sig\r\n-rw-r-----. 1 root       root       3221225472 Jul 20 00:16 prt-03072ext3-11384fdc.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Jul 20 00:24 prt-03072ext3-11384fdc.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         37 Jul 20 00:15 prt-03072ext3-11384fdc.sig\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shaon","name":"shaon","key":"shaon","accountId":"557058:1e5e1aa5-5986-4a9e-b9ed-814f7000cd4f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue"},"displayName":"Imran Hossain Shaon","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-07-20T15:03:02.154-0500","updated":"2016-07-20T15:03:02.154-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/107178","id":"107178","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=kshaik","name":"kshaik","key":"kshaik","accountId":"557058:c99aa270-2e4b-40a1-a392-ecf800a93a31","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Kasim Shaik","active":true,"timeZone":"US/Central"},"body":"[~shaon], Yes, it was my bad.  I wanted to show the files for i-8eacd211 on Node B (10.104.1.201).","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=kshaik","name":"kshaik","key":"kshaik","accountId":"557058:c99aa270-2e4b-40a1-a392-ecf800a93a31","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/6d01908cb401ffb023e2d01e4f9150c9?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Kasim Shaik","active":true,"timeZone":"US/Central"},"created":"2016-07-21T00:03:43.136-0500","updated":"2016-07-21T00:03:43.136-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/108223","id":"108223","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=jbreiding","name":"jbreiding","key":"jbreiding","accountId":"557058:2be99265-2170-4b3d-8e28-2f0728ab294e","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue"},"displayName":"jeremy breiding","active":true,"timeZone":"US/Central"},"body":"This is likely a side effect of this commit,\r\n6ccb8759a0f150e00f20a7d0bf63416961ee7b7f\r\n\r\nEUCA-12085","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=jbreiding","name":"jbreiding","key":"jbreiding","accountId":"557058:2be99265-2170-4b3d-8e28-2f0728ab294e","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue"},"displayName":"jeremy breiding","active":true,"timeZone":"US/Central"},"created":"2016-08-11T16:29:24.755-0500","updated":"2016-08-11T16:30:07.374-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/109009","id":"109009","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"body":"Unless the directory has +t the files' ownership doesn't matter one iota when it comes to deleting them.  It might be worth checking those files' labels ({{ls -lZ}}) as well as whether or not any AVCs show up in the system's audit logs when the NC goes to delete them.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-16T16:33:35.332-0500","updated":"2016-08-16T16:35:57.694-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/109420","id":"109420","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=jbreiding","name":"jbreiding","key":"jbreiding","accountId":"557058:2be99265-2170-4b3d-8e28-2f0728ab294e","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue"},"displayName":"jeremy breiding","active":true,"timeZone":"US/Central"},"body":"A little further testing...\r\nBuilt euca-blobs from storage folder.\r\n\r\nperformed the following on a node where an instance was migrated to then from attempting to delete.\r\n{noformat}\r\nsu - eucalyptus\r\n./euca-blobs delete /var/lib/eucalyptus/instances/work AIDAAVXZ7FZAMD5OTPYMZ/i-755f465d/emi-90dc8544-3813d3e3\r\nwarning: env variable $EUCALYPTUS is not set, assuming root\r\nerror: failed to open blob 'AIDAAVXZ7FZAMD5OTPYMZ/i-755f465d/emi-90dc8544-3813d3e3': permission denied\r\n{noformat}\r\n\r\n\r\n{noformat}\r\n/var/lib/eucalyptus/instances/work/AIDAAVXZ7FZAMD5OTPYMZ/:\r\ntotal 8\r\ndrwx--x--x. 2 eucalyptus eucalyptus 4096 Aug 24 13:23 i-755f465d\r\ndrwx--x--x. 3 eucalyptus eucalyptus   23 Aug 24 13:18 .\r\ndrwxrwx--x. 6 eucalyptus eucalyptus 4096 Aug 22 14:14 ..\r\n\r\n/var/lib/eucalyptus/instances/work/AIDAAVXZ7FZAMD5OTPYMZ/i-755f465d:\r\ntotal 5242904\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Aug 24 13:27 emi-90dc8544-3813d3e3.lock\r\ndrwx--x--x. 2 eucalyptus eucalyptus\t  4096 Aug 24 13:23 .\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Aug 24 13:23 prt-00120ext3-2d24bf0a.lock\r\n-rw-r-----. 1 root\t root       5243928576 Aug 24 13:19 emi-90dc8544-3813d3e3.blocks\r\n-rw-r-----. 1 root\t root        125829120 Aug 24 13:18 prt-00120ext3-2d24bf0a.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus         36 Aug 24 13:18 prt-00120ext3-2d24bf0a.sig\r\n-rw-r-----. 1 eucalyptus eucalyptus         21 Aug 24 13:18 emi-90dc8544-3813d3e3.sig\r\ndrwx--x--x. 3 eucalyptus eucalyptus         23 Aug 24 13:18 ..\r\n{noformat}\r\n\r\n\r\nchowning instance path to eucalyptus:eucalyptus euca-blob delete does in fact work.\r\n\r\nLeaning back to requirement of chowning prior to instance destroy, not sure there is a downside here.\r\n\r\nInterestingly the files are running under qemu ownership prior to migrating away and end up as root post migration.\r\n\r\npre chown\r\n\r\n{noformat}\r\n/var/lib/eucalyptus/instances/work/AIDAAVXZ7FZAMD5OTPYMZ/:\r\ndrwx--x--x. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 i-755f465d\r\ndrwx--x--x. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 .\r\ndrwxrwx--x. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 ..\r\n\r\n/var/lib/eucalyptus/instances/work/AIDAAVXZ7FZAMD5OTPYMZ/i-755f465d:\r\ndrwx--x--x. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 .\r\n-rw-r-----. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 emi-90dc8544-433a0886.lock\r\n-rw-r-----. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 prt-00120ext3-2d24bf0a.lock\r\n-rw-r-----. root       root       system_u:object_r:virt_image_t:s0 emi-90dc8544-433a0886.blocks\r\n-rw-r-----. root       root       system_u:object_r:virt_image_t:s0 prt-00120ext3-2d24bf0a.blocks\r\n-rw-r-----. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 prt-00120ext3-2d24bf0a.sig\r\n-rw-r-----. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 emi-90dc8544-433a0886.sig\r\ndrwx--x--x. eucalyptus eucalyptus system_u:object_r:virt_image_t:s0 ..\r\n{noformat}\r\n\r\n\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=jbreiding","name":"jbreiding","key":"jbreiding","accountId":"557058:2be99265-2170-4b3d-8e28-2f0728ab294e","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/dc55053b5c09c4537ccb41597d60fece?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Djbreiding%26avatarId%3D17000%26noRedirect%3Dtrue"},"displayName":"jeremy breiding","active":true,"timeZone":"US/Central"},"created":"2016-08-24T15:42:24.690-0500","updated":"2016-08-24T15:42:24.690-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/109514","id":"109514","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"body":"The downside is adding another capability to the process.  Did we ever discover the cause of the failure?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-08-25T13:16:14.912-0500","updated":"2016-08-25T13:16:14.912-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/110826","id":"110826","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Just started looking into this ticket, some initial observations:\r\n\r\n* The NC is failing to delete the files because the NC has to open and be able to understand the blobstore, before it can delete it. Hence the error: 'error: failed to open blob 'AIDAAVXZ7FZAMD5OTPYMZ/i-755f465d/emi-90dc8544-3813d3e3': permission denied'\r\n* The open of the blobstore fails because the files are owned by root.\r\n* The file permission change seems to be a behavior from libvirt as seen in comments from the removed code: https://github.com/eucalyptus/eucalyptus/commit/6ccb8759a0f150e00f20a7d0bf63416961ee7b7f\r\n\r\nTwo ways out of this:\r\n* Revert the change, and add the ability to chown files for this process (only in the work/cache directories)\r\n* Create another code path that brute force removes the files without trying to open them.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-09-28T17:58:07.198-0500","updated":"2016-09-28T17:58:07.198-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/110829","id":"110829","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=vasya","name":"vasya","key":"vasya","accountId":"557058:1c63481a-0634-4ae7-9004-cb0f143e141f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue"},"displayName":"Vasiliy Kochergin","active":false,"timeZone":"America/Los_Angeles"},"body":"[~sgraham], thank you for your research. I think [~gholms] was always really vocal against adding any new abilities to processes. I'd think we have to go with brute force removal. Does NC have a way to remove files owned by root via root_wrapper?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=vasya","name":"vasya","key":"vasya","accountId":"557058:1c63481a-0634-4ae7-9004-cb0f143e141f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue"},"displayName":"Vasiliy Kochergin","active":false,"timeZone":"America/Los_Angeles"},"created":"2016-09-28T18:24:06.279-0500","updated":"2016-09-28T18:24:06.279-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/110832","id":"110832","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"[~vasya] Shouldn't need to use root_wrapper, the directory is owned by eucalyptus so the delete of the file will work if it is owned by root.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-09-28T22:54:48.820-0500","updated":"2016-09-28T22:54:48.820-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/110921","id":"110921","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Doesn't the node controller already have this capability?\r\nfrom: https://github.com/eucalyptus/eucalyptus-selinux/blob/master/eucalyptus.te#L286\r\n{code}\r\nallow eucalyptus_node_t self:capability { chown dac_override fowner kill setgid setuid };\r\n{code}\r\n\r\nI think allowing the process to chown the files is what we are going to have to revert back to. The process needs to open these files in order to detach them from the system (dmsetup, losetup, etc), before deleting the files themselves. The way this happens is by opening up the blobstore. I agree that the NC shouldn't *have* to do the chown, but this is something out of our control given that libvirt is the one modifying the ownership of the files. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-09-29T17:04:08.034-0500","updated":"2016-09-29T17:04:08.034-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/111148","id":"111148","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"body":"There's granting the process the capability, and then there is actually allowing the process to use it on VMs' files.  As that is the process with the greatest level of exposure to untrusted workloads it behooves us to make the NC's policy as restrictive as we reasonably can.  dmsetup and losetup don't run as eucalyptus_node_t, so we should focus specifically on what the NC's process needs to read.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-10-04T19:17:06.581-0500","updated":"2016-10-04T19:17:06.581-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/112833","id":"112833","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"body":"Why are the six comments above private?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=gholms","name":"gholms","key":"gholms","accountId":"557058:6e5fdc25-c797-4d3d-8fd4-55c3c4ed99b0","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3e16def22dd4a96dbe507df70f15f37f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dgholms%26avatarId%3D18100%26noRedirect%3Dtrue"},"displayName":"Garrett Holmstrom","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-11-09T15:27:11.173-0600","updated":"2016-11-09T15:27:11.173-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113266","id":"113266","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"I've got a working libvirt hook script for qemu that correctly changes the ownership back to eucalyptus.eucalyptus. The output below is what the directory looks like as the instance is getting migrated out, without the fix, the .blocks files, along with .lock/.sig would not get removed correctly.\r\n\r\n{code}\r\n[root@g-05-06 ~]# ls -l /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/\r\ntotal 5248032\r\n-rw-------. 1 qemu       qemu                0 Nov 21 16:38 console.log\r\n-rw-r-----. 1 qemu       qemu       2367684608 Nov 21 16:39 emi-94d3caff-811dd46f.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Nov 21 16:38 emi-94d3caff-811dd46f.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         21 Nov 21 16:38 emi-94d3caff-811dd46f.sig\r\n-rw-r--r--. 1 eucalyptus eucalyptus       1514 Nov 21 16:38 instance-libvirt.xml\r\n-rw-rw----. 1 eucalyptus eucalyptus       6273 Nov 21 16:40 instance.xml\r\nlrwxrwxrwx. 1 eucalyptus eucalyptus         96 Nov 21 16:38 link-to-vda -> /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/emi-94d3caff-811dd46f.blocks\r\nlrwxrwxrwx. 1 eucalyptus eucalyptus         97 Nov 21 16:38 link-to-vdb -> /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/prt-02868ext3-abe6af7a.blocks\r\n-rw-r-----. 1 qemu       qemu       3007315968 Nov 21 16:39 prt-02868ext3-abe6af7a.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Nov 21 16:38 prt-02868ext3-abe6af7a.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         37 Nov 21 16:38 prt-02868ext3-abe6af7a.sig\r\n[root@g-05-06 ~]# ls -l /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/\r\ntotal 5248032\r\n-rw-------. 1 root       root                0 Nov 21 16:38 console.log\r\n-rw-r-----. 1 eucalyptus eucalyptus 2367684608 Nov 21 16:39 emi-94d3caff-811dd46f.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Nov 21 16:38 emi-94d3caff-811dd46f.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         21 Nov 21 16:38 emi-94d3caff-811dd46f.sig\r\n-rw-r--r--. 1 eucalyptus eucalyptus       1514 Nov 21 16:38 instance-libvirt.xml\r\n-rw-rw----. 1 eucalyptus eucalyptus       6272 Nov 21 16:41 instance.xml\r\nlrwxrwxrwx. 1 eucalyptus eucalyptus         96 Nov 21 16:38 link-to-vda -> /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/emi-94d3caff-811dd46f.blocks\r\nlrwxrwxrwx. 1 eucalyptus eucalyptus         97 Nov 21 16:38 link-to-vdb -> /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/prt-02868ext3-abe6af7a.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus 3007315968 Nov 21 16:39 prt-02868ext3-abe6af7a.blocks\r\n-rw-r-----. 1 eucalyptus eucalyptus          0 Nov 21 16:38 prt-02868ext3-abe6af7a.lock\r\n-rw-r-----. 1 eucalyptus eucalyptus         37 Nov 21 16:38 prt-02868ext3-abe6af7a.sig\r\n[root@g-05-06 ~]# ls -l /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/\r\nls: cannot access /var/lib/eucalyptus/instances/work/AIDAAVDIBQDQT7QOAJTTS/i-9f9dc85a/: No such file or directory\r\n{code}\r\n\r\nThe following script, when placed in the file: /etc/libvirt/hooks/qemu does the trick (it can be any kind of script/executable). I need to do a little more cleanup on it. \r\n{code}\r\n#!/usr/bin/python\r\n\r\n#\r\n#\r\n#\r\nimport os\r\nimport grp\r\nimport pwd\r\nimport sys\r\nimport xml.etree.ElementTree as ET\r\n\r\nEUCA_CONFIG = '/etc/eucalyptus/eucalyptus.conf'\r\nEUCA_USER_TOKEN = 'EUCA_USER'\r\nEUCA_USER = 'eucalyptus' # if we can't find a user in the config\r\n\r\n# Add checks\r\ndef get_euca_user():\r\n    with open(EUCA_CONFIG) as f:\r\n       for line in f:\r\n          if line.startswith('EUCA_USER_TOKEN'):\r\n              return line[:-1].split('=')[1].replace('\"','')\r\n    return EUCA_USER\r\n\r\ndef get_uid_gid(username):\r\n    pwd_user = pwd.getpwnam(username)\r\n    return (pwd_user.pw_uid, pwd_user.pw_gid)\r\n\r\ndef get_instance_workdir(domain_config):\r\n    '''\r\n    Parse an libvirt XML domain config and look for the <devices><disk> configurations so we can\r\n    determine the instance's working directory\r\n\r\n    returns:  instance working directory from the first disk configuration it finds\r\n              None if no directory found\r\n    '''\r\n    disks = domain_config.findall('devices/disk')\r\n    for disk in disks:\r\n        if disk.attrib['device'] == 'disk':\r\n            source = disk.find('source')\r\n            if disk.attrib['type'] == 'block':\r\n                bs_attrib = 'dev'\r\n            elif disk.attrib['type'] == 'file':\r\n                bs_attrib = 'file'\r\n            backingstore = source.attrib[bs_attrib]\r\n            h, t = os.path.split(backingstore)\r\n            if t.startswith('link-to-'):\r\n                return h\r\n    return None\r\n\r\nif __name__ == '__main__':\r\n\r\n        if len(sys.argv) > 4:\r\n            domain = sys.argv[1]\r\n            operation = sys.argv[2]\r\n            sub_operation = sys.argv[3]\r\n            extra = sys.argv[4]\r\n\r\n            #\r\n            # We only care about the 'release/end' operation for a domain\r\n            # For some reason qemu likes to chown the *.blocks files to root.root\r\n            # This script will chown back to eucalyptus.eucalyptus (found via passwd file)\r\n            # so that the node controller is happy\r\n            #\r\n            if domain.startswith('i-') and operation == 'release' and sub_operation == 'end':\r\n                euca_user = get_euca_user()\r\n                uid,gid = get_uid_gid(euca_user)\r\n\r\n                # libvirt passes XML to us on stdin\r\n                domain_str = \"\".join(sys.stdin.readlines())\r\n                domain_config = ET.fromstring(domain_str)\r\n\r\n                instance_dir = get_instance_workdir(domain_config)\r\n                if instance_dir is not None:\r\n                   block_files = [i for i in os.listdir(instance_dir) if i.endswith('.blocks')]\r\n                   for file in block_files:\r\n                       os.chown(os.path.join(instance_dir,file), uid, gid)\r\n\r\n{code}\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-11-21T19:03:38.868-0600","updated":"2016-11-21T19:03:38.868-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113275","id":"113275","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Additional note: (without the fix) If a user tries to migrate an instance *back* to the Node Controller, the operation will fail because the instance work directory still exists.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-11-22T10:44:13.988-0600","updated":"2016-11-22T10:44:13.988-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113311","id":"113311","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"In doing some more testing after discussing the issue with [~dmitrii] over IRC, I made the assertion that this happens on instance termination. \r\n\r\nIt is looking like this happens when an instance has been migrated and only shows up on the 'second' migration, and or termination after it has been migrated. \r\n\r\nThis makes sense given that libvirt/qemu is *creating* the .blocks files when it is copying them over to the new node controller. At that point if the user migrates or terminates the instance the files are no longer owned by eucalyptus.eucalyptus, they are owned by qemu.qemu or root.root. \r\n\r\nThe instance that I terminated, had been migrated.\r\n\r\nJust to recap:\r\n# Issue doesn't seem to occur on instances that have never been migrated\r\n# Issue occurs on second migration\r\n# Issue occurs on termination of migrated instance. \r\n\r\nI'll try and see if the customer reported issues were migrations, I've been told they were not. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-11-22T19:06:58.887-0600","updated":"2016-11-22T19:06:58.887-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113318","id":"113318","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"from: https://libvirt.org/hooks.html - \"If a hook script is added to a host after the libvirt daemon is already running, it won't be used until the libvirt daemon next starts.\"\r\n\r\nI didn't run into this because I was testing with migrations, the NC has to restart libvirtd in order to authorize clients. So a restart of libvirtd is required in order for the hook to execute. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-11-23T11:38:49.844-0600","updated":"2016-11-23T11:38:49.844-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113328","id":"113328","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"body":"I'd like to rule out this happening on normal instance termination. We cannot reproduce that in house (Steve G tried and QA team tried), but that's apparently what's happening on customer sites. Gotta dig into logs.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"created":"2016-11-23T16:19:41.095-0600","updated":"2016-11-23T16:19:41.095-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113410","id":"113410","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"I tried restarts of libvirtd and the permissions stayed the same. \r\nTried killing instances as they were launching as I saw evidence of this in the logs, no permissions change.\r\nI don't see anything in the logs pointing to a smoking gun.\r\n\r\nLooked through more logs and most of the .blocks files are owned by root and I didn't see any migrations, so the perms are definitely changing without a migration.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-11-28T12:24:17.364-0600","updated":"2016-11-28T12:24:17.364-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113910","id":"113910","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"[~sgraham], I too was prepared for this in 4.3.1. Is there a reason that now that is in question?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2016-12-05T12:36:09.233-0600","updated":"2016-12-05T12:36:09.233-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113912","id":"113912","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"[~tony] Ok, cool. [~gholms] mentioned that he thought we weren't going to fix it, given a conversation with Dima about it. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-12-05T12:44:26.938-0600","updated":"2016-12-05T12:44:26.938-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113914","id":"113914","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"body":"Thanks, [~sgraham]. Given that we're seeing this with non-migrated instances, this should be in 4.3.1. Earlier that wasn't clear.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"created":"2016-12-05T12:47:55.390-0600","updated":"2016-12-05T12:47:55.390-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113915","id":"113915","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=vasya","name":"vasya","key":"vasya","accountId":"557058:1c63481a-0634-4ae7-9004-cb0f143e141f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue"},"displayName":"Vasiliy Kochergin","active":false,"timeZone":"America/Los_Angeles"},"body":"[~tony], do you see this issue for non-migrating instances?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=vasya","name":"vasya","key":"vasya","accountId":"557058:1c63481a-0634-4ae7-9004-cb0f143e141f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue"},"displayName":"Vasiliy Kochergin","active":false,"timeZone":"America/Los_Angeles"},"created":"2016-12-05T12:59:56.435-0600","updated":"2016-12-05T12:59:56.435-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113927","id":"113927","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"[~vasya] I wasn't able to reproduce the issue with non-migrated instances, nor was support. But the customer logs indicate that it was happening on non-migrated instances. I suspect QA won't be able to reproduce the issue either, given I used quicklaunch. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-12-05T15:08:43.924-0600","updated":"2016-12-05T15:08:43.924-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/113929","id":"113929","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Testing Notes:\r\n\r\nIn order to verify the fix is correct you need to do the following with at least 2 node controllers:\r\nInstance work dir: /var/lib/eucalyptus/instances/work/ACCOUNTHASH/<instance_id>\r\n\r\nNode A - starting node\r\nNode B - destination Node\r\n\r\nh5. Second Migration\r\n* migrate an instance to Node B\r\n** Look at the instance work directory and you should notice that the .blocks files are owned by 'qemu' after migration.\r\n* Migrate the instance back to Node A\r\n\r\n*Expected:* Instance files should be properly removed from Node B, and you should be able to migrate back to Node B\r\n\r\nh5. Migrate then Terminate \r\n* Migrate an instance to Node B\r\n** Look a the instance work directory, verify blocks are owned by 'qemu'\r\n* Terminate the instance on Node B\r\n\r\n*Expected:* Instance files should be properly removed from Node B","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2016-12-05T15:18:33.248-0600","updated":"2016-12-05T15:20:16.565-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/46217/comment/114136","id":"114136","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shaon","name":"shaon","key":"shaon","accountId":"557058:1e5e1aa5-5986-4a9e-b9ed-814f7000cd4f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue"},"displayName":"Imran Hossain Shaon","active":true,"timeZone":"America/Los_Angeles"},"body":"Verified.\r\n\r\n*Installed Packages*\r\n{code}\r\nName        : eucalyptus\r\nArch        : x86_64\r\nVersion     : 4.3.1\r\nRelease     : 0.25167.82.20161207git13777bb.el7\r\nSize        : 262 k\r\nRepo        : installed\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shaon","name":"shaon","key":"shaon","accountId":"557058:1e5e1aa5-5986-4a9e-b9ed-814f7000cd4f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/70d1c1681d03ea38518d3b4f59db4385?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dshaon%26avatarId%3D11900%26noRedirect%3Dtrue"},"displayName":"Imran Hossain Shaon","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-12-08T13:34:37.019-0600","updated":"2016-12-08T13:34:37.019-0600"}],"maxResults":26,"total":26,"startAt":0},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}