{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"54602","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602","key":"EUCA-13216","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18100","id":"18100","description":"Eucalyptus 4.4.0","name":"4.4.0","archived":false,"released":true,"releaseDate":"2017-03-07"}],"customfield_11001":null,"aggregatetimespent":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/7","id":"7","description":"Signifies completion of tasks, info requests, etc.","name":"Completed"},"customfield_10310":null,"customfield_10311":null,"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"customfield_11400":null,"customfield_10302":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10104":[],"customfield_10105":null,"customfield_10303":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":null,"customfield_10703":null,"customfield_10704":null,"customfield_10308":null,"resolutiondate":"2017-03-15T23:14:07.480-0500","customfield_10705":null,"customfield_10309":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13216/watchers","watchCount":5,"isWatching":false},"created":"2017-02-09T11:58:59.573-0600","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12201":null,"customfield_10102":null,"customfield_12600":"{repository={count=3, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":3,\"lastUpdated\":\"2017-02-14T14:24:57.000-0600\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":3,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10300":null,"customfield_10301":null,"labels":[],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18100","id":"18100","description":"Eucalyptus 4.4.0","name":"4.4.0","archived":false,"released":true,"releaseDate":"2017-03-07"}],"issuelinks":[{"id":"48906","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/48906","type":{"id":"10100","name":"Blocks","inward":"is blocked by","outward":"blocks","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10100"},"outwardIssue":{"id":"54510","key":"EUCA-13209","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54510","fields":{"summary":"Snapshot deltas not limited by X.storage.maxsnapshotdeltas when old snapshots deleted","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/1","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}},{"id":"48907","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/48907","type":{"id":"10100","name":"Blocks","inward":"is blocked by","outward":"blocks","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10100"},"outwardIssue":{"id":"54512","key":"EUCA-13211","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54512","fields":{"summary":"Snapshot delta count incorrect when base snapshot deleted","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ccassler","name":"ccassler","key":"ccassler","accountId":"557058:8fb32702-a3cf-42d3-9846-95c74f801354","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue"},"displayName":"Casey Cassler","active":true,"timeZone":"America/Los_Angeles"},"updated":"2017-03-15T23:14:07.491-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10014","id":"10014","name":"Storage Controller"}],"timeoriginalestimate":null,"customfield_13000":null,"description":"When zones do not share ceph resources snapshot artifacts are copied between zones using s3. After snapshots are deleted and a new snapshot is created creating a volume in another zone incorrectly uses the deltas that are unused but not yet deleted.\r\n\r\nSnapshots that are present:\r\n\r\n{code}\r\neucalyptus_shared=# select start_time, version, status, volume_name, snapshot_name, previous_snapshot_id from eucalyptus_storage.snapshots order by start_time;\r\n       start_time        | version |     status     | volume_name  | snapshot_name | previous_snapshot_id \r\n-------------------------+---------+----------------+--------------+---------------+----------------------\r\n 2017-02-08 23:17:30.484 |      20 | available      | vol-2ff24667 | snap-1df39b05 | \r\n 2017-02-08 23:20:01.618 |       6 | deletedfromebs | vol-2ff24667 | snap-06aad259 | snap-1df39b05\r\n 2017-02-08 23:20:20.485 |       6 | deletedfromebs | vol-2ff24667 | snap-77af8f79 | snap-06aad259\r\n 2017-02-08 23:22:47.738 |      22 | deletedfromebs | vol-2ff24667 | snap-e13ab86e | snap-77af8f79\r\n 2017-02-08 23:22:59.155 |       6 | deletedfromebs | vol-2ff24667 | snap-05125088 | snap-e13ab86e\r\n 2017-02-08 23:23:10.179 |       6 | deletedfromebs | vol-2ff24667 | snap-a19d05ca | snap-05125088\r\n 2017-02-08 23:23:21.613 |       6 | deletedfromebs | vol-2ff24667 | snap-2a5a2651 | snap-a19d05ca\r\n 2017-02-08 23:23:28.575 |       6 | deletedfromebs | vol-2ff24667 | snap-41ea4da2 | snap-2a5a2651\r\n 2017-02-08 23:23:39.868 |       6 | deletedfromebs | vol-2ff24667 | snap-ddef8fb7 | snap-41ea4da2\r\n 2017-02-08 23:23:51.378 |       6 | deletedfromebs | vol-2ff24667 | snap-2fbaa4f5 | snap-ddef8fb7\r\n 2017-02-08 23:23:58.198 |       6 | deletedfromebs | vol-2ff24667 | snap-9486242e | snap-2fbaa4f5\r\n 2017-02-08 23:24:09.506 |       6 | deletedfromebs | vol-2ff24667 | snap-2571f0ca | snap-9486242e\r\n 2017-02-08 23:26:09.257 |      22 | deletedfromebs | vol-2ff24667 | snap-d952ae4c | snap-2571f0ca\r\n 2017-02-08 23:26:25.4   |       6 | deletedfromebs | vol-2ff24667 | snap-4f3ed0d1 | snap-d952ae4c\r\n 2017-02-08 23:26:41.774 |       6 | deletedfromebs | vol-2ff24667 | snap-3558d08a | snap-4f3ed0d1\r\n 2017-02-08 23:26:48.672 |       6 | deletedfromebs | vol-2ff24667 | snap-18532b03 | snap-3558d08a\r\n 2017-02-08 23:26:59.954 |       7 | deleted        | vol-2ff24667 | snap-173f6526 | snap-18532b03\r\n 2017-02-08 23:27:11.424 |       7 | deleted        | vol-2ff24667 | snap-4ed9810f | snap-173f6526\r\n 2017-02-08 23:27:18.752 |       7 | deleted        | vol-2ff24667 | snap-affef78f | snap-4ed9810f\r\n 2017-02-08 23:27:30.073 |       7 | deleted        | vol-2ff24667 | snap-f1e052ed | snap-affef78f\r\n 2017-02-08 23:27:42.453 |       7 | deleted        | vol-2ff24667 | snap-e4cbce87 | snap-f1e052ed\r\n 2017-02-08 23:27:49.318 |       7 | deleted        | vol-2ff24667 | snap-64f84797 | snap-e4cbce87\r\n 2017-02-08 23:28:01.762 |       7 | deleted        | vol-2ff24667 | snap-86584ec1 | snap-64f84797\r\n 2017-02-08 23:28:08.573 |       7 | deleted        | vol-2ff24667 | snap-f7f1ac08 | snap-86584ec1\r\n 2017-02-08 23:28:20.697 |       7 | deleted        | vol-2ff24667 | snap-755305b5 | snap-f7f1ac08\r\n 2017-02-08 23:28:33.114 |       7 | deleted        | vol-2ff24667 | snap-aa157fd5 | snap-755305b5\r\n 2017-02-08 23:28:49.87  |       7 | deleted        | vol-2ff24667 | snap-247fb69e | snap-aa157fd5\r\n 2017-02-08 23:29:02.088 |       7 | deleted        | vol-2ff24667 | snap-afe16d2e | snap-247fb69e\r\n 2017-02-08 23:29:18.807 |       7 | deleted        | vol-2ff24667 | snap-df446f5a | snap-afe16d2e\r\n 2017-02-08 23:29:30.928 |       7 | deleted        | vol-2ff24667 | snap-f1267c2d | snap-df446f5a\r\n 2017-02-08 23:29:43.372 |       7 | deleted        | vol-2ff24667 | snap-3fd063bc | snap-f1267c2d\r\n 2017-02-08 23:30:01.053 |       7 | deleted        | vol-2ff24667 | snap-4f65e723 | snap-3fd063bc\r\n 2017-02-08 23:30:08.162 |       7 | deleted        | vol-2ff24667 | snap-21ab367f | snap-4f65e723\r\n 2017-02-08 23:30:20.65  |       7 | deleted        | vol-2ff24667 | snap-709ac0ef | snap-21ab367f\r\n 2017-02-08 23:30:32.967 |       7 | deleted        | vol-2ff24667 | snap-62326476 | snap-709ac0ef\r\n 2017-02-08 23:30:50.694 |       7 | deleted        | vol-2ff24667 | snap-e00b0400 | snap-62326476\r\n 2017-02-08 23:31:02.991 |       7 | deleted        | vol-2ff24667 | snap-c79688b2 | snap-e00b0400\r\n 2017-02-08 23:31:20.876 |       7 | deleted        | vol-2ff24667 | snap-123bf519 | snap-c79688b2\r\n 2017-02-08 23:31:33.142 |       7 | deleted        | vol-2ff24667 | snap-050c0dfb | snap-123bf519\r\n 2017-02-08 23:31:50.836 |       7 | deleted        | vol-2ff24667 | snap-96139c3e | snap-050c0dfb\r\n 2017-02-08 23:32:03.725 |       7 | deleted        | vol-2ff24667 | snap-0e4563cf | snap-96139c3e\r\n 2017-02-08 23:32:21.559 |       7 | deleted        | vol-2ff24667 | snap-1f7b2ce9 | snap-0e4563cf\r\n 2017-02-08 23:32:29.172 |       7 | deleted        | vol-2ff24667 | snap-4a93e32d | snap-1f7b2ce9\r\n 2017-02-08 23:32:41.535 |       7 | deleted        | vol-2ff24667 | snap-87aa47ea | snap-4a93e32d\r\n 2017-02-08 23:32:59.378 |       7 | deleted        | vol-2ff24667 | snap-6495ab7b | snap-87aa47ea\r\n 2017-02-08 23:33:11.484 |       7 | deleted        | vol-2ff24667 | snap-0abfa068 | snap-6495ab7b\r\n 2017-02-08 23:33:29.252 |       7 | deleted        | vol-2ff24667 | snap-1e7f3757 | snap-0abfa068\r\n 2017-02-08 23:33:41.595 |       7 | deleted        | vol-2ff24667 | snap-0867ba30 | snap-1e7f3757\r\n 2017-02-08 23:33:59.412 |       7 | deleted        | vol-2ff24667 | snap-7f789b00 | snap-0867ba30\r\n 2017-02-08 23:34:11.612 |       7 | deleted        | vol-2ff24667 | snap-7610f2ad | snap-7f789b00\r\n 2017-02-08 23:39:36.392 |      20 | available      | vol-2ff24667 | snap-31bbf740 | snap-1df39b05\r\n(51 rows)\r\n{code}\r\n\r\nSo the most recently created snap-31bbf740 snapshot is correctly created with the parent snap-1df39b05 skipping many deltas that were created more recently than snap-1df39b05 but are in the process of being deleted.\r\n\r\nWhen restoring in the second zone all deltas are used, leading to a failure when trying to restore one of the deltas that has been deleted:\r\n\r\n{code}\r\nWed Feb 8 23:50:31 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Download snap-9486242e (delta from snap-2fbaa4f5) and restore it on snap-31bbf740\r\nWed Feb 8 23:50:31 2017  INFO [CephRbdProvider:eucalyptus-storage-volumecreator-worker-564] Restoring delta on base=tempsnap/snap-31bbf740, snapshotId=snap-9486242e, snapsDeltaFile=/var/tmp/snap-\r\n9486242e_snap-2fbaa4f5_8850424907212531999.diff\r\nWed Feb 8 23:50:32 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Download snap-2571f0ca (delta from snap-9486242e) and restore it on snap-31bbf740\r\nWed Feb 8 23:50:32 2017  INFO [CephRbdProvider:eucalyptus-storage-volumecreator-worker-564] Restoring delta on base=tempsnap/snap-31bbf740, snapshotId=snap-2571f0ca, snapsDeltaFile=/var/tmp/snap-\r\n2571f0ca_snap-9486242e_2575109951653026891.diff\r\nWed Feb 8 23:50:33 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Download snap-d952ae4c (delta from snap-2571f0ca) and restore it on snap-31bbf740\r\nWed Feb 8 23:50:33 2017  INFO [CephRbdProvider:eucalyptus-storage-volumecreator-worker-564] Restoring delta on base=tempsnap/snap-31bbf740, snapshotId=snap-d952ae4c, snapsDeltaFile=/var/tmp/snap-\r\nd952ae4c_snap-2571f0ca_6578824100803433994.diff\r\nWed Feb 8 23:50:34 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Download snap-4f3ed0d1 (delta from snap-d952ae4c) and restore it on snap-31bbf740\r\nWed Feb 8 23:50:34 2017  INFO [CephRbdProvider:eucalyptus-storage-volumecreator-worker-564] Restoring delta on base=tempsnap/snap-31bbf740, snapshotId=snap-4f3ed0d1, snapsDeltaFile=/var/tmp/snap-\r\n4f3ed0d1_snap-d952ae4c_9194426875582989427.diff\r\nWed Feb 8 23:50:35 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Download snap-3558d08a (delta from snap-4f3ed0d1) and restore it on snap-31bbf740\r\nWed Feb 8 23:50:35 2017  INFO [CephRbdProvider:eucalyptus-storage-volumecreator-worker-564] Restoring delta on base=tempsnap/snap-31bbf740, snapshotId=snap-3558d08a, snapsDeltaFile=/var/tmp/snap-\r\n3558d08a_snap-4f3ed0d1_591626396826044901.diff\r\nWed Feb 8 23:50:36 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Download snap-18532b03 (delta from snap-3558d08a) and restore it on snap-31bbf740\r\nWed Feb 8 23:50:36 2017  INFO [CephRbdProvider:eucalyptus-storage-volumecreator-worker-564] Restoring delta on base=tempsnap/snap-31bbf740, snapshotId=snap-18532b03, snapsDeltaFile=/var/tmp/snap-\r\n18532b03_snap-3558d08a_970243323255088135.diff\r\nWed Feb 8 23:50:37 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Download snap-173f6526 (delta from snap-18532b03) and restore it on snap-31bbf740\r\nWed Feb 8 23:50:37 2017  WARN [S3SnapshotTransfer:eucalyptus-storage-volumecreator-worker-564] Failed to download snapshot from objectstorage: snapshotId=snap-173f6526, bucket=snapshots-47f4f8597\r\n07c48009c85e286c4246c15, key=snap-173f6526\r\nWed Feb 8 23:50:37 2017 ERROR [VolumeCreator:eucalyptus-storage-volumecreator-worker-564] Failed to create volume vol-cd12a00c\r\ncom.eucalyptus.blockstorage.exceptions.SnapshotTransferException: Failed to download snapshot from objectstorage: snapshotId=snap-173f6526, bucket=snapshots-47f4f859707c48009c85e286c4246c15, key=\r\nsnap-173f6526\r\n        at com.eucalyptus.blockstorage.S3SnapshotTransfer.download(S3SnapshotTransfer.java:774)\r\n        at com.eucalyptus.blockstorage.S3SnapshotTransfer.download(S3SnapshotTransfer.java:458)\r\n        at com.eucalyptus.blockstorage.async.VolumeCreator.downloadAndRestoreDelta(VolumeCreator.java:628)\r\n        at com.eucalyptus.blockstorage.async.VolumeCreator.run(VolumeCreator.java:256)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n        at java.lang.Thread.run(Thread.java:745)\r\nCaused by: com.eucalyptus.blockstorage.exceptions.SnapshotTransferException: Snapshot transfer operation failed because of\r\n        at com.eucalyptus.blockstorage.S3SnapshotTransfer.retryAfterRefresh(S3SnapshotTransfer.java:967)\r\n        at com.eucalyptus.blockstorage.S3SnapshotTransfer.download(S3SnapshotTransfer.java:762)\r\n        ... 6 more\r\nCaused by: com.amazonaws.services.s3.model.AmazonS3Exception: Status Code: 404, AWS Service: Amazon S3, AWS Request ID: 74ebb026-6212-4aae-99cc-0be8914d877f, AWS Error Code: NoSuchKey, AWS Error \r\nMessage: The specified key does not exist., S3 Extended Request ID: null\r\n        at com.amazonaws.http.AmazonHttpClient.handleErrorResponse(AmazonHttpClient.java:773)\r\n        at com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:417)\r\n        at com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:229)\r\n        at com.amazonaws.services.s3.AmazonS3Client.invoke(AmazonS3Client.java:3384)\r\n        at com.amazonaws.services.s3.AmazonS3Client.getObject(AmazonS3Client.java:1093)\r\n        at com.eucalyptus.objectstorage.client.EucaS3Client.getObject(EucaS3Client.groovy:109)\r\n        at com.eucalyptus.blockstorage.S3SnapshotTransfer$4.apply(S3SnapshotTransfer.java:768)\r\n        at com.eucalyptus.blockstorage.S3SnapshotTransfer$4.apply(S3SnapshotTransfer.java:762)\r\n        at com.eucalyptus.blockstorage.S3SnapshotTransfer.retryAfterRefresh(S3SnapshotTransfer.java:958)\r\n        ... 7 more\r\n{code}\r\n\r\nOnce this occurs it is not possible to create a volume from the snapshot even after all the deltas have been cleaned up:\r\n\r\n{code}\r\nThu Feb 9 09:44:10 2017  INFO [BlockStorageController:eucalyptus-bootstrap-servicecontext-common-worker-377] Processing CreateStorageVolume request for volume vol-6cf2db5b\r\nThu Feb 9 09:44:10 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-442] snap-31bbf740 is an incremental snapshot orignating from az one\r\nThu Feb 9 09:44:10 2017  INFO [VolumeCreator:eucalyptus-storage-volumecreator-worker-442] Create base container for snap-31bbf740 and restore it with snap-1df39b05\r\nThu Feb 9 09:44:10 2017  WARN [VolumeCreator:eucalyptus-storage-volumecreator-worker-442] Failed to download base snap-1df39b05 for restoring snap-31bbf740\r\nThu Feb 9 09:44:10 2017 ERROR [VolumeCreator:eucalyptus-storage-volumecreator-worker-442] Failed to create volume vol-6cf2db5b\r\ncom.eucalyptus.util.EucalyptusCloudException: Failed to download base snap-1df39b05 for restoring snap-31bbf740\r\n        at com.eucalyptus.blockstorage.async.VolumeCreator.downloadAndRestoreBase(VolumeCreator.java:599)\r\n        at com.eucalyptus.blockstorage.async.VolumeCreator.run(VolumeCreator.java:250)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n        at java.lang.Thread.run(Thread.java:745)\r\n{code}\r\n\r\nThis was tried after restarting the storage controller and waiting ~12 hours.\r\n\r\nThe following storage metadata is present for the snapshot:\r\n\r\n{code}\r\neucalyptus_shared=# select creation_timestamp, volumeid, iqn, scname, status from eucalyptus_storage.san_volume_info where volumeid='snap-31bbf740';\r\n   creation_timestamp    |   volumeid    |            iqn            | scname | status \r\n-------------------------+---------------+---------------------------+--------+--------\r\n 2017-02-08 23:39:36.51  | snap-31bbf740 | eucaqa_snap/snap-31bbf740 | one    | \r\n 2017-02-08 23:50:02.347 | snap-31bbf740 | tempsnap/snap-31bbf740    | two    | \r\n(2 rows)\r\n{code}\r\n\r\nThis was seen with 50 snapshot deltas, when clean up of deleted snapshots takes > 10 minutes.","customfield_13200":null,"customfield_11300":"EUCA-5313","customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/39803","id":"39803","filename":"Snapshot reconstruction bug.gliffy","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=addon_com.gliffy.integration.jira","name":"addon_com.gliffy.integration.jira","key":"addon_com.gliffy.integration.jira","accountId":"557058:8f10a0a5-d759-4932-8870-eac8ad18fc0a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4145cc1cfb434da684155400a72fed2c?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4145cc1cfb434da684155400a72fed2c?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4145cc1cfb434da684155400a72fed2c?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4145cc1cfb434da684155400a72fed2c?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Gliffy Diagrams for JIRA Cloud","active":true,"timeZone":"US/Central"},"created":"2017-02-24T16:08:03.414-0600","size":16612,"mimeType":"application/octet-stream","content":"https://eucalyptus.atlassian.net/secure/attachment/39803/Snapshot+reconstruction+bug.gliffy"}],"summary":"Snapshot deltas creating volume in another zone uses incorrect deltas","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"customfield_10000":"3_*:*_1_*:*_349324564_*|*_10000_*:*_1_*:*_15127478_*|*_10002_*:*_1_*:*_43710619_*|*_10001_*:*_1_*:*_31863084_*|*_10003_*:*_1_*:*_784878207_*|*_10006_*:*_1_*:*_0","customfield_12100":"0|i042lb:","aggregateprogress":{"progress":0,"total":0},"customfield_10001":"2017-02-09T15:50:50.978-0600","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_12500":null,"customfield_10400":null,"customfield_10116":null,"customfield_11600":["ccassler(ccassler)","lbiasi(lbiasi)","lincoln.thomas(lincoln.thomas)","sjones(sjones)"],"environment":null,"customfield_10117":null,"customfield_11800":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"}],"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13216/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117406","id":"117406","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"I found the same issue while investigating EUCA-13209 and EUCA-13211 today, and I already have a fix for this one. It's not the same fix as the fix for the other two.\r\n\r\nBasically, when we go to construct a volume from a snapshot, and we have to reconstruct the snapshot image from deltas (because the snapshot is not available on the ceph pools this SC can access), there's a bug:\r\n\r\nIt looks for the most recent full snapshot that is not deleted (but could be in the earlier 'deletedfromebs' or 'deleted' state). It then applies all the deltas in the chain from that full snapshot, in time order, ending with the snapshot from which the volume is being created.\r\n\r\nHowever, a delta snapshot could have been created from a snapshot chain that is *_not_* the most recent chain at the time it was created. This will happen if all of the snapshots (full and deltas) in that most recent chain are in either the 'deleting' or 'deletedfromebs' state. Then the snapshot will be created from the latest snapshot from the latest chain that has a non-deleted snapshot. This snapshot is created correctly.\r\n\r\nSo, when creating a volume from this snapshot, it fails because this delta is not part of that latest chain.\r\n\r\nThis fix, which is easy, is to follow the linked list of parent snapshots, from the one being used to create a volume to its starting full snapshot, and then apply the deltas in time order using that linked list.\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-09T15:50:50.978-0600","updated":"2017-02-09T16:10:49.237-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117409","id":"117409","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"The storage metadata issue in the Description is still under investigation.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-09T16:12:59.714-0600","updated":"2017-02-09T16:12:59.714-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117411","id":"117411","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"An even simpler error case:\r\n\r\nWhen creating a snapshot X: If the most recent snapshot is in 'deleting' or 'deletedfromebs' state, but there is an earlier snapshot in the same chain that is *_not_* in a 'delet*' state, and max deltas has not yet been exceeded, then snapshot X will be created as a delta from the earlier snapshot in the chain. This is correct.\r\n\r\nThen, when creating a volume from snapshot X, reconstructing the snapshot image will fail because the time-ordered deltas in that chain are not in same order as the linked list of deltas ending at snapshot X.\r\n\r\nShown in the attached gliffy diagram. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-09T16:52:18.061-0600","updated":"2017-02-24T16:24:39.710-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117532","id":"117532","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"Fixed in commits 2ee9dad and 7959a90\r\nPull request at https://github.com/eucalyptus/eucalyptus/pull/97\r\n\r\nThe last issue, about the metadata in san_volume_info, is correct in that there is a Ceph image in both Ceph clusters (zone one and two) after that failure. It downloaded the full snapshot from OSG and created a base image in Ceph on zone two, but failed to apply the deltas to it, leaving it there. I'm investigating if the image in zone two should be cleaned up by the existing code in this failure case, or if we need code changes to delete such images.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-11T19:23:16.287-0600","updated":"2017-02-11T19:23:16.287-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117543","id":"117543","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lincoln.thomas], the changes so far look good to me. One thing I would change is to have BlockStorageUtil#getSnapshotChain fail with an error if a snapshot is not found in the chain rather than returning a \"short\" chain.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-13T12:44:02.011-0600","updated":"2017-02-13T12:44:02.011-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117566","id":"117566","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"The issue about the metadata in san_volume_info: Although it leaves the failed snapshot Ceph image {{tempsnap/snap-31bbf740}} on zone two and the 2 metadata entries in {{san_volume_info}}, if you ever delete the snapshot {{snap-31bbf740}}, then both metadata entries {{eucaqa_snap/snap-31bbf740}} and {{tempsnap/snap-31bbf740}} will be deleted by the ExpiredSnapshotCleaner periodic process, and the Ceph image {{tempsnap/snap-31bbf740}} will be deleted by the VolumeDeleter periodic process.\r\n\r\nI've added code to explicitly delete a failed Ceph image creation from a snapshot (full or delta), so the image e.g. {{tempsnap/snap-31bbf740}} and its metadata entry e.g. {{tempsnap/snap-31bbf740}} will be removed by the cleaners instead of hanging around until the original snapshot is deleted (if ever).\r\n\r\nThe issue:\r\n{quote}\r\nBlockStorageUtil#getSnapshotChain fail with an error if a snapshot is not found in the chain rather than returning a \"short\" chain.\r\n{quote}\r\nAs a utility method, I've left that method intact except for clarifying the javadoc comment. It's up to the caller to check if the first element in the chain is a full snapshot or a delta, if that's important to the caller. In some cases the returned chain is still useful even if it doesn't start from a full snapshot. \r\n\r\nAlso added code so that instead of failing the snapshot delta creation if the chain doesn't start with a full snapshot, it will log an error and then continue to create the snapshot as a full snapshot instead of a delta, thus allowing for more success cases in practice.\r\n\r\nNow in testing...\r\nUpdated PR at https://github.com/eucalyptus/eucalyptus/pull/98 , [~sjones] please review.\r\n\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-14T02:04:14.693-0600","updated":"2017-02-14T02:04:14.693-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117612","id":"117612","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lincoln.thomas], the fix looks good to me.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-14T12:47:11.016-0600","updated":"2017-02-14T12:47:11.016-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117616","id":"117616","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks [~sjones].\r\n\r\nReproduced the original metadata and ceph image leftover in 4.4.0 code before my fixes. \r\n\r\nTested that issue in my fixed code with added inducement of an error to simulate a failure in applying a snap delta, in {{CephRbdProvider#restoreSnapshotDelta}} as shown: (LPT = my initials)\r\n\r\n{noformat}\r\n//LPT        \r\n        throw new EucalyptusCloudException(\"LPT-induced error after importing diff\");\r\n/*        \r\n        if (output.returnValue != 0) {\r\n          throw new EucalyptusCloudException(\"Unable to execute rbd command. Failed with error: \" + output.output + \"\\n\" + output.error);\r\n        }\r\nLPT end */\r\n{noformat}\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-14T14:12:21.282-0600","updated":"2017-02-14T14:12:21.282-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/117649","id":"117649","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"To see the entries get deleted from the database tables more quickly, and the images and snapshots get removed from Ceph, set these timeouts to shorter # of minutes (10 is the minimum allowed):\r\n\r\n{noformat}\r\neuctl <zone>.storage.snapexpiration=10\r\neuctl <zone>.storage.volexpiration=10\r\n{noformat}\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-15T11:27:44.991-0600","updated":"2017-02-15T11:27:44.991-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/118130","id":"118130","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ccassler","name":"ccassler","key":"ccassler","accountId":"557058:8fb32702-a3cf-42d3-9846-95c74f801354","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue"},"displayName":"Casey Cassler","active":true,"timeZone":"America/Los_Angeles"},"body":"I cannot reproduce this in the latest build.  I created 50 snapshots, deleted all but the first one created.  I then created another snapshot which used the oldest snapshot delta.  I then created a volume from the latest snapshot without issues.\r\n{code}\r\n[root@b-39 ~]# rpm -qi eucalyptus\r\nName        : eucalyptus\r\nVersion     : 4.4.0\r\nRelease     : 0.25808.161.20170217git82fb574.el7\r\nArchitecture: x86_64\r\nInstall Date: Tue 21 Feb 2017 05:29:53 PM PST\r\nGroup       : Unspecified\r\nSize        : 248082\r\nLicense     : GPLv3\r\nSignature   : (none)\r\nSource RPM  : eucalyptus-4.4.0-0.25808.161.20170217git82fb574.el7.src.rpm\r\nBuild Date  : Fri 17 Feb 2017 12:48:32 PM PST\r\nBuild Host  : buildsys.qa1.eucalyptus-systems.com\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ccassler","name":"ccassler","key":"ccassler","accountId":"557058:8fb32702-a3cf-42d3-9846-95c74f801354","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ace94e80ebc0a3b718cc5422760b57de?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dccassler%26avatarId%3D14700%26noRedirect%3Dtrue"},"displayName":"Casey Cassler","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-02-23T16:14:03.518-0600","updated":"2017-02-23T16:14:03.518-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54602/comment/119144","id":"119144","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lbiasi","name":"lbiasi","key":"lbiasi","accountId":"557058:daaebf52-3713-4e4f-a29b-79f55aed32c9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue"},"displayName":"Leslie Biasi","active":false,"timeZone":"US/Central"},"body":"Moving 4.4.0 Issues from Release Pending to Resolved","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lbiasi","name":"lbiasi","key":"lbiasi","accountId":"557058:daaebf52-3713-4e4f-a29b-79f55aed32c9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/3d92822583af436915b8264dbff0d30a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlbiasi%26avatarId%3D15002%26noRedirect%3Dtrue"},"displayName":"Leslie Biasi","active":false,"timeZone":"US/Central"},"created":"2017-03-15T23:14:07.488-0500","updated":"2017-03-15T23:14:07.488-0500"}],"maxResults":11,"total":11,"startAt":0},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}