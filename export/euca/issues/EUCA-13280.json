{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"55704","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/55704","key":"EUCA-13280","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"customfield_11001":null,"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"customfield_11401":null,"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/11500","value":"Edge","id":"11500"}],"customfield_11400":null,"customfield_10302":null,"customfield_10104":[],"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10303":null,"customfield_10105":null,"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"resolutiondate":null,"customfield_10308":null,"customfield_10704":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13280/watchers","watchCount":5,"isWatching":false},"created":"2017-03-04T12:15:17.663-0600","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"customfield_12201":null,"customfield_10102":null,"customfield_12600":"{}","customfield_10300":null,"customfield_10301":null,"labels":[],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/17200","id":"17200","description":"Eucalyptus 4.2.2","name":"4.2.2","archived":false,"released":true,"releaseDate":"2016-04-28"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/17800","id":"17800","description":"Eucalyptus 4.3.1","name":"4.3.1","archived":false,"released":true,"releaseDate":"2016-12-14"}],"issuelinks":[{"id":"50005","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/50005","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"outwardIssue":{"id":"53210","key":"EUCA-13121","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/53210","fields":{"summary":"Snapshoting of a >10MB volume triggers errors ","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"updated":"2017-03-09T16:13:44.000-0600","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10001","description":"This issue has been validated/reproduced, but has not been prioritized yet.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Confirmed","id":"10001","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11504","id":"11504","name":"EC2"}],"timeoriginalestimate":null,"description":"We are using Ceph both for EBS and Object store on the Aristotle cloud at UCSB.  We have a 500 GB volume that the user is attempting to snapshot.  snapshottransfer is set to true so the snapshot is being copied (slowly) to the object store.  With the default partition size of 100 mb, the snapshot takes about 27 hours to complete.  However only one snapshot works.  Subsequent attempts to make a snapshot from the same volume\r\n\r\n-- fail immediately in the logs\r\n-- still spend 24 hours transferring the snapshot which is then deleted immediately\r\n\r\nThe log failure message is\r\n\r\n2017-03-04 09:27:16 ERROR | Data PUT failure to backend for bucketuuid / objectuuid : 89895339-c47e-4a2d-9fbb-7cbdf5bc84a6/338cc397-d2a9-459a-99f2-7c9f5bec6793-snap-91482ba8\r\njava.util.concurrent.ExecutionException: com.amazonaws.AmazonClientException: Unable to unmarshall error response (Content is not allowed in prolog.). Response Code: 400, Response Text: Bad Request\r\n        at java.util.concurrent.FutureTask.report(FutureTask.java:122)\r\n        at java.util.concurrent.FutureTask.get(FutureTask.java:202)\r\n        at com.eucalyptus.objectstorage.ObjectFactoryImpl.waitForCompletion(ObjectFactoryImpl.java:361)\r\n        at com.eucalyptus.objectstorage.ObjectFactoryImpl.createObjectPart(ObjectFactoryImpl.java:682)\r\n        at com.eucalyptus.objectstorage.ObjectStorageGateway.uploadPart(ObjectStorageGateway.java:2111)\r\n        at sun.reflect.GeneratedMethodAccessor1276.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:606)\r\n        at org.mule.model.resolvers.AbstractEntryPointResolver.invokeMethod(AbstractEntryPointResolver.java:151)\r\n        at org.mule.model.resolvers.ReflectionEntryPointResolver.invoke(ReflectionEntryPointResolver.java:121)\r\n        at org.mule.model.resolvers.DefaultEntryPointResolverSet.invoke(DefaultEntryPointResolverSet.java:39)\r\n        at org.mule.component.DefaultComponentLifecycleAdapter.invoke(DefaultComponentLifecycleAdapter.java:343)\r\n        at org.mule.component.AbstractJavaComponent.invokeComponentInstance(AbstractJavaComponent.java:86)\r\n\r\nThis message occurs in the log *immediately* when the snapshot request is made but the snapshot appears as pending under the transfer completes 24 hours from the time of the request.  It then shows up as 0% complete.  \r\n\r\nLooking at the source code I see this error message in three places in\r\n\r\neucalyptus-4.3.1.1/clc/modules/object-storage/src/main/java/com/eucalyptus/objectstorage/ObjectFactoryImpl.java\r\n\r\n186       LOG.error(\"Data PUT failure to backend for bucketuuid / objectuuid : \" + entity.getBucket().getBucketUuid() + \"/\" + entity.getObjectUuid(), e);\r\n  187 \r\n  188       // Remove metadata and return failure\r\n  189       try {\r\n  190         ObjectMetadataManagers.getInstance().transitionObjectToState(entity, ObjectState.deleting);\r\n  191       } catch (Exception ex) {\r\n  192         LOG.warn(\"Failed to mark failed object entity in deleting state on failure rollback. Will be cleaned later.\", e);\r\n  193       }\r\n  194 \r\n  195       // ObjectMetadataManagers.getInstance().delete(objectEntity);\r\n  196       throw new InternalErrorException(entity.getObjectKey());\r\n  197     }\r\n\r\n317       response = waitForCompletion(putTask, uploadingObject.getObjectUuid(), updateTimeout, failTime, checkIntervalSec);\r\n  318       entity = entityRef.get(); // Get the latest if it was updated\r\n  319       // lastModified = response.getLastModified();\r\n  320       lastModified = new Date();\r\n  321       etag = response.getEtag();\r\n  322 \r\n  323     } catch (Exception e) {\r\n  324       LOG.error(\"Data PUT failure to backend for bucketuuid / objectuuid : \" + entity.getBucket().getBucketUuid() + \"/\" + entity.getObjectUuid(), e);\r\n  325 \r\n  326       // Remove metadata and return failure\r\n  327       try {\r\n  328         ObjectMetadataManagers.getInstance().transitionObjectToState(entity, ObjectState.deleting);\r\n  329       } catch (Exception ex) {\r\n  330         LOG.warn(\"Failed to mark failed object entity in deleting state on failure rollback. Will be cleaned later.\", e);\r\n  331       }\r\n  332 \r\n  333       // ObjectMetadataManagers.getInstance().delete(objectEntity);\r\n  334       throw new InternalErrorException(entity.getObjectKey());\r\n  335     }\r\n  336 \r\n\r\nand\r\n\r\n 682       response = waitForCompletion(putTask, uploadingObject.getPartUuid(), updateTimeout, failTime, checkIntervalSec);\r\n  683       entity = entityRef.get(); // Get the latest if it was updated\r\n  684       // lastModified = response.getLastModified();\r\n  685       lastModified = new Date();\r\n  686       etag = response.getEtag();\r\n  687 \r\n  688     } catch (Exception e) {\r\n  689       LOG.error(\"Data PUT failure to backend for bucketuuid / objectuuid : \" + entity.getBucket().getBucketUuid() + \"/\" + entity.getPartUuid(), e);\r\n  690 \r\n  691       // Remove metadata and return failure\r\n  692       try {\r\n  693         MpuPartMetadataManagers.getInstance().transitionPartToState(entity, ObjectState.deleting);\r\n  694       } catch (Exception ex) {\r\n  695         LOG.error(\"Failed to mark failed object entity in deleting state on failure rollback. Will be cleaned later.\", e);\r\n  696       }\r\n  697 \r\n  698       // ObjectMetadataManagers.getInstance().delete(objectEntity);\r\n  699       throw new InternalErrorException(entity.getObjectKey());\r\n  700     }\r\n\r\nwe are also seeing the Internal error exception in the logs.\r\n\r\nWhy the \"Bad Response\" message?  It looks like it has something to do with metadata which could explain whey it worked the first time.\r\n\r\n","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/40201","id":"40201","filename":"grot","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=rich","name":"rich","key":"rich","accountId":"557058:8c482bdc-e25e-4adf-8ce3-d545bda65679","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Rich Wolski","active":true,"timeZone":"US/Central"},"created":"2017-03-04T12:28:50.706-0600","size":18356,"mimeType":"text/html","content":"https://eucalyptus.atlassian.net/secure/attachment/40201/grot"}],"summary":"failure to create large snapshots with Ceph","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=rich","name":"rich","key":"rich","accountId":"557058:8c482bdc-e25e-4adf-8ce3-d545bda65679","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Rich Wolski","active":true,"timeZone":"US/Central"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=rich","name":"rich","key":"rich","accountId":"557058:8c482bdc-e25e-4adf-8ce3-d545bda65679","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Rich Wolski","active":true,"timeZone":"US/Central"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":null,"customfield_12100":"0|i0436f:","customfield_10001":"2017-03-09T16:13:44.000-0600","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_12500":null,"customfield_10400":null,"customfield_11600":["dmitrii(dmitrii)","rich(rich)"],"customfield_10116":null,"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13280/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/55704/comment/118628","id":"118628","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=rich","name":"rich","key":"rich","accountId":"557058:8c482bdc-e25e-4adf-8ce3-d545bda65679","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Rich Wolski","active":true,"timeZone":"US/Central"},"body":"I added more of the log as the file \"grot\" that I've attached to this ticket.\r\n\r\nRich\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=rich","name":"rich","key":"rich","accountId":"557058:8c482bdc-e25e-4adf-8ce3-d545bda65679","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/836ed5700fb9db2dd603525a729cf69f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Rich Wolski","active":true,"timeZone":"US/Central"},"created":"2017-03-04T12:30:10.073-0600","updated":"2017-03-04T12:30:10.073-0600"}],"maxResults":1,"total":1,"startAt":0},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}