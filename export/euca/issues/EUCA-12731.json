{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"48205","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/48205","key":"EUCA-12731","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"customfield_11001":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18200","id":"18200","description":"Eucalyptus 4.3.0.1","name":"4.3.0.1","archived":false,"released":true,"releaseDate":"2016-09-21"}],"aggregatetimespent":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10310":null,"customfield_11401":null,"customfield_10311":null,"customfield_11400":null,"customfield_10302":null,"customfield_10104":[],"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10303":null,"customfield_10105":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":null,"customfield_10703":null,"customfield_10704":null,"customfield_10308":null,"resolutiondate":"2016-09-08T16:14:29.473-0500","customfield_10309":null,"customfield_10705":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-12731/watchers","watchCount":2,"isWatching":false},"created":"2016-09-07T16:03:22.536-0500","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12400":null,"customfield_12201":null,"customfield_12600":"{}","customfield_10102":null,"customfield_10300":null,"customfield_10301":null,"labels":[],"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18200","id":"18200","description":"Eucalyptus 4.3.0.1","name":"4.3.0.1","archived":false,"released":true,"releaseDate":"2016-09-21"}],"customfield_11901":null,"issuelinks":[],"assignee":null,"updated":"2016-09-08T16:14:29.488-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/12700","id":"12700","name":"OSG","description":"Object Storage Gateway"}],"timeoriginalestimate":null,"description":"After upgrading an EQS 1-node cloud from 4.2.2 to 4.3.0.1, the \"objectstorage\" service shows \"broken\" in the euserv-describe-services output, but \"walrusbackedn\" is enabled. Both services were fine in 4.2.2.\r\n\r\n{noformat}\r\nSERVICE  objectstorage         API_10.111.5.164  API_10.111.5.164.objectstorage   broken\r\n( ...) \r\nSERVICE  walrusbackend         walrus            walrus-1                         enabled\r\n{noformat}\r\n\r\ncloud-debug.log shows this shortly after every eucalyptus-cloud service start:\r\n\r\n{noformat}\r\nWed Sep 7 10:47:47 2016 ERROR [Topology:Eucalyptus.bootstrap:EphemeralConfiguration:arn:euca:bootstrap:Topology::external/.class java.util.concurrent.ThreadPoolExecutor$Worker#37] [com.eucalyptus.component.Topology$TopologyChange.doTopologyChange(Topology.java):1322] START:DISABLED  arn:euca:bootstrap:API_10.111.5.164:objectstorage:API_10.111.5.164.objectstorage/ LOADED->DISABLED=BROKEN [No ENABLED WalrusBackend found. Cannot initialize fully.]\r\nWed Sep 7 10:47:47 2016  WARN [StorageProperties:Eucalyptus.bootstrap:EphemeralConfiguration:arn:euca:bootstrap:Topology::external/.class java.util.concurrent.ThreadPoolExecutor$Worker#43] Could not obtain walrus information. Snapshot functionality may be unavailable. Have you registered ObjectStorage?\r\nWed Sep 7 10:47:59 2016 ERROR [Topology:Eucalyptus.bootstrap:EphemeralConfiguration:arn:euca:bootstrap:Topology::external/.class java.util.concurrent.ThreadPoolExecutor$Worker#61] [com.eucalyptus.component.Topology$TopologyChange.doTopologyChange(Topology.java):1322] CHECK:null  arn:euca:bootstrap:API_10.111.5.164:objectstorage:API_10.111.5.164.objectstorage/ BROKEN->DISABLED=BROKEN [No ENABLED WalrusBackend found. Cannot initialize fully.]\r\nWed Sep 7 10:48:00 2016 ERROR [Topology:Eucalyptus.bootstrap:EphemeralConfiguration:arn:euca:bootstrap:Topology::external/.class java.util.concurrent.ThreadPoolExecutor$Worker#38] [com.eucalyptus.component.Topology$TopologyChange.doTopologyChange(Topology.java):1322] START:DISABLED  arn:euca:bootstrap:API_10.111.5.164:objectstorage:API_10.111.5.164.objectstorage/ BROKEN->DISABLED=BROKEN [S3 provider HEAD op code is not set]\r\nWed Sep 7 10:48:38 2016 ERROR [Topology:Eucalyptus.bootstrap:EphemeralConfiguration:arn:euca:bootstrap:Topology::external/.class java.util.concurrent.ThreadPoolExecutor$Worker#57] [com.eucalyptus.component.Topology$TopologyChange.doTopologyChange(Topology.java):1322] CHECK:null  arn:euca:bootstrap:API_10.111.5.164:objectstorage:API_10.111.5.164.objectstorage/ BROKEN->DISABLED=BROKEN [S3 provider HEAD op code is not set]\r\n{noformat}\r\n(The last error message repeats every few seconds forever.)\r\n\r\nRestarting all services didn't help, neither did rebooting, neither did euserv-deregister-service walrus-1 and re-registering it.\r\n\r\nInteresting things from euctl:\r\n\r\n{noformat}\r\nobjectstorage.providerclient = walrus\r\nobjectstorage.s3provider.s3endpointheadresponse =\r\n{noformat}\r\n\r\nNormally, that 2nd line should be:\r\n\r\n{noformat}\r\nobjectstorage.s3provider.s3endpointheadresponse = 405\r\n{noformat}\r\n\r\nSetting that line explicitly allowed the objectstorage service to become available in a few seconds (no restarts needed).\r\n\r\n{noformat}\r\n[root@g-15-09 eucalyptus]# euctl objectstorage.s3provider.s3endpointheadresponse=405\r\nobjectstorage.s3provider.s3endpointheadresponse = 405\r\n{noformat}\r\n\r\nSo, why was it unset after the upgrade?\r\n\r\nThe system is g-15-09 / 10.111.5.164 if someone ([~swathi]?) wants to take a look.\r\n","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[],"summary":"objectstorage service broken after 4.2.2 -> 4.3.0.1 upgrade","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"customfield_12100":"0|i03x1z:","customfield_10000":"5_*:*_1_*:*_0_*|*_10000_*:*_1_*:*_87066954","aggregateprogress":{"progress":0,"total":0},"customfield_10001":"2016-09-07T16:58:05.217-0500","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["lincoln.thomas(lincoln.thomas)","swathi(swathi)"],"customfield_10116":null,"customfield_10117":null,"environment":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-12731/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/48205/comment/110026","id":"110026","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=swathi","name":"swathi","key":"swathi","accountId":"557058:ab7e71b5-781c-49ea-9f4d-ea9148c88f03","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue"},"displayName":"Swathi Gangisetty","active":true,"timeZone":"America/Los_Angeles"},"body":"[~lincoln.thomas] tried to upgrade to 4.3.0.1 which is still in progress. What might have happened here is the database upgrade to 4.3.0 was skipped as an unknown version was presented to Java code. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=swathi","name":"swathi","key":"swathi","accountId":"557058:ab7e71b5-781c-49ea-9f4d-ea9148c88f03","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/d6487612d6674329ecef11be0a95552b?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dswathi%26avatarId%3D17901%26noRedirect%3Dtrue"},"displayName":"Swathi Gangisetty","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-07T16:58:05.217-0500","updated":"2016-09-07T16:58:05.217-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/48205/comment/110027","id":"110027","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"Per [~gholms]: This is probably due to the upgrade logic being changed in 4.3.0.1 so that database upgrades are not being triggered. That's why we don't see this issue in the upgrade from 4.2.2 --> 4.3.0. QA/Release team is fixing that now.\r\n\r\nSo the fix implemented in 4.3 for EUCA-12364 is not being run, resulting in the symptom from that bug (pre-fix) re-appearing here.\r\n\r\nQA is still testing the 4.3.0.1 kit and upgrades to it, I unintentionally tested upgrading to 4.3.0.1 when I thought I'd be getting 4.3.0 from the internal eucalyptus repo. Once 4.3.0.1 is finished and blessed by QA, this issue should go away (I'll re-test then).\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-09-07T17:02:28.476-0500","updated":"2016-09-07T17:02:28.476-0500"}],"maxResults":2,"total":2,"startAt":0},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}