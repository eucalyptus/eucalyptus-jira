{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"28225","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/28225","key":"EUCA-8926","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/6","id":"6","description":"The product is working as designed.","name":"Not a Bug"},"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/11500","value":"Edge","id":"11500"}],"customfield_11401":null,"customfield_11400":null,"customfield_10500":null,"customfield_10104":[],"customfield_10302":null,"customfield_10105":null,"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":null,"customfield_10703":null,"resolutiondate":"2014-03-18T21:07:28.902-0500","customfield_10704":null,"customfield_10308":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-8926/watchers","watchCount":2,"isWatching":false},"created":"2014-03-18T18:58:26.222-0500","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/1","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"customfield_12201":null,"customfield_10300":null,"customfield_12600":"{}","customfield_10102":null,"labels":[],"customfield_10301":null,"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12806","id":"12806","description":"Eucalyptus 4.0.0","name":"4.0.0","archived":false,"released":true,"releaseDate":"2014-05-30"}],"issuelinks":[],"assignee":null,"updated":"2014-03-18T22:44:12.140-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11504","id":"11504","name":"EC2"}],"timeoriginalestimate":null,"description":"STSAssumeRoleTest has shown a regression in describing images with an assumed role.\r\n\r\ntest output\r\n{code}\r\n[2014-03-18 16:41:24,330] - *****TEST NAME: TestSTSAssumeRole\r\n[2014-03-18 16:41:24,331] - Getting cloud information from eucarc\r\n[2014-03-18 16:41:24,337] - Updating endpoints file\r\n[2014-03-18 16:41:24,343] - Getting cloud connections\r\n[2014-03-18 16:41:25,428] - Using image: emi-8c63f50b\r\n[2014-03-18 16:41:25,601] - Using image: emi-8c63f50b\r\n[2014-03-18 16:41:25,874] - Using availability zone: PARTI00\r\n[2014-03-18 16:41:25,874] - Using resource prefix for test: 3fdbc838bb344a24-\r\n[2014-03-18 16:41:25,874] - Cloud Discovery Complete\r\n[2014-03-18 16:41:26,243] - Created account: 3fdbc838bb344a24-account\r\n[2014-03-18 16:41:26,586] - Created new user 3fdbc838bb344a24-user in account 3fdbc838bb344a24-account\r\n[2014-03-18 16:41:26,740] - Created policy: 3fdbc838bb344a24-policy\r\n[2014-03-18 16:41:26,905] - Created new access key for user 3fdbc838bb344a24-user\r\n[2014-03-18 16:41:26,905] - Access Key: AKINIJ2YKUS37WWZSOJS\r\n[2014-03-18 16:41:26,905] - Secret Key: oH73oqTSfvfJoOYUqsiOHWUw2vxyU8rMIkvawmBQ\r\n[2014-03-18 16:41:27,023] - Got user ARN (will convert account alias to ID if necessary): arn:aws:iam::479653825213:user/3fdbc838bb344a24-user\r\n[2014-03-18 16:41:27,023] - Creating role to determine account number: 3fdbc838bb344a24-AssumeRoleTestA\r\n[2014-03-18 16:41:27,438] - Using account id: 479653825213\r\n[2014-03-18 16:41:27,438] - Using user ARN in assume role policy: arn:aws:iam::479653825213:user/3fdbc838bb344a24-user\r\n[2014-03-18 16:41:27,438] - Creating role: 3fdbc838bb344a24-AssumeRoleTest\r\n[2014-03-18 16:41:27,743] - Getting role: 3fdbc838bb344a24-AssumeRoleTest\r\n[2014-03-18 16:41:27,952] - Describing images to ensure no permission with role: 3fdbc838bb344a24-AssumeRoleTest\r\n[2014-03-18 16:41:27,958] - Searching images using role: 3fdbc838bb344a24-AssumeRoleTest\r\n[2014-03-18 16:41:28,099] - Created new access key for user 3fdbc838bb344a24-user\r\n[2014-03-18 16:41:28,099] - Access Key: AKIQS4MAVJHTJWOAEMYE\r\n[2014-03-18 16:41:28,099] - Secret Key: qoiKgqnquA1KL3Dv0IyoxVAYTky9Vy58hJU76rG5\r\n[2014-03-18 16:41:28,865] - Deleting role: 3fdbc838bb344a24-AssumeRoleTest\r\n[2014-03-18 16:41:29,278] - Deleting role: 3fdbc838bb344a24-AssumeRoleTestA\r\n[2014-03-18 16:41:29,585] - Deleting account 3fdbc838bb344a24-account\r\n[2014-03-18 16:41:29,898] - Deleted account: 3fdbc838bb344a24-account\r\ncom.amazonaws.AmazonServiceException: Status Code: 403, AWS Service: AmazonEC2, AWS Request ID: null, AWS Error Code: null, AWS Error Message: null\r\n\tat com.amazonaws.http.AmazonHttpClient.handleErrorResponse(AmazonHttpClient.java:773)\r\n\tat com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:417)\r\n\tat com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:229)\r\n\tat com.amazonaws.services.ec2.AmazonEC2Client.invoke(AmazonEC2Client.java:8368)\r\n\tat com.amazonaws.services.ec2.AmazonEC2Client.describeImages(AmazonEC2Client.java:3993)\r\n\tat com.eucalyptus.tests.awssdk.TestSTSAssumeRole.getImagesUsingRole(TestSTSAssumeRole.java:276)\r\n\tat com.eucalyptus.tests.awssdk.TestSTSAssumeRole.STSAssumeRoleTest(TestSTSAssumeRole.java:174)\r\n{code}\r\n\r\nThe failure is at the return ec2.describeImages... call\r\n{code}\r\n    private DescribeImagesResult getImagesUsingRole(final String account,\r\n                                                    final String user,\r\n                                                    final String roleName,\r\n                                                    final String roleArn,\r\n                                                    String externalId) {\r\n        final AmazonEC2 ec2 = getEc2ClientUsingRole(account, user, roleArn, externalId, \"session-name-here\");\r\n\r\n        print(\"Searching images using role: \" + roleName);\r\n        return ec2.describeImages(new DescribeImagesRequest().withFilters(\r\n                new Filter().withName(\"image-type\").withValues(\"machine\"),\r\n                new Filter().withName(\"root-device-type\").withValues(\"instance-store\")\r\n        ));\r\n    }\r\n{code}\r\n\r\nInstalled Packages\r\nName        : eucalyptus\r\nArch        : x86_64\r\nVersion     : 4.0.0\r\nRelease     : 0.0.719.20140316git6156d19e.el6","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"Unable to describe images with assumed role","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":"10000_*:*_1_*:*_7742699_*|*_5_*:*_1_*:*_0","customfield_12100":"0|i02l67:","customfield_10001":"2014-03-18T21:07:28.918-0500","customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_10116":null,"customfield_11600":["sjones(sjones)","tony(tony)"],"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"progress":{"progress":0,"total":0},"customfield_11806":null,"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-8926/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/28225/comment/64955","id":"64955","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"This is expected behaviour for 4.0 (as per EUCA-8513), if you do not have permission for an action then we now fail with an error rather than returning an empty response.\r\n\r\nThe test should be updated to catch the exception that occurs when performing the initial describe images attempt (when the role is not permitted to perform the action)","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-03-18T21:07:28.918-0500","updated":"2014-03-18T21:07:28.918-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/28225/comment/64959","id":"64959","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"body":"Thank you for pointing that out [~sjones]. The test has been updated accordingly to check for the exception in this scenario.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"created":"2014-03-18T22:44:12.131-0500","updated":"2014-03-18T22:44:12.131-0500"}],"maxResults":2,"total":2,"startAt":0},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}