{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"25902","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/25902","key":"EUCA-8448","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12806","id":"12806","description":"Eucalyptus 4.0.0","name":"4.0.0","archived":false,"released":true,"releaseDate":"2014-05-30"}],"customfield_11001":null,"aggregatetimespent":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"customfield_10311":null,"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"customfield_11400":null,"customfield_10104":["com.atlassian.greenhopper.service.sprint.Sprint@5a94df76[id=66,rapidViewId=45,state=CLOSED,name=4.1.0 Sprint 1,goal=<null>,startDate=2014-06-30T13:48:10.163Z,endDate=2014-07-21T13:48:00.000Z,completeDate=2014-07-24T15:48:24.089Z,sequence=66]","com.atlassian.greenhopper.service.sprint.Sprint@3294c1af[id=54,rapidViewId=75,state=CLOSED,name=4.0 Sprint 7,goal=<null>,startDate=2014-04-05T00:26:27.500Z,endDate=2014-04-26T00:26:00.000Z,completeDate=2014-04-29T13:33:10.513Z,sequence=54]","com.atlassian.greenhopper.service.sprint.Sprint@269d408d[id=59,rapidViewId=75,state=CLOSED,name=4.0 Sprint 8,goal=<null>,startDate=2014-04-29T13:38:45.824Z,endDate=2014-05-27T22:00:00.000Z,completeDate=2014-06-09T16:26:51.613Z,sequence=59]"],"customfield_10302":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10402","value":"Internal","id":"10402"},"customfield_10105":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10101","value":"No","id":"10101"},"customfield_10303":null,"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10200","value":"High","id":"10200"},"customfield_10703":null,"customfield_10704":null,"customfield_10308":null,"resolutiondate":"2014-05-12T19:48:32.781-0500","customfield_10705":null,"customfield_10309":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-8448/watchers","watchCount":5,"isWatching":false},"created":"2013-12-16T14:39:05.740-0600","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"customfield_12400":null,"customfield_12201":null,"customfield_10300":null,"customfield_12600":"{repository={count=1, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":1,\"lastUpdated\":\"2014-04-10T13:26:33.000-0500\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":1,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10102":null,"labels":["AWSCompat-PM"],"customfield_10301":null,"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12105","id":"12105","description":"Eucalyptus 3.4.0","name":"3.4.0","archived":false,"released":true,"releaseDate":"2013-10-24"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12801","id":"12801","description":"Eucalyptus 3.4.1","name":"3.4.1","archived":false,"released":true,"releaseDate":"2013-12-16"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/13700","id":"13700","description":"Eucalyptus 3.4.2","name":"3.4.2","archived":false,"released":true,"releaseDate":"2014-02-24"}],"customfield_11901":null,"issuelinks":[{"id":"22203","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/22203","type":{"id":"10600","name":"Bonfire Testing","inward":"discovered while testing","outward":"testing discovered","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10600"},"inwardIssue":{"id":"22211","key":"EUCA-6782","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/22211","fields":{"summary":"Instance meta-data service should serve JSON for role security credentials","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}},{"id":"22202","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/22202","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"outwardIssue":{"id":"24675","key":"EUCA-7863","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/24675","fields":{"summary":"Instance Profiles Don't Support Tools/Scripts That Use S3 API Calls","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mmunn1","name":"mmunn1","key":"mmunn1","accountId":"557058:6e62b7e8-e48f-469d-ac54-e9449dec5cd9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue"},"displayName":"Michael Munn","active":true,"timeZone":"America/Los_Angeles"},"updated":"2014-07-03T09:06:27.774-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10201","id":"10201","name":"AWS Compatibility"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11504","id":"11504","name":"EC2"}],"timeoriginalestimate":null,"description":"*Assessment*\r\n\r\nWhile troubleshooting the reason why the _--configure_ option fails with [s3cmd|https://github.com/s3tools/s3cmd], when its used in an instance that is launched with an instance profile that contains an S3 IAM policy, it was observed that the metadata service provided by Eucalyptus doesn't behave the same way as the [metadata service provided by AWS|http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AESDG-chapter-instancedata.html].  When there are multiple URL requests done in the same HTTP connection, Eucalyptus responds with a [HTTP exception|http://docs.python.org/2/library/httplib.html#httplib.BadStatusLine], while on AWS, everything runs successfully.   From the behavior, it looks like Eucalyptus closes the connection before sending a valid response.  I tested it with various _timeout_ (in seconds) settings (by default s3cmd uses a 2 second timeout; I tested with 10 - 20 second timeouts), but the behavior was the same on Eucalyptus.\r\n\r\n*Signs*\r\n\r\nTo show the comparison, I used [python's httplib module|http://docs.python.org/2/library/httplib.html].  The flow is a shortened version - based on the [_role_config_ method seen in s3cmd/S3/Config.py|https://github.com/s3tools/s3cmd/blob/master/S3/Config.py#L129-L154].  \r\n\r\n*_Eucalyptus_*\r\n{code}\r\n$ ipython\r\nPython 2.7.4 (default, Apr 19 2013, 18:28:01)\r\nType \"copyright\", \"credits\" or \"license\" for more information.\r\n\r\nIPython 0.13.2 -- An enhanced Interactive Python.\r\n?         -> Introduction and overview of IPython's features.\r\n%quickref -> Quick reference.\r\nhelp      -> Python's own help system.\r\nobject?   -> Details about 'object', use 'object??' for extra details.\r\n\r\nIn [1]: import httplib\r\n\r\nIn [2]: conn = httplib.HTTPConnection(host='169.254.169.254', timeout = 10)\r\n\r\nIn [3]: conn.set_debuglevel(2)\r\n\r\nIn [4]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/\")\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [5]: resp = conn.getresponse()\r\nreply: 'HTTP/1.1 200 OK\\r\\n'\r\nheader: Content-Type: text/plain\r\nheader: Content-Length: 16\r\n\r\nIn [6]: files = resp.read()\r\n\r\nIn [7]: print files\r\nACCT1-S3-ACTIONS\r\n\r\nIn [8]: print resp.status\r\n200\r\n\r\nIn [9]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/%s\"%files)\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ACCT1-S3-ACTIONS HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [10]: resp = conn.getresponse()\r\nreply: ''\r\n---------------------------------------------------------------------------\r\nBadStatusLine                             Traceback (most recent call last)\r\n<ipython-input-10-b9bf8c07bce9> in <module>()\r\n----> 1 resp = conn.getresponse()\r\n\r\n/usr/lib/python2.7/httplib.pyc in getresponse(self, buffering)\r\n   1043         response = self.response_class(*args, **kwds)\r\n   1044\r\n-> 1045         response.begin()\r\n   1046         assert response.will_close != _UNKNOWN\r\n   1047         self.__state = _CS_IDLE\r\n\r\n/usr/lib/python2.7/httplib.pyc in begin(self)\r\n    407         # read until we get a non-100 response\r\n    408         while True:\r\n--> 409             version, status, reason = self._read_status()\r\n    410             if status != CONTINUE:\r\n    411                 break\r\n\r\n/usr/lib/python2.7/httplib.pyc in _read_status(self)\r\n    371             # Presumably, the server closed the connection before\r\n    372             # sending a valid response.\r\n--> 373             raise BadStatusLine(line)\r\n    374         try:\r\n    375             [version, status, reason] = line.split(None, 2)\r\n\r\nBadStatusLine: ''\r\n{code}\r\n\r\n*_AWS_*\r\n{code}\r\n$ ipython\r\nPython 2.7.5+ (default, Sep 19 2013, 13:48:49)\r\nType \"copyright\", \"credits\" or \"license\" for more information.\r\n\r\nIPython 0.13.2 -- An enhanced Interactive Python.\r\n?         -> Introduction and overview of IPython's features.\r\n%quickref -> Quick reference.\r\nhelp      -> Python's own help system.\r\nobject?   -> Details about 'object', use 'object??' for extra details.\r\n\r\nIn [1]: import httplib\r\n\r\nIn [2]: conn = httplib.HTTPConnection(host='169.254.169.254', timeout = 10)\r\n\r\nIn [3]: conn.set_debuglevel(2)\r\n\r\nIn [4]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/\")\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [5]: resp = conn.getresponse()\r\nreply: 'HTTP/1.0 200 OK\\r\\n'\r\nheader: Content-Type: text/plain\r\nheader: Accept-Ranges: bytes\r\nheader: ETag: \"3982256218\"\r\nheader: Last-Modified: Mon, 16 Dec 2013 20:00:12 GMT\r\nheader: Content-Length: 10\r\nheader: Connection: close\r\nheader: Date: Mon, 16 Dec 2013 20:00:20 GMT\r\nheader: Server: EC2ws\r\n\r\nIn [6]: files = resp.read()\r\n\r\nIn [7]: print files\r\nS3-ACTIONS\r\n\r\nIn [8]: print resp.status\r\n200\r\n\r\nIn [9]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/%s\"%files)\r\nsend: 'GET /latest/meta-data/iam/security-credentials/S3-ACTIONS HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [10]: resp = conn.getresponse()\r\nreply: 'HTTP/1.0 200 OK\\r\\n'\r\nheader: Content-Type: text/plain\r\nheader: Accept-Ranges: bytes\r\nheader: ETag: \"2501856378\"\r\nheader: Last-Modified: Mon, 16 Dec 2013 20:00:12 GMT\r\nheader: Content-Length: 770\r\nheader: Connection: close\r\nheader: Date: Mon, 16 Dec 2013 20:00:59 GMT\r\nheader: Server: EC2ws\r\n\r\nIn [11]: print resp.read()\r\n{\r\n  \"Code\" : \"Success\",\r\n  \"LastUpdated\" : \"2013-12-16T19:59:14Z\",\r\n  \"Type\" : \"AWS-HMAC\",\r\n  \"AccessKeyId\" : \"ASIAIYQNO4E23NM5F63A\",\r\n  \"SecretAccessKey\" : \"80/IEYMDeQIiDq1ttd/GL0ghU/Iw+oQZZ/hkDn0W\",\r\n  \"Token\" : \"AQoDYXdzEGUa8AIM7Tlyol1Y/jCIdQXNxiTVJACI0u69Zjd08RCtVRiiQzD58xUtwBnfk38hG1Rx0VLnKepaoTChn0D9s8FSQp/CYbDJ8Pkxv6i5KiycPKqgofUj+0rblKTOTahm4ECoG+LVwjtB/4ACFLvAkJhuOecBpk1eOCQc7RhV/dJJDrQXwoH/4kfozQ/BTMrRa2zS3+bUEo5b/1pUORFTrIMS6JSRrATcgMDnWRmjRT8m/EDgSNbG67IOmpklepXip4varIPpr8nvr7ritNZfpnAf4oPtf6Eq4X6PXVKk0CnDQBzMqqyqSK/jtoL7ab+kQ1loxL8aUln2KF9BmwcZr6ap0yjJLqxVhhPOVqhrCK+IDpV4nOLkIAKkLShlTFfsthl9IIzsGxUJ11Ue1Mb7TfDne7rsOX19jE2gTMKi2fKmPh+0FoGeyDUMnGFjHr4cm4hVxH7zkVDBUgNSkXs5uvJyXQXzY2I+t9ssSySxt0bu/KFxZyDMt72VBQ==\",\r\n  \"Expiration\" : \"2013-12-17T02:34:59Z\"\r\n}\r\n{code}\r\n\r\nOn AWS, it handles multiple [_getresponse()_|http://docs.python.org/2/library/httplib.html#httplib.HTTPConnection.getresponse] under each [HTTPConnection|http://docs.python.org/2/library/httplib.html#httplib.HTTPConnection] instance, whereas on Eucalyptus it fails.  In order to get Eucalyptus to succeed, another [HTTPConnection instance|http://docs.python.org/2/library/httplib.html#httplib.HTTPConnection] using 169.254.169.254 needs to be created, then it will successfully grab the credentials:\r\n{code}\r\n$ ipython\r\nPython 2.7.4 (default, Apr 19 2013, 18:28:01)\r\nType \"copyright\", \"credits\" or \"license\" for more information.\r\n\r\nIPython 0.13.2 -- An enhanced Interactive Python.\r\n?         -> Introduction and overview of IPython's features.\r\n%quickref -> Quick reference.\r\nhelp      -> Python's own help system.\r\nobject?   -> Details about 'object', use 'object??' for extra details.\r\n\r\nIn [1]: import httplib\r\n\r\nIn [2]: conn = httplib.HTTPConnection(host='169.254.169.254', timeout = 10)\r\n\r\nIn [3]: conn.set_debuglevel(2)\r\n\r\nIn [4]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/\")\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [5]: resp = conn.getresponse()\r\nreply: 'HTTP/1.1 200 OK\\r\\n'\r\nheader: Content-Type: text/plain\r\nheader: Content-Length: 16\r\n\r\nIn [6]: files = resp.read()\r\n\r\nIn [7]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/%s\"%files)\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ACCT1-S3-ACTIONS HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [8]: resp = conn.getresponse()\r\nreply: ''\r\n---------------------------------------------------------------------------\r\nBadStatusLine                             Traceback (most recent call last)\r\n<ipython-input-8-b9bf8c07bce9> in <module>()\r\n----> 1 resp = conn.getresponse()\r\n\r\n/usr/lib/python2.7/httplib.pyc in getresponse(self, buffering)\r\n   1043         response = self.response_class(*args, **kwds)\r\n   1044\r\n-> 1045         response.begin()\r\n   1046         assert response.will_close != _UNKNOWN\r\n   1047         self.__state = _CS_IDLE\r\n\r\n/usr/lib/python2.7/httplib.pyc in begin(self)\r\n    407         # read until we get a non-100 response\r\n    408         while True:\r\n--> 409             version, status, reason = self._read_status()\r\n    410             if status != CONTINUE:\r\n    411                 break\r\n\r\n/usr/lib/python2.7/httplib.pyc in _read_status(self)\r\n    371             # Presumably, the server closed the connection before\r\n    372             # sending a valid response.\r\n--> 373             raise BadStatusLine(line)\r\n    374         try:\r\n    375             [version, status, reason] = line.split(None, 2)\r\n\r\nBadStatusLine: ''\r\n\r\nIn [9]: conn = httplib.HTTPConnection(host='169.254.169.254', timeout = 10)\r\n\r\nIn [10]: conn.set_debuglevel(2)\r\n\r\nIn [11]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/%s\"%files)\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ACCT1-S3-ACTIONS HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [12]: resp = conn.getresponse()\r\nreply: 'HTTP/1.1 200 OK\\r\\n'\r\nheader: Content-Type: text/plain\r\nheader: Content-Length: 499\r\n\r\nIn [13]: print resp.read()\r\n{\r\n  \"Code\": \"Success\",\r\n  \"LastUpdated\": \"2013-12-16T20:23:42Z\",\r\n  \"Type\": \"AWS-HMAC\",\r\n  \"AccessKeyId\": \"AKIFJUTXRYTNKXXVDMYL\",\r\n  \"SecretAccessKey\": \"sVvi1LeWDlyMBL7oBemsDC8u80ReVgjsvEGRkMYW\",\r\n  \"Token\": \"ZXVjYQABClnTCMDMIn+XKKcKdDSyhYFIwt0c+wff+1beBuXD11DvsfQLsLtJ7bAm8LsUFohnfuFXKXxB5xnplg07eS6BL3MfI2PdDD+ylQADJzASKoLP080Ntw13yfZCw2r3andZWbkc9zrUGOIH0ftHjUjt2MBXjAmDHFhlPxOiAivutGgp44tI8wCpOYOgbalC8K824RneXvJhFMO1jbbCKLl6JFtL1Va5B7Z5Zpf8iC7dM272RTKchAHq\",\r\n  \"Expiration\": \"2013-12-16T21:23:42Z\"\r\n}\r\n{code}\r\n\r\n*Steps*\r\n\r\nTo reproduce this issue, do the following:\r\n\r\n* Follow the steps mentioned in the _Description_ field in EUCA-7863 to set up the cloud, role, instance profile and development environment in the instance.\r\n* Run the follow in an ipython/python session:\r\n{code}\r\n# import httplib\r\n# conn = httplib.HTTPConnection(host='169.254.169.254', timeout = 10)\r\n# conn.set_debuglevel(2)\r\n# conn.request('GET', \"/latest/meta-data/iam/security-credentials/\")\r\n# resp = conn.getresponse()\r\n# files = resp.read()\r\n# conn.request('GET', \"/latest/meta-data/iam/security-credentials/%s\"%files)\r\n# resp = conn.getresponse()\r\n# print resp.read()\r\n{code}\r\n\r\n*Workaround*\r\n\r\nCurrent workaround is to create a new HTTPConnection instance for every metadata URL query.\r\n\r\n*Pertinent Data*\r\n\r\nThis does affect the bootstrapping of s3cmd, but I am not sure what other tools it will affect.  ","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/18307","id":"18307","filename":"metadata-multiget-request.py","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-19T09:25:42.643-0600","size":1141,"mimeType":"text/x-python-script","content":"https://eucalyptus.atlassian.net/secure/attachment/18307/metadata-multiget-request.py"}],"summary":"Metadata Service Doesn't Handle Multiple URL Requests Per HTTP Connection","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":"3_*:*_1_*:*_26294653_*|*_10001_*:*_1_*:*_6650154380_*|*_10000_*:*_1_*:*_3292086687_*|*_10006_*:*_1_*:*_0_*|*_10003_*:*_1_*:*_2747231372","customfield_12100":"0|i00dmf:","customfield_10001":"2014-04-10T17:23:06.698-0500","customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["hspencer(hspencer)","mmunn1(mmunn1)","sjones(sjones)"],"customfield_10116":null,"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-8448/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/25902/comment/59886","id":"59886","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"Attached metadata-multiget-request.py.  This can be used instead of running the ipython session inside the instance.  The script performs the test that discovered this issue.  If the test is successful, it will print out the _role-name_ that was passed to the instance via the metadata service.  Example below:\r\n{code}\r\nubuntu@euca-172-17-121-140:~$ ./multi_http_get_test.py\r\n{\r\n    \"AccessKeyId\": \"AKIKPBYMARDN9VQIKXIN\",\r\n    \"Code\": \"Success\",\r\n    \"Expiration\": \"2013-12-19T16:18:59Z\",\r\n    \"LastUpdated\": \"2013-12-19T15:18:59Z\",\r\n    \"SecretAccessKey\": \"mZ9njZCWZvPAgb9gBqTcdLeh19x46JW30TAgTusb\",\r\n    \"Token\": \"ZXVjYQABuHfTjHJMKtjD2aS7Xd2005O3tYGPmIuVDbLcCKq7cnzv2IlIGKZILcZQmZC1Z04TMiLrsC5aER0MODT5lEYtVVgOD82+Ys6oGoyFOa/4sz0ETy8k+RImfUfTPVZQ58rdqeWrbQ7hM3YWZTzbdQ4ZBIQSSaDb0mrdaCDxv+H/Lh064xbmx079+oP6u+sXRfhO6buSud09JSqVYYjGxRLO5liBIyOPTPILtK4KcCykjwtPJGrP3M7a\",\r\n    \"Type\": \"AWS-HMAC\"\r\n}\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-12-19T09:25:42.653-0600","updated":"2013-12-19T09:25:42.653-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/25902/comment/63332","id":"63332","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"Confirmed this behavior is still present in 3.4.2:\r\n\r\n{code}\r\nubuntu@euca-172-17-112-249:~$ git clone https://github.com/s3tools/s3cmd.git\r\nCloning into 's3cmd'...\r\nremote: Reusing existing pack: 3795, done.\r\nremote: Total 3795 (delta 0), reused 0 (delta 0)\r\nReceiving objects: 100% (3795/3795), 3.14 MiB | 325 KiB/s, done.\r\nResolving deltas: 100% (2406/2406), done.\r\nubuntu@euca-172-17-112-249:~$ cd s3cmd\r\nubuntu@euca-172-17-112-249:~/s3cmd$ cd ..\r\nubuntu@euca-172-17-112-249:~$ ./s3cmd/s3cmd --configure\r\n\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n    An unexpected error has occurred.\r\n  Please try reproducing the error using\r\n  the latest s3cmd code from the git master\r\n  branch found at:\r\n    https://github.com/s3tools/s3cmd\r\n  If the error persists, please report the\r\n  following lines (removing any private\r\n  info as necessary) to:\r\n   s3tools-bugs@lists.sourceforge.net\r\n\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n\r\nInvoked as: ./s3cmd/s3cmd --configureProblem: BadStatusLine: ''\r\nS3cmd:   1.5.0-beta1\r\npython:   2.7.3 (default, Sep 26 2013, 20:03:06)\r\n[GCC 4.6.3]\r\nenvironment LANG=en_US.UTF-8\r\n\r\nTraceback (most recent call last):\r\n  File \"./s3cmd/s3cmd\", line 2337, in <module>\r\n    main()\r\n  File \"./s3cmd/s3cmd\", line 2081, in main\r\n    cfg = Config(options.config)\r\n  File \"/home/ubuntu/s3cmd/S3/Config.py\", line 127, in __init__\r\n    self.role_config()\r\n  File \"/home/ubuntu/s3cmd/S3/Config.py\", line 143, in role_config\r\n    resp=conn.getresponse()\r\n  File \"/usr/lib/python2.7/httplib.py\", line 1030, in getresponse\r\n    response.begin()\r\n  File \"/usr/lib/python2.7/httplib.py\", line 407, in begin\r\n    version, status, reason = self._read_status()\r\n  File \"/usr/lib/python2.7/httplib.py\", line 371, in _read_status\r\n    raise BadStatusLine(line)\r\nBadStatusLine: ''\r\n\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n    An unexpected error has occurred.\r\n  Please try reproducing the error using\r\n  the latest s3cmd code from the git master\r\n  branch found at:\r\n    https://github.com/s3tools/s3cmd\r\n  If the error persists, please report the\r\n  above lines (removing any private\r\n  info as necessary) to:\r\n   s3tools-bugs@lists.sourceforge.net\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\nubuntu@euca-172-17-112-249:~$ ipython\r\nPython 2.7.3 (default, Sep 26 2013, 20:03:06)\r\nType \"copyright\", \"credits\" or \"license\" for more information.\r\n\r\nIPython 0.12.1 -- An enhanced Interactive Python.\r\n?         -> Introduction and overview of IPython's features.\r\n%quickref -> Quick reference.\r\nhelp      -> Python's own help system.\r\nobject?   -> Details about 'object', use 'object??' for extra details.\r\n\r\nIn [1]: import httplib\r\n\r\nIn [2]: conn = httplib.HTTPConnection(host='169.254.169.254', timeout = 10)\r\n\r\nIn [3]: conn.set_debuglevel(2)\r\n\r\nIn [4]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/\")\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [5]: resp = conn.getresponse()\r\nreply: 'HTTP/1.1 200 OK\\r\\n'\r\nheader: Content-Type: text/plain\r\nheader: Content-Length: 16\r\n\r\nIn [6]: files = resp.read()\r\n\r\nIn [7]: print files\r\nACCT1-S3-ACTIONS\r\n\r\nIn [8]: print resp.status\r\n200\r\n\r\nIn [9]: conn.request('GET', \"/latest/meta-data/iam/security-credentials/%s\"%files)\r\nsend: 'GET /latest/meta-data/iam/security-credentials/ACCT1-S3-ACTIONS HTTP/1.1\\r\\nHost: 169.254.169.254\\r\\nAccept-Encoding: identity\\r\\n\\r\\n'\r\n\r\nIn [10]: resp = conn.getresponse()\r\nreply: ''\r\n---------------------------------------------------------------------------\r\nBadStatusLine                             Traceback (most recent call last)\r\n/home/ubuntu/<ipython-input-10-b9bf8c07bce9> in <module>()\r\n----> 1 resp = conn.getresponse()\r\n\r\n/usr/lib/python2.7/httplib.pyc in getresponse(self, buffering)\r\n   1028         response = self.response_class(*args, **kwds)\r\n   1029\r\n-> 1030         response.begin()\r\n   1031         assert response.will_close != _UNKNOWN\r\n   1032         self.__state = _CS_IDLE\r\n\r\n/usr/lib/python2.7/httplib.pyc in begin(self)\r\n    405         # read until we get a non-100 response\r\n\r\n    406         while True:\r\n--> 407             version, status, reason = self._read_status()\r\n    408             if status != CONTINUE:\r\n    409                 break\r\n\r\n/usr/lib/python2.7/httplib.pyc in _read_status(self)\r\n    369             # Presumably, the server closed the connection before\r\n\r\n    370             # sending a valid response.\r\n\r\n--> 371             raise BadStatusLine(line)\r\n    372         try:\r\n    373             [version, status, reason] = line.split(None, 2)\r\n\r\nBadStatusLine: ''\r\n\r\nIn [11]:\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-02-25T07:12:25.549-0600","updated":"2014-02-25T07:12:25.549-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/25902/comment/66623","id":"66623","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"The issue is we are closing the HTTP connection without sending the appropriate \"Connection: close\" header.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-10T17:23:06.698-0500","updated":"2014-04-10T17:23:06.698-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/25902/comment/66648","id":"66648","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"We now include the \"Connection: close\" header in instance metadata responses.\r\n\r\nTo test I used a slightly modified version of [~hspencer]s script:\r\n\r\n{code}\r\nimport httplib\r\nconn = httplib.HTTPConnection(host='169.254.169.254', timeout = 10)\r\nconn.set_debuglevel(2)\r\nconn.request('GET', \"/latest/meta-data/\")\r\nresp = conn.getresponse()\r\nprint resp.read()\r\nconn.request('GET', \"/latest/meta-data/\")\r\nresp = conn.getresponse()\r\nprint resp.read()\r\n\r\n{code}\r\n\r\nwhich will print out the response message from each request (so twice)","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-04-11T00:41:21.451-0500","updated":"2014-04-11T00:41:21.451-0500"}],"maxResults":4,"total":4,"startAt":0},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}