{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"57700","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/57700","key":"EUCA-13367","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"resolution":null,"customfield_10310":null,"customfield_11401":null,"customfield_10311":null,"customfield_11400":null,"customfield_10302":null,"customfield_10104":[],"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10105":null,"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"resolutiondate":null,"customfield_10308":null,"customfield_10704":null,"customfield_10309":null,"customfield_10705":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13367/watchers","watchCount":2,"isWatching":false},"lastViewed":null,"created":"2017-04-21T11:54:07.914-0500","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/4","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"customfield_12400":null,"customfield_12201":null,"customfield_12600":"{}","customfield_10300":null,"customfield_10102":null,"customfield_10301":null,"labels":[],"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18601","id":"18601","description":"Eucalyptus 4.4.1","name":"4.4.1","archived":false,"released":true,"releaseDate":"2017-05-09"}],"issuelinks":[{"id":"51600","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/51600","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"outwardIssue":{"id":"54109","key":"EUCA-13187","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54109","fields":{"summary":"Incorrect accounting for cluster availability per vmtype when using PV images","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=kedwards","name":"kedwards","key":"kedwards","accountId":"557058:f9c2f8da-1fc6-4aa7-8fb0-750e7e422b6b","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/d1746a6d05a30ca027012a7da4545962?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dkedwards%26avatarId%3D10200%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/d1746a6d05a30ca027012a7da4545962?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dkedwards%26avatarId%3D10200%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/d1746a6d05a30ca027012a7da4545962?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dkedwards%26avatarId%3D10200%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/d1746a6d05a30ca027012a7da4545962?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dkedwards%26avatarId%3D10200%26noRedirect%3Dtrue"},"displayName":"Ken Edwards","active":true,"timeZone":"America/Los_Angeles"},"updated":"2017-04-27T16:10:38.822-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10001","description":"This issue has been validated/reproduced, but has not been prioritized yet.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Confirmed","id":"10001","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11504","id":"11504","name":"EC2"}],"timeoriginalestimate":null,"description":"It appears that if there are VMs of different VM types in the pending state, the availability of one of these VM types can be mis-reported for a brief window of time.  In the following test it appears the m1.small vmtype briefly shows the availability of the c1.medium type instead of m1.small.\r\nThe logs from the NC and CC appear to be showing the correct availability during this period. \r\n\r\nTo reproduce:\r\nRun an m1.small VM, followed by a c1.medium VM (have only tested a single zone). Poll the VM type availability for the zone they are running in.  \r\n\r\nExample:\r\n{code}\r\nIn [290]: def vmtype_poll(vmtype):\r\n    tc.admin.ec2.show_zone_availability()\r\n    val = None\r\n    for x in xrange(0, 600):\r\n        start = time.time()\r\n        new_val = tc.admin.ec2.get_vm_type_info(vmtype).availability['one'].available\r\n        if new_val != val:\r\n            print 'type:{0} available:{1} time:{2}'.format(vmtype, new_val, time.asctime())\r\n            if val is not None and abs(int(new_val)-int(val)) > 1: \r\n                tc.admin.ec2.show_zone_availability()\r\n            val = new_val\r\n        time.sleep(.5)\r\n\r\nIn [291]: def run_ins(runemi):\r\n    ins = user.ec2.run_image(image=runemi, keypair=key, zone='one', group=group, vmtype='m1.small', min=1, max=1)\r\n    ins = user.ec2.run_image(image=runemi, keypair=key, zone='one', group=group, vmtype='c1.medium', min=1, max=1)\r\n{code}\r\n\r\nThen run the 2 vms and poll/monitor. Notice the vmtypes are mis-reported from \"Fri Apr 21 09:36:58 201\" then correctly reported again at \"Fri Apr 21 09:36:59 2017\" \r\n\r\n{code}\r\nIn [292]: run_ins(emi);  vmtype_poll('m1.small')\r\n[2017-04-21 09:36:20,823][INFO][EC2ops(admin:eucalyptus)]: \r\n ZONE: one AVAILABILE VM SLOTS:                                                                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n | VMTYPE           | FREE/MAX         | RAM        | CPU        | DISK       |                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n | t1.micro         | 4/4              | 4096       | 3          | 1          |                    \r\n | m1.small         | 22/24            | 256        | 1          | 5          |                    \r\n | m1.medium        | 11/12            | 512        | 1          | 10         |                    \r\n | c1.medium        | 11/12            | 512        | 2          | 10         |                    \r\n | m1.large         | 11/12            | 512        | 2          | 10         |                    \r\n | m1.xlarge        | 11/12            | 1024       | 2          | 10         |                    \r\n | c1.xlarge        | 9/9              | 2048       | 2          | 10         |                    \r\n | m2.xlarge        | 9/9              | 2048       | 2          | 10         |                    \r\n | m3.xlarge        | 7/7              | 2048       | 4          | 15         |                    \r\n | m2.2xlarge       | 3/3              | 4096       | 2          | 30         |                    \r\n | m3.2xlarge       | 3/3              | 4096       | 4          | 30         |                    \r\n | cc1.4xlarge      | 1/2              | 3072       | 8          | 60         |                    \r\n | m2.4xlarge       | 1/2              | 4096       | 8          | 60         |                    \r\n | hi1.4xlarge      | 0/0              | 6144       | 8          | 120        |                    \r\n | cc2.8xlarge      | 0/0              | 6144       | 16         | 120        |                    \r\n | cg1.4xlarge      | 0/0              | 12288      | 16         | 200        |                    \r\n | cr1.8xlarge      | 0/0              | 16384      | 16         | 240        |                    \r\n | hs1.8xlarge      | 0/0              | 119808     | 48         | 24000      |                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n                                                                                                   \r\n\r\ntype:m1.small available:22 time:Fri Apr 21 09:36:20 2017\r\ntype:m1.small available:21 time:Fri Apr 21 09:36:27 2017\r\ntype:m1.small available:9 time:Fri Apr 21 09:36:58 2017\r\n[2017-04-21 09:36:58,614][INFO][EC2ops(admin:eucalyptus)]: \r\n ZONE: one AVAILABILE VM SLOTS:                                                                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n | VMTYPE           | FREE/MAX         | RAM        | CPU        | DISK       |                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n | t1.micro         | 3/4              | 4096       | 3          | 1          |                    \r\n | m1.small         | 9/24             | 256        | 1          | 5          |                    \r\n | m1.medium        | 9/12             | 512        | 1          | 10         |                    \r\n | c1.medium        | 9/12             | 512        | 2          | 10         |                    \r\n | m1.large         | 9/12             | 512        | 2          | 10         |                    \r\n | m1.xlarge        | 9/12             | 1024       | 2          | 10         |                    \r\n | c1.xlarge        | 7/9              | 2048       | 2          | 10         |                    \r\n | m2.xlarge        | 7/9              | 2048       | 2          | 10         |                    \r\n | m3.xlarge        | 5/7              | 2048       | 4          | 15         |                    \r\n | m2.2xlarge       | 1/3              | 4096       | 2          | 30         |                    \r\n | m3.2xlarge       | 1/3              | 4096       | 4          | 30         |                    \r\n | cc1.4xlarge      | 0/2              | 3072       | 8          | 60         |                    \r\n | m2.4xlarge       | 0/2              | 4096       | 8          | 60         |                    \r\n | hi1.4xlarge      | 0/0              | 6144       | 8          | 120        |                    \r\n | cc2.8xlarge      | 0/0              | 6144       | 16         | 120        |                    \r\n | cg1.4xlarge      | 0/0              | 12288      | 16         | 200        |                    \r\n | cr1.8xlarge      | 0/0              | 16384      | 16         | 240        |                    \r\n | hs1.8xlarge      | 0/0              | 119808     | 48         | 24000      |                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n                                                                                                   \r\n\r\ntype:m1.small available:19 time:Fri Apr 21 09:36:59 2017\r\n[2017-04-21 09:36:59,207][INFO][EC2ops(admin:eucalyptus)]: \r\n ZONE: one AVAILABILE VM SLOTS:                                                                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n | VMTYPE           | FREE/MAX         | RAM        | CPU        | DISK       |                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n | t1.micro         | 4/4              | 4096       | 3          | 1          |                    \r\n | m1.small         | 19/24            | 256        | 1          | 5          |                    \r\n | m1.medium        | 9/12             | 512        | 1          | 10         |                    \r\n | c1.medium        | 9/12             | 512        | 2          | 10         |                    \r\n | m1.large         | 9/12             | 512        | 2          | 10         |                    \r\n | m1.xlarge        | 9/12             | 1024       | 2          | 10         |                    \r\n | c1.xlarge        | 8/9              | 2048       | 2          | 10         |                    \r\n | m2.xlarge        | 8/9              | 2048       | 2          | 10         |                    \r\n | m3.xlarge        | 5/7              | 2048       | 4          | 15         |                    \r\n | m2.2xlarge       | 2/3              | 4096       | 2          | 30         |                    \r\n | m3.2xlarge       | 2/3              | 4096       | 4          | 30         |                    \r\n | cc1.4xlarge      | 0/2              | 3072       | 8          | 60         |                    \r\n | m2.4xlarge       | 0/2              | 4096       | 8          | 60         |                    \r\n | hi1.4xlarge      | 0/0              | 6144       | 8          | 120        |                    \r\n | cc2.8xlarge      | 0/0              | 6144       | 16         | 120        |                    \r\n | cg1.4xlarge      | 0/0              | 12288      | 16         | 200        |                    \r\n | cr1.8xlarge      | 0/0              | 16384      | 16         | 240        |                    \r\n | hs1.8xlarge      | 0/0              | 119808     | 48         | 24000      |                    \r\n +------------------+------------------+------------+------------+------------+                    \r\n                                                                                                   \r\n\r\n^C---------------------------------------------------------------------------\r\nKeyboardInterrupt                         Traceback (most recent call last)\r\n\r\n{code}","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[],"summary":"VM type availability may be incorrect while VMs of different type are in pending","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":null,"customfield_12100":"0|i04467:","customfield_10001":null,"customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_12500":null,"customfield_10400":null,"customfield_10116":null,"customfield_11600":["kedwards(kedwards)","mclark(mclark)"],"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13367/votes","votes":0,"hasVoted":false},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}