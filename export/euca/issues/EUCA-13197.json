{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"54309","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/54309","key":"EUCA-13197","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"resolution":null,"customfield_10310":null,"customfield_10311":null,"customfield_11401":null,"customfield_11400":null,"customfield_10302":null,"customfield_10104":[],"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10105":null,"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"customfield_10308":null,"resolutiondate":null,"customfield_10704":null,"customfield_10705":null,"customfield_10309":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13197/watchers","watchCount":1,"isWatching":false},"created":"2017-02-03T17:45:24.380-0600","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12201":null,"customfield_12600":"{}","customfield_10300":null,"customfield_10102":null,"labels":[],"customfield_10301":null,"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_11901":null,"versions":[],"issuelinks":[],"assignee":null,"updated":"2017-06-26T12:16:02.154-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10001","description":"This issue has been validated/reproduced, but has not been prioritized yet.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Confirmed","id":"10001","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/12900","id":"12900","name":"CloudFormation"}],"timeoriginalestimate":null,"description":"Deletion of a VPC stack fails on the AWS::EC2::VPCGatewayAttachment resource if it is already detached.\r\n\r\nTo reproduce use the template:\r\n\r\n{code}\r\n{\r\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\r\n    \r\n    \"Description\": \"VPC stack\",\r\n    \r\n    \"Resources\": {\r\n        \"InternetGateway\": {\r\n            \"Type\": \"AWS::EC2::InternetGateway\"\r\n        },\r\n        \"Vpc\": {\r\n            \"Properties\": {\r\n                \"CidrBlock\": \"10.0.0.0/16\"\r\n            },\r\n            \"Type\": \"AWS::EC2::VPC\"\r\n        },\r\n        \"AttachInternetGateway\": {\r\n            \"Properties\": {\r\n                \"InternetGatewayId\": {\r\n                    \"Ref\": \"InternetGateway\"\r\n                },\r\n                \"VpcId\": {\r\n                    \"Ref\": \"Vpc\"\r\n                }\r\n            },\r\n            \"Type\": \"AWS::EC2::VPCGatewayAttachment\"\r\n        }\r\n    }\r\n}\r\n{code}\r\n\r\nCreate a stack and then manually detach the internet gateway:\r\n\r\n{code}\r\n# \r\n# \r\n# euform-create-stack --template-file vpc-template.json vpc-stack-1\r\narn:aws:cloudformation::000977437016:stack/vpc-stack-1/7eec687c-660a-49ec-a4bf-4939683581f8\r\n# \r\n# \r\n# euform-describe-stacks\r\nSTACK\tvpc-stack-1\tCREATE_COMPLETE\t\tVPC stack\t2017-02-03T23:21:02.732Z\r\n# \r\n# \r\n# euform-describe-stack-events vpc-stack-1\r\nEVENT\tvpc-stack-1\t2bd3b20b-af43-4f44-ab9b-556d83620d0b\tAWS::CloudFormation::Stack\tvpc-stack-1\tarn:aws:cloudformation::000977437016:stack/vpc-stack-1/7eec687c-660a-49ec-a4bf-4939683581f8\t2017-02-03T23:21:06.709Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-CREATE_COMPLETE-1486164066346\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\tvpc-stack-1-AttachInternetGateway-6PAQGIHXVY6Y3\t2017-02-03T23:21:06.346Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-CREATE_IN_PROGRESS-1486164066122\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\tvpc-stack-1-AttachInternetGateway-6PAQGIHXVY6Y3\t2017-02-03T23:21:06.122Z\tCREATE_IN_PROGRESS\tResource creation Initiated\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-CREATE_IN_PROGRESS-1486164065846\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\t\t2017-02-03T23:21:05.846Z\tCREATE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\tVpc-CREATE_COMPLETE-1486164065470\tAWS::EC2::VPC\tVpc\tvpc-7def3585\t2017-02-03T23:21:05.470Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tInternetGateway-CREATE_COMPLETE-1486164065011\tAWS::EC2::InternetGateway\tInternetGateway\tigw-6eacf4ed\t2017-02-03T23:21:05.011Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tVpc-CREATE_IN_PROGRESS-1486164064541\tAWS::EC2::VPC\tVpc\tvpc-7def3585\t2017-02-03T23:21:04.541Z\tCREATE_IN_PROGRESS\tResource creation Initiated\r\nEVENT\tvpc-stack-1\tInternetGateway-CREATE_IN_PROGRESS-1486164064417\tAWS::EC2::InternetGateway\tInternetGateway\tigw-6eacf4ed\t2017-02-03T23:21:04.417Z\tCREATE_IN_PROGRESS\tResource creation Initiated\r\nEVENT\tvpc-stack-1\tVpc-CREATE_IN_PROGRESS-1486164064042\tAWS::EC2::VPC\tVpc\t\t2017-02-03T23:21:04.042Z\tCREATE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\tInternetGateway-CREATE_IN_PROGRESS-1486164064033\tAWS::EC2::InternetGateway\tInternetGateway\t\t2017-02-03T23:21:04.033Z\tCREATE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\t02515bad-5a29-4841-93c0-e73f2b892310\tAWS::CloudFormation::Stack\tvpc-stack-1\tarn:aws:cloudformation::000977437016:stack/vpc-stack-1/7eec687c-660a-49ec-a4bf-4939683581f8\t2017-02-03T23:21:03.364Z\tCREATE_IN_PROGRESS\tUser Initiated\r\n# \r\n# \r\n# euca-detach-internet-gateway igw-6eacf4ed -c vpc-7def3585\r\n# \r\n{code}\r\n\r\nDeletion of the stack now fails when detach is attempted of the already detached internet gateway:\r\n\r\n{code}\r\n# \r\n# euform-delete-stack vpc-stack-1\r\n# \r\n# \r\n# euform-describe-stacks\r\nSTACK\tvpc-stack-1\tDELETE_IN_PROGRESS\tUser Initiated\tVPC stack\t2017-02-03T23:21:02.732Z\r\n# \r\n# \r\n# euform-describe-stacks\r\nSTACK\tvpc-stack-1\tDELETE_FAILED\tThe following resource(s) failed to delete: [AttachInternetGateway].\tVPC stack\t2017-02-03T23:21:02.732Z\r\n# \r\n# \r\n# euform-describe-stack-events vpc-stack-1\r\nEVENT\tvpc-stack-1\tccfec9fd-14f6-48c1-995f-15d8f424f447\tAWS::CloudFormation::Stack\tvpc-stack-1\tarn:aws:cloudformation::000977437016:stack/vpc-stack-1/7eec687c-660a-49ec-a4bf-4939683581f8\t2017-02-03T23:23:09.113Z\tDELETE_FAILED\tThe following resource(s) failed to delete: [AttachInternetGateway].\r\nEVENT\tvpc-stack-1\tVpc-DELETE_COMPLETE-1486164188759\tAWS::EC2::VPC\tVpc\tvpc-7def3585\t2017-02-03T23:23:08.759Z\tDELETE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tInternetGateway-DELETE_COMPLETE-1486164188733\tAWS::EC2::InternetGateway\tInternetGateway\tigw-6eacf4ed\t2017-02-03T23:23:08.733Z\tDELETE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tInternetGateway-DELETE_IN_PROGRESS-1486164188217\tAWS::EC2::InternetGateway\tInternetGateway\tigw-6eacf4ed\t2017-02-03T23:23:08.217Z\tDELETE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\tVpc-DELETE_IN_PROGRESS-1486164188191\tAWS::EC2::VPC\tVpc\tvpc-7def3585\t2017-02-03T23:23:08.191Z\tDELETE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-DELETE_FAILED-1486164187824\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\tvpc-stack-1-AttachInternetGateway-6PAQGIHXVY6Y3\t2017-02-03T23:23:07.824Z\tDELETE_FAILED\tresource igw-6eacf4ed is not attached to network vpc-7def3585\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-DELETE_IN_PROGRESS-1486164130654\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\tvpc-stack-1-AttachInternetGateway-6PAQGIHXVY6Y3\t2017-02-03T23:22:10.654Z\tDELETE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\t875a4fab-f9d7-4b48-a073-af8ec9af7d24\tAWS::CloudFormation::Stack\tvpc-stack-1\tarn:aws:cloudformation::000977437016:stack/vpc-stack-1/7eec687c-660a-49ec-a4bf-4939683581f8\t2017-02-03T23:22:10.350Z\tDELETE_IN_PROGRESS\tUser Initiated\r\nEVENT\tvpc-stack-1\t2bd3b20b-af43-4f44-ab9b-556d83620d0b\tAWS::CloudFormation::Stack\tvpc-stack-1\tarn:aws:cloudformation::000977437016:stack/vpc-stack-1/7eec687c-660a-49ec-a4bf-4939683581f8\t2017-02-03T23:21:06.709Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-CREATE_COMPLETE-1486164066346\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\tvpc-stack-1-AttachInternetGateway-6PAQGIHXVY6Y3\t2017-02-03T23:21:06.346Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-CREATE_IN_PROGRESS-1486164066122\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\tvpc-stack-1-AttachInternetGateway-6PAQGIHXVY6Y3\t2017-02-03T23:21:06.122Z\tCREATE_IN_PROGRESS\tResource creation Initiated\r\nEVENT\tvpc-stack-1\tAttachInternetGateway-CREATE_IN_PROGRESS-1486164065846\tAWS::EC2::VPCGatewayAttachment\tAttachInternetGateway\t\t2017-02-03T23:21:05.846Z\tCREATE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\tVpc-CREATE_COMPLETE-1486164065470\tAWS::EC2::VPC\tVpc\tvpc-7def3585\t2017-02-03T23:21:05.470Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tInternetGateway-CREATE_COMPLETE-1486164065011\tAWS::EC2::InternetGateway\tInternetGateway\tigw-6eacf4ed\t2017-02-03T23:21:05.011Z\tCREATE_COMPLETE\t\r\nEVENT\tvpc-stack-1\tVpc-CREATE_IN_PROGRESS-1486164064541\tAWS::EC2::VPC\tVpc\tvpc-7def3585\t2017-02-03T23:21:04.541Z\tCREATE_IN_PROGRESS\tResource creation Initiated\r\nEVENT\tvpc-stack-1\tInternetGateway-CREATE_IN_PROGRESS-1486164064417\tAWS::EC2::InternetGateway\tInternetGateway\tigw-6eacf4ed\t2017-02-03T23:21:04.417Z\tCREATE_IN_PROGRESS\tResource creation Initiated\r\nEVENT\tvpc-stack-1\tVpc-CREATE_IN_PROGRESS-1486164064042\tAWS::EC2::VPC\tVpc\t\t2017-02-03T23:21:04.042Z\tCREATE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\tInternetGateway-CREATE_IN_PROGRESS-1486164064033\tAWS::EC2::InternetGateway\tInternetGateway\t\t2017-02-03T23:21:04.033Z\tCREATE_IN_PROGRESS\t\r\nEVENT\tvpc-stack-1\t02515bad-5a29-4841-93c0-e73f2b892310\tAWS::CloudFormation::Stack\tvpc-stack-1\tarn:aws:cloudformation::000977437016:stack/vpc-stack-1/7eec687c-660a-49ec-a4bf-4939683581f8\t2017-02-03T23:21:03.364Z\tCREATE_IN_PROGRESS\tUser Initiated\r\n# \r\n#\r\n{code}\r\n\r\nRetries of the deletion will succeed with the above template but may repeatedly fail if the template declares dependences between resources.","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[],"summary":"CloudFormation vpc stack deletion fails after manual detach of internet gateway","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"customfield_12100":"0|i042en:","customfield_10000":null,"aggregateprogress":{"progress":0,"total":0},"customfield_10001":null,"customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["sjones(sjones)"],"customfield_10116":null,"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13197/votes","votes":0,"hasVoted":false},"comment":{"comments":[],"maxResults":0,"total":0,"startAt":0},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}