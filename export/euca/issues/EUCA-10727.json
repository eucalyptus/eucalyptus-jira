{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"35615","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/35615","key":"EUCA-10727","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/7","id":"7","description":"A user story. Created by JIRA Software - do not edit or delete.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14815&avatarType=issuetype","name":"Story","subtask":false,"avatarId":14815},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14801","id":"14801","description":"Eucalyptus 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2015-10-22"}],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10311":null,"customfield_11401":null,"customfield_11400":null,"customfield_12800":null,"customfield_10104":["com.atlassian.greenhopper.service.sprint.Sprint@66179d95[id=113,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 4,goal=<null>,startDate=2015-04-30T17:10:52.516Z,endDate=2015-05-20T17:10:00.000Z,completeDate=2015-05-22T01:23:00.449Z,sequence=113]","com.atlassian.greenhopper.service.sprint.Sprint@31f6cb8d[id=119,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 5,goal=<null>,startDate=2015-05-22T01:25:21.486Z,endDate=2015-06-11T01:25:00.000Z,completeDate=2015-06-18T16:45:49.818Z,sequence=119]","com.atlassian.greenhopper.service.sprint.Sprint@59f99184[id=122,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 6,goal=<null>,startDate=2015-06-11T13:02:10.090Z,endDate=2015-07-01T13:02:00.000Z,completeDate=2015-07-06T19:44:13.686Z,sequence=122]","com.atlassian.greenhopper.service.sprint.Sprint@2b161174[id=123,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 7,goal=<null>,startDate=2015-07-02T19:45:06.233Z,endDate=2015-07-23T19:45:00.000Z,completeDate=2015-07-28T14:18:30.340Z,sequence=123]","com.atlassian.greenhopper.service.sprint.Sprint@71b7dab6[id=126,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 8,goal=<null>,startDate=2015-07-24T17:18:30.088Z,endDate=2015-08-14T17:18:00.000Z,completeDate=2015-08-19T20:57:28.154Z,sequence=126]","com.atlassian.greenhopper.service.sprint.Sprint@761addae[id=127,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 9,goal=<null>,startDate=2015-08-18T21:33:50.479Z,endDate=2015-09-08T21:33:00.000Z,completeDate=2015-09-11T20:28:07.867Z,sequence=127]","com.atlassian.greenhopper.service.sprint.Sprint@63fa1758[id=128,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 10,goal=<null>,startDate=2015-09-09T20:38:52.383Z,endDate=2015-10-02T20:38:00.000Z,completeDate=2015-11-03T02:34:19.117Z,sequence=128]"],"customfield_10303":null,"customfield_10105":null,"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":null,"customfield_10703":null,"customfield_10308":null,"customfield_10704":null,"resolutiondate":"2015-10-05T10:27:45.958-0500","customfield_10309":null,"customfield_10705":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10727/watchers","watchCount":2,"isWatching":false},"created":"2015-04-09T11:50:27.992-0500","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12201":null,"customfield_12600":"{}","customfield_10102":null,"labels":[],"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14801","id":"14801","description":"Eucalyptus 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2015-10-22"}],"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"updated":"2016-06-06T16:24:28.245-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11502","id":"11502","name":"Cloudwatch"}],"timeoriginalestimate":null,"customfield_13000":null,"description":"As a cloud administrator, I would like to determine whether or not a cloud with two nodes can function if 10,000 instances worth of cloudwatch instance data is fed into it and/or 5,000,000 alarms.  This represents 10,000 instances and 5000 alarms for 1000 accounts.  If this data is not currently supported, determine a number for alarms/instance data that is supported.","customfield_13200":null,"customfield_11300":"EUCA-10517","customfield_11500":null,"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14801","id":"14801","description":"Eucalyptus 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2015-10-22"}],"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[],"summary":"Cloudwatch: Determine alarms and instances max usage for two nodes","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"subtasks":[{"id":"36142","key":"EUCA-10823","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/36142","fields":{"summary":"Determine how much instance data can be put into the system","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/5","id":"5","description":"The sub-task of the issue","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14816&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":14816}}}],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"customfield_10000":"5_*:*_1_*:*_0_*|*_10000_*:*_1_*:*_1819703774_*|*_10001_*:*_1_*:*_13640934227","aggregateprogress":{"progress":0,"total":0},"customfield_12100":"0|i000wn:","customfield_10001":null,"customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_10004":8.0,"customfield_12500":null,"customfield_11600":["ethomas(ethomas)"],"customfield_10116":null,"customfield_10117":null,"environment":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/35615/comment/92903","id":"92903","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"body":"The following cases have been tested and numbers will be reported below.\r\n\r\n1) On a standard QA setup, with 1 UFS, 1 CLC, and 1 NC, using the CloudWatchFalseDataSystemMetricGenerator (modified for 500 accounts), data was fed into the AbsoluteMetricHistoryQueue, simulating system data for 1,000 instances, each with 2 EBS volumes, with 1 minute granularity.  This amount of data was comfortably handled by the system, taking about 40 seconds to pass through the absolute metric \"phase\" and data sent to the put metric data queue.  (About 28,000 data points were in the absolute metric queue every minute).  The put metric data queue was able to handle the points generated (which had turned into 58,000 points by this point due to redundant points for instance data (one with \"instanceId\" dimensions, one with \"imageId\", one with \"instanceType\", one with no dimensions) in generally less than 20 seconds.  The List Metric data queue was serviced once every 5 minutes, and due to duplicate removal, generally only had 58,000 data points in it, but often took more than 5 minutes to service, which somewhat regularly causes transaction timeout issues.  The bottleneck in this case seems to be in the absolute metric phase, possibly putting data across the wire.\r\n\r\n2) On a standard QA setup as described in #1, using a java program written against the AWS SDK in java, sending 58,000 data points (similar data to #1) to the UFS via the Put Metric Data command directly, using synchronous calls with 4 threads (also with 500 users) took about 20-30 seconds per minute.  The put metric data queue also took similar time as in #1.  The List Metric Data queue also had similar performance, as well as the rollback/timeout issues.  Other tests in the past have shown scaling to more than one UFS linearly scales the amount of data that can be put into the Put Metric Data queues but processing there is not linear, as all nodes are writing to the same database.\r\n\r\n3) On the same setup as #2, with each metric \"fully padded\" with 10 dimensions each, it took about 40-45 seconds to send the data across.  Put metric data/list metric data times and results were similar to #2.  So CW can handle all the dimensions.\r\n\r\n3)  On a standard QA setup as described in #1, with 14 days worth of 500 instances (and 1000 EBS volumes) prepopulated in the database, 14,000 alarms each with 1 alarm action (many against the same autoscaling groups), in this case, generally 10 accounts, each with 1 autoscaling group, depending on the setup, it took anywhere from 90 seconds to 140 minutes to evaluate all the alarms and execute the actions.  Reducing the number of alarms to 7000 reduced the time to less than one minute.  (Though sometimes twice that if alarm actions were executed)\r\n\r\n4) In a similar setup to #3, alarms were given the maximum number of alarm actions (5 in each of OK/INSUFFICIENT_ACTION/ALARM).  There were 5 autoscaling groups for each account, and 1 action for each group.  Thus every autoscaling group action was likely called every minute many times.  With this, only  616 alarms could be evaluated each minute.  Clearly the alarm action execution is the bottleneck here.  There is no issue storing the alarm actions, just executing them in a timely manner.\r\n\r\n5) In a setup similar to #3, it appeared that 14000 alarms could be evaluated and executed in about 15 seconds, even while data for 1,000 instances was put into the system in real time as in setup #2 above.  While in a different system as #3 and #4, these numbers seemed to be at odds with the results there.  Prepopulating the database with 5 days of data for 1000 instances did not seem to affect the speed, but it was noted that setup #3 and #4 had 14 days of data for 500 instances, rather than 5 days of data for 1000 instances.  More data for #5 will be obtained once this data is loaded.  \r\n\r\nAddendum(5): Now with a setup similar to #4, with two weeks of data for 500 instances, it generally takes under 60 seconds to evaluate 14,000 alarms (though sometimes twice as long, assuming when the alarm state changes and alarm evaluation must occur).  Not much impact occurs to the timing when data for 1,000 instances is added real-time via the put metric data command as in setup #2.  There must be some difference in hardware or configuration, as I have also seen a 2x time difference in bulk data insert across systems.\r\n\r\nSo bottom line, it appears in some cases that data for 1,000 instances (or about 58,000 points for put metric data) can be put into the system at a 1 minute interval, with 14,000 alarms being executed per minute, under certain circumstances. \r\n\r\n\r\n\r\n\r\n \r\nFinally, I will describe disk space requirements.  In a standard QA setup the default disk allcation is 200GB.  This is approximately enough disk for 5 days of data for 1000 instances and 2000 EBS volumes at a 1 minute interval.  In order to hold data for two weeks at 10,000 instances and 20,000 volumes, we need at least 30 times that amount, so a disk of 6TB is required.  This is an approximate calculation, and does not include situation like metrics with lots of dimensions or the fact that the database often soft deletes row updates.  Additional 'scratch' space may also be required. \r\n\r\nIn addition to the above, I also ran a test case with fields of maximum length.  Each data point had 10 dimensions, and each text field was 255 characters.  At this point the standard QA machine with 200 GB was able to hold data for 2.5 days at 1000 instances.  We would need approximately 60 times this amount for 2 weeks of 10000 instances, which is approximately 12TB of space.  (Again, this does not include temporary or scratch space, this is simply for storage).","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-10-05T02:05:36.849-0500","updated":"2015-10-08T13:18:14.832-0500"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10727/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}