{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"36913","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/36913","key":"EUCA-11014","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/10301","id":"10301","description":"","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14911&avatarType=issuetype","name":"Spike","subtask":false,"avatarId":14911},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14801","id":"14801","description":"Eucalyptus 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2015-10-22"}],"customfield_11001":null,"aggregatetimespent":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10310":null,"customfield_10311":null,"customfield_11401":null,"customfield_11400":null,"customfield_10104":["com.atlassian.greenhopper.service.sprint.Sprint@42504f91[id=122,rapidViewId=92,state=CLOSED,name=4.2.0 Sprint 6,goal=<null>,startDate=2015-06-11T13:02:10.090Z,endDate=2015-07-01T13:02:00.000Z,completeDate=2015-07-06T19:44:13.686Z,sequence=122]"],"customfield_10303":null,"customfield_10105":null,"customfield_10304":null,"customfield_10700":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":null,"customfield_10703":null,"customfield_10704":null,"customfield_10308":null,"resolutiondate":"2015-06-25T20:08:26.435-0500","customfield_10309":null,"customfield_10705":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-11014/watchers","watchCount":1,"isWatching":false},"lastViewed":null,"created":"2015-06-24T17:12:12.987-0500","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12400":null,"customfield_12201":null,"customfield_10102":null,"customfield_12600":"{}","labels":[],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_11901":null,"versions":[],"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"updated":"2016-06-06T16:29:13.379-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/11502","id":"11502","name":"Cloudwatch"}],"timeoriginalestimate":null,"description":"In an attempt to determine the best way to insert data in the 'metric_data' tables, several sets of alternatives exist.\r\n\r\nBatch Mode: Batch mode or non-batch mode\r\n\r\nTable Stragegy: One table or many tables\r\n\r\nJDBC or Native: Use jdbc/hibernate code or native Postgres CopyManager.  The latter is non-portable but probably faster.\r\n\r\nDimensions Representation: Dimensions are referenced via a hash in the tables and there are current extra redundant fields.  Redundant fields may be useful with hash collisions though (should not happen).  The options here are\r\na) 20 \"redundant fields) (dim_X_name, dim_X_ value for X = 1..10)\r\nb) one large text field (about 7000 chars) that concat all dim name/values\r\nc) no redundant fields\r\n\r\nResults will be shown in a matrix.\r\n\r\nalternatives exist.\r\n1) Use \"batch\" mode for insert \r\n2) Don't use \"batch\" mode for insert\r\n1 and 2 above depend on fields set in hibernate.\r\nOther options include\r\n1) Use standard JDBC/Hibernate commands for insert\r\n2) Use PSQL native code (might be faster but not portable)","customfield_13000":null,"customfield_13200":null,"customfield_11300":"EUCA-10517","customfield_11500":null,"timetracking":{},"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/24712","id":"24712","filename":"10000 instances-1 minute of data.xlsx","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-06-25T19:44:15.062-0500","size":6470,"mimeType":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","content":"https://eucalyptus.atlassian.net/secure/attachment/24712/10000+instances-1+minute+of+data.xlsx"}],"summary":"Determine differences in Cloudwatch 'insert' tasks","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"customfield_12100":"0|i002qv:","aggregateprogress":{"progress":0,"total":0},"customfield_10000":"1_*:*_1_*:*_96973464_*|*_5_*:*_1_*:*_0","customfield_10001":null,"customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_10116":null,"customfield_11600":["ethomas(ethomas)"],"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"progress":{"progress":0,"total":0},"customfield_11806":null,"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-11014/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/36913/comment/88389","id":"88389","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"body":"There should be an attached file above 10000 instances-1 minute of data.xsls.  The variability in the file is as follows.\r\nThe columns indicate the number of insert operations \"at a time\" that are done before a new connection is created.\r\nThe rows indicate combinations from above, with the different keys as follows:\r\n\r\nJDBC = use hibernate and standard JDBC commands, nothing postgres specific\r\nNATIVE = use the Postgres driver's \"CopyManager\" to do \"COPY\" sql commands.  Postgres specific.\r\n\r\nBATCH = use the tables in the schema/database where hibernate property 'hibernate.jdbc.batch_size' is defined.  (value is 50).  Use batch idiom (clear and flush session) during \r\nJDBC calls.  (No difference in NATIVE case).\r\nNONBATCH = use the tables in the schema/database where hibernate property 'hibernate.jdbc.batch_size' is not defined.  (value is 50).  Don't use batch idiom (clear and flush session) during JDBC calls.  (No difference in NATIVE case).\r\n\r\nSINGLE = use a schema with a single db table (metric_data)\r\nMULTI = use a schema with 32 database tables (0..9/a..f for custom and system metrics)\r\n\r\nREGULAR = use the same fields for dimensions (dim_1_name, dim_1_value, dim_2_name, dim_2_value, ... , dim_10_name, dim_10_value) that are currently used by CW.\r\nTEXT = use a single string field (dimensions) for the dimensions.  (key=value, comma separated)\r\nNONE = use no fields for dimensions\r\n\r\nFor dimensions, we already use a dimension_hash for search.  The values stored in REGULAR, TEXT, NONE fields are never referenced.\r\n\r\nGiven the information above, the row in the table: JDBC-NONBATCH-SINGLE-REGULAR uses standard JDBC/Hibernate calls in a database that is not configured for batch inserts, a single table, and 20 fields for dimensions.\r\n\r\nThe numbers shown in the table are in milliseconds, just the part of the code that does the INSERT into the table.\r\n\r\nTo try to keep the numbers as consistent as possible, before every run, all data from the schemas was deleted, the clc was restarted, and a VACUUM FULL command was issued to each database.  (See postgres documentation for more details about vacuum).\r\n\r\nAll attempts were made to use the same machines for this test, but we ran out of time.  Numbers in yellow were \"approximated\" as follows.\r\nFor the numbers in yellow, runs were done on a different machine.\r\n1) A previously run scenario that had been run on the original machines was run on the new machine.  (For example, in the case of JDBC-NONBATCH-MULTI-TEXT, the scenario was run with 100 connections on the original and new machine).  This run scenario was done twice and time averaged.\r\n2) The scenario we wanted to run was run on the new machine.  The final value was as follows\r\n\r\nfinal value (skewed) = final value (raw) * (average_time_of_other_scenario on new machine) / (time of other_scenario on old machine)\r\n\r\nThe rationale is that the new machine may be a bit faster/slower overall than the old machine.  The assumptions are simplistic, I know.\r\n\r\nRegardless, certain information was determined.\r\n\r\n1) NATIVE runs faster than JDBC in general.\r\n2) MULTI runs faster than SINGLE, but this is probably because less information is going into each table.  This may change when more data is added later.\r\n3) BATCH runs faster than NONBATCH (except in the cases where the number of items per connection is less than the batch size)\r\n4) NONE runs faster than TEXT, and TEXT runs faster than REGULAR.\r\n\r\n\r\nFrom the above, however, the biggest speed increase comes from using BATCH or NATIVE.  Given that we would prefer to be DB agnostic, we will use BATCH for this release, unless we have a need for even more throughput.\r\n\r\nWe will also keep \"REGULAR\" as to avoid the need for upgrade changes, for now.  \r\n\r\nIn the future, we do have more efficiencies we can perform if needed.\r\n\r\nIf you want to run the test yourself, you can do the following\r\n\r\n1) Setup a db setup against the branch dev-ethomas-EUCA-batch-exp\r\n2) log into the CLC machine as root, \"source eucarc\" then run the following command.\r\n3) euca-modify-property -peuca='new com.eucalyptus.cloudwatch.experiment.Experiment(1, 10000, 100, \"JDBC\", \"BATCH\", \"MULTI\", \"REGULAR\").start()'\r\nThe arguments to the function in 3 in order are: \r\nnumber of minutes of data to enter (will be entered w/o waiting a minute).  Usually 1 minute is enough\r\nnumber of instances of data to check\r\nJDBC or NATIVE as described above\r\nBATCH or NONBATCH as described above\r\nMULTI or SINGLE as described above\r\nREGULAR or TEXT or NONE as described above\r\n\r\noutput will be at the FATAL log level in /var/log/eucalyptus/cloud-output.log \r\nrun a test against the branch: \r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=ethomas","name":"ethomas","key":"ethomas","accountId":"557058:8f092f9a-0724-44c0-84a3-0220705f856a","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a01d066493c57e5dee4b94dc87395576?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Evan Thomas","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-06-25T20:08:08.214-0500","updated":"2015-08-18T16:26:51.889-0500"}],"maxResults":1,"total":1,"startAt":0},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}