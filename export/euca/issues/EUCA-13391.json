{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"58100","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100","key":"EUCA-13391","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/19100","id":"19100","description":"Eucalyptus 4.4.2","name":"4.4.2","archived":false,"released":true,"releaseDate":"2017-08-30"}],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/12401","value":"VPC-MIDO","id":"12401"}],"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"customfield_11400":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10302":null,"customfield_10104":[],"customfield_10303":null,"customfield_10105":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"customfield_10704":null,"resolutiondate":"2017-08-02T12:44:15.824-0500","customfield_10308":null,"customfield_10705":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13391/watchers","watchCount":4,"isWatching":false},"lastViewed":null,"created":"2017-05-05T11:48:17.462-0500","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12201":null,"customfield_12600":"{repository={count=1, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":1,\"lastUpdated\":\"2017-07-24T12:11:42.000-0500\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":1,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10300":null,"customfield_10102":null,"customfield_10301":null,"labels":[],"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/18601","id":"18601","description":"Eucalyptus 4.4.1","name":"4.4.1","archived":false,"released":true,"releaseDate":"2017-05-09"}],"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"updated":"2017-08-02T12:44:15.858-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10006","description":"A fix has been committed, and will be part of the next release","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Release Pending","id":"10006","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/13601","id":"13601","name":"VPC"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/12800","id":"12800","name":"eucanetd","description":"Used to track component level items associated with Edge."}],"timeoriginalestimate":null,"description":"VPC migration test is failing due to inability to ping from vm to vm within the same SG after VM migration. Investigating more now. Sample params to run this test alone in CI by replacing the CLC ip...\r\n\r\nhttp://jenkins.qa1.eucalyptus-systems.com/job/nephoria-vpc-eni-basics/19/parameters/\r\n\r\nConsole output from a failed test. \r\n\r\nhttp://jenkins.qa1.eucalyptus-systems.com/job/nephoria-vpc-eni-basics/19/console\r\n\r\nThanks, \r\n-M","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"Cannot ping secondary ENIs after VM migration","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"customfield_10000":"3_*:*_1_*:*_1454979039_*|*_10000_*:*_1_*:*_533797141_*|*_10001_*:*_1_*:*_4925741801_*|*_10003_*:*_1_*:*_778440417_*|*_10006_*:*_1_*:*_0","customfield_12100":"0|i044fj:","aggregateprogress":{"progress":0,"total":0},"customfield_10001":"2017-05-12T15:37:15.865-0500","customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_10116":null,"customfield_11600":["mclark(mclark)","tsugawa(tsugawa)","sjones(sjones)","sgraham(sgraham)"],"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13391/votes","votes":0,"hasVoted":false},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/121515","id":"121515","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"I was able to reproduce this manually. The 2nd interface is not reachable post migration from VM's within the same subnet and security group. It can be detached and reattached and becomes reachable again. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-05-05T14:21:25.212-0500","updated":"2017-05-05T14:21:25.212-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/121909","id":"121909","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"Some notes on this issue from architecture meeting discussion. \r\n\r\nQ's for [~mclark]:\r\n* is this a regression? (or not previously tested)\r\n* if a regression do we know the last release that did not have this issue?\r\n* does this occur on very migration? (i.e. is easy to reproduce)\r\n\r\nOther items to check:\r\n* does a eucanetd restart fix the issue? if so it is likely a eucanetd  issue else probably a node controller issue  \r\n* does the instance xml contain network interface information after migration?\r\n* does the global network info have the right network interface information after migration?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-05-12T15:37:15.865-0500","updated":"2017-05-12T15:37:15.865-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/121919","id":"121919","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks like an error on the NC. Maybe due to order of operations on the secondary ENIs (more info below)?\r\n\r\nI believe this is a regression, this test was passing late January but began failing for a different reason (selinux issue I believe which has since been fixed). I'm not sure when this issue became the cause of failure as the ENI test was recently moved to it's own job, and detailed test history/output is now truncated on the parent. \r\n\r\nThis test is reproducible every time using the following job and job parameters:\r\nhttp://jenkins.qa1.eucalyptus-systems.com:8080/view/NET/job/nephoria-vpc-eni-basics/build?delay=0sec\r\nSet the following job parameters; 'clc_ip' == clc ip address,\r\n'extra_args' == --test-list test6m1_eni_migration_test_with_secondary_eni --no-clean\r\n\r\nTo test by hand:\r\nCreate 2 VMs which 2 ENIs each. \r\nENI1 should be on a public reachable subnet used to ssh into each VM. \r\nENI2 should be on a 2nd and private subnet used to communicate between VM1 and VM2. \r\nSetup network for 2nd ENIs, (example: static network config/ip assignment and bring each interface up)\r\nVerify VM1 can ping VM2 on the 2nd ENIs. \r\nMigrate VM1, verify migration from nodeA to nodeB\r\nRe-verify VM1 can ping VM2 on the 2nd ENIs. \r\n\r\nI have tested with selinux in enforcing as well as permissive, both fail with the error shown below.\r\n\r\nThanks, \r\n-M\r\n\r\nnc.log...\r\n{code}\r\n2017-05-15 11:20:13  INFO | [i-252c231a] migration destination preparing 10.111.1.199 > 10.111.1.45 [creds=present]\r\n2017-05-15 11:20:16 ERROR | [i-252c231a] failed to write instance XML to\r\n2017-05-15 11:20:16  INFO | [i-252c231a] skipping download of http://10.111.5.151:8773/services/objectstorage/7af7bf-download-manifests-v2/DM-emi-ed3355c8-one?Signature=W2V06Zh1BlNVKXg95CiwyIyCy3E%3D&AWSAccessKeyId=AKIAA76FSANZLCY2KBCA&Expires=1494883108&x-amz-security-token=ZXVjYQABNTbu1sud90MeLtrSIfsiaR90LuNobRgsVCQUgV38QGjcSs0%2Br3pnM2nXsPXO1%2BY2F8llQp4dkoGAXCFKiVlmwhDbwNehBGMW0zplSM59TbK7aa8sjP%2FrYE1y%2FvBfToQ%2FDHWa5qnbiWG6ClFCCSptmDjVnrBsY6IH7C9t1Q8oGalm%2FMljTF7ineKuq42jGmF6%2FkfY61sV4t1JTvythZB35XmOqTtuqvptpoE%2F74Y4yj5s7URqM30g%2B2%2FWfg%3D%3D\r\n2017-05-15 11:20:17  INFO | [i-252c231a] skipping formatting of prt-03072ext3-11384fdc\r\n2017-05-15 11:20:17  INFO | [i-252c231a] migration destination ready 10.111.1.199 > 10.111.1.45\r\n2017-05-15 11:20:23  INFO | [i-252c231a] incoming (10.111.1.45 < 10.111.1.199) migration in progress (1 of 1)\r\n2017-05-15 11:21:24  INFO | [i-252c231a] completing incoming (10.111.1.45 < 10.111.1.199) migration...\r\n2017-05-15 11:21:24  INFO | [i-252c231a] incoming migration complete (0 other incoming migration[s] actively in progress)\r\n2017-05-15 11:21:24  INFO | no remaining active incoming migrations -- checking to see if there are any pending migrations\r\n2017-05-15 11:21:24  INFO | no remaining incoming or pending migrations -- deauthorizing all migration client keys\r\n2017-05-15 11:22:15 ERROR | libvirt: Unable to create tap device vn_eni-fdbe000c: Device or resource busy (code=38)\r\n2017-05-15 11:22:15 ERROR | [i-252c231a][eni-fdbe000c] failed to attach network interface to guest on attempt 1 of 3\r\n2017-05-15 11:22:18 ERROR | libvirt: Unable to create tap device vn_eni-fdbe000c: Device or resource busy (code=38)\r\n2017-05-15 11:22:18 ERROR | [i-252c231a][eni-fdbe000c] failed to attach network interface to guest on attempt 2 of 3\r\n2017-05-15 11:22:21 ERROR | libvirt: Unable to create tap device vn_eni-fdbe000c: Device or resource busy (code=38)\r\n2017-05-15 11:22:21 ERROR | [i-252c231a][eni-fdbe000c] failed to attach network interface to guest on attempt 3 of 3\r\n2017-05-15 11:22:24 ERROR | [i-252c231a][eni-fdbe000c] failed to attach network device to guest after 3 tries\r\n2017-05-15 11:22:24 ERROR | [i-252c231a][eni-fdbe000c] libvirt attach device failed\r\n2017-05-15 11:22:24 ERROR | [i-252c231a][eni-fdbe000c][eni-attach-bbc9d618] failed to attach network interface2017-05-15 12:58:46  INFO | [i-2514c64c] running instance groupId=sg-2e7bdf04 cores=1 disk=5 memory=256 vlan=-1 net=-1 priMAC=d0:0d:9d:7c:58:14 privIp=172.1.1.57 plat=linux kernel=(null) ramdisk=(null)\r\n{code}\r\n\r\nOn node, device 'vn_eni-fdbe000c'  is not fully configured, and/or mis-configured using br0 and not midonet, incorrect mtu, etc...\r\n\r\n{code}\r\nnode.sys('ip addr list | grep eni -A3', listformat=False)\r\n\r\n87: vn_eni-ec4bbd12: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 65000 qdisc pfifo_fast master midonet state UNKNOWN qlen 1000\r\n    link/ether fe:0d:ec:4b:bd:12 brd ff:ff:ff:ff:ff:ff\r\n    inet6 fe80::fc0d:ecff:fe4b:bd12/64 scope link \r\n       valid_lft forever preferred_lft forever\r\n--\r\n89: vn_eni-fdbe000c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br0 state UNKNOWN qlen 1000\r\n    link/ether fe:0d:fd:be:00:0c brd ff:ff:ff:ff:ff:ff\r\n    inet6 fe80::fc0d:fdff:febe:c/64 scope link \r\n       valid_lft forever preferred_lft forever\r\n{code}\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-05-15T16:35:29.340-0500","updated":"2017-05-15T16:37:47.322-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/124802","id":"124802","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Debug level logging on the destination node controller, when the network attachment is attempted:\r\n{code}\r\n2017-07-10 09:36:33 DEBUG 000026488 doBroadcastNetworkInfo   | invoked\r\n2017-07-10 09:36:33 DEBUG 000026488 doBroadcastNetworkInfo   | decoding/writing buffer to (//var/run/eucalyptus/global_network_info.xml)\r\n2017-07-10 09:36:33 DEBUG 000026488 doBroadcastNetworkInfo   | attempting to parse GNI at //var/run/eucalyptus/global_network_info.xml\r\n2017-07-10 09:36:33 DEBUG 000026488 gni_populate_v           | gni validated in 6 us.\r\n2017-07-10 09:36:33 DEBUG 000026488 gni_populate_v           | gni populated in 2.54 ms.\r\n2017-07-10 09:36:33 DEBUG 000026488 find_interface_changes   | lastVersion f2e86455 from gni\r\n2017-07-10 09:36:33 DEBUG 000026488 find_interface_changes   | calling foreach instance for 1 global_instances\r\n2017-07-10 09:36:33 DEBUG 000026488 attach_or_detach         | [i-ff05f6c1] compare local network state with gni\r\n2017-07-10 09:36:33 DEBUG 000026488 attach_or_detach         | [i-ff05f6c1] found 1 secondary network interface(s) in gni\r\n2017-07-10 09:36:33 DEBUG 000026488 attach_or_detach         | [i-ff05f6c1][eni-ae01b311][eni-attach-4ca2bc56] evaluating if network interface attach is necessary\r\n2017-07-10 09:36:33 DEBUG 000026488 attach_or_detach         | [i-ff05f6c1][eni-ae01b311][eni-attach-4ca2bc56] gni contains network interface attachment but local state does not, invoking attach\r\n2017-07-10 09:36:33 DEBUG 000026488 doAttachNetworkInterface | [i-ff05f6c1][eni-ae01b311][eni-attach-4ca2bc56] processing attach network interface request\r\n2017-07-10 09:36:34 DEBUG 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] attaching network interface to guest by invoking virDomainAttachDevice() with: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<interface type=\"bridge\">\r\n  <source bridge=\"br0\"/>\r\n  <mac address=\"D0:0D:AE:01:B3:11\"/>\r\n  <target dev=\"vn_eni-ae01b311\"/>\r\n  <model type=\"virtio\"/>\r\n</interface>\r\n\r\n2017-07-10 09:36:34 ERROR 000026488 libvirt_err_handler      | libvirt: Unable to create tap device vn_eni-ae01b311: Device or resource busy (code=38)\r\n2017-07-10 09:36:34 ERROR 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] failed to attach network interface to guest on attempt 1 of 3\r\n2017-07-10 09:36:34 DEBUG 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] virDomainAttachDevice() failed (err=-1) XML='<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<interface type=\"bridge\">\r\n  <source bridge=\"br0\"/>\r\n  <mac address=\"D0:0D:AE:01:B3:11\"/>\r\n  <target dev=\"vn_eni-ae01b311\"/>\r\n  <model type=\"virtio\"/>\r\n</interface>\r\n'\r\n2017-07-10 09:36:37 DEBUG 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] attaching network interface to guest by invoking virDomainAttachDevice() with: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<interface type=\"bridge\">\r\n  <source bridge=\"br0\"/>\r\n  <mac address=\"D0:0D:AE:01:B3:11\"/>\r\n  <target dev=\"vn_eni-ae01b311\"/>\r\n  <model type=\"virtio\"/>\r\n</interface>\r\n\r\n2017-07-10 09:36:37 ERROR 000026488 libvirt_err_handler      | libvirt: Unable to create tap device vn_eni-ae01b311: Device or resource busy (code=38)\r\n2017-07-10 09:36:37 ERROR 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] failed to attach network interface to guest on attempt 2 of 3\r\n2017-07-10 09:36:37 DEBUG 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] virDomainAttachDevice() failed (err=-1) XML='<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<interface type=\"bridge\">\r\n  <source bridge=\"br0\"/>\r\n  <mac address=\"D0:0D:AE:01:B3:11\"/>\r\n  <target dev=\"vn_eni-ae01b311\"/>\r\n  <model type=\"virtio\"/>\r\n</interface>\r\n'\r\n2017-07-10 09:36:40 DEBUG 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] attaching network interface to guest by invoking virDomainAttachDevice() with: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<interface type=\"bridge\">\r\n  <source bridge=\"br0\"/>\r\n  <mac address=\"D0:0D:AE:01:B3:11\"/>\r\n  <target dev=\"vn_eni-ae01b311\"/>\r\n  <model type=\"virtio\"/>\r\n</interface>\r\n\r\n2017-07-10 09:36:40 ERROR 000026488 libvirt_err_handler      | libvirt: Unable to create tap device vn_eni-ae01b311: Device or resource busy (code=38)\r\n2017-07-10 09:36:40 ERROR 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] failed to attach network interface to guest on attempt 3 of 3\r\n2017-07-10 09:36:40 DEBUG 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] virDomainAttachDevice() failed (err=-1) XML='<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<interface type=\"bridge\">\r\n  <source bridge=\"br0\"/>\r\n  <mac address=\"D0:0D:AE:01:B3:11\"/>\r\n  <target dev=\"vn_eni-ae01b311\"/>\r\n  <model type=\"virtio\"/>\r\n</interface>\r\n'\r\n2017-07-10 09:36:43 ERROR 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] failed to attach network device to guest after 3 tries\r\n2017-07-10 09:36:43 DEBUG 000026488 attach_network_interface | [i-ff05f6c1][eni-ae01b311] virDomainAttachDevice() failed (err=-1) XML='<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<interface type=\"bridge\">\r\n  <source bridge=\"br0\"/>\r\n  <mac address=\"D0:0D:AE:01:B3:11\"/>\r\n  <target dev=\"vn_eni-ae01b311\"/>\r\n  <model type=\"virtio\"/>\r\n</interface>\r\n'\r\n2017-07-10 09:36:43 ERROR 000026488 doAttachNetworkInterface | [i-ff05f6c1][eni-ae01b311] libvirt attach device failed\r\n2017-07-10 09:36:43 ERROR 000026488 attach_or_detach         | [i-ff05f6c1][eni-ae01b311][eni-attach-4ca2bc56] failed to attach network interface2017-07-10 09:36:43 DEBUG 000026488 find_interface_changes   | completed detection of interface changes in gni (0)\r\n2017-07-10 09:36:43 DEBUG 000026488 find_interface_changes   | Updating lastVersion f2e86455 with appliedVersion a10bfa83\r\n2017-07-10 09:36:43 DEBUG 000026488 doBroadcastNetworkInfo   | completed parsing GNI and performing actions\r\n2017-07-10 09:36:43 DEBUG 000026488 doBroadcastNetworkInfo   | 10.000000 seconds to complete interface change processing\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-10T11:38:44.892-0500","updated":"2017-07-10T11:38:44.892-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/124803","id":"124803","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Eucanetd logs on the CLC:\r\n\r\n{code}\r\n2017-07-10 09:35:38  INFO | eucanetd report: tot_checks=300 tot_update_attempts=2\r\n        success_update_attempts=2 fail_update_attempts=0 duty_cycle_minutes=5.000000\r\n2017-07-10 09:36:33  INFO | new networking state: updating system\r\n2017-07-10 09:36:33  INFO |     gni/mido tagging processed in 0.16 ms.\r\n2017-07-10 09:36:33  INFO |     remove anything in mido not in gni processed in 0.03 ms.\r\n2017-07-10 09:36:33  INFO |     vpcs processed in 2.36 ms.\r\n2017-07-10 09:36:33  INFO |     sgs processed in 0.03 ms.\r\n2017-07-10 09:36:33  INFO |     instances processed in 0.02 ms.\r\n2017-07-10 09:36:33  INFO | MidoNet API requests: 21 gets, 0 puts, 0 posts, 0 deletes\r\n2017-07-10 09:36:33  INFO | eucanetd system_scrub executed in 2.67 ms.\r\n2017-07-10 09:36:33  INFO | main loop complete (4 ms), applied GNI a10bfa83\r\n2017-07-10 09:36:56  INFO | new networking state: updating system\r\n2017-07-10 09:36:56  INFO |     gni/mido tagging processed in 0.28 ms.\r\n2017-07-10 09:36:56  INFO |     remove anything in mido not in gni processed in 0.04 ms.\r\n2017-07-10 09:36:56  INFO |     vpcs processed in 1.21 ms.\r\n2017-07-10 09:36:56  INFO |     sgs processed in 0.05 ms.\r\n2017-07-10 09:36:56  INFO |     eni-ae01b311 vmhost change detected.\r\n2017-07-10 09:36:56  INFO |     disconnecting eni-ae01b311 from e-35.qa1.eucalyptus-systems.com\r\n2017-07-10 09:36:57  INFO |     i-ff05f6c1 vmhost change detected.\r\n2017-07-10 09:36:57  INFO |     disconnecting i-ff05f6c1 from e-35.qa1.eucalyptus-systems.com\r\n2017-07-10 09:36:57  INFO |     instances processed in 1102.75 ms.\r\n2017-07-10 09:36:57  INFO | MidoNet API requests: 24 gets, 2 puts, 6 posts, 6 deletes\r\n2017-07-10 09:36:57  INFO | eucanetd system_scrub executed in 1104.48 ms.\r\n{code}\r\n\r\nNotice that the time of the eni-ae01b311 vmhost change detected is at 9:36:56, the node controller logs are from 9:36:34, 20 seconds earlier. \r\n\r\nSeems like a timing issue, we possibly haven't told midonet to move the interface before the node controller is attempting to attach the network interface on the migrated instance. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-10T15:35:57.493-0500","updated":"2017-07-10T15:35:57.493-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/124806","id":"124806","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Midonet logs on the node controller:\r\n{code}\r\n2017.07.10 09:36:56.894 INFO  [pool-22-thread-1] transfer -  [FlowStateClient] Internal Ack received from previous owner of d608eb51-2098-4835-b9ae-c151ed484add\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Binding port d608eb51-2098-4835-b9ae-c151ed484add to vn_eni-ae01b311\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] OneToManyDpConnManager -  creating datapath connection for vn_eni-ae01b311\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  HTB updated\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root cap:72 tokens:13\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms cap:0 tokens:0\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms/midorecirc-dp cap:4 tokens:4\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms/vn_eni-ae01b311 cap:4 tokens:4\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tngre-overlay cap:16 tokens:16\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-overlay cap:16 tokens:16\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-vtep cap:16 tokens:16\r\n2017.07.10 09:36:56.903 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-recirc cap:16 tokens:16\r\n2017.07.10 09:36:56.905 INFO  [midolman-akka.actor.default-dispatcher-2] OneToManyDpConnManager -  creating datapath port DpPort{portNo=null, type=NetDev, name='vn_eni-ae01b311', stats=null}\r\n2017.07.10 09:36:56.906 ERROR [midolman-akka.actor.default-dispatcher-2] OneToManyDpConnManager -  failed to create or retrieve datapath port vn_eni-ae01b311\r\norg.midonet.netlink.exceptions.NetlinkException: [19] No such device\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  HTB updated\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root cap:68 tokens:15\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms cap:0 tokens:0\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms/midorecirc-dp cap:4 tokens:4\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tngre-overlay cap:16 tokens:16\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-overlay cap:16 tokens:16\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-vtep cap:16 tokens:16\r\n2017.07.10 09:36:56.906 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-recirc cap:16 tokens:16\r\n2017.07.10 09:36:56.906 WARN  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Failed to create port vn_eni-ae01b311: [19] No such device\r\n2017.07.10 09:36:57.404 INFO  [pool-22-thread-1] transfer -  [FlowStateClient] Internal Ack received from previous owner of 136a4d4d-321c-4bf8-9719-8c751042d91d\r\n2017.07.10 09:36:57.411 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Binding port 136a4d4d-321c-4bf8-9719-8c751042d91d to vn_i-ff05f6c1\r\n2017.07.10 09:36:57.411 INFO  [midolman-akka.actor.default-dispatcher-2] OneToManyDpConnManager -  creating datapath connection for vn_i-ff05f6c1\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  HTB updated\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root cap:72 tokens:15\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms cap:0 tokens:0\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms/midorecirc-dp cap:4 tokens:4\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/vms/vn_i-ff05f6c1 cap:4 tokens:4\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tngre-overlay cap:16 tokens:16\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-overlay cap:16 tokens:16\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-vtep cap:16 tokens:16\r\n2017.07.10 09:36:57.412 INFO  [midolman-akka.actor.default-dispatcher-2] htb -  name:midolman-root/tnvxlan-recirc cap:16 tokens:16\r\n2017.07.10 09:36:57.413 INFO  [midolman-akka.actor.default-dispatcher-2] OneToManyDpConnManager -  creating datapath port DpPort{portNo=null, type=NetDev, name='vn_i-ff05f6c1', stats=null}\r\n2017.07.10 09:36:57.415 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Datapath port vn_i-ff05f6c1 added\r\n2017.07.10 09:36:57.415 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Port 6/vn_i-ff05f6c1/136a4d4d-321c-4bf8-9719-8c751042d91d became active\r\n2017.07.10 09:36:57.444 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Binding port d608eb51-2098-4835-b9ae-c151ed484add to vn_eni-ae01b311\r\n2017.07.10 09:36:57.445 INFO  [midolman-akka.actor.default-dispatcher-2] OneToManyDpConnManager -  creating datapath connection for vn_eni-ae01b311\r\n{code}\r\n\r\nLater, when I called detach/attach:\r\n{code}\r\n2017.07.10 09:52:04.270 INFO  [midolman-akka.actor.default-dispatcher-2] OneToManyDpConnManager -  creating datapath port DpPort{portNo=null, type=NetDev, name='vn_eni-ae01b311', stats=null}\r\n2017.07.10 09:52:04.273 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Datapath port vn_eni-ae01b311 added\r\n2017.07.10 09:52:04.273 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Port 7/vn_eni-ae01b311/d56a16ea-9072-4cdb-b613-8bee937a3468 became active\r\n2017.07.10 09:52:04.344 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Unbinding port d56a16ea-9072-4cdb-b613-8bee937a3468 from vn_eni-ae01b311\r\n2017.07.10 09:52:04.344 INFO  [midolman-akka.actor.default-dispatcher-2] datapath-control -  Port 7/vn_eni-ae01b311/d56a16ea-9072-4cdb-b613-8bee937a3468 became inactive\r\n{code}\r\n\r\nPretty sure this confirms that there is a timing issue during migration where the network isn't ready before we try to add it via libvirt. The midolman errors are probably a result of libvirt trying to attach the interface to the instance. I'll have to look into how we can add a midonet network gate to ensure we don't try to attach an interface before it is 'ready'. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-10T21:08:18.040-0500","updated":"2017-07-10T21:08:18.040-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125305","id":"125305","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"This is 'ip link show' output during the migration.\r\n{code}\r\n40: vn_i-ff05f6c1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN mode DEFAULT qlen 1000\r\n    link/ether fe:0d:fe:78:3d:cb brd ff:ff:ff:ff:ff:ff\r\n41: vn_eni-ae01b311: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br0 state UNKNOWN mode DEFAULT qlen 1000\r\n    link/ether fe:0d:ae:01:b3:11 brd ff:ff:ff:ff:ff:ff\r\n{code}\r\n\r\nThe vn_i-ff05f6c1 interface isn't tied to the br0 bridge, but the secondary interface is. \r\n\r\nThe libvirt xmldump during the migration shows that all of the interfaces are getting passed along:\r\n{code}\r\n   <interface type='bridge'>\r\n      <mac address='d0:0d:fe:78:3d:cb'/>\r\n      <source bridge='br0'/>\r\n      <target dev='vn_i-ff05f6c1'/>\r\n      <model type='virtio'/>\r\n      <alias name='net0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>\r\n    </interface>\r\n    <interface type='bridge'>\r\n      <mac address='d0:0d:ae:01:b3:11'/>\r\n      <source bridge='br0'/>\r\n      <target dev='vn_eni-ae01b311'/>\r\n      <model type='virtio'/>\r\n      <alias name='net1'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/>\r\n    </interface>\r\n{code}\r\n\r\nI had though initially that maybe we were supposed to detach the network interfaces before migration, but now I'm not sure of that. I think when we migrate the interfaces transfer and we shouldn't have to 'attach' the secondary interfaces after migration. I think the attach_or_detach() calls are happening because the migration failed to bring up those interfaces correctly. Its not clear why the primary network interface works \"just fine\" but the secondary doesn't.\r\n\r\nThe interface is obviously there during migration, midonet is the process that is complaining about it not being there. \r\n\r\nHere is the interaction from journalctl output (in reverse order)\r\n{code}\r\nJul 18 11:24:33 c-27.qa1.eucalyptus-systems.com kernel: device vn_i-ff05f6c1 entered promiscuous mode\r\n\r\n// This is the secondary interface attachment requests that the Node Controller is making\r\nJul 18 11:24:05 c-27.qa1.eucalyptus-systems.com libvirtd[5342]: Unable to create tap device vn_eni-ae01b311: Device or resource busy\r\nJul 18 11:24:02 c-27.qa1.eucalyptus-systems.com libvirtd[5342]: Unable to create tap device vn_eni-ae01b311: Device or resource busy\r\nJul 18 11:23:59 c-27.qa1.eucalyptus-systems.com libvirtd[5342]: Unable to create tap device vn_eni-ae01b311: Device or resource busy\r\nJul 18 11:23:59 c-27.qa1.eucalyptus-systems.com libvirtd[5342]: hostname: c-27.qa1.eucalyptus-systems.com\r\n\r\n// Libvirt restart after clearing the authorization keys (migration is complete)\r\nJul 18 11:23:59 c-27.qa1.eucalyptus-systems.com libvirtd[5342]: libvirt version: 2.0.0, package: 10.el7_3.9 (CentOS BuildSystem <http://bugs.centos.org>, 2017-05-25-2\r\nJul 18 11:23:51 c-27.qa1.eucalyptus-systems.com systemd[1]: Started Virtualization daemon.\r\nJul 18 11:23:51 c-27.qa1.eucalyptus-systems.com systemd[1]: Starting Virtualization daemon...\r\nJul 18 11:23:51 c-27.qa1.eucalyptus-systems.com systemd[1]: Stopping Virtualization daemon...\r\nJul 18 11:23:50 c-27.qa1.eucalyptus-systems.com virtlogd[3990]: End of file while reading data: Input/output error\r\n\r\n// Interesting here that vn_i has been disabled...while vn_eni has not. \r\nJul 18 11:22:23 c-27.qa1.eucalyptus-systems.com kernel: br0: port 2(vn_eni-ae01b311) entered forwarding state\r\nJul 18 11:22:23 c-27.qa1.eucalyptus-systems.com kernel: br0: topology change detected, propagating\r\nJul 18 11:22:21 c-27.qa1.eucalyptus-systems.com kernel: br0: port 2(vn_eni-ae01b311) entered learning state\r\nJul 18 11:22:20 c-27.qa1.eucalyptus-systems.com kernel: br0: port 1(vn_i-ff05f6c1) entered disabled state\r\nJul 18 11:22:20 c-27.qa1.eucalyptus-systems.com kernel: device vn_i-ff05f6c1 left promiscuous mode\r\n\r\n// Migration has completed, guest is started on the destination\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com kvm[5178]: 1 guest now active\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com systemd[1]: Starting Virtual Machine qemu-1-i-ff05f6c1.\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com systemd[1]: Started Virtual Machine qemu-1-i-ff05f6c1.\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com systemd-machined[5173]: New machine qemu-1-i-ff05f6c1.\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com systemd[1]: Started Virtual Machine and Container Registration Service.\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com dbus[807]: [system] Successfully activated service 'org.freedesktop.machine1'\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com dbus-daemon[807]: dbus[807]: [system] Successfully activated service 'org.freedesktop.machine1'\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com systemd[1]: Starting Virtual Machine and Container Registration Service...\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com dbus[807]: [system] Activating via systemd: service name='org.freedesktop.machine1' unit='dbus-org.freedesktop.machine\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com dbus-daemon[807]: dbus[807]: [system] Activating via systemd: service name='org.freedesktop.machine1' unit='dbus-org.f\r\n\r\n// both interfaces are present, and seem to act the same. \r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com kernel: br0: port 2(vn_eni-ae01b311) entered listening state\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com kernel: br0: port 2(vn_eni-ae01b311) entered listening state\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com kernel: device vn_eni-ae01b311 entered promiscuous mode\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com kernel: br0: port 1(vn_i-ff05f6c1) entered listening state\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com kernel: br0: port 1(vn_i-ff05f6c1) entered listening state\r\nJul 18 11:22:19 c-27.qa1.eucalyptus-systems.com kernel: device vn_i-ff05f6c1 entered promiscuous mode\r\n{code}\r\n\r\nAlso in the qemu log (/var/log/libvirt/qemu/i-ff05f6c1.log, both network interfaces show up:\r\n{code}\r\n-netdev tap,fd=29,id=hostnet0,vhost=on,vhostfd=31 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=d0:0d:fe:78:3d:cb,bus=pci.0,addr=0x2 \r\n-netdev tap,fd=32,id=hostnet1,vhost=on,vhostfd=33 -device virtio-net-pci,netdev=hostnet1,id=net1,mac=d0:0d:ae:01:b3:11,bus=pci.0,addr=0x7\r\n{code}\r\n\r\nI need to look and see if there is any magic we are doing to the primary interface post migration and possibly forgetting to do on the secondary interfaces. Its not clear as to what is going on with the secondary interfaces and why they aren't visible to midonet. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-18T14:02:50.075-0500","updated":"2017-07-18T14:02:50.075-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125306","id":"125306","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"One possible way around this issue, is to detach the interface before migration, then re-attach post migration. The only tricky part is to make sure that the node controller doesn't try and re-attach the interface while the migration is happening. This effectively implements the 'workaround' automatically. At this point it is just an idea. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-18T14:06:56.595-0500","updated":"2017-07-18T14:06:56.595-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125307","id":"125307","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tsugawa","name":"tsugawa","key":"tsugawa","accountId":"557058:619bab88-9b87-4778-995a-1e8a85d8b899","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"M Tsugawa","active":true,"timeZone":"America/New_York"},"body":"[~sgraham], midolman complains when an interface is connected to a linux bridge. Once the interface is pulled out from the bridge, it should work (no restart of any component is needed - midolman will automatically detect the availability of the interface).\r\nlibvirt can only create interfaces that are attached to a linux bridge (there is no clean way to create interfaces attached to midonet via libvirt), so NC is responsible to create the interface and then disconnect the interface from the bridge.\r\nPerhaps the code to pull out interfaces from linux bridges does not cover secondary interfaces in the case of migration?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tsugawa","name":"tsugawa","key":"tsugawa","accountId":"557058:619bab88-9b87-4778-995a-1e8a85d8b899","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c16b1da4b6426cad544b6eddd78d76b1?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"M Tsugawa","active":true,"timeZone":"America/New_York"},"created":"2017-07-18T14:17:47.922-0500","updated":"2017-07-18T14:17:47.922-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125308","id":"125308","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Thanks [~tsugawa]! I'll run with that.\r\n\r\n-Steve","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-18T15:58:01.950-0500","updated":"2017-07-18T15:58:01.950-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125309","id":"125309","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"{code}\r\n/**\r\n * Removes instance NIC(s) from bridge.\r\n * @param nc [in] pointer to nc_state data structure.\r\n * @param instance [in] pointer to ncInstance data structure of the instance of interest.\r\n * @return 0 on success. Positive integer otherwise.\r\n */\r\nint bridge_instance_interfaces_remove(struct nc_state_t *nc, ncInstance *instance) {\r\n    char iface[16];\r\n    int rc = 0;\r\n\r\n    if (!nc || !instance) {\r\n        LOGWARN(\"Invalid argument: cannot remove NULL bridge interface.\\n\");\r\n        return (1);\r\n    }\r\n    snprintf(iface, 16, \"vn_%s\", instance->instanceId);\r\n    LOGINFO(\"STEVE REMOVING PRIMARY IFACE: %s\\n\", iface);\r\n    rc += bridge_interface_remove(nc, instance, iface);\r\n\r\n    // Repeat process for secondary interfaces as well\r\n    for (int i = 0; i < EUCA_MAX_NICS; i++) {\r\n        if (strlen(instance->secNetCfgs[i].interfaceId) == 0)\r\n            continue;\r\n\r\n        // Looks suspect: should this be: \"vn_emi%s\"?\r\n        snprintf(iface, 16, \"vn_%s\", instance->secNetCfgs[i].interfaceId);\r\n        LOGINFO(\"STEVE REMOVING NONPRIMARY IFACE: %s\\n\", iface);\r\n        rc += bridge_interface_remove(nc, instance, iface);\r\n    }\r\n\r\n    return (rc);\r\n}\r\n{code}\r\n\r\nWhen I migrated the instance, only one log message showed up for removing the primary interface. Seems as though the secondary interfaces haven't been populated....so its never removed from the bridge. Now to track down why it is missing the secondary interfaces. Thanks again [~tsugawa].","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-18T16:23:32.806-0500","updated":"2017-07-18T16:23:32.806-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125310","id":"125310","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"\r\nThe CLC passes only the instance id as a string to the CC to migrate an instance, so the CC should have the instance information (such as the secondary ifaces). In looking at a packet capture between the CC and the NC, the secondary interface information isn't populated. \r\n\r\nOn the CC, the first refresh_instances() log shows that the secondary network config info is missing for the instance (at this time I'm not sure why, its possible the NC is reporting back this incorrect info). But when I detach and attach the secondary network, you can see that the info is populated into the instance structure on the CC. I'll dig into this some more tomorrow, I think the issue lies in the CC. \r\n\r\nFrom the CC logs:\r\n{code}\r\n2017-07-18 17:18:01 DEBUG 000009557 refresh_instances        | describing instance i-ff05f6c1, Extant, 0\r\n2017-07-18 17:18:01 DEBUG 000009557 refresh_instances        | storing instance state: i-ff05f6c1/Extant/0.0.0.0/172.31.13.99\r\n2017-07-18 17:18:01 DEBUG 000009557 print_ccInstance         | refresh_instances():  instanceId=i-ff05f6c1 reservationId=r-98eeebe0 state=Extant accountId=000563596509 ownerId=AIDAAEXYVVNQ3EIQZD7OO ts=1499627037 keyName= ccnet={privateIp=172.31.13.99 publicIp=0.0.0.0 privateMac=d0:0d:fe:78:3d:cb vlan=-1 networkIndex=-1 (vpc-only interfaceId=i-ff05f6c1 device=0 attachmentId=eni-attach-ea647973)} ccvm={cores=1 mem=256 disk=5} ncHostIdx=0 serviceTag=http://10.111.1.62:8775/axis2/services/EucalyptusNC userData= launchIndex=0 platform=linux bundleTaskStateName=none bundleTaskProgress=0.0000 volumesSize=0 volumes={} groupNames={} migration_state=none guestStateName=poweredOn hasFloopy=false secondaryNetCfgsSize=0 secondaryNetCfgs={}\r\n2017-07-18 17:18:08 DEBUG 000009576 refresh_instances        | describing instance i-ff05f6c1, Extant, 0\r\n2017-07-18 17:18:08 DEBUG 000009576 refresh_instances        | storing instance state: i-ff05f6c1/Extant/0.0.0.0/172.31.13.99\r\n2017-07-18 17:18:08 DEBUG 000009576 print_ccInstance         | refresh_instances():  instanceId=i-ff05f6c1 reservationId=r-98eeebe0 state=Extant accountId=000563596509 ownerId=AIDAAEXYVVNQ3EIQZD7OO ts=1499627037 keyName= ccnet={privateIp=172.31.13.99 publicIp=0.0.0.0 privateMac=d0:0d:fe:78:3d:cb vlan=-1 networkIndex=-1 (vpc-only interfaceId=i-ff05f6c1 device=0 attachmentId=eni-attach-ea647973)} ccvm={cores=1 mem=256 disk=5} ncHostIdx=0 serviceTag=http://10.111.1.62:8775/axis2/services/EucalyptusNC userData= launchIndex=0 platform=linux bundleTaskStateName=none bundleTaskProgress=0.0000 volumesSize=0 volumes={} groupNames={} migration_state=none guestStateName=poweredOn hasFloopy=false secondaryNetCfgsSize=1 secondaryNetCfgs={interfaceId=eni-ae01b311,device=1,privateIp=172.31.15.252,publicIp=0.0.0.0,privateMac=D0:0D:AE:01:B3:11,vlan=-1,networkIndex=-1,attachmentId=eni-attach-152e92aa }\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-18T19:28:29.423-0500","updated":"2017-07-18T19:28:29.423-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125401","id":"125401","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sgraham], I did a quick test in master and when the secondaryNetConfig is populated for a vpc instance in the ncMigrateInstances call it is possible to ping (etc) the secondary interfaces after migration. I did run into issues when migrating back to the original host, as after migration the node controller was not reporting the secondary interfaces to the cluster controller. This meant that when migrating back to the original host (and presumably any other migration) the reported issue occurred as the secondaryNetConfig was then not available on the cluster controller so was once again not passed in the ncMigrateInstances call. I saw this in my development branch from master with various other changes, so you might not see the same issue in 4.4.2.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-07-19T11:36:14.841-0500","updated":"2017-07-19T11:36:14.841-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125405","id":"125405","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"\r\nThis is a log snippet from the CC showing the loss of the secondary network configs:\r\n{code}\r\n2017-07-19 11:14:18 DEBUG 000028972 refresh_instances        | storing instance state: i-ff05f6c1/Extant/0.0.0.0/172.31.13.99\r\n2017-07-19 11:14:18 DEBUG 000028972 print_ccInstance         | refresh_instances():  instanceId=i-ff05f6c1 reservationId=r-98eeebe0 state=Extant accountId=000563596509 ownerId=AIDAAEXYVVNQ3EIQZD7OO ts=1499627037 keyName= ccnet={privateIp=172.31.13.99 publicIp=0.0.0.0 privateMac=d0:0d:fe:78:3d:cb vlan=-1 networkIndex=-1 (vpc-only interfaceId=i-ff05f6c1 device=0 attachmentId=eni-attach-ea647973)} ccvm={cores=1 mem=256 disk=5} ncHostIdx=0 serviceTag=http://10.111.1.62:8775/axis2/services/EucalyptusNC userData= launchIndex=0 platform=linux bundleTaskStateName=none bundleTaskProgress=0.0000 volumesSize=0 volumes={} groupNames={} migration_state=cleaning guestStateName=poweredOn hasFloopy=false secondaryNetCfgsSize=1 secondaryNetCfgs={interfaceId=eni-ae01b311,device=1,privateIp=172.31.15.252,publicIp=0.0.0.0,privateMac=D0:0D:AE:01:B3:11,vlan=-1,networkIndex=-1,attachmentId=eni-attach-152e92aa }\r\n2017-07-19 11:14:18 DEBUG 000028974 refresh_instances        | describing instance i-ff05f6c1, Extant, 1\r\n2017-07-19 11:14:18 DEBUG 000028974 migration_handler        | invoked\r\n2017-07-19 11:14:18 DEBUG 000028974 migration_handler        | [i-ff05f6c1] ignoring update from destination node 10.111.1.193 during migration: Extant(migrating)\r\n2017-07-19 11:14:18 DEBUG 000028974 migration_handler        | done\r\n2017-07-19 11:14:24 DEBUG 000028980 migration_handler        | invoked\r\n2017-07-19 11:14:24 DEBUG 000028980 migration_handler        | [i-ff05f6c1] received state Teardown(cleaning) from source node 10.111.1.62\r\n2017-07-19 11:14:24 DEBUG 000028980 migration_handler        | done\r\n2017-07-19 11:14:24 DEBUG 000028980 refresh_instanceCache    | instance counts: 2/1\r\n2017-07-19 11:14:24 DEBUG 000028980 refresh_instances        | storing instance state: i-ff05f6c1/Teardown/0.0.0.0/172.31.13.99\r\n2017-07-19 11:14:24 DEBUG 000028980 print_ccInstance         | refresh_instances():  instanceId=i-ff05f6c1 reservationId=r-98eeebe0 state=Teardown accountId=000563596509 ownerId=AIDAAEXYVVNQ3EIQZD7OO ts=1499627037 keyName= ccnet={privateIp=172.31.13.99 publicIp=0.0.0.0 privateMac=d0:0d:fe:78:3d:cb vlan=-1 networkIndex=-1 (vpc-only interfaceId=i-ff05f6c1 device=0 attachmentId=eni-attach-ea647973)} ccvm={cores=1 mem=256 disk=5} ncHostIdx=0 serviceTag=http://10.111.1.62:8775/axis2/services/EucalyptusNC userData= launchIndex=0 platform=linux bundleTaskStateName=none bundleTaskProgress=0.0000 volumesSize=0 volumes={} groupNames={} migration_state=cleaning guestStateName=poweredOn hasFloopy=false secondaryNetCfgsSize=0 secondaryNetCfgs={}\r\n{code}\r\n\r\nI like the TODO comment (ref: cluster/handlers.c)\r\n{code}\r\n                            refresh_instanceCache(myInstance->instanceId, myInstance);\r\n                            LOGDEBUG(\"storing instance state: %s/%s/%s/%s\\n\", myInstance->instanceId, myInstance->state, myInstance->ccnet.publicIp, myInstance->ccnet.privateIp);\r\n                            print_ccInstance(\"refresh_instances(): \", myInstance);\r\n                            sensor_set_resource_alias(myInstance->instanceId, myInstance->ncnet.privateIp);\r\n                            // TODO swathi should this account for secondary enis?\r\n                            EUCA_FREE(myInstance);\r\n{code}\r\n\r\nIf I'm reading this right, it seems as though the update from the 'src' NC is causing the poisoning of the instance info.\r\n\r\nI don't think this is the cause of the initial issue though, probably another issue to deal with. At this point the call has already been made to the NC to migrate the instance (and the secondary configs are in the data structure). I'm going to instrument some of the CC code to see why the secondaryNetCfgs aren't getting passed to the NC. I'll have to circle back to this after finding the main issue. \r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-19T15:13:47.291-0500","updated":"2017-07-19T15:13:47.291-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125406","id":"125406","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"\r\nRef: cluster/handlers.c  func: ccInstance_to_ncInstance()\r\n\r\nThe memcpy call is wrong, second argument should be: {code} &(src->secNetCfgs[i]){code}\r\n{code}\r\n    for(i = 0; (i < src->secNetCfgsSize && i < EUCA_MAX_NICS); i++) {\r\n        if(strlen(src->secNetCfgs[i].interfaceId) == 0)\r\n            break;\r\n        memcpy(&(dst->secNetCfgs[i]), &(src->secNetCfgs), sizeof(netConfig));\r\n    }\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-19T16:41:17.161-0500","updated":"2017-07-19T16:41:17.161-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125409","id":"125409","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"The stateName check in copy_instance_to_adb() is causing the secondary interfaces to not be included in the ncMigrateInstances() request. For some reason the stateName is empty:\r\n{code:title=ref: instrumented CC logs}\r\n2017-07-20 10:35:44 DEBUG 000028278 doMigrateInstances       | [i-ff05f6c1] found instance running on node 10.111.1.62\r\n2017-07-20 10:35:44 DEBUG 000028278 doMigrateInstances       | STEVE PREPPING instance: i-ff05f6c1\r\n2017-07-20 10:35:44 DEBUG 000028278 doMigrateInstances       | STEVE PREPPING Secondary iface index:[0] - name:[eni-ae01b311] state:[]\r\n{code}\r\n\r\n When I removed the stateName check, the migration completed correctly; I saw that the SOAP request had the data, and the interface on destination NC was correctly removed from the br0 bridge and is owned by midonet. \r\n\r\n{code:title=ip link show}\r\n66: vn_i-ff05f6c1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 65000 qdisc pfifo_fast master midonet state UNKNOWN mode DEFAULT qlen 1000\r\n    link/ether fe:0d:fe:78:3d:cb brd ff:ff:ff:ff:ff:ff\r\n67: vn_eni-ae01b311: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 65000 qdisc pfifo_fast master midonet state UNKNOWN mode DEFAULT qlen 1000\r\n    link/ether fe:0d:ae:01:b3:11 brd ff:ff:ff:ff:ff:ff\r\n{code}\r\n\r\n{code:title=ref:util/adb-helper.h - copy_instance_to_adb()}\r\n    for (i = 0; i < EUCA_MAX_NICS; i++) { // vpc\r\n        // report only attached interfaces since state is not a part of the message\r\n        if (strlen(outInst->secNetCfgs[i].interfaceId) == 0 ||\r\n                strncmp(outInst->secNetCfgs[i].stateName, VOL_STATE_ATTACHED, sizeof(VOL_STATE_ATTACHED)))\r\n            continue;  // skip empty or un-attached interfaces\r\n        netconf = adb_netConfigType_create(env);\r\n        adb_netConfigType_set_interfaceId(netconf, env, outInst->secNetCfgs[i].interfaceId);\r\n        adb_netConfigType_set_device(netconf, env, outInst->secNetCfgs[i].device);\r\n        adb_netConfigType_set_privateMacAddress(netconf, env, outInst->secNetCfgs[i].privateMac);\r\n        adb_netConfigType_set_privateIp(netconf, env, outInst->secNetCfgs[i].privateIp);\r\n        adb_netConfigType_set_publicIp(netconf, env, outInst->secNetCfgs[i].publicIp);\r\n        adb_netConfigType_set_vlan(netconf, env, outInst->secNetCfgs[i].vlan);\r\n        adb_netConfigType_set_networkIndex(netconf, env, outInst->secNetCfgs[i].networkIndex);\r\n        adb_netConfigType_set_attachmentId(netconf, env, outInst->secNetCfgs[i].attachmentId);\r\n        adb_instanceType_add_secondaryNetConfig(instance, env, netconf);\r\n    }\r\n{code}\r\n\r\nI need to hunt down the root cause of why the stateName for the interface is empty. Once found, that is the root cause of this issue. \r\n\r\nI'm still seeing the secondary interfaces getting removed upon migration completion, on the CC:\r\n{code:title=ref:CC logs - refresh_instances()}\r\n2017-07-20 10:51:24 DEBUG 000030308 refresh_instances        | storing instance state: i-ff05f6c1/Extant/0.0.0.0/172.31.13.99\r\n2017-07-20 10:51:24 DEBUG 000030308 print_ccInstance         | refresh_instances():  instanceId=i-ff05f6c1 reservationId=r-98eeebe0 state=Extant accountId=000563596509 ownerId=AIDAAEXYVVNQ3EIQZD7OO ts=149962703 keyName= ccnet={privateIp=172.31.13.99 publicIp=0.0.0.0 privateMac=d0:0d:fe:78:3d:cb vlan=-1 networkIndex=-1 (vpc-only interfaceId=i-ff05f6c1 device=0 attachmentId=eni-attach-ea647973)} ccvm={cores=1 mem=256 disk=5} ncHostIdx=1 serviceTag=http://10.111.1.193:8775/axis2/services/EucalyptusNC userData= launchIndex=0 platform=linux bundleTaskStateName=none bundleTaskProgress=0.0000 volumesSize=0 volumes={} groupNames={} migration_state=none guestStateName=poweredOn hasFloopy=false secondaryNetCfgsSize=0 secondaryNetCfgs={}\r\n{code}\r\n\r\nWhich is a problem if we try to migrate again.\r\n\r\nThus far:\r\n# Memory copy in ccInstance_to_ncInstance() is incorrect\r\n# Figured out why the secondaryInterfaces were missing from the SOAP requests.\r\n\r\nSo two issues remain:\r\n# The root cause of why the stateName is missing in the ccInstance/ncInstance structure.\r\n# Why is the secondary network information getting blown out when the Teardown state is received from the source node controller. \r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-20T13:21:56.848-0500","updated":"2017-07-20T13:23:26.645-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125411","id":"125411","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"Most likely the teardown issue:\r\n\r\n{code:title=node/handlers.c}\r\n    case TEARDOWN:\r\n        // Mark primary and secondary network interfaces as detached\r\n        euca_strncpy(instance->ncnet.stateName, VOL_STATE_DETACHED, sizeof(instance->ncnet.stateName)); // primary nic\r\n        for (int i = 0; i < EUCA_MAX_NICS; i++) { // secondary nics in VPC mode only\r\n            if (strlen(instance->secNetCfgs[i].interfaceId) == 0)\r\n               continue; // empty slot, move on\r\n            else\r\n               euca_strncpy(instance->secNetCfgs[i].stateName, VOL_STATE_DETACHED, sizeof(instance->secNetCfgs[i].stateName));\r\n        }\r\n        instance->stateCode = TEARDOWN;\r\n        break;\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-20T17:58:03.700-0500","updated":"2017-07-20T17:58:03.700-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125502","id":"125502","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"\r\n{code}// TODO swathi should this account for secondary enis?{code}\r\n\r\nThen answer is: YES. The stateName is not part of the SOAP message, so the handler needs to update the state when executing refresh_instances()\r\n\r\n{code:title=ref:cluster/handlers.c - refresh_instances() }\r\n+                            //\r\n+                            // Populate state of the secondary interfaces, if they got here, then they are \"attached\r\n+                            //\r\n+                            for (int nic_idx=0; nic_idx < EUCA_MAX_NICS; nic_idx++) {\r\n+                                if ( strlen(myInstance->secNetCfgs[nic_idx].interfaceId) == 0) {\r\n+                                    continue;\r\n+                               } else {\r\n+                                    euca_strncpy(myInstance->secNetCfgs[nic_idx].stateName, VOL_STATE_ATTACHED, sizeof(myInstance->secNetCfgs[nic_idx].stateName));\r\n+                               }\r\n+                            }\r\n+\r\n{code}\r\n\r\nWith that change, the stateName is now populated in the CC instance (last field in the instrumented log)\r\n{code:title=ref:/var/log/eucalyptus/cc.log}\r\n2017-07-21 09:07:19 DEBUG 000014980 print_ccInstance         | refresh_instances():  instanceId=i-ff05f6c1 reservationId=r-98eeebe0 state=Extant accountId=000563596509 ownerId=AIDAAEXYVVNQ3EIQZD7OO ts=149962703 keyName= ccnet={privateIp=172.31.13.99 publicIp=0.0.0.0 privateMac=d0:0d:fe:78:3d:cb vlan=-1 networkIndex=-1 (vpc-only interfaceId=i-ff05f6c1 device=0 attachmentId=eni-attach-ea647973)} ccvm={cores=1 mem=256 disk=5} ncHostIdx=1 serviceTag=http://10.111.1.193:8775/axis2/services/EucalyptusNC userData= launchIndex=0 platform=linux bundleTaskStateName=none bundleTaskProgress=0.0000 volumesSize=0 volumes={} groupNames={} migration_state=cleaning guestStateName=poweredOn hasFloopy=false secondaryNetCfgsSize=1 secondaryNetCfgs={interfaceId=eni-ae01b311,device=1,privateIp=172.31.15.252,publicIp=0.0.0.0,privateMac=D0:0D:AE:01:B3:11,vlan=-1,networkIndex=-1,attachmentId=eni-attach-0d9b437d,stateName=attached}\r\n{code}\r\n\r\nOn the second issue, post migration, still seeing the secondary interfaces blown away. I think this is happening in two stages:\r\n# the Teardown state is marking them as detached. Which I believe is normal.\r\n# The destination node controller is not reporting the status of the secondaryNetworkConfigs as the stateName is not set correctly. The NC logs show the following:\r\n{code:title=ref:/var/log/eucalyptus/nc.log}\r\n2017-07-21 09:23:44 DEBUG 000003950 doDescribeInstances      | [i-ff05f6c1] Extant (running) pub=0.0.0.0 vols= nics=eni-ae01b311:U\r\n{code}\r\n\r\nThat 'U' code indicates that it is in an unknown state. Onto looking at the NC code and see what its problem is. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-21T11:35:31.724-0500","updated":"2017-07-21T11:35:31.724-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125503","id":"125503","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"I think I found the last issue, when migration is complete we don't set the state for the secondary interfaces, the following change resolved the node controller issue and I can now migrate an instance with a secondary interface back and forth between two nodes without issue:\r\n{code:title=node/handler.c}\r\ndiff --git a/node/handlers.c b/node/handlers.c\r\nindex 7708b18..98f23f9 100644\r\n--- a/node/handlers.c\r\n+++ b/node/handlers.c\r\n@@ -1038,6 +1038,20 @@ void unlock_hypervisor_conn()\r\n }\r\n \r\n //!\r\n+//! Mark primary and secondary network interfaces as attached or detached\r\n+//!\r\n+void mark_instance_interfaces(ncInstance *instance, char *state_name)\r\n+{\r\n+    euca_strncpy(instance->ncnet.stateName, state_name, sizeof(instance->ncnet.stateName)); // primary nic\r\n+    for (int i = 0; i < EUCA_MAX_NICS; i++) { // secondary nics in VPC mode only\r\n+        if (strlen(instance->secNetCfgs[i].interfaceId) == 0)\r\n+            continue; // empty slot, move on\r\n+        else\r\n+            euca_strncpy(instance->secNetCfgs[i].stateName, state_name, sizeof(instance->secNetCfgs[i].stateName));\r\n+    }\r\n+}\r\n+\r\n+//!\r\n //! Instance state state machine.\r\n //!\r\n //! @param[in] instance a pointer to the instance to modify\r\n@@ -1051,14 +1065,7 @@ void change_state(ncInstance * instance, instance_states state)\r\n     switch (state) {                   /* mapping from NC's internal states into external ones */\r\n     case STAGING:\r\n     case CANCELED:\r\n-        // Mark primary and secondary network interfaces as attached\r\n-        euca_strncpy(instance->ncnet.stateName, VOL_STATE_ATTACHED, sizeof(instance->ncnet.stateName)); // primary nic\r\n-        for (int i = 0; i < EUCA_MAX_NICS; i++) { // secondary nics in VPC mode only\r\n-            if (strlen(instance->secNetCfgs[i].interfaceId) == 0)\r\n-               continue; // empty slot, move on\r\n-            else\r\n-               euca_strncpy(instance->secNetCfgs[i].stateName, VOL_STATE_ATTACHED, sizeof(instance->secNetCfgs[i].stateName));\r\n-        }\r\n+        mark_instance_interfaces(instance, VOL_STATE_ATTACHED);\r\n         instance->stateCode = PENDING;\r\n         break;\r\n     case BOOTING:\r\n@@ -1081,14 +1088,7 @@ void change_state(ncInstance * instance, instance_states state)\r\n         instance->retries = LIBVIRT_QUERY_RETRIES;\r\n         break;\r\n     case TEARDOWN:\r\n-        // Mark primary and secondary network interfaces as detached\r\n-        euca_strncpy(instance->ncnet.stateName, VOL_STATE_DETACHED, sizeof(instance->ncnet.stateName)); // primary nic\r\n-        for (int i = 0; i < EUCA_MAX_NICS; i++) { // secondary nics in VPC mode only\r\n-            if (strlen(instance->secNetCfgs[i].interfaceId) == 0)\r\n-               continue; // empty slot, move on\r\n-            else\r\n-               euca_strncpy(instance->secNetCfgs[i].stateName, VOL_STATE_DETACHED, sizeof(instance->secNetCfgs[i].stateName));\r\n-        }\r\n+        mark_instance_interfaces(instance, VOL_STATE_DETACHED);\r\n         instance->stateCode = TEARDOWN;\r\n         break;\r\n     default:\r\n@@ -1267,6 +1267,9 @@ static void refresh_instance_info(struct nc_state_t *nc, ncInstance * instance)\r\n                     bzero(instance->migration_src, HOSTNAME_SIZE);\r\n                     bzero(instance->migration_dst, HOSTNAME_SIZE);\r\n                     bzero(instance->migration_credentials, CREDENTIAL_SIZE);\r\n+ \r\n+                    mark_instance_interfaces(instance, VOL_STATE_ATTACHED); \r\n+\r\n                     instance->migrationTime = 0;\r\n                     save_instance_struct(instance);\r\n                     // copy_intances is called upon return in monitoring_thread().\r\ndiff --git a/node/handlers.h b/node/handlers.h\r\nindex 3b8fad7..4f0a08e 100644\r\n--- a/node/handlers.h\r\n+++ b/node/handlers.h\r\n@@ -387,6 +387,8 @@ int bridge_interface_remove(struct nc_state_t *nc, ncInstance *instance, char *i\r\n int bridge_instance_interfaces_remove(struct nc_state_t *nc, ncInstance *instance);\r\n int bridge_interface_set_hairpin(struct nc_state_t *nc, ncInstance *instance, char *iface);\r\n \r\n+void mark_instance_interfaces(ncInstance *instance, char *state_name);\r\n+\r\n /*----------------------------------------------------------------------------*\\\r\n  |                                                                            |\r\n  |                           STATIC INLINE PROTOTYPES                         |\r\n{code}\r\n\r\nI think I've got this one nailed down for the root cause, and the fixes needed. I'll work on a real patch and test that out. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-21T12:16:20.187-0500","updated":"2017-07-21T12:16:20.187-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125504","id":"125504","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"For the attachment state, I think since we do not include the state in messages and only include attached network interfaces then the right approach is to set the attached state when unmarshalling.\r\n\r\nAn example patch with all fixes could then be:\r\n\r\n{code}\r\n# git diff\r\ndiff --git a/cluster/handlers.c b/cluster/handlers.c\r\nindex 211be8c..e6e1bf3 100644\r\n--- a/cluster/handlers.c\r\n+++ b/cluster/handlers.c\r\n@@ -3085,7 +3085,7 @@ int ccInstance_to_ncInstance(ncInstance * dst, ccInstance * src)\r\n     for(i = 0; (i < src->secNetCfgsSize && i < EUCA_MAX_NICS); i++) {\r\n         if(strlen(src->secNetCfgs[i].interfaceId) == 0)\r\n             break;\r\n-        memcpy(&(dst->secNetCfgs[i]), &(src->secNetCfgs), sizeof(netConfig));\r\n+        memcpy(&(dst->secNetCfgs[i]), &(src->secNetCfgs[i]), sizeof(netConfig));\r\n     }\r\n \r\n     for (i = 0; i < 64; i++) {\r\ndiff --git a/util/adb-helpers.h b/util/adb-helpers.h\r\nindex aa17c4e..588a9e9 100644\r\n--- a/util/adb-helpers.h\r\n+++ b/util/adb-helpers.h\r\n@@ -997,6 +997,7 @@ static inline ncInstance *copy_instance_from_adb(adb_instanceType_t * instance,\r\n         outInst->secNetCfgs[i].vlan = adb_netConfigType_get_vlan(netParams, env);\r\n         outInst->secNetCfgs[i].networkIndex = adb_netConfigType_get_networkIndex(netParams, env);\r\n         euca_strncpy(outInst->secNetCfgs[i].attachmentId, adb_netConfigType_get_attachmentId(netParams, env), ENI_ATTACHMENT_ID_LEN);\r\n+        euca_strncpy(outInst->secNetCfgs[i].stateName, VOL_STATE_ATTACHED, CHAR_BUFFER_SIZE );\r\n     }\r\n     outInst->hasFloppy = adb_instanceType_get_hasFloopy(instance, env);\r\n     return (outInst);\r\n{code}\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-07-21T13:02:15.270-0500","updated":"2017-07-21T13:02:15.270-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125505","id":"125505","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"[~sjones] I like that change, smaller and does the job on both sides (CC/NC).","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-21T13:16:37.813-0500","updated":"2017-07-21T13:16:37.813-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125507","id":"125507","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"[~sjones] minimal regression tests pass with that change, along with the original test from [~mclark].\r\n\r\nI had initially thought this change might impact RunInstance(), but it shouldn't given that the unmarshalling is different for that call.\r\n\r\nShall I merge the fix, or do we want to discuss during tomorrows meeting?\r\n\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-24T11:48:06.686-0500","updated":"2017-07-24T11:48:06.686-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125508","id":"125508","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"[~sgraham], I'd say merge it, seem like a beneficial low risk change.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-07-24T11:59:43.373-0500","updated":"2017-07-24T11:59:43.373-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/125510","id":"125510","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"body":"merged to maint-4.4: eucalyptus/maint-4.4 2b882ef Steven Graham: EUCA-13391 - Cannot ping secondary ENIs after VM migration...\r\n\r\nTesting Notes:\r\n # I found a memcpy() bug that should have manifested itself when migrating , or describe instance calls with multiple secondary interfaces. They probably would have all been the same as the first secondary interface. For example, without the fix I think the following would occur:\r\n{code}\r\nPrimary : vn_i-123456\r\nSec[0]: veni-abcdef\r\nSec[1]: veni-abcdef\r\n{code}\r\n I would suggest testing out functionality of multiple secondary interfaces. I didn't try to reproduce the issue, just found it via static code analysis. \r\n# Make sure that RunInstances() with secondary interfaces works properly. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sgraham","name":"sgraham","key":"sgraham","accountId":"557058:dab30ab9-44e7-4b70-a841-8b188c40edfc","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/a40e2a7b21096d27f2427d53d5f45fbf?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsgraham%26avatarId%3D18000%26noRedirect%3Dtrue"},"displayName":"Steven Graham","active":true,"timeZone":"US/Central"},"created":"2017-07-24T12:30:15.436-0500","updated":"2017-07-24T12:30:15.436-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/58100/comment/126001","id":"126001","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"Ran secondary eni migration test, passed. All basic regression tests passed as well.  \r\nhttp://jenkins.qa1.eucalyptus-systems.com/view/NET/job/nephoria-vpc-eni-basics/22/console\r\n\r\nThanks, \r\n-M","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-08-02T12:44:15.852-0500","updated":"2017-08-02T12:44:15.852-0500"}],"maxResults":25,"total":25,"startAt":0},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}