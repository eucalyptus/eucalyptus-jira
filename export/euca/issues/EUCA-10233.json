{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"33905","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905","key":"EUCA-10233","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14301","id":"14301","description":"Eucalyptus 4.1.0","name":"4.1.0","archived":false,"released":true,"releaseDate":"2015-01-29"}],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_10311":null,"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=viglesias","name":"viglesias","key":"viglesias","accountId":"557058:49b276ff-ebf9-4dd6-ada3-b568a2898707","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue"},"displayName":"Victor Iglesias","active":true,"timeZone":"America/Los_Angeles"},"customfield_11400":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10302":null,"customfield_10104":[],"customfield_10105":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10100","value":"Yes","id":"10100"},"customfield_10303":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=nurmi","name":"nurmi","key":"nurmi","accountId":"557058:68718820-f5e0-4305-a46c-f867a6bc9565","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue"},"displayName":"Daniel Nurmi","active":true,"timeZone":"US/Central"},"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10201","value":"Medium","id":"10201"},"customfield_10702":null,"customfield_10703":null,"customfield_10308":null,"resolutiondate":"2015-01-16T19:22:25.647-0600","customfield_10704":null,"customfield_10705":null,"customfield_10309":null,"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10233/watchers","watchCount":7,"isWatching":false},"created":"2014-12-15T14:06:15.515-0600","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"customfield_12400":null,"customfield_12201":null,"customfield_10102":null,"customfield_10300":null,"customfield_12600":"{repository={count=2, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":2,\"lastUpdated\":\"2015-01-08T17:04:45.000-0600\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":2,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","labels":[],"customfield_10301":null,"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12806","id":"12806","description":"Eucalyptus 4.0.0","name":"4.0.0","archived":false,"released":true,"releaseDate":"2014-05-30"}],"customfield_11901":null,"issuelinks":[{"id":"28302","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/28302","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"outwardIssue":{"id":"33361","key":"EUCA-10151","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33361","fields":{"summary":"NC should delay instance VM booting until network configuration is available","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=viglesias","name":"viglesias","key":"viglesias","accountId":"557058:49b276ff-ebf9-4dd6-ada3-b568a2898707","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue"},"displayName":"Victor Iglesias","active":true,"timeZone":"America/Los_Angeles"},"updated":"2015-05-08T17:00:21.835-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/12800","id":"12800","name":"eucanetd","description":"Used to track component level items associated with Edge."}],"timeoriginalestimate":null,"description":"In EDGE networking mode, EUCANETD is responsible to installing the rules that pertains to the VMs. It is possible for a VM to acquire network connectivity and be able to send un-filtered traffic onto the network after booting up as it can take some times for EUCANETD to update the EBTABLES and IPTABLES. \r\n\r\nThe solution would be to force the VM traffic to be dropped until the rules for that VM are installed. This means installing the default PRE and POST filters:\r\n\r\n{noformat}\r\nBridge chain: EUCA_EBT_NAT_PRE, entries: 1, policy: ACCEPT\r\n-i vnet+ -j DROP  ### To replace the per-VNET rule\r\n\r\nBridge chain: EUCA_EBT_NAT_POST, entries: 1, policy: ACCEPT\r\n-o vnet+ -j DROP  ### To replace the per-VNET rule\r\n{noformat}\r\n\r\nWhen an instance is being run, EUCANETD would naturally install the following filters:\r\n{noformat}\r\n[NC01-0 ~]# ebtables -t nat -L\r\nBridge table: nat\r\n\r\nBridge chain: PREROUTING, entries: 1, policy: ACCEPT\r\n-j EUCA_EBT_NAT_PRE\r\n\r\nBridge chain: OUTPUT, entries: 0, policy: ACCEPT\r\n\r\nBridge chain: POSTROUTING, entries: 1, policy: ACCEPT\r\n-j EUCA_EBT_NAT_POST\r\n\r\nBridge chain: EUCA_EBT_NAT_PRE, entries: 13, policy: ACCEPT\r\n-s ! d0:d1:af:20:b:b9 -i vnet0 -j DROP \r\n-p IPv4 -s d0:d1:af:20:b:b9 -i vnet0 --ip-proto udp --ip-dport 67:68 -j ACCEPT \r\n-p IPv4 -i vnet0 --ip-src ! 1.100.64.222 -j DROP \r\n-p IPv4 -i vnet0 -j ACCEPT \r\n-p ARP -i vnet0 --arp-mac-src ! d0:d1:af:20:b:b9 -j DROP \r\n-p ARP -i vnet0 --arp-ip-src ! 1.100.64.222 -j DROP \r\n-p ARP -i vnet0 --arp-op Request -j ACCEPT \r\n-p ARP -i vnet0 --arp-op Reply -j ACCEPT \r\n-p ARP -i vnet0 -j DROP \r\n-p 0x8035 -s d0:d1:af:20:b:b9 -d Broadcast -i vnet0 --arp-op Request_Reverse --arp-ip-src 0.0.0.0 --arp-ip-dst 0.0.0.0 --arp-mac-src d0:d1:af:20:b:b9 --arp-mac-dst d0:d1:af:20:b:b9 -j ACCEPT \r\n-p 0x8035 -i vnet0 -j DROP \r\n-p 0x835 -i vnet0 -j ACCEPT \r\n-i vnet0 -j DROP \r\n\r\nBridge chain: EUCA_EBT_NAT_POST, entries: 10, policy: ACCEPT\r\n-p IPv4 -d ! d0:d1:af:20:b:b9 -o vnet0 --ip-proto udp --ip-dport 67:68 -j DROP \r\n-p IPv4 -o vnet0 -j ACCEPT \r\n-p ARP -o vnet0 --arp-op Reply --arp-mac-dst ! d0:d1:af:20:b:b9 -j DROP \r\n-p ARP -o vnet0 --arp-ip-dst ! 1.100.64.222 -j DROP \r\n-p ARP -o vnet0 --arp-op Request -j ACCEPT \r\n-p ARP -o vnet0 --arp-op Reply -j ACCEPT \r\n-p ARP -o vnet0 -j DROP \r\n-p 0x8035 -d Broadcast -o vnet0 --arp-op Request_Reverse --arp-ip-src 0.0.0.0 --arp-ip-dst 0.0.0.0 --arp-mac-src d0:d1:af:20:b:b9 --arp-mac-dst d0:d1:af:20:b:b9 -j ACCEPT \r\n-p 0x8035 -o vnet0 -j DROP \r\n-o vnet0 -j DROP \r\n{noformat}\r\n","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"Race condition in EDGE allowing VMs to send unfiltered traffic","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"customfield_10000":"3_*:*_1_*:*_33630_*|*_10000_*:*_1_*:*_267732956_*|*_10002_*:*_1_*:*_80649614_*|*_10001_*:*_1_*:*_1713142006_*|*_10003_*:*_1_*:*_722211939_*|*_10006_*:*_1_*:*_0","aggregateprogress":{"progress":0,"total":0},"customfield_12100":"0|i030fj:","customfield_10001":"2015-01-08T10:45:33.717-0600","customfield_10002":null,"customfield_10200":null,"customfield_10003":null,"customfield_12500":null,"customfield_10400":null,"customfield_11600":["chuck(chuck)","nurmi(nurmi)","mmunn1(mmunn1)","viglesias(viglesias)"],"customfield_10116":null,"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/80513","id":"80513","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"Also, when NC_ROUTER is enabled, I would replace the per-VNET ARP rule with a more global rule:\r\n{noformat}\r\n-p ARP -i vnet+ --arp-ip-dst <GATEWAY IP> -j arpreply --arpreply-mac <NC MAC>\r\n{noformat}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-12-15T14:08:45.908-0600","updated":"2014-12-15T14:08:45.908-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/80514","id":"80514","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"And to clarify, the default \"vnet+\" DROP filter are expected to be installed at the bottom of the PRE and POST chain... The order would be important.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-12-15T14:09:44.063-0600","updated":"2014-12-15T14:09:44.063-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/81225","id":"81225","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"{noformat}\r\ncommit 1d068ae29681ed8794ea7c9ec5c4248ca820dda0\r\nAuthor: chuck <chuck@eucalyptus.com> 2015-01-06 15:32:24\r\nCommitter: chuck <chuck@eucalyptus.com> 2015-01-06 15:32:24\r\nParent: bc945464397821a7088d60c4a1d151f9b649037b (use mido config options from global network view - config file values will still override)\r\nBranches: dev/chuck/EUCA-10233, origin/dev/chuck/EUCA-10233\r\n\r\nForces traffic to be blocked until rules are installed\r\nEUCA-10233\r\n\r\n-------------------------------- net/eucanetd.c -------------------------------\r\ndiff --git a/net/eucanetd.c b/net/eucanetd.c\r\nindex 89a9c2e..d78a248 100644\r\n--- a/net/eucanetd.c\r\n+++ b/net/eucanetd.c\r\n@@ -659,137 +659,139 @@\r\n         rc = gni_node_get_instances(globalnetworkinfo, myself, NULL, 0, NULL, 0, &instances, &max_instances);\r\n     }\r\n \r\n-    for (i = 0; i < max_instances; i++) {\r\n-        if (instances[i].privateIp && maczero(instances[i].macAddress)) {\r\n-            strptra = strptrb = NULL;\r\n-            strptra = hex2dot(instances[i].privateIp);\r\n-            hex2mac(instances[i].macAddress, &strptrb);\r\n+    gwip = hex2dot(config->vmGatewayIP);\r\n+    brmac = interface2mac(config->bridgeDev);\r\n \r\n-            // this one is a special case, which only gets identified once the VM is actually running on the hypervisor - need to give it some time to appear\r\n-            vnetinterface = mac2interface(strptrb);\r\n+    if (gwip && brmac) {\r\n+        // If we're using the \"fake\" router option and have some instance running,\r\n+        // we need to respond for out of network ARP request.\r\n+        if (config->nc_router && !config->nc_router_ip && (max_instances > 0)) {\r\n+            snprintf(cmd, EUCA_MAX_PATH, \"-i vn_i+ -p ARP --arp-ip-dst %s -j arpreply --arpreply-mac %s\", gwip, brmac);\r\n+            rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+        }\r\n \r\n-            //gwip = hex2dot(mycluster->private_subnet.gateway);\r\n-            gwip = hex2dot(config->vmGatewayIP);\r\n-            brmac = interface2mac(config->bridgeDev);\r\n+        for (i = 0; i < max_instances; i++) {\r\n+            if (instances[i].privateIp && maczero(instances[i].macAddress)) {\r\n+                strptra = strptrb = NULL;\r\n+                strptra = hex2dot(instances[i].privateIp);\r\n+                hex2mac(instances[i].macAddress, &strptrb);\r\n \r\n-            if (strptra && strptrb && vnetinterface && gwip && brmac) {\r\n-                if (!config->disable_l2_isolation) {\r\n-                    //NOTE: much of this ruleset is a translation of libvirt FW example at http://libvirt.org/firewall.html\r\n+                // this one is a special case, which only gets identified once the VM is actually running on the hypervisor - need to give it some time to appear\r\n+                vnetinterface = mac2interface(strptrb);\r\n \r\n-                    // PRE Routing\r\n+                if (strptra && strptrb && vnetinterface) {\r\n+                    if (!config->disable_l2_isolation) {\r\n+                        //NOTE: much of this ruleset is a translation of libvirt FW example at http://libvirt.org/firewall.html\r\n \r\n-                    // basic MAC check\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -s ! %s -j DROP\", vnetinterface, strptrb);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+                        // PRE Routing\r\n \r\n-                    // IPv4\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -i %s -s %s --ip-proto udp --ip-dport 67:68 -j ACCEPT\", vnetinterface, strptrb);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -i %s --ip-src ! %s -j DROP\", vnetinterface, strptra);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -i %s -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    // ARP\r\n-                    if (config->nc_router && !config->nc_router_ip) {\r\n-                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-ip-dst %s -j arpreply --arpreply-mac %s\", vnetinterface, gwip, brmac);\r\n+                        // basic MAC check\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -s ! %s -j DROP\", vnetinterface, strptrb);\r\n                         rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        // IPv4\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -i %s -s %s --ip-proto udp --ip-dport 67:68 -j ACCEPT\", vnetinterface, strptrb);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -i %s --ip-src ! %s -j DROP\", vnetinterface, strptra);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -i %s -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-mac-src ! %s -j DROP\", vnetinterface, strptrb);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-ip-src ! %s -j DROP\", vnetinterface, strptra);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-op Request -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-op Reply -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP -j DROP\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        // RARP\r\n+                        snprintf(cmd, EUCA_MAX_PATH,\r\n+                                 \"-i %s -p 0x8035 -s %s -d Broadcast --arp-op Request_Reverse --arp-ip-src 0.0.0.0 --arp-ip-dst 0.0.0.0 --arp-mac-src %s --arp-mac-dst %s -j ACCEPT\",\r\n+                                 vnetinterface, strptrb, strptrb, strptrb);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p 0x8035 -j DROP\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        // pass KVM migration weird packet\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p 0x835 -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+                        // POST routing\r\n+\r\n+                        // IPv4\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -o %s -d ! %s --ip-proto udp --ip-dport 67:68 -j DROP\", vnetinterface, strptrb);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -o %s -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        // ARP\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Reply --arp-mac-dst ! %s -j DROP\", vnetinterface, strptrb);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-ip-dst ! %s -j DROP\", vnetinterface, strptra);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Request -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Request -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Reply -j ACCEPT\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s -j DROP\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        // RARP\r\n+                        snprintf(cmd, EUCA_MAX_PATH,\r\n+                                 \"-p 0x8035 -o %s -d Broadcast --arp-op Request_Reverse --arp-ip-src 0.0.0.0 --arp-ip-dst 0.0.0.0 --arp-mac-src %s --arp-mac-dst %s -j ACCEPT\",\r\n+                                 vnetinterface, strptrb, strptrb);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                        snprintf(cmd, EUCA_MAX_PATH, \"-p 0x8035 -o %s -j DROP\", vnetinterface);\r\n+                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+                    } else {\r\n+                        if (config->nc_router && !config->nc_router_ip) {\r\n+                            snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-ip-dst %s -j arpreply --arpreply-mac %s\", vnetinterface, gwip, brmac);\r\n+                            rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+                        }\r\n                     }\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-mac-src ! %s -j DROP\", vnetinterface, strptrb);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-ip-src ! %s -j DROP\", vnetinterface, strptra);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-op Request -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-op Reply -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP -j DROP\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    // RARP\r\n-                    snprintf(cmd, EUCA_MAX_PATH,\r\n-                             \"-i %s -p 0x8035 -s %s -d Broadcast --arp-op Request_Reverse --arp-ip-src 0.0.0.0 --arp-ip-dst 0.0.0.0 --arp-mac-src %s --arp-mac-dst %s -j ACCEPT\",\r\n-                             vnetinterface, strptrb, strptrb, strptrb);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p 0x8035 -j DROP\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    // pass KVM migration weird packet\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p 0x835 -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    // DROP everything else\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-i %s -j DROP\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-\r\n-                    // POST routing\r\n-\r\n-                    // IPv4\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -o %s -d ! %s --ip-proto udp --ip-dport 67:68 -j DROP\", vnetinterface, strptrb);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p IPv4 -o %s -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    // ARP\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Reply --arp-mac-dst ! %s -j DROP\", vnetinterface, strptrb);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-ip-dst ! %s -j DROP\", vnetinterface, strptra);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Request -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Request -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s --arp-op Reply -j ACCEPT\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p ARP -o %s -j DROP\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    // RARP\r\n-                    snprintf(cmd, EUCA_MAX_PATH,\r\n-                             \"-p 0x8035 -o %s -d Broadcast --arp-op Request_Reverse --arp-ip-src 0.0.0.0 --arp-ip-dst 0.0.0.0 --arp-mac-src %s --arp-mac-dst %s -j ACCEPT\",\r\n-                             vnetinterface, strptrb, strptrb);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-p 0x8035 -o %s -j DROP\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n-                    // DROP everything else\r\n-                    snprintf(cmd, EUCA_MAX_PATH, \"-o %s -j DROP\", vnetinterface);\r\n-                    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n-\r\n                 } else {\r\n-                    if (config->nc_router && !config->nc_router_ip) {\r\n-                        snprintf(cmd, EUCA_MAX_PATH, \"-i %s -p ARP --arp-ip-dst %s -j arpreply --arpreply-mac %s\", vnetinterface, gwip, brmac);\r\n-                        rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n-                    }\r\n+                    LOGWARN(\"could not retrieve one of: vmip (%s), vminterface (%s), vmmac (%s), gwip (%s), brmac (%s): skipping but will retry\\n\", SP(strptra), SP(vnetinterface),\r\n+                            SP(strptrb), SP(gwip), SP(brmac));\r\n+                    ret = 1;\r\n                 }\r\n-            } else {\r\n-                LOGWARN(\"could not retrieve one of: vmip (%s), vminterface (%s), vmmac (%s), gwip (%s), brmac (%s): skipping but will retry\\n\", SP(strptra), SP(vnetinterface),\r\n-                        SP(strptrb), SP(gwip), SP(brmac));\r\n-                ret = 1;\r\n+                EUCA_FREE(vnetinterface);\r\n+                EUCA_FREE(strptra);\r\n+                EUCA_FREE(strptrb);\r\n             }\r\n-            EUCA_FREE(vnetinterface);\r\n-            EUCA_FREE(strptra);\r\n-            EUCA_FREE(strptrb);\r\n-            EUCA_FREE(brmac);\r\n-            EUCA_FREE(gwip);\r\n         }\r\n     }\r\n \r\n+    // DROP everything from the instance by default\r\n+    snprintf(cmd, EUCA_MAX_PATH, \"-i vn_i+ -j DROP\", vnetinterface);\r\n+    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_PRE\", cmd);\r\n+\r\n+    // DROP everything to the instance by default\r\n+    snprintf(cmd, EUCA_MAX_PATH, \"-o vn_i+ -j DROP\");\r\n+    rc = ebt_chain_add_rule(config->ebt, \"nat\", \"EUCA_EBT_NAT_POST\", cmd);\r\n+\r\n+    EUCA_FREE(brmac);\r\n+    EUCA_FREE(gwip);\r\n     EUCA_FREE(instances);\r\n \r\n     rc = ebt_handler_print(config->ebt);\r\n@@ -1164,10 +1166,10 @@\r\n \r\n             snprintf(cmd, EUCA_MAX_PATH, \"ip addr add %s/%d dev %s >/dev/null 2>&1\", strptra, 32, config->pubInterface);\r\n             rc = se_add(&cmds, cmd, NULL, ignore_exit2);\r\n-            \r\n+\r\n             snprintf(cmd, EUCA_MAX_PATH, \"arping -c 5 -w 1 -U -I %s %s >/dev/null 2>&1 &\", config->pubInterface, strptra);\r\n             rc = se_add(&cmds, cmd, NULL, ignore_exit);\r\n-            \r\n+\r\n             se_print(&cmds);\r\n             rc = se_execute(&cmds);\r\n             if (rc) {\r\n@@ -1217,10 +1219,10 @@\r\n     }\r\n     // if all has gone well, now clear any public IPs that have not been mapped to private IPs\r\n     if (!ret) {\r\n-        \r\n+\r\n         for (i = 0; i < globalnetworkinfo->max_public_ips; i++) {\r\n             int found = 0;\r\n-            \r\n+\r\n             if (max_instances > 0) {\r\n                 // only clear IPs that are not assigned to instances running on this node\r\n                 for (j = 0; j < max_instances && !found; j++) {\r\n@@ -1229,14 +1231,14 @@\r\n                     }\r\n                 }\r\n             }\r\n-            \r\n+\r\n             if (!found) {\r\n                 se_init(&cmds, config->cmdprefix, 2, 1);\r\n-                \r\n+\r\n                 strptra = hex2dot(globalnetworkinfo->public_ips[i]);\r\n                 snprintf(cmd, EUCA_MAX_PATH, \"ip addr del %s/%d dev %s >/dev/null 2>&1\", strptra, 32, config->pubInterface);\r\n                 EUCA_FREE(strptra);\r\n-                \r\n+\r\n                 rc = se_add(&cmds, cmd, NULL, ignore_exit2);\r\n                 se_print(&cmds);\r\n                 rc = se_execute(&cmds);\r\n@@ -1245,7 +1247,7 @@\r\n                     ret = 1;\r\n                 }\r\n                 se_free(&cmds);\r\n-                \r\n+\r\n                 }\r\n         }\r\n     }\r\n@@ -1720,7 +1722,7 @@\r\n     snprintf(config->vnetMode, sizeof(config->vnetMode), \"%s\", cvals[EUCANETD_CVAL_MODE]);\r\n \r\n     // mido config opts\r\n-    \r\n+\r\n     if (cvals[EUCANETD_CVAL_MIDOSETUPCORE])\r\n         snprintf(config->midosetupcore, sizeof(config->midosetupcore), \"%s\", cvals[EUCANETD_CVAL_MIDOSETUPCORE]);\r\n     if (cvals[EUCANETD_CVAL_MIDOEUCANETDHOST])\r\n@@ -1917,7 +1919,7 @@\r\n     int brdev_len = 0, i = 0, found_ip = 0;\r\n     char *strptra = NULL, *strptrb = NULL, *strptrc = NULL, *strptrd = NULL;\r\n     gni_cluster *mycluster = NULL;\r\n-    \r\n+\r\n     LOGDEBUG(\"reading latest network view into eucanetd\\n\");\r\n \r\n     rc = gni_populate(globalnetworkinfo, config->global_network_info_file.dest);\r\n{noformat}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-01-07T12:21:24.102-0600","updated":"2015-01-07T12:21:24.102-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/81226","id":"81226","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"Ready for code review. Ran this code change through QA successfully. In terms of manual testing:\r\n\r\n* Check for presence of default drop rules when no instance is running on a node\r\n{noformat}\r\n[root@g-12-06 ~]# ebtables -t nat -L\r\nBridge table: nat\r\n\r\nBridge chain: PREROUTING, entries: 1, policy: ACCEPT\r\n-j EUCA_EBT_NAT_PRE\r\n\r\nBridge chain: OUTPUT, entries: 0, policy: ACCEPT\r\n\r\nBridge chain: POSTROUTING, entries: 1, policy: ACCEPT\r\n-j EUCA_EBT_NAT_POST\r\n\r\nBridge chain: EUCA_EBT_NAT_PRE, entries: 14, policy: ACCEPT\r\n-i vn_i+ -j DROP \r\n\r\nBridge chain: EUCA_EBT_NAT_POST, entries: 10, policy: ACCEPT\r\n-o vn_i+ -j DROP \r\n[root@g-12-06 ~]# \r\n{noformat}\r\n\r\n* Check for the presence of the following rule with NC_ROUTER=Y and with instance running. Otherwise, the rule shouldn't be there\r\n{noformat}\r\n-p ARP -i vn_i+ --arp-ip-dst <router_ip> -j arpreply --arpreply-mac <bridge_dev_mac>\r\n{noformat}\r\n\r\n* When instances are running, we should still see the default \"vn_i+\" drop rules and we should not see a per VM default drop (as we had previously)","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-01-07T12:26:42.531-0600","updated":"2015-01-07T12:26:42.531-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/81329","id":"81329","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=nurmi","name":"nurmi","key":"nurmi","accountId":"557058:68718820-f5e0-4305-a46c-f867a6bc9565","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue"},"displayName":"Daniel Nurmi","active":true,"timeZone":"US/Central"},"body":"code reviewed","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=nurmi","name":"nurmi","key":"nurmi","accountId":"557058:68718820-f5e0-4305-a46c-f867a6bc9565","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue"},"displayName":"Daniel Nurmi","active":true,"timeZone":"US/Central"},"created":"2015-01-08T10:45:33.717-0600","updated":"2015-01-08T10:45:33.717-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/81419","id":"81419","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"Fix has been pushed to testing branch.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-01-08T22:05:35.100-0600","updated":"2015-01-08T22:05:35.100-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/82097","id":"82097","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=viglesias","name":"viglesias","key":"viglesias","accountId":"557058:49b276ff-ebf9-4dd6-ada3-b568a2898707","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue"},"displayName":"Victor Iglesias","active":true,"timeZone":"America/Los_Angeles"},"body":"Looks good to me.\r\n\r\nNo instances:\r\n{noformat}\r\n[root@e-37 ~]# ebtables -t nat -L\r\nBridge table: nat\r\n\r\nBridge chain: PREROUTING, entries: 1, policy: ACCEPT\r\n-j EUCA_EBT_NAT_PRE\r\n\r\nBridge chain: OUTPUT, entries: 0, policy: ACCEPT\r\n\r\nBridge chain: POSTROUTING, entries: 1, policy: ACCEPT\r\n-j EUCA_EBT_NAT_POST\r\n\r\nBridge chain: EUCA_EBT_NAT_PRE, entries: 1, policy: ACCEPT\r\n-i vn_i+ -j DROP\r\n\r\nBridge chain: EUCA_EBT_NAT_POST, entries: 1, policy: ACCEPT\r\n-o vn_i+ -j DROP\r\n[root@e-37 ~]#\r\n{noformat}\r\n\r\nWith instances:\r\n{noformat}\r\n-s ! d0:d:99:bb:a3:8a -i vn_i-99bba38a -j DROP\r\n-p IPv4 -s d0:d:99:bb:a3:8a -i vn_i-99bba38a --ip-proto udp --ip-dport 67:68 -j ACCEPT\r\n-p IPv4 -i vn_i-99bba38a --ip-src ! 10.111.52.122 -j DROP\r\n-p IPv4 -i vn_i-99bba38a -j ACCEPT\r\n-p ARP -i vn_i-99bba38a --arp-ip-dst 10.111.0.1 -j arpreply --arpreply-mac b8:ac:6f:8b:81:7b\r\n-p ARP -i vn_i-99bba38a --arp-mac-src ! d0:d:99:bb:a3:8a -j DROP\r\n-p ARP -i vn_i-99bba38a --arp-ip-src ! 10.111.52.122 -j DROP\r\n-p ARP -i vn_i-99bba38a --arp-op Request -j ACCEPT\r\n-p ARP -i vn_i-99bba38a --arp-op Reply -j ACCEPT\r\n-p ARP -i vn_i-99bba38a -j DROP\r\n-p 0x8035 -s d0:d:99:bb:a3:8a -d Broadcast -i vn_i-99bba38a --arp-op Request_Reverse --arp-ip-src 0.0.0.0 --arp-ip-dst 0.0.0.0 --arp-mac-src d0:d:99:bb:a3:8a --arp-mac-dst d0:d:99:bb:a3:8a -j ACCEPT\r\n-p 0x8035 -i vn_i-99bba38a -j DROP\r\n-p 0x835 -i vn_i-99bba38a -j ACCEPT\r\n-i vn_i-99bba38a -j DROP\r\n{noformat}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=viglesias","name":"viglesias","key":"viglesias","accountId":"557058:49b276ff-ebf9-4dd6-ada3-b568a2898707","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue"},"displayName":"Victor Iglesias","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-16T19:22:20.047-0600","updated":"2015-01-16T19:22:20.047-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/84516","id":"84516","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"[~hspencer]: nope","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-03-30T11:52:13.190-0500","updated":"2015-03-30T11:52:13.190-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/84557","id":"84557","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mmunn1","name":"mmunn1","key":"mmunn1","accountId":"557058:6e62b7e8-e48f-469d-ac54-e9449dec5cd9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue"},"displayName":"Michael Munn","active":true,"timeZone":"America/Los_Angeles"},"body":"[~chuck] Just for clarification, \"nope\" the script is not needed or \"nope\" the fix does not resolve the pre-boot issue and the script is still needed?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mmunn1","name":"mmunn1","key":"mmunn1","accountId":"557058:6e62b7e8-e48f-469d-ac54-e9449dec5cd9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/6638eee119e9c0bdcca16883c5415349?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dmmunn1%26avatarId%3D11300%26noRedirect%3Dtrue"},"displayName":"Michael Munn","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-03-30T15:38:45.118-0500","updated":"2015-03-30T15:38:45.118-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33905/comment/84559","id":"84559","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"the first one. No script needed.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-03-30T15:41:02.543-0500","updated":"2015-03-30T15:41:02.543-0500"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10233/votes","votes":0,"hasVoted":false},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}