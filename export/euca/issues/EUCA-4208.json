{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"17246","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/17246","key":"EUCA-4208","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"resolution":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10307","value":"Managed","id":"10307"}],"customfield_11401":null,"customfield_11400":null,"customfield_10104":[],"customfield_10302":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10105":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10101","value":"No","id":"10101"},"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10202","value":"Low","id":"10202"},"customfield_10703":null,"customfield_10704":null,"customfield_10308":null,"resolutiondate":null,"customfield_10705":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"workratio":-1,"lastViewed":null,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-4208/watchers","watchCount":2,"isWatching":false},"created":"2012-11-21T00:48:53.600-0600","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12201":null,"customfield_10102":null,"customfield_10300":null,"customfield_12600":"{}","labels":[],"customfield_10301":null,"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/10112","id":"10112","description":"Eucalyptus 3.2.0","name":"3.2.0","archived":false,"released":true,"releaseDate":"2012-12-19"}],"customfield_11901":null,"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=vasya","name":"vasya","key":"vasya","accountId":"557058:1c63481a-0634-4ae7-9004-cb0f143e141f","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fa832ffa4e20c9aa05ac272214d43196?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dvasya%26avatarId%3D10408%26noRedirect%3Dtrue"},"displayName":"Vasiliy Kochergin","active":false,"timeZone":"America/Los_Angeles"},"updated":"2016-03-24T16:49:18.640-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10001","description":"This issue has been validated/reproduced, but has not been prioritized yet.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Confirmed","id":"10001","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10010","id":"10010","name":"Node Controller"}],"timeoriginalestimate":null,"description":"Opening this ticket to track stale iscsi connections on the NC after detach. iscsiadm often shows connections long after all volumes have been detached. Logs below show failures on disconnect/detach. In this case I had previously been using this system for churn and mpath fail over tests. Will try to provide more info to reproduce. \r\nThanks,\r\n-M\r\n\r\n\r\n{code}\r\n[root@eucahost-51-110 ~]# euca-describe-volumes \r\nVOLUME\tvol-D8B740FA\t 1\t\tPARTI00\tavailable\t2012-11-20T22:09:03.728Z\r\nVOLUME\tvol-9D1B3958\t 1\tsnap-3EAE3ACA\tPARTI00\tavailable\t2012-11-20T23:55:50.925Z\r\nVOLUME\tvol-4D4245A1\t 1\t\tPARTI00\tavailable\t2012-11-20T23:07:11.995Z\r\nVOLUME\tvol-0E5A3E4E\t 1\t\tPARTI00\tavailable\t2012-11-21T00:02:18.009Z\r\nVOLUME\tvol-8611400A\t 1\tsnap-87153EDF\tPARTI00\tavailable\t2012-11-21T00:09:51.221Z\r\nVOLUME\tvol-CB26424C\t 1\t\tPARTI00\tavailable\t2012-11-20T22:09:02.264Z\r\nVOLUME\tvol-35603F6E\t 1\t\tPARTI00\tavailable\t2012-11-20T23:48:22.389Z\r\nVOLUME\tvol-FD374199\t 1\t\tPARTI00\tavailable\t2012-11-20T22:09:04.447Z\r\nVOLUME\tvol-7EBF4185\t 1\t\tPARTI00\tavailable\t2012-11-20T22:09:03.041Z\r\n\r\n-----------------------------------------------\r\n\r\n\r\n2012-11-20 16:16:17 DEBUG 000020248 disconnect_iscsi_target  | returned: 0, stdout: '', stderr: 'Tried deleting lun 10 times\r\nTried deleting lun 10 times\r\n'\r\n2012-11-20 16:16:17  INFO 000020248 doDetachVolume           | [i-20863FF4][vol-8611400A] detached as host device '/dev/mapper/mpathl' and guest device 'sdh'\r\n2012-11-20 16:16:17  INFO 000020248 find_and_terminate_insta | [i-20863FF4] destroying instance\r\n2012-11-20 16:16:17 DEBUG 000020248 change_state             | [i-20863FF4] state change for instance: Running -> Shutoff (Extant)\r\n\r\n------------------------------------------------------------\r\n\r\n012-11-20 22:27:07 DEBUG 000020248 disconnect_iscsi_target  | invoking `//usr/lib/eucalyptus/euca_rootwrap //usr/share/eucalyptus/disconnect_iscsitarget.pl /,matt,,2,ZcTClCL9xbGRlu7axmPCWuM2LZB6olfInfGo4Pv9H3Zub8RUwIu+jdxTNuh/NiQh1iG/2N0vY0GdK2VwkBth/6/lfgcWmYkX/7Cin5A9jiagavpUCj1++R3ziO2A6MzeLTSFdARd99aizFaZte7kENjRMHkU8s7BviF+w2ArxkVkLgwiudETn8ffZu3dYIphzvKWr8COnk6v//7NZ2pyuETZomUPhi2CSSrke7yFxYFXk+s+KoSTNyroN63CL5EGoa+18lS8M6EGpmw7KYtxywrnVdLJfI82evotnHpSZ/Qx7RamxUJawYv9Z06kVkey/vMnuKpe721ZvqIbkP+taw==,iface0,192.168.25.182,iqn.1992-04.com.emc:cx.apm00121200804.a6,iface1,10.109.25.186,iqn.1992-04.com.emc:cx.apm00121200804.b6`\r\n2012-11-20 22:27:10 DEBUG 000020248 disconnect_iscsi_target  | returned: 0, stdout: '', stderr: 'Tried deleting lun 0 times\r\nTried deleting lun 0 times\r\nFailed to run '/sbin/dmsetup message mpathm 0 'fail_if_no_path'': device-mapper: message ioctl on mpathm failed: No such device or address\r\n Command failed\r\n'\r\n2012-11-20 22:27:10  INFO 000020248 doDetachVolume           | [i-6E9A481C][vol-D8B740FA] detached as host device '/dev/mapper/mpathm' and guest device 'sdf'\r\n2012-11-20 22:27:10 DEBUG 000020248 doDescribeResource       | returning cores=2/4 mem=7280/7792 disk=27/37 iqn=iqn.1994-05.com.redhat:e37d909e41ed\r\n\r\n------------------------------------------------------------\r\n\r\n[root@eucahost-51-121 ~]# iscsiadm -m session -P 3\r\niSCSI Transport Class version 2.0-870\r\nversion 2.0-872.41.el6\r\nTarget: iqn.1992-04.com.emc:cx.apm00121200804.a6\r\n\tCurrent Portal: 192.168.25.182:3260,1\r\n\tPersistent Portal: 192.168.25.182:3260,1\r\n\t\t**********\r\n\t\tInterface:\r\n\t\t**********\r\n\t\tIface Name: iface0\r\n\t\tIface Transport: tcp\r\n\t\tIface Initiatorname: iqn.1994-05.com.redhat:e37d909e41ed\r\n\t\tIface IPaddress: 192.168.51.121\r\n\t\tIface HWaddress: <empty>\r\n\t\tIface Netdev: br0\r\n\t\tSID: 1\r\n\t\tiSCSI Connection State: LOGGED IN\r\n\t\tiSCSI Session State: LOGGED_IN\r\n\t\tInternal iscsid Session State: NO CHANGE\r\n\t\t*********\r\n\t\tTimeouts:\r\n\t\t*********\r\n\t\tRecovery Timeout: 15\r\n\t\tTarget Reset Timeout: 30\r\n\t\tLUN Reset Timeout: 10\r\n\t\tAbort Timeout: 15\r\n\t\t*****\r\n\t\tCHAP:\r\n\t\t*****\r\n\t\tusername: matt\r\n\t\tpassword: ********\r\n\t\tusername_in: <empty>\r\n\t\tpassword_in: ********\r\n\t\t************************\r\n\t\tNegotiated iSCSI params:\r\n\t\t************************\r\n\t\tHeaderDigest: None\r\n\t\tDataDigest: None\r\n\t\tMaxRecvDataSegmentLength: 262144\r\n\t\tMaxXmitDataSegmentLength: 65536\r\n\t\tFirstBurstLength: 0\r\n\t\tMaxBurstLength: 262144\r\n\t\tImmediateData: No\r\n\t\tInitialR2T: Yes\r\n\t\tMaxOutstandingR2T: 1\r\n\t\t************************\r\n\t\tAttached SCSI devices:\r\n\t\t************************\r\n\t\tHost Number: 6\tState: running\r\n\t\tscsi6 Channel 00 Id 0 Lun: 0\r\n\t\t\tAttached scsi disk sdc\t\tState: running\r\n\t\tscsi6 Channel 00 Id 0 Lun: 1\r\n\t\t\tAttached scsi disk sdd\t\tState: running\r\n\t\tscsi6 Channel 00 Id 0 Lun: 3\r\n\t\t\tAttached scsi disk sdg\t\tState: running\r\nTarget: iqn.1992-04.com.emc:cx.apm00121200804.b6\r\n\tCurrent Portal: 10.109.25.186:3260,2\r\n\tPersistent Portal: 10.109.25.186:3260,2\r\n\t\t**********\r\n\t\tInterface:\r\n\t\t**********\r\n\t\tIface Name: iface1\r\n\t\tIface Transport: tcp\r\n\t\tIface Initiatorname: iqn.1994-05.com.redhat:e37d909e41ed\r\n\t\tIface IPaddress: 10.109.51.121\r\n\t\tIface HWaddress: <empty>\r\n\t\tIface Netdev: eth1\r\n\t\tSID: 2\r\n\t\tiSCSI Connection State: LOGGED IN\r\n\t\tiSCSI Session State: LOGGED_IN\r\n\t\tInternal iscsid Session State: NO CHANGE\r\n\t\t*********\r\n\t\tTimeouts:\r\n\t\t*********\r\n\t\tRecovery Timeout: 15\r\n\t\tTarget Reset Timeout: 30\r\n\t\tLUN Reset Timeout: 10\r\n\t\tAbort Timeout: 15\r\n\t\t*****\r\n\t\tCHAP:\r\n\t\t*****\r\n\t\tusername: matt\r\n\t\tpassword: ********\r\n\t\tusername_in: <empty>\r\n\t\tpassword_in: ********\r\n\t\t************************\r\n\t\tNegotiated iSCSI params:\r\n\t\t************************\r\n\t\tHeaderDigest: None\r\n\t\tDataDigest: None\r\n\t\tMaxRecvDataSegmentLength: 262144\r\n\t\tMaxXmitDataSegmentLength: 65536\r\n\t\tFirstBurstLength: 0\r\n\t\tMaxBurstLength: 262144\r\n\t\tImmediateData: No\r\n\t\tInitialR2T: Yes\r\n\t\tMaxOutstandingR2T: 1\r\n\t\t************************\r\n\t\tAttached SCSI devices:\r\n\t\t************************\r\n\t\tHost Number: 7\tState: running\r\n\t\tscsi7 Channel 00 Id 0 Lun: 0\r\n\t\t\tAttached scsi disk sde\t\tState: running\r\n\t\tscsi7 Channel 00 Id 0 Lun: 1\r\n\t\t\tAttached scsi disk sdf\t\tState: running\r\n\t\tscsi7 Channel 00 Id 0 Lun: 3\r\n\t\t\tAttached scsi disk sdh\t\tState: running\r\n\r\n{code}","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"iscsi connections occasionally left behind after disconnect w/ vnx mpath","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":null,"customfield_12100":"0|i01wyv:","customfield_10001":"2012-11-26T12:20:39.216-0600","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["mclark(mclark)","vasya(vasya)","zhill(zhill)"],"customfield_10116":null,"environment":"192.168.51.110\tCENTOS\t6.3\t64\tREPO\t[CLC]\r\n192.168.51.111\tCENTOS\t6.3\t64\tREPO\t[WS]\r\n192.168.51.113\tCENTOS\t6.3\t64\tREPO\t[CC00 SC00]\r\n192.168.51.121\tCENTOS\t6.3\t64\tREPO\t[NC00]\r\n192.168.51.123\tCENTOS\t6.3\t64\tREPO\t[NC00]\r\n","customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"progress":{"progress":0,"total":0},"customfield_11806":null,"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/17246/comment/36154","id":"36154","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"body":"The issue here is that when the disconnect code cannot disconnect all paths it will leave some paths still connected. We do not restore the state back to original and fail cleanly. Arguably, the proper case is to either leave the state unchanged or full complete the disconnect, not partially tear-down state and leave it down on failure.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=zhill","name":"zhill","key":"zhill","accountId":"557058:70b4b768-eb1f-43a3-a225-3353d0fe3f56","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/239165321c2f152424c9be883721791a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dzhill%26avatarId%3D10406%26noRedirect%3Dtrue"},"displayName":"Zach Hill","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-26T12:20:39.216-0600","updated":"2012-11-26T12:20:39.216-0600"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-4208/votes","votes":0,"hasVoted":false},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}