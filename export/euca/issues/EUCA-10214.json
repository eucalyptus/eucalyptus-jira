{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"33752","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752","key":"EUCA-10214","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"resolution":null,"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/11500","value":"Edge","id":"11500"}],"customfield_11401":null,"customfield_11400":null,"customfield_10302":null,"customfield_10104":[],"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10105":null,"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"customfield_10308":null,"resolutiondate":null,"customfield_10704":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10214/watchers","watchCount":7,"isWatching":false},"lastViewed":null,"created":"2014-12-05T09:24:16.999-0600","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12400":null,"customfield_12201":null,"customfield_12600":"{}","customfield_10102":null,"customfield_10300":null,"customfield_10301":null,"labels":[],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14606","id":"14606","description":"Eucalyptus 4.0.2","name":"4.0.2","archived":false,"released":true,"releaseDate":"2014-10-20"}],"customfield_11901":null,"issuelinks":[{"id":"28616","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/28616","type":{"id":"10103","name":"Relates","inward":"relates to","outward":"relates to","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10103"},"inwardIssue":{"id":"34230","key":"EUCA-10384","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/34230","fields":{"summary":"failed to clone euca-zero device into partition dmsetup","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"updated":"2015-01-16T12:47:10.471-0600","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10000","description":"This issue has not yet been validated, and is not currently being investigated.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Unconfirmed","id":"10000","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10010","id":"10010","name":"Node Controller"}],"timeoriginalestimate":null,"description":"Here's how I reproduced the problem:\r\n\r\n1) On a working NC running eucalyptus 4.0.2, I started an instance using an instance-store image. In nc.log, I saw NC downloaded the image and booted the instance. I verified the instance rans correctly.\r\n\r\n2) ON the same NC, I started another instance using the same image. This time the log shows NC booted the instance immediately off the cache (as expected) without downloading. I verified the second instance ran correctly.\r\n\r\n2) Restart NC using \"service eucalyptus-nc restart\".\r\n\r\n3) After the NC service is running, I started a third instance using the same image. The log showed the NC actually downloaded another copy of the image, tried the boot it but failed.\r\n\r\n4) All subsequent attempts of booting the same image on the NC failed (nc.log in EXTREME level attached).\r\n\r\n5) However, I could boot instances off images that were not running on the NC when I restarted the service.\r\n\r\n6) The only way to rectify the problem (i.e. being able to boot more instances using the first image) was to reboot the node.","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/22720","id":"22720","filename":"nc.log","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"created":"2014-12-11T21:37:33.389-0600","size":125949,"mimeType":"text/plain","content":"https://eucalyptus.atlassian.net/secure/attachment/22720/nc.log"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/22608","id":"22608","filename":"nc.log","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"created":"2014-12-05T09:24:17.027-0600","size":980479,"mimeType":"text/plain","content":"https://eucalyptus.atlassian.net/secure/attachment/22608/nc.log"}],"summary":"Node left in bad state after restarting eucalyptus-nc service with instances running","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"customfield_12100":"0|i0300n:","aggregateprogress":{"progress":0,"total":0},"customfield_10000":null,"customfield_10001":"2014-12-11T17:43:39.663-0600","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_10116":null,"customfield_11600":["dmitrii(dmitrii)","hspencer(hspencer)","shl1@cornell.edu(shl1@cornell.edu)"],"customfield_10117":null,"environment":"Eucalyptus 4.0.2 in edge mode. CLC/Walrus host and CC/SC host and NC are all running CentOS 6.5.","customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"progress":{"progress":0,"total":0},"customfield_11806":null,"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/80362","id":"80362","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"body":"Hi Steven,\r\n\r\nI looked through nc.log and I am seeing something a little bit different. When that run request is being serviced, there is no second image download. (There is a small download of the manifest -- on the line that says {{downloading /tmp/http-reply-AnOb75}} -- but that happens at every run, even when the cached image is reused.)\r\n\r\nThen, indeed, I see a failure to prepare the working image. The failure has to do with inability to manipulate device mapper devices as expected. Something in the state of the cache or work files on disk and in kernel memory is invalid. I can see how rebooting the node resolves the problem, since our device mapper entries do not persist across reboots. I suspect you can clear up the problem without rebooting by\r\n\r\n* terminating all instances\r\n* removing any disk state with {{rm -rf /var/lib/eucalyptus/instances/**/**}}\r\n* removing any kernel state by running *three times*: {{dmsetup table | grep euca | cut -d':' -f 1 | sort | uniq | xargs -L 1 dmsetup remove; losetup -a | cut -d':' -f 1 | xargs -L 1 losetup -d}}\r\n* restarting the NC service\r\n\r\nI am unable to recreate this problem simply by restarting the NC with a running instance and a second instance after restart. For me, the second instance runs using the cache just fine. So, if you are still having this problem after performing the above steps, please, include the following:\r\n\r\n* a new {{nc.log}} captured at DEBUG level (not EXTREME, since that's just more work for me to grep that out -- those statements are for really low-level debugging) that contains log messages for the first good instance and the second, bad instance after NC restart\r\n* output of {{losetup -a}}\r\n* output of {{dmsetup table}}\r\n* output of {{find /var/lib/eucalyptus/instances/cache/}}\r\n* output of {{ls -l /dev/mapper/}}\r\n\r\nThanks!\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-12-11T17:43:39.663-0600","updated":"2014-12-11T17:43:39.663-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/80370","id":"80370","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"body":"Hi,\r\n\r\nI was able to follow your instructions to clear up the problem without rebooting. It works perfectly. I knew the problem was caused by device mapper problems but didn't know how to clean up without rebooting :)\r\n\r\nAnyway, I can still make this problem happen and your clean up method is less than ideal because it requires me to migrate all running instances off the node or terminate them. I've reproduced the problem one more time and captured the nc.log and command outputs as you requested. Here's the sequence of events:\r\n\r\n22:17:00 started  i-d31bea60 (worked)\r\n22:20:01 service eucalyptus-nc restart\r\n22:20:59 started  i-58f92d51 (failed)\r\n\r\n-----\r\n[root@cn0008 instances]# losetup -a\r\n/dev/loop0: [fd04]:123813981 (/localdisk/eucalyptus/instances/cache/emi-55c368ed-a8eece66/bl*)\r\n/dev/loop1: [fd04]:123813986 (/localdisk/eucalyptus/instances/work/AIDQJ6L4KAGGDNXWCD4J5/i-d*)\r\n/dev/loop2: [fd04]:123813995 (/localdisk/eucalyptus/instances/cache/prt-92280ext3-a7a25811/b*)\r\n/dev/loop3: [fd04]:123814000 (/localdisk/eucalyptus/instances/work/AIDQJ6L4KAGGDNXWCD4J5/i-d*)\r\n[root@cn0008 instances]# dmsetup table\r\neuca-prt-92280ext3-a7a25811: 0 188989440 linear 253:10 0\r\neuca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-prt-92280ext3-a7a25811-p0-back: 0 188989440 linear 7:3 0\r\neuca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-emi-55c368ed-a8eece66-p0-back: 0 20725760 linear 7:1 0\r\nvg_cn0008-tmp: 0 10240000 linear 8:17 2048\r\neuca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-prt-92280ext3-a7a25811: 0 188989440 linear 253:13 0\r\neuca-prt-92280ext3-a7a25811-p0-snap: 0 188989440 snapshot 253:8 253:9 N 16\r\neuca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-emi-55c368ed-a8eece66: 0 20725760 linear 253:6 0\r\nvg_cn0008-localdisk: 0 7688544256 linear 8:17 121243648\r\nvg_cn0008-localdisk: 7688544256 1064960 linear 8:2 2048\r\nvg_cn0008-var: 0 20480000 linear 8:17 59803648\r\neuca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-prt-92280ext3-a7a25811-p0-snap: 0 188989440 snapshot 253:11 253:12 N 16\r\neuca-zero: 0 2199023255552 zero \r\neuca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-emi-55c368ed-a8eece66-p0-snap: 0 20725760 snapshot 7:0 253:5 N 16\r\nvg_cn0008-swap: 0 49561600 linear 8:17 10242048\r\nvg_cn0008-root: 0 40960000 linear 8:17 80283648\r\neuca-prt-92280ext3-a7a25811-p0-back: 0 188989440 linear 7:2 0\r\n[root@cn0008 instances]# find /var/lib/eucalyptus/instances/cache/\r\n/var/lib/eucalyptus/instances/cache/\r\n/var/lib/eucalyptus/instances/cache/.blobstore\r\n/var/lib/eucalyptus/instances/cache/emi-55c368ed-a8eece66\r\n/var/lib/eucalyptus/instances/cache/emi-55c368ed-a8eece66/blocks\r\n/var/lib/eucalyptus/instances/cache/emi-55c368ed-a8eece66/sig\r\n/var/lib/eucalyptus/instances/cache/emi-55c368ed-a8eece66/refs\r\n/var/lib/eucalyptus/instances/cache/emi-55c368ed-a8eece66/lock\r\n[root@cn0008 instances]# ls -l /dev/mapper/\r\ntotal 0\r\ncrw-rw---- 1 root root 10, 58 Dec 11 14:01 control\r\nlrwxrwxrwx 1 root root      7 Dec 11 22:18 euca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-emi-55c368ed-a8eece66 -> ../dm-7\r\nlrwxrwxrwx 1 root root      7 Dec 11 22:18 euca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-emi-55c368ed-a8eece66-p0-back -> ../dm-5\r\nlrwxrwxrwx 1 root root      7 Dec 11 22:18 euca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-emi-55c368ed-a8eece66-p0-snap -> ../dm-6\r\nlrwxrwxrwx 1 root root      8 Dec 11 22:19 euca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-prt-92280ext3-a7a25811 -> ../dm-14\r\nlrwxrwxrwx 1 root root      8 Dec 11 22:19 euca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-prt-92280ext3-a7a25811-p0-back -> ../dm-12\r\nlrwxrwxrwx 1 root root      8 Dec 11 22:19 euca-AIDQJ6L4KAGGDNXWCD4J5-i-d31bea60-prt-92280ext3-a7a25811-p0-snap -> ../dm-13\r\nlrwxrwxrwx 1 root root      8 Dec 11 22:19 euca-prt-92280ext3-a7a25811 -> ../dm-11\r\nlrwxrwxrwx 1 root root      7 Dec 11 22:18 euca-prt-92280ext3-a7a25811-p0-back -> ../dm-9\r\nlrwxrwxrwx 1 root root      8 Dec 11 22:18 euca-prt-92280ext3-a7a25811-p0-snap -> ../dm-10\r\nlrwxrwxrwx 1 root root      7 Dec 11 22:18 euca-zero -> ../dm-8\r\nlrwxrwxrwx 1 root root      7 Dec 11 14:26 vg_cn0008-localdisk -> ../dm-4\r\nlrwxrwxrwx 1 root root      7 Dec 11 14:26 vg_cn0008-root -> ../dm-1\r\nlrwxrwxrwx 1 root root      7 Dec 11 14:26 vg_cn0008-swap -> ../dm-0\r\nlrwxrwxrwx 1 root root      7 Dec 11 14:26 vg_cn0008-tmp -> ../dm-2\r\nlrwxrwxrwx 1 root root      7 Dec 11 14:26 vg_cn0008-var -> ../dm-3\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"created":"2014-12-11T21:37:38.126-0600","updated":"2014-12-11T21:37:38.126-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/80616","id":"80616","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"[~shl1@cornell.edu],\r\n\r\nYou mind providing a sosreport from the NC when you see this issue?  Something that sticks out here - I see from your 'losetup -a' output, you have /localhost/eucalyptus/instances/(work|cache) - yet the output you have under /var/lib/eucalyptus/instances has the cache and work directories.  Are you doing any symbolic linking here?  Did you change INSTANCE_PATH in the eucalyptus.conf on the NC recently?  ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-17T13:49:11.485-0600","updated":"2014-12-17T13:49:11.485-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/80618","id":"80618","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"body":"Hi I captured a sosreport after I recreated the problem here:\r\n\r\nhttps://drive.google.com/file/d/0B5zK8EQCFbo1eVRrVzlkRXRMaGc\r\n\r\nThere is a symbolic link:\r\n\r\n[root@cn0008 ~]# ls -ld /var/lib/eucalyptus\r\nlrwxrwxrwx 1 root root 21 Sep 25 15:29 /var/lib/eucalyptus -> /localdisk/eucalyptus\r\n\r\nWe set up our nodes with this symbolic link in Euca 3.4.2 with no ill effects. Is this a problem?\r\n\r\n\r\nSteven\r\n\r\nOn Dec 17, 2014, at 2:50 PM, Harold Spencer Jr. (JIRA) <jira@eucalyptus.atlassian.net<mailto:jira@eucalyptus.atlassian.net>> wrote:\r\n\r\n\r\n   [ https://eucalyptus.atlassian.net/browse/EUCA-10214?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&focusedCommentId=80616#comment-80616 ]\r\n\r\nHarold Spencer Jr. commented on EUCA-10214:\r\n-------------------------------------------\r\n\r\n[~shl1@cornell.edu<mailto:shl1@cornell.edu>],\r\n\r\nYou mind providing a sosreport from the NC when you see this issue?  Something that sticks out here - I see from your 'losetup -a' output, you have /localhost/eucalyptus/instances/(work|cache) - yet the output you have under /var/lib/eucalyptus/instances has the cache and work directories.  Are you doing any symbolic linking here?  Did you change INSTANCE_PATH in the eucalyptus.conf on the NC recently?\r\n\r\nNode left in bad state after restarting eucalyptus-nc service with instances running\r\n------------------------------------------------------------------------------------\r\n\r\n               Key: EUCA-10214\r\n               URL: https://eucalyptus.atlassian.net/browse/EUCA-10214\r\n           Project: Eucalyptus\r\n        Issue Type: Bug\r\n        Components: Node Controller\r\n  Affects Versions: 4.0.2\r\n       Environment: Eucalyptus 4.0.2 in edge mode. CLC/Walrus host and CC/SC host and NC are all running CentOS 6.5.\r\n          Reporter: Steven Lee\r\n          Assignee: Dmitrii Zagorodnov\r\n       Attachments: nc.log, nc.log\r\n\r\n\r\nHere's how I reproduced the problem:\r\n1) On a working NC running eucalyptus 4.0.2, I started an instance using an instance-store image. In nc.log, I saw NC downloaded the image and booted the instance. I verified the instance rans correctly.\r\n2) ON the same NC, I started another instance using the same image. This time the log shows NC booted the instance immediately off the cache (as expected) without downloading. I verified the second instance ran correctly.\r\n2) Restart NC using \"service eucalyptus-nc restart\".\r\n3) After the NC service is running, I started a third instance using the same image. The log showed the NC actually downloaded another copy of the image, tried the boot it but failed.\r\n4) All subsequent attempts of booting the same image on the NC failed (nc.log in EXTREME level attached).\r\n5) However, I could boot instances off images that were not running on the NC when I restarted the service.\r\n6) The only way to rectify the problem (i.e. being able to boot more instances using the first image) was to reboot the node.\r\n\r\n\r\n\r\n--\r\nThis message was sent by Atlassian JIRA\r\n(v6.4-OD-12-026#64007)\r\n\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"created":"2014-12-17T15:10:53.589-0600","updated":"2014-12-17T15:10:53.589-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/80620","id":"80620","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"[~shl1@cornell.edu],\r\n\r\nLooks like your perms is a bit off:\r\n\r\n{code}\r\nroot@cn0008 ~# ls -ld /var/lib/eucalyptus\r\nlrwxrwxrwx 1 root root 21 Sep 25 15:29 /var/lib/eucalyptus -> /localdisk/eucalyptus\r\n{code}\r\n\r\nEverything should be owned by the \"eucalyptus\" user.  For example:\r\n\r\n{code}\r\nroot@cn0008 ~# ls -ld /var/lib/eucalyptus\r\nlrwxrwxrwx 1 eucalyptus eucalyptus 21 Sep 25 15:29 /var/lib/eucalyptus -> /localdisk/eucalyptus\r\n{code}","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-17T15:23:26.636-0600","updated":"2014-12-17T15:24:23.408-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/80641","id":"80641","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"body":"Hi,\r\n\r\nI fixed the ownership of the symbolic link but the problem still persisted. However, you were onto something about that symbolic link.\r\n\r\nI reconfigured the node so we no longer use a symbolic link at /var/lib/eucalyptus:\r\n\r\n1) I use /localdisk/eucalyptus/instances for instance path and modified /etc/eucalyptus/eucalytpus.conf to read:\r\n\r\nINSTANCE_PATH=\"/localdisk/eucalyptus/instances\"\r\n\r\n2) I copied the rest of /localdisk/eucalyptus (except for instances sub-directory) to /var/lib/eucalyptus.\r\n\r\nNow I could restart eucalyptus-nc with an instance running and start more instances after the restart. During eucalyptus-nc restart, all loopback devices detach error messages in nc.log went away as well. The second instance ran straight from the cache and started almost instantly.\r\n\r\nI am happy with this new configuration. I will configure the other 2 nodes to run this way tomorrow. I have no idea why using a symbolic link for /var/lib/eucalyptus would cause such a big problem. (It worked fine in Euca 4.3.2).\r\n\r\nThanks for your help.\r\n\r\n\r\nSteven\r\n\r\nOn Dec 17, 2014, at 4:25 PM, Harold Spencer Jr. (JIRA) <jira@eucalyptus.atlassian.net<mailto:jira@eucalyptus.atlassian.net>> wrote:\r\n\r\n\r\n   [ https://eucalyptus.atlassian.net/browse/EUCA-10214?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&focusedCommentId=80620#comment-80620 ]\r\n\r\nHarold Spencer Jr. edited comment on EUCA-10214 at 12/17/14 3:24 PM:\r\n---------------------------------------------------------------------\r\n\r\n[~shl1@cornell.edu<mailto:shl1@cornell.edu>],\r\n\r\nLooks like your perms is a bit off:\r\n\r\n{code}\r\nroot@cn0008 ~# ls -ld /var/lib/eucalyptus\r\nlrwxrwxrwx 1 root root 21 Sep 25 15:29 /var/lib/eucalyptus -> /localdisk/eucalyptus\r\n{code}\r\n\r\nEverything should be owned by the \"eucalyptus\" user.  For example:\r\n\r\n{code}\r\nroot@cn0008 ~# ls -ld /var/lib/eucalyptus\r\nlrwxrwxrwx 1 eucalyptus eucalyptus 21 Sep 25 15:29 /var/lib/eucalyptus -> /localdisk/eucalyptus\r\n{code}\r\n\r\n\r\nwas (Author: hspencer):\r\n[~shl1@cornell.edu<mailto:shl1@cornell.edu>],\r\n\r\nLooks like your perms is a bit off:\r\n\r\n{code}\r\nroot@cn0008 ~# ls -ld /var/lib/eucalyptus\r\nlrwxrwxrwx 1 root root 21 Sep 25 15:29 /var/lib/eucalyptus -> /localdisk/eucalyptus\r\n{code}\r\n\r\nShould be owned by the \"eucalyptus\" user.  For example:\r\n\r\n{code}\r\nroot@cn0008 ~# ls -ld /var/lib/eucalyptus\r\nlrwxrwxrwx 1 eucalyptus eucalyptus 21 Sep 25 15:29 /var/lib/eucalyptus -> /localdisk/eucalyptus\r\n{code}\r\n\r\nNode left in bad state after restarting eucalyptus-nc service with instances running\r\n------------------------------------------------------------------------------------\r\n\r\n               Key: EUCA-10214\r\n               URL: https://eucalyptus.atlassian.net/browse/EUCA-10214\r\n           Project: Eucalyptus\r\n        Issue Type: Bug\r\n        Components: Node Controller\r\n  Affects Versions: 4.0.2\r\n       Environment: Eucalyptus 4.0.2 in edge mode. CLC/Walrus host and CC/SC host and NC are all running CentOS 6.5.\r\n          Reporter: Steven Lee\r\n          Assignee: Dmitrii Zagorodnov\r\n       Attachments: nc.log, nc.log\r\n\r\n\r\nHere's how I reproduced the problem:\r\n1) On a working NC running eucalyptus 4.0.2, I started an instance using an instance-store image. In nc.log, I saw NC downloaded the image and booted the instance. I verified the instance rans correctly.\r\n2) ON the same NC, I started another instance using the same image. This time the log shows NC booted the instance immediately off the cache (as expected) without downloading. I verified the second instance ran correctly.\r\n2) Restart NC using \"service eucalyptus-nc restart\".\r\n3) After the NC service is running, I started a third instance using the same image. The log showed the NC actually downloaded another copy of the image, tried the boot it but failed.\r\n4) All subsequent attempts of booting the same image on the NC failed (nc.log in EXTREME level attached).\r\n5) However, I could boot instances off images that were not running on the NC when I restarted the service.\r\n6) The only way to rectify the problem (i.e. being able to boot more instances using the first image) was to reboot the node.\r\n\r\n\r\n\r\n--\r\nThis message was sent by Atlassian JIRA\r\n(v6.4-OD-12-026#64007)\r\n\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"created":"2014-12-17T22:09:53.573-0600","updated":"2014-12-17T22:09:53.573-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/81026","id":"81026","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"body":"Update: I fixed this problem by removing the use of the symbolic link /var/lib/eucalyptus to /localdisk hosted a larger disk volume. After the symbolic link is removed, all the error messages in nc.log went away and I can restart eucalyptus-nc without issues.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=shl1%40cornell.edu","name":"shl1@cornell.edu","key":"shl1@cornell.edu","accountId":"557058:8f59fb40-eb43-4f07-aa9b-4cb9f8019714","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/42f6dd3a4d305212fd8179d125b823db?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Steven Lee","active":true,"timeZone":"America/New_York"},"created":"2015-01-05T09:17:01.266-0600","updated":"2015-01-05T09:17:01.266-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/33752/comment/81061","id":"81061","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"body":"Thanks for the update, [~shl1@cornell.edu]. I am also surprised that this stopped working in 4.0. That said, we are not testing this use case.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"created":"2015-01-05T14:57:08.291-0600","updated":"2015-01-05T14:57:08.291-0600"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-10214/votes","votes":0,"hasVoted":false},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}