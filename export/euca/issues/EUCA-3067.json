{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"14890","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/14890","key":"EUCA-3067","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14811&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":14811},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/10001","id":"10001","description":"This issue won't be actioned.","name":"Won't Do"},"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10207","value":"Ubuntu Precise","id":"10207"}],"customfield_11401":null,"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10306","value":"System","id":"10306"}],"customfield_11400":null,"customfield_10104":[],"customfield_10105":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10101","value":"No","id":"10101"},"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":null,"customfield_10703":null,"customfield_10308":null,"resolutiondate":"2017-06-13T13:30:17.627-0500","customfield_10704":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-3067/watchers","watchCount":5,"isWatching":false},"lastViewed":null,"created":"2012-07-27T00:35:11.670-0500","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"customfield_12400":null,"customfield_12201":null,"customfield_12600":"{}","customfield_10102":null,"labels":["3.4-PM"],"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/10005","id":"10005","description":"Eucalyptus 3.1.0","name":"3.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"customfield_11901":null,"issuelinks":[],"assignee":null,"updated":"2017-06-13T13:30:17.634-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10002","id":"10002","name":"Cloud Controller"}],"timeoriginalestimate":null,"description":"based on this case:\r\nhttps://engage.eucalyptus.com/customer/en/portal/questions/424062-abnormal-server-shutdown-postgres-error-525-return-value-143?new=424062\r\n\r\neucalyptus-cloud start\r\ndoesn't notice when /var/lib/eucalyptus/db is a read-only filesystem, user output is [OK] and startup.log and cloud-output.log do NOT point to the real root cause\r\n\r\nCase is easy to reproduce (put /var/lib/eucalyptus on a separate filesystem and mount -r /dev/... )\r\n- and likely to happen to other users (power-off abnormal system shutdown, power outage, silent filesystem corruption):\r\n\r\nThis is what has happened (to me):\r\n1.) Euca box was accidentally power-off (abnormal system shutdown).\r\n2.) On next power-on Linux tries to check/fixx all unclean dismounted filesystems by fsck\r\n3.) in this particular case /var/lib/eucalyptus was a filesystem of its own - and fsck failed to fix inconsistencies automatically - as a consequence this filesystem was mounted as \"read-only\"\r\n4.) euca-services started as usual on system start-up ... but didn't really notice that filesystem was readonly\r\n5.) on bootstrap:SYSTEM_DIR_CHECK:TX and SYSTEM_DIR_CREATE:TX process was faced the fact that filesys was readonly - and died/hang without useful error message in cloud-output.log or startup.log\r\n6.) service eucalyptus-cloud start didn't notice any problems either and responded [OK]","customfield_13000":null,"customfield_13200":null,"customfield_11300":"PRD-42","customfield_11500":null,"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[],"summary":"eucalyptus-cloud start - better diag messages in case of r/o filesystem","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=acmattheis%40gmx.net","name":"acmattheis@gmx.net","key":"acmattheis@gmx.net","accountId":"557058:7ec6da50-a80d-4da5-91b6-98d1bd6a16ad","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Chris Mattheis","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=acmattheis%40gmx.net","name":"acmattheis@gmx.net","key":"acmattheis@gmx.net","accountId":"557058:7ec6da50-a80d-4da5-91b6-98d1bd6a16ad","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/5547212a9fdfdba3aeaf2fc86cdf3116?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Chris Mattheis","active":true,"timeZone":"Europe/Berlin"},"customfield_10000":"5_*:*_1_*:*_0_*|*_10000_*:*_1_*:*_21647439043_*|*_10001_*:*_1_*:*_132363866922","customfield_12100":"0|i01hfb:","aggregateprogress":{"progress":0,"total":0},"customfield_10001":"2012-07-27T06:19:49.614-0500","customfield_10200":null,"customfield_10002":null,"customfield_10003":["Maintainability-PM"],"customfield_10400":null,"customfield_12500":null,"customfield_11600":["agrimm(agrimm)","acmattheis@gmx.net(acmattheis@gmx.net)"],"customfield_10116":null,"customfield_10117":null,"environment":"euca3.1 community edition on Ubuntu 12.04 LTS","customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/14890/comment/30403","id":"30403","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=agrimm","name":"agrimm","key":"agrimm","accountId":"557058:9ebc3512-73d8-45c9-85de-4325aaa62488","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue"},"displayName":"Andy Grimm","active":false,"timeZone":"America/New_York"},"body":"Thanks for filing this.  Here are my thoughts on the issue (I'll try to get other engineers to weigh in as well):\n\nFor at least one other service (the node controller), we do a set of \"pre-flight checks\", and it's possible that we could do something in the eucalyptus-cloud start-up to catch errors like this early (before the init script returns \"okay\").  However, since there are more than a dozen different places where you could mount a read-only filesystem and break some part of eucalyptus's operation, I'm not sure that checking them one-by-one is feasible.  Perhaps we could get a list of mounts from /proc/mounts, check which are read-only, and decide whether any of them matter.  Even that is difficult, though, due to the possible existence of symlinks across filesystems.\n\nThe other approach, instead of \"pre-flight checks\", would be to wait until an operation fails due to an unexpected read-only filesystem, and shut down the services when that happens (and log the reason, of course).  The way our init script currently works, though, it would still return \"OK\" in this case.  The reason is that prior to the days of parallelized init processes such as upstart and systemd, most people preferred to see a complex service daemonize quickly so that other init scripts could run.  For modern Linux systems, taking longer to report success or failure may be okay, since other init scripts can be running concurrently.\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=agrimm","name":"agrimm","key":"agrimm","accountId":"557058:9ebc3512-73d8-45c9-85de-4325aaa62488","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue"},"displayName":"Andy Grimm","active":false,"timeZone":"America/New_York"},"created":"2012-07-30T09:22:08.066-0500","updated":"2012-07-30T09:22:08.066-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/14890/comment/42805","id":"42805","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=agrimm","name":"agrimm","key":"agrimm","accountId":"557058:9ebc3512-73d8-45c9-85de-4325aaa62488","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue"},"displayName":"Andy Grimm","active":false,"timeZone":"America/New_York"},"body":"This would be a great check for euca-validator to have.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=agrimm","name":"agrimm","key":"agrimm","accountId":"557058:9ebc3512-73d8-45c9-85de-4325aaa62488","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/0e947b5413f5d57fba29a8ea5412f773?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dagrimm%26avatarId%3D10500%26noRedirect%3Dtrue"},"displayName":"Andy Grimm","active":false,"timeZone":"America/New_York"},"created":"2013-04-03T13:45:50.710-0500","updated":"2013-04-03T13:45:50.710-0500"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-3067/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}