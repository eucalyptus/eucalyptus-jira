{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"62405","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/62405","key":"EUCA-13453","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"resolution":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/12600","value":"RHEL 7","id":"12600"}],"customfield_11401":null,"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/12401","value":"VPC-MIDO","id":"12401"}],"customfield_11400":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10104":[],"customfield_10302":null,"customfield_10303":null,"customfield_10105":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":null,"customfield_10702":null,"customfield_10703":null,"resolutiondate":null,"customfield_10704":null,"customfield_10308":null,"customfield_10705":null,"customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13453/watchers","watchCount":3,"isWatching":false},"lastViewed":null,"created":"2017-11-09T18:22:41.463-0600","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12201":null,"customfield_10300":null,"customfield_12600":"{}","customfield_10102":null,"customfield_10301":null,"labels":[],"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_11901":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/17200","id":"17200","description":"Eucalyptus 4.2.2","name":"4.2.2","archived":false,"released":true,"releaseDate":"2016-04-28"}],"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=tony","name":"tony","key":"tony","accountId":"557058:353956db-b78c-4f3b-9096-f8f58e6709c8","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/14ec1b18e630cc0743492fc327a12df7?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dtony%26avatarId%3D16600%26noRedirect%3Dtrue"},"displayName":"Tony Beckham","active":true,"timeZone":"America/Tijuana"},"updated":"2017-11-15T10:54:13.818-0600","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/10000","description":"This issue has not yet been validated, and is not currently being investigated.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Unconfirmed","id":"10000","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10014","id":"10014","name":"Storage Controller"}],"timeoriginalestimate":null,"customfield_13000":null,"description":"We are having an issue where several terabytes worth of volumes remain on the underlying Ceph storage system even though they have been deleted.\r\n\r\nLooking at {{cloud-output.log}} on the SC node you can see the volume was deleted\r\n{noformat}\r\n# grep vol-b633e986 /var/log/eucalyptus/cloud-output.log*\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:38:51  INFO | Processing CreateStorageVolume request for volume vol-b633e986\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:38:51  INFO | Creating vol-b633e986 on backend\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:38:51  INFO | Creating volume volumeId=vol-b633e986, size=8GB\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:38:51  INFO | Create ceph-rbd image imageName=vol-b633e986, imageSize=8589934592\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:38:56  INFO | Processing GetVolumeToken request for volume vol-b633e986\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:38:57  INFO | Processing ExportVolume request for volume vol-b633e986\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:38:57  INFO | Exporting vol-b633e986 on backend to Node Controller host IQN iqn.1994-05.com.redhat:722e5b327a\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:44:51  INFO | Processing UnexportVolume request for volume vol-b633e986 from node 10.93.4.77 with iqn iqn.199\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:44:51  INFO | Unexporting vol-b633e986 on backend from Node Controller host IQN iqn.1994-05.com.redhat:722e5b\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:45:07  INFO | Processing DeleteStorageVolume request for volume vol-b633e986\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:45:23  INFO | Volume: vol-b633e986 was marked for deletion. Cleaning up...\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:45:23  INFO | Deleting vol-b633e986 on backend\r\n/var/log/eucalyptus/cloud-output.log.1:2017-11-08 06:45:23  INFO | Deleting volume volumeId=vol-b633e986, volumeIqn=cdc-west-2a-vol/vol-b633e986\r\n{noformat}\r\nHowever looking at the Ceph storage you see the volume is still present\r\n{noformat}\r\n# rbd --name client.eucalyptus --keyring /etc/ceph/ceph.client.eucalyptus.keyring --pool cdc-west-2a-vol ls | grep -c vol-b633e986\r\n1\r\n{noformat}\r\n\r\nCurrently the only workaround I have found is to run a script to check all the volumes on ceph and compare it to all the volumes in the DB. If they exist on Ceph and not in the DB they get deleted. Is there a cleanup method within Eucalyptus which does the equivalent to locate stale volumes on the underlyaing storage?\r\n\r\n","customfield_13200":null,"customfield_11300":null,"customfield_11500":null,"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"security":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"Volumes not deleting on backend","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=jgallucci32","name":"jgallucci32","key":"jgallucci32","accountId":"557058:1cd98ee4-b2ee-4683-a315-2a6abd75b048","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"John Gallucci","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=jgallucci32","name":"jgallucci32","key":"jgallucci32","accountId":"557058:1cd98ee4-b2ee-4683-a315-2a6abd75b048","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/31cfdf964a6ac26962c22f3279e2c85c?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"John Gallucci","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":null,"customfield_12100":"0|i0456n:","customfield_10001":"2017-11-13T19:06:42.682-0600","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_10116":null,"customfield_11600":["jgallucci32(jgallucci32)","lincoln.thomas(lincoln.thomas)","sjones(sjones)","tony(tony)"],"environment":null,"customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"duedate":null,"customfield_11805":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/62405/comment/128055","id":"128055","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"body":"When the volume is deleted from ceph you will see the log message:\r\n\r\n{code}\r\nINFO | Deleting image=delTM87D7QD-vol-a4a0933d, pool=eucaqa_vol\r\n{code}\r\n\r\nwhen there are snapshots of a volume then that volume cannot be safely deleted and it will instead be renamed for later deletion:\r\n\r\n{code}\r\n#\r\n# rbd --name client.qauser --keyring /etc/ceph/ceph.client.qauser.keyring --pool eucaqa_vol ls | grep vol-a4a0933d\r\ndelTM87D7QD-vol-a4a0933d\r\n#\r\n#\r\n{code}\r\n\r\nin the above example the deletion prefix is \"delTM87D7QD-\".\r\n\r\nWhen the snapshots of the volume have been deleted then it is safe to remove the volume from ceph and deletion will occur after a short period.\r\n\r\nTo locate snapshots for a volume you can use:\r\n\r\n{code}\r\n# euca-describe-snapshots --filter volume-id=vol-d81ae62a verbose\r\n{code}\r\n\r\nwhich should be run as cloud administrator to show snapshots for volumes in any account.","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=sjones","name":"sjones","key":"sjones","accountId":"557058:f5dce1b0-db45-4dd6-a0e8-3cea5effb5ce","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/037fddf6d3bf6d691a448e01136f233a?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dsjones%26avatarId%3D18300%26noRedirect%3Dtrue"},"displayName":"Steve Jones","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-11-13T19:06:42.682-0600","updated":"2017-11-13T19:06:42.682-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/62405/comment/128056","id":"128056","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jgallucci32] so this appears to be working as designed, if you get the same results as [~sjones]. Also, you marked this as 4.2.2. Is that correct?","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=lincoln.thomas","name":"lincoln.thomas","key":"lincoln.thomas","accountId":"557058:f9364c00-87ee-4948-b657-bb8f8f2030ea","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/c21bba9797b880c34a5d772e6db4664f?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dlincoln.thomas%26avatarId%3D17800%26noRedirect%3Dtrue"},"displayName":"Lincoln Thomas","active":true,"timeZone":"America/Los_Angeles"},"created":"2017-11-14T12:45:52.769-0600","updated":"2017-11-14T12:45:52.769-0600"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-13453/votes","votes":0,"hasVoted":false},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}