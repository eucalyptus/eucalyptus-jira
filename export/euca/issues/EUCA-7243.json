{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"23211","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/23211","key":"EUCA-7243","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10209","value":"CentOS 6","id":"10209"}],"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_10311":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10307","value":"Managed","id":"10307"}],"customfield_11401":null,"customfield_11400":null,"customfield_10104":[],"customfield_10302":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10105":null,"customfield_10303":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10702":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10200","value":"High","id":"10200"},"customfield_10703":null,"customfield_10704":null,"customfield_10308":null,"resolutiondate":"2014-01-16T16:34:31.024-0600","customfield_10309":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10204","value":"KVM","id":"10204"}],"customfield_10705":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-7243/watchers","watchCount":4,"isWatching":false},"lastViewed":null,"created":"2013-08-12T16:53:42.655-0500","customfield_12000":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/3","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_12400":null,"customfield_12201":null,"customfield_10300":null,"customfield_10102":null,"customfield_12600":"{}","labels":[],"customfield_10301":null,"customfield_11700":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12106","id":"12106","description":"Eucalyptus 3.3.1","name":"3.3.1","archived":false,"released":true,"releaseDate":"2013-08-27"}],"customfield_11901":null,"issuelinks":[{"id":"22550","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLink/22550","type":{"id":"10102","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://eucalyptus.atlassian.net/rest/api/2/issueLinkType/10102"},"inwardIssue":{"id":"25612","key":"EUCA-8366","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/25612","fields":{"summary":"Security group rules with CIDR source ip ranges should also apply between security groups","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/4","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803}}}}],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"updated":"2015-05-08T17:14:27.213-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10003","id":"10003","name":"Cluster Controller"}],"timeoriginalestimate":null,"description":"Working on adding a multi-cluster eutester script to our Multi-cluster automated runs. It seems the following test is failing when security group 'net_tests_group2' is authorized for access from security group 'net_tests_group1':\r\n\r\n(instance1:security group1: zone1) --ssh--> ((instance2:security group2: zone2)\r\n\r\nVerified manually as well. Note, the 2 CC's are on the same l2 segment, so are not using tunneling. \r\n\r\n\r\n{code}\r\n[root@c-34 ~]# euca-describe-group net_tests_group2_1376341955.66\r\nGROUP\tsg-0B0D4138\t109707466405\tnet_tests_group2_1376341955.66\tnet_tests_group2_1376341955.66\t\r\nPERMISSION\t109707466405\tnet_tests_group2_1376341955.66\tALLOWS\tudp\t1\t65535\tFROM\tUSER\t109707466405\tID\tsg-D88841C2\tingress\r\nPERMISSION\t109707466405\tnet_tests_group2_1376341955.66\tALLOWS\ttcp\t1\t65535\tFROM\tUSER\t109707466405\tID\tsg-D88841C2\tingress\r\nPERMISSION\t109707466405\tnet_tests_group2_1376341955.66\tALLOWS\ticmp\t-1\t-1\tFROM\tUSER\t109707466405\tID\tsg-D88841C2\tingress\r\n\r\n[root@c-34 ~]# euca-describe-group net_tests_group1_1376341955.38\r\nGROUP\tsg-D88841C2\t109707466405\tnet_tests_group1_1376341955.38\tnet_tests_group1_1376341955.38\t\r\nPERMISSION\t109707466405\tnet_tests_group1_1376341955.38\tALLOWS\ttcp\t22\t22\tFROM\tCIDR\t0.0.0.0/0\tingress\r\n{code}\r\n\r\nOutput from test:\r\n{code}\r\n-------------------------------------------------------------------------\r\n[2013-08-12 14:20:07,601] [net_tests] [DEBUG]: (test6_test_ssh_between_instances_in_diff_sec_groups_different_zone:501): \r\n-------------------------------------------------------------------------\r\nAuthorizing group2:net_tests_group2_1376341955.66 for access from group1:net_tests_group1_1376341955.38\r\n-------------------------------------------------------------------------\r\n[2013-08-12 14:20:07,601] [EUCAOPS] [DEBUG]: \r\n--->(ec2ops.py:418)Starting method: authorize_group_by_name(self, group_name=net_tests_group2_1376341955.66, port=None, protocol=tcp, cidr_ip=None, src_security_group=None, src_security_group_name=net_tests_group1_1376341955.38, src_security_group_owner_id=None, force_args=False)\r\n[2013-08-12 14:20:07,699] [EUCAOPS] [DEBUG]: Found matching security group for name:net_tests_group1_1376341955.38 and id:None\r\n[2013-08-12 14:20:07,699] [EUCAOPS] [DEBUG]: Attempting authorization of net_tests_group2_1376341955.66 from net_tests_group1_1376341955.38 on port None None\r\n[2013-08-12 14:20:07,814] [net_tests] [DEBUG]: (test6_test_ssh_between_instances_in_diff_sec_groups_different_zone:514): Grabbing  a single instance from each zone and from each test security group to use in this test...\r\n[2013-08-12 14:20:07,818] [net_tests] [DEBUG]: (test6_test_ssh_between_instances_in_diff_sec_groups_different_zone:535): \r\n-------------------------------------------------------------------------\r\nChecking connectivity for instances in each zone, in separate but authorized security groups...\r\n-------------------------------------------------------------------------\r\n[2013-08-12 14:20:07,822] [net_tests] [DEBUG]: (test6_test_ssh_between_instances_in_diff_sec_groups_different_zone:551): Attempting to run ssh command \"uname -a\" between instances across zones and security groups:\r\ni-48743CCD/sec grps([SecurityGroup:net_tests_group1_1376341955.38]) --> i-5F7945C2/sec grps([SecurityGroup:net_tests_group2_1376341955.66])\r\nCurrent test run in zones: PARTI00-->PARTI01\r\n[2013-08-12 14:20:07,825] [net_tests] [DEBUG]: (test6_test_ssh_between_instances_in_diff_sec_groups_different_zone:552): Check some debug information re this data connection in this security group first...\r\n[2013-08-12 14:20:07,825] [EUCAOPS] [DEBUG]: \r\n--->(ec2ops.py:2611)Starting method: does_instance_sec_group_allow(self, src_addr=1.102.165.73, protocol=tcp, port=22)\r\n[2013-08-12 14:20:07,825] [EUCAOPS] [DEBUG]: Using src_addr:1.102.165.73\r\n[2013-08-12 14:20:07,825] [EUCAOPS] [DEBUG]: Is src_addr:1.102.165.73 allowed in group:net_tests_group2_1376341955.66...?\r\n[2013-08-12 14:20:07,825] [EUCAOPS] [DEBUG]: \r\n--->(ec2ops.py:2657)Starting method: does_sec_group_allow(self, group=SecurityGroup:net_tests_group2_1376341955.66, src=1.102.165.73, protocol=tcp, port=22)\r\n[2013-08-12 14:20:07,905] [EUCAOPS] [DEBUG]: Found matching security group for name:net_tests_group2_1376341955.66 and id:sg-0B0D4138\r\n[2013-08-12 14:20:07,905] [EUCAOPS] [DEBUG]: rule#1: port:65535, grants:net_tests_group1_1376341955.38-109707466405,\r\n[2013-08-12 14:20:07,905] [EUCAOPS] [DEBUG]: does_sec_group_allow? False\r\n[2013-08-12 14:20:07,905] [EUCAOPS] [DEBUG]: Sec does NOT allow from source\r\n[2013-08-12 14:20:07,908] [net_tests] [DEBUG]: (test6_test_ssh_between_instances_in_diff_sec_groups_different_zone:557): Now Running the ssh command...\r\n[2013-08-12 14:20:07,909] [i-48743CCD] [DEBUG]: [root@10.111.101.160]# ssh -o StrictHostKeyChecking=no -i net_tests_key_1376108572.22.pem root@1.102.166.124 ' uname -a'\r\n[2013-08-12 14:21:11,127] [i-48743CCD] [DEBUG]: \r\nssh: connect to host 1.102.166.124 port 22: Connection timed out\r\n\r\n[2013-08-12 14:21:11,178] [i-48743CCD] [DEBUG]: done with exec\r\n[2013-08-12 14:21:11,178] [i-48743CCD] [DEBUG]: ['ssh: connect to host 1.102.166.124 port 22: Connection timed out', '']\r\n{code}\r\n-------------------------------------------------------------------------------------------------------------\r\nOutput from Manual test after freezing the above test:\r\n---------------------------------------------------------------------------------------------------------------\r\n{code}\r\nIn [17]: ins = nt.group1_instances[0]\r\n\r\nIn [18]: ins.id\r\nOut[18]: u'i-48743CCD'\r\n\r\nIn [19]: ins.ssh.start_interactive()\r\nOpened channel, starting interactive mode...\r\nroot@i:~# ping 1.102.166.124 \r\nPING 1.102.166.124 (1.102.166.124) 56(84) bytes of data.\r\n^C\r\n--- 1.102.166.124 ping statistics ---\r\n5 packets transmitted, 0 received, 100% packet loss, time 3999ms\r\n\r\n{code}\r\n\r\n---------------------------------------------------------------------------------------------------------------\r\niptables from cc hosting instance 1:\r\n---------------------------------------------------------------------------------------------------------------\r\n\r\n{code}\r\n\r\n[root@c-34 ~]# euca-describe-instances i-48743CCD\r\nRESERVATION\tr-5C594008\t109707466405\tnet_tests_group1_1376341955.38\r\nINSTANCE\ti-48743CCD\temi-88083AF1\t10.111.101.160\t1.102.165.73\trunning\tnet_tests_key_1376108572.22\t0\t\tm1.small\t2013-08-12T21:13:37.810Z\tPARTI00\teki-C3AD4038\teri-3C0C3C87\t\tmonitoring-disabled\t10.111.101.160\t1.102.165.73\t\t\tinstance-store\t\t\t\t\t\t\t\r\nTAG\tinstance\ti-48743CCD\teuca:node\t10.111.1.71\r\n\r\n[root@c-35 ~]# iptables -L\r\nChain INPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\n\r\nChain FORWARD (policy DROP)\r\ntarget     prot opt source               destination         \r\nEUCA_COUNTERS_OUT  all  --  anywhere             anywhere            \r\nEUCA_COUNTERS_IN  all  --  anywhere             anywhere            \r\nACCEPT     all  --  anywhere             anywhere            ctstate ESTABLISHED \r\nACCEPT     all  --  anywhere            !1.102.128.0/18      \r\nPfUI7PGfuPci65PMSzgVLA==  all  --  anywhere             anywhere            \r\nACCEPT     all  --  1.102.161.112/28     1.102.161.112/28    \r\nf/s2F9weFK96rduWfZzHZw==  all  --  anywhere             anywhere            \r\nACCEPT     all  --  1.102.165.64/28      1.102.165.64/28     \r\n979pti8huiq2YWl+RogrPQ==  all  --  anywhere             anywhere            \r\nACCEPT     all  --  1.102.166.112/28     1.102.166.112/28    \r\n\r\nChain OUTPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\n\r\nChain 979pti8huiq2YWl+RogrPQ== (1 references)\r\ntarget     prot opt source               destination         \r\nACCEPT     udp  --  1.102.165.64/28      1.102.166.112/28    udp dpts:tcpmux:65535 \r\nACCEPT     tcp  --  1.102.165.64/28      1.102.166.112/28    tcp dpts:tcpmux:65535 \r\nACCEPT     icmp --  1.102.165.64/28      1.102.166.112/28    icmp any \r\n\r\nChain EUCA_COUNTERS_IN (1 references)\r\ntarget     prot opt source               destination         \r\n           all  --  anywhere             1.102.128.0/18      \r\n           all  --  anywhere             1.102.161.123       \r\n           all  --  anywhere             1.102.165.73        \r\n           all  --  anywhere             1.102.166.123       \r\n\r\nChain EUCA_COUNTERS_OUT (1 references)\r\ntarget     prot opt source               destination         \r\n           all  --  1.102.128.0/18       anywhere            \r\n           all  --  1.102.161.123        anywhere            \r\n           all  --  1.102.165.73         anywhere            \r\n           all  --  1.102.166.123        anywhere            \r\n\r\nChain PfUI7PGfuPci65PMSzgVLA== (1 references)\r\ntarget     prot opt source               destination         \r\nACCEPT     tcp  --  1.102.162.124        1.102.161.112/28    tcp dpt:ssh \r\nACCEPT     tcp  --  1.102.162.121        1.102.161.112/28    tcp dpt:ssh \r\n\r\nChain f/s2F9weFK96rduWfZzHZw== (1 references)\r\ntarget     prot opt source               destination         \r\nACCEPT     tcp  --  anywhere             1.102.165.64/28     tcp dpt:ssh \r\n[root@c-35 ~]# iptables -L -t nat\r\nChain PREROUTING (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nDNAT       tcp  --  anywhere             169.254.169.254     tcp dpt:http to:10.111.1.69:8773 \r\nDNAT       all  --  anywhere             10.111.101.162      to:1.102.161.123 \r\nDNAT       all  --  anywhere             10.111.101.160      to:1.102.165.73 \r\nDNAT       all  --  anywhere             10.111.101.164      to:1.102.166.123 \r\n\r\nChain POSTROUTING (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nSNAT       all  --  1.102.166.123        anywhere            to:10.111.101.164 \r\nSNAT       all  --  1.102.165.73         anywhere            to:10.111.101.160 \r\nSNAT       all  --  1.102.161.123        anywhere            to:10.111.101.162 \r\nMASQUERADE  all  --  1.102.128.0/18      !1.102.128.0/18      \r\n\r\nChain OUTPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nDNAT       all  --  anywhere             10.111.101.162      to:1.102.161.123 \r\nDNAT       all  --  anywhere             10.111.101.160      to:1.102.165.73 \r\nDNAT       all  --  anywhere             10.111.101.164      to:1.102.166.123 \r\n{code}\r\n\r\n---------------------------------------------------------------------------------------------------------------\r\niptables from CC hosting instance 2:\r\n---------------------------------------------------------------------------------------------------------------\r\n\r\n{code}\r\n[root@e-38 ~]# euca-describe-instances i-5F7945C2\r\nRESERVATION\tr-C7C9414B\t109707466405\tnet_tests_group2_1376341955.66\r\nINSTANCE\ti-5F7945C2\temi-88083AF1\t10.111.101.165\t1.102.166.124\trunning\tnet_tests_key_1376108572.22\t0\t\tm1.small\t2013-08-12T21:16:44.219Z\tPARTI01\teki-C3AD4038\teri-3C0C3C87\t\tmonitoring-disabled\t10.111.101.165\t1.102.166.124\t\t\tinstance-store\t\t\t\t\t\t\t\r\nTAG\tinstance\ti-5F7945C2\teuca:node\t10.111.5.105\r\n\r\n[root@e-38 ~]# iptables -L\r\nChain INPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\n\r\nChain FORWARD (policy DROP)\r\ntarget     prot opt source               destination         \r\nEUCA_COUNTERS_OUT  all  --  anywhere             anywhere            \r\nEUCA_COUNTERS_IN  all  --  anywhere             anywhere            \r\nACCEPT     all  --  anywhere             anywhere            ctstate ESTABLISHED \r\nACCEPT     all  --  anywhere            !1.102.128.0/18      \r\nPfUI7PGfuPci65PMSzgVLA==  all  --  anywhere             anywhere            \r\nACCEPT     all  --  1.102.161.112/28     1.102.161.112/28    \r\nf/s2F9weFK96rduWfZzHZw==  all  --  anywhere             anywhere            \r\nACCEPT     all  --  1.102.165.64/28      1.102.165.64/28     \r\n979pti8huiq2YWl+RogrPQ==  all  --  anywhere             anywhere            \r\nACCEPT     all  --  1.102.166.112/28     1.102.166.112/28    \r\n\r\nChain OUTPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\n\r\nChain 979pti8huiq2YWl+RogrPQ== (1 references)\r\ntarget     prot opt source               destination         \r\nACCEPT     udp  --  1.102.165.64/28      1.102.166.112/28    udp dpts:tcpmux:65535 \r\nACCEPT     tcp  --  1.102.165.64/28      1.102.166.112/28    tcp dpts:tcpmux:65535 \r\nACCEPT     icmp --  1.102.165.64/28      1.102.166.112/28    icmp any \r\n\r\nChain EUCA_COUNTERS_IN (1 references)\r\ntarget     prot opt source               destination         \r\n           all  --  anywhere             1.102.128.0/18      \r\n           all  --  anywhere             1.102.161.125       \r\n           all  --  anywhere             1.102.165.77        \r\n           all  --  anywhere             1.102.166.124       \r\n\r\nChain EUCA_COUNTERS_OUT (1 references)\r\ntarget     prot opt source               destination         \r\n           all  --  1.102.128.0/18       anywhere            \r\n           all  --  1.102.161.125        anywhere            \r\n           all  --  1.102.165.77         anywhere            \r\n           all  --  1.102.166.124        anywhere            \r\n\r\nChain PfUI7PGfuPci65PMSzgVLA== (1 references)\r\ntarget     prot opt source               destination         \r\nACCEPT     tcp  --  1.102.162.124        1.102.161.112/28    tcp dpt:ssh \r\nACCEPT     tcp  --  1.102.162.121        1.102.161.112/28    tcp dpt:ssh \r\n\r\nChain f/s2F9weFK96rduWfZzHZw== (1 references)\r\ntarget     prot opt source               destination         \r\nACCEPT     tcp  --  anywhere             1.102.165.64/28     tcp dpt:ssh \r\n[root@e-38 ~]# iptables -L -t nat\r\nChain PREROUTING (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nDNAT       tcp  --  anywhere             169.254.169.254     tcp dpt:http to:10.111.1.69:8773 \r\nDNAT       all  --  anywhere             10.111.101.163      to:1.102.161.125 \r\nDNAT       all  --  anywhere             10.111.101.161      to:1.102.165.77 \r\nDNAT       all  --  anywhere             10.111.101.165      to:1.102.166.124 \r\n\r\nChain POSTROUTING (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nSNAT       all  --  1.102.166.124        anywhere            to:10.111.101.165 \r\nSNAT       all  --  1.102.165.77         anywhere            to:10.111.101.161 \r\nSNAT       all  --  1.102.161.125        anywhere            to:10.111.101.163 \r\nMASQUERADE  all  --  1.102.128.0/18      !1.102.128.0/18      \r\n\r\nChain OUTPUT (policy ACCEPT)\r\ntarget     prot opt source               destination         \r\nDNAT       all  --  anywhere             10.111.101.163      to:1.102.161.125 \r\nDNAT       all  --  anywhere             10.111.101.161      to:1.102.165.77 \r\nDNAT       all  --  anywhere             10.111.101.165      to:1.102.166.124 \r\n{code}","customfield_13000":null,"customfield_13200":null,"customfield_11300":null,"customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"timetracking":{},"customfield_10005":null,"customfield_10401":null,"customfield_10600":null,"customfield_12900":null,"aggregatetimeestimate":null,"attachment":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/attachment/17307","id":"17307","filename":"10_111_5_7_em1_icmp_reply.pcap","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-01T18:58:42.967-0500","size":720,"mimeType":"application/vnd.tcpdump.pcap","content":"https://eucalyptus.atlassian.net/secure/attachment/17307/10_111_5_7_em1_icmp_reply.pcap"}],"summary":"Can not communicate over private net diff security groups and different zones","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_10000":"3_*:*_1_*:*_521018751_*|*_10001_*:*_2_*:*_12789495781_*|*_10000_*:*_1_*:*_256733887_*|*_5_*:*_1_*:*_0","customfield_12100":"0|i02847:","customfield_10001":"2013-09-23T21:41:45.967-0500","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_11600":["chuck(chuck)","nurmi(nurmi)","mclark(mclark)"],"customfield_10116":null,"environment":"10.111.1.69\tCENTOS\t6.3\t64\tBZR\t[CLC WS UI]\r\n10.111.1.70\tCENTOS\t6.3\t64\tBZR\t[CC00 SC00]\r\n10.111.1.71\tCENTOS\t6.3\t64\tBZR\t[NC00]\r\n10.111.1.99\tCENTOS\t6.3\t64\tBZR\t[NC00]\r\n10.111.5.95\tCENTOS\t6.3\t64\tBZR\t[CC01 SC01]\r\n10.111.5.105\tVMWARE\tESXI-5.0\t64\tBZR\t[NC01]","customfield_10117":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"customfield_11806":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/23211/comment/54628","id":"54628","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"body":"pcap from PARTI01 cc capturing icmp reply from instance in PARTI00","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=mclark","name":"mclark","key":"mclark","accountId":"557058:9b68e4d6-90d8-47d3-9c86-519770009164","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/4227b07e7ea0ea725670fc4e987ed04d?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"Matt Clark","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-01T18:58:42.972-0500","updated":"2013-10-01T18:58:42.972-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/23211/comment/54629","id":"54629","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=nurmi","name":"nurmi","key":"nurmi","accountId":"557058:68718820-f5e0-4305-a46c-f867a6bc9565","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue"},"displayName":"Daniel Nurmi","active":true,"timeZone":"US/Central"},"body":"okay, i've dug into the existing setup - thanks matt, that is invaluable!\r\n\r\nI believe there are two things happening at once preventing this action from happening.  In neither case do I believe this behavior is new, and so I can't consider this a regression unless we go all the way back, many many versions ago (and even then, only maybe..)\r\n\r\n1) At some point, the SNAT rules were elevated in priority and made to match even if destination traffic was going to internal IPs (I believe this was for making a source IP appear as though it were coming from the elastic IP instead of the private IP).  This is problem since the rules that are installed as a consequence of authorize (when using source group/user instead of CIDR) use the private subnet of the originating sec. group.  So, this is problem one.  \r\n\r\nfaking the above out, by replacing the SNAT rules with ones that only SNAT to el. IP if the destination is not private...\r\n\r\n2) there is a conntrack rule in place that is not sufficient for this case.  the conntrack rule is meant to handle ESTABLISHED,RELATED connections, but the last hop (destination CC, destination VM vlan interface) is never seeing the traffic from the source.  If we change the FORWARD policy on the destination CC to 'ALLOW', then the connection goes all the way through, and so we know that none of the ACCEPT rules in the FORWARD chain are matching.\r\n\r\nThis issue will require further investigation in terms of coming up with a fix.  I believe the the issue is entirely related to iptables rule ordering and implementation.  Right at this moment, I do not have a fix or workaround for this issue, in mind.\r\n\r\n","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=nurmi","name":"nurmi","key":"nurmi","accountId":"557058:68718820-f5e0-4305-a46c-f867a6bc9565","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/7ac3bd8409137b5a6a6f8fc7d6e5f94b?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dnurmi%26avatarId%3D10601%26noRedirect%3Dtrue"},"displayName":"Daniel Nurmi","active":true,"timeZone":"US/Central"},"created":"2013-10-01T21:38:55.031-0500","updated":"2013-10-01T21:41:30.470-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/23211/comment/61351","id":"61351","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"body":"Resolving as duplicate of EUCA-8366...","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=chuck","name":"chuck","key":"chuck","accountId":"557058:95e4b012-7cd1-4fd1-995d-eba573d35653","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/39b69736417cafd9d6dddeb1c2e00169?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dchuck%26avatarId%3D12900%26noRedirect%3Dtrue"},"displayName":"Chuck","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-01-16T16:34:31.053-0600","updated":"2014-01-16T16:34:31.053-0600"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-7243/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_11808":null}}