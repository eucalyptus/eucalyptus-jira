{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"30218","self":"https://eucalyptus.atlassian.net/rest/api/2/issue/30218","key":"EUCA-9452","fields":{"issuetype":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://eucalyptus.atlassian.net/secure/viewavatar?size=xsmall&avatarId=14803&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":14803},"timespent":null,"customfield_13100":null,"project":{"self":"https://eucalyptus.atlassian.net/rest/api/2/project/10000","id":"10000","key":"EUCA","name":"Eucalyptus","avatarUrls":{"48x48":"https://eucalyptus.atlassian.net/secure/projectavatar?pid=10000&avatarId=10011","24x24":"https://eucalyptus.atlassian.net/secure/projectavatar?size=small&pid=10000&avatarId=10011","16x16":"https://eucalyptus.atlassian.net/secure/projectavatar?size=xsmall&pid=10000&avatarId=10011","32x32":"https://eucalyptus.atlassian.net/secure/projectavatar?size=medium&pid=10000&avatarId=10011"}},"customfield_11000":null,"fixVersions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/14301","id":"14301","description":"Eucalyptus 4.1.0","name":"4.1.0","archived":false,"released":true,"releaseDate":"2015-01-29"}],"customfield_11001":null,"aggregatetimespent":null,"customfield_10310":null,"resolution":{"self":"https://eucalyptus.atlassian.net/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_11401":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=viglesias","name":"viglesias","key":"viglesias","accountId":"557058:49b276ff-ebf9-4dd6-ada3-b568a2898707","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/5608e0aa05bd6e5d73b855a08079cceb?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dviglesias%26avatarId%3D10405%26noRedirect%3Dtrue"},"displayName":"Victor Iglesias","active":true,"timeZone":"America/Los_Angeles"},"customfield_10311":null,"customfield_11400":null,"customfield_10302":null,"customfield_10500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10403","value":"Not Applicable","id":"10403"},"customfield_10104":[],"customfield_10303":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"customfield_10105":null,"customfield_10700":null,"customfield_10304":null,"customfield_10701":null,"customfield_10306":{"self":"https://eucalyptus.atlassian.net/rest/api/2/customFieldOption/10201","value":"Medium","id":"10201"},"customfield_10702":null,"customfield_10703":null,"resolutiondate":"2015-01-20T13:02:41.207-0600","customfield_10308":null,"customfield_10704":null,"customfield_10309":null,"customfield_10705":null,"workratio":-1,"watches":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-9452/watchers","watchCount":5,"isWatching":false},"lastViewed":null,"created":"2014-05-22T21:24:15.746-0500","customfield_12000":null,"customfield_12400":null,"priority":{"self":"https://eucalyptus.atlassian.net/rest/api/2/priority/2","iconUrl":"https://eucalyptus.atlassian.net/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"customfield_12201":null,"customfield_10300":null,"customfield_12600":"{repository={count=1, dataType=repository}, json={\"cachedValue\":{\"errors\":[],\"summary\":{\"repository\":{\"overall\":{\"count\":1,\"lastUpdated\":\"2014-11-20T04:12:48.000-0600\",\"dataType\":\"repository\"},\"byInstanceType\":{\"github\":{\"count\":1,\"name\":\"GitHub\"}}}}},\"isStale\":true}}","customfield_10102":null,"labels":["4.1-storage","BDM-4.1"],"customfield_10301":null,"customfield_11700":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/version/12105","id":"12105","description":"Eucalyptus 3.4.0","name":"3.4.0","archived":false,"released":true,"releaseDate":"2013-10-24"}],"customfield_11901":null,"issuelinks":[],"assignee":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"updated":"2015-05-08T17:02:03.285-0500","status":{"self":"https://eucalyptus.atlassian.net/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://eucalyptus.atlassian.net/images/icons/statuses/generic.png","name":"Closed","id":"6","statusCategory":{"self":"https://eucalyptus.atlassian.net/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/component/10010","id":"10010","name":"Node Controller"}],"timeoriginalestimate":null,"customfield_13000":null,"description":"After Eucalyptus3.0 the EBS backend Instance have not with ephemeral disk in NC, but the disk resources are still included in used resource. \r\nref: doDescribeResource() in handlers_default.c \r\n---------------------------------------------------------------------\r\nmy suggest is as follow:\r\n----------------------------------------------------------------------\r\nlong long getInstanceEphemeralDiskSize(virtualMachine *vm) {\r\n    for (int i = 0; i < EUCA_MAX_VBRS && i < vm->virtualBootRecordLen; i++) {\r\n        virtualBootRecord *vbr = &(vm->virtualBootRecord[i]);\r\n        if (vbr->locationType == NC_LOCATION_NONE) {\r\n\t\treturn vm->disk;\r\n        }\r\n    }\r\n    return 0;\r\n}\r\n\r\n.................................doDescribeResource()\r\n<-        sum_disk += inst->params.disk;\r\n->        sum_disk += getInstanceEphemeralDiskSize(inst->params);","customfield_13200":null,"customfield_11300":null,"customfield_11500":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"timetracking":{},"customfield_10401":null,"customfield_10005":null,"customfield_10600":null,"customfield_12900":null,"attachment":[],"aggregatetimeestimate":null,"summary":"EBS backend Instance shouldn't allocate the resource of disk in NCs","creator":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=QinWei","name":"QinWei","key":"qinwei","accountId":"557058:37f974f7-a218-48c8-8028-3ca5698c4a9b","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"QinWei","active":true,"timeZone":"US/Central"},"subtasks":[],"reporter":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=QinWei","name":"QinWei","key":"qinwei","accountId":"557058:37f974f7-a218-48c8-8028-3ca5698c4a9b","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FavatarId%3D10122%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26avatarId%3D10122%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26avatarId%3D10122%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/48ab31420165afbcc95b0ca36cc80b29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26avatarId%3D10122%26noRedirect%3Dtrue"},"displayName":"QinWei","active":true,"timeZone":"US/Central"},"customfield_12100":"0|i02q3z:","aggregateprogress":{"progress":0,"total":0},"customfield_10000":"10000_*:*_1_*:*_54639044_*|*_10002_*:*_1_*:*_167836_*|*_10001_*:*_1_*:*_15648283174_*|*_10003_*:*_1_*:*_5265615444_*|*_10006_*:*_1_*:*_0","customfield_10001":"2014-06-26T17:53:25.826-0500","customfield_10200":null,"customfield_10002":null,"customfield_10003":null,"customfield_10400":null,"customfield_12500":null,"customfield_10116":null,"customfield_11600":["dmitrii(dmitrii)","hspencer(hspencer)","QinWei(qinwei)","spark(spark)"],"customfield_10117":null,"environment":null,"customfield_11800":null,"customfield_11802":null,"customfield_11805":null,"duedate":null,"progress":{"progress":0,"total":0},"customfield_11806":null,"comment":{"comments":[{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/30218/comment/72962","id":"72962","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"body":"AFAIK, physical disk resource is not allocated for EBS instance. There's a device mapping from iscsi-mounted volume to local file name, but the local file does not allocate physical disk block. ","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=spark","name":"spark","key":"spark","accountId":"557058:2ed923b8-7172-41f0-a425-8796bd9a62f9","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/fec440044f6e652174838d59d9233f29?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dspark%26avatarId%3D10900%26noRedirect%3Dtrue"},"displayName":"Sang-Min Park","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-06-26T17:53:25.826-0500","updated":"2014-06-26T17:53:25.826-0500"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/30218/comment/79342","id":"79342","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"body":"Now EBS instances without ephemeral disk should have no effect on disk availability. Regression potential is to miscalculate disk availability for Instance Store instances. It would be good to max out an NC in terms of instance workspace use and ensure it behaves as advertised (i.e., can run the number of instances that it claims it can).","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=dmitrii","name":"dmitrii","key":"dmitrii","accountId":"557058:1e0ea807-434b-4b54-967f-1dec4a9ede55","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/efb56b507e22d4fc0d8d5e900e5651d5?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Ddmitrii%26avatarId%3D15900%26noRedirect%3Dtrue"},"displayName":"Dmitrii Calzago","active":false,"timeZone":"America/Los_Angeles"},"created":"2014-11-20T14:22:25.797-0600","updated":"2014-11-20T14:22:25.797-0600"},{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/30218/comment/82239","id":"82239","author":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"body":"[~spark]/[~dmitrii]:\r\n\r\nVerified that issue is fixed.\r\n\r\nEucalyptus Version:  4.1.0-0.0.23023.353.20150116git0f5f4f1.el6\r\n\r\n*Steps*\r\n\r\n# On [Group #1 cloud|https://eucalyptus.atlassian.net/wiki/display/QA/Euca+4.1+Quality+Dashboard#Euca4.1QualityDashboard-TypeofDeployments], bundled, uploaded, and registered an instance store-backed HVM [Ubuntu Trusty image|http://images.objectstorage.cloud.qa1.eucalyptus-systems.com:8773/trusty-server-cloudimg-amd64-disk1-20150115.img]\r\n{code}\r\n# euca-install-image -b ubuntu-trusty-20150120 -i /mnt/ephemeral/trusty-server-cloudimg-amd64-disk1-20150115.img -n ubuntu-trusty-20150120 -r x86_64 --region admin-hspencer@group1 --virtualization-type hvm\r\n...\r\n/var/tmp/bundle-o3qXlC/trusty-server-cloudimg-amd64-disk1-20150115.img.manifest.xml 100% |=====================================================|   7.16 kB  24.29 kB/s Time: 0:00:00\r\nIMAGE\temi-38abe905\r\n{code}\r\n# Launch an instance from the EMI:\r\n{code}\r\n# euca-run-instances -k admin-hspencer1 -t m1.xlarge emi-38abe905 --region admin-hspencer@group1\r\nRESERVATION\tr-88cc1732\t439629811643\tdefault\r\nINSTANCE\ti-7a2983ab\temi-38abe905\t\teuca-10-111-52-147.eucalyptus.internal\tpending\tadmin-hspencer1\t0\t\tm1.xlarge\t2015-01-20T15:39:21.357Z\tone\t\t\t\tmonitoring-disabled\t10.111.52.147\t10.111.52.147\t\t\tinstance-store\t\t\t\t\thvm\t\t\tsg-1dab229a\t\t\t\tx86_64\r\n\r\n# euca-describe-instances --region admin-hspencer@group1\r\nRESERVATION\tr-88cc1732\t439629811643\tdefault\r\nINSTANCE\ti-7a2983ab\temi-38abe905\teuca-10-111-52-34.eucalyptus.h-12.autoqa.qa1.eucalyptus-systems.com\teuca-10-111-52-147.eucalyptus.internal\trunning\tadmin-hspencer1\t0\t\tm1.xlarge\t2015-01-20T15:39:21.357Z\tone\t\t\t\tmonitoring-disabled\t10.111.52.34\t10.111.52.147\t\t\tinstance-store\t\t\t\t\thvm\t\t\tsg-1dab229a\t\t\t\tx86_64\r\n{code}\r\n# Follow the steps mentioned in the [KB article regarding creating an Ubuntu EBS-backed EMI from an existing Ubuntu instance store-backed instance|https://support.eucalyptus.com/hc/en-us/articles/201605884-Creating-an-Ubuntu-EBS-backed-EMI-from-an-Existing-Instance-Store-Backed-Instance?flash_digest=9710a6c569815eded433115a2c074f6fd8697342].\r\n# Launch 4 EBS-backed instances; 2 without block device mapping of ephemeral, 2 with block device mapping of ephemeral. This tests the behavior on both SAN based and Ceph backed SCs.\r\n{code}\r\n# euca-run-instances -k admin-hspencer1 -t m1.xlarge emi-1a7c64f8 --region admin-hspencer@group1\r\n# euca-run-instances -k admin-hspencer1 -t m1.xlarge emi-1a7c64f8 --block-device-mapping /dev/sdb=ephemeral0 --region admin-hspencer@group1\r\n# euca-run-instances -k admin-hspencer1 -t m1.xlarge emi-1a7c64f8 --block-device-mapping /dev/sdb=ephemeral0 -z two --region admin-hspencer@group1\r\n# euca-run-instances -k admin-hspencer1 -t m1.xlarge emi-1a7c64f8 -z one --region admin-hspencer@group1\r\n\r\n# euca-describe-instances --filter root-device-type=ebs --filter availability-zone=one --region admin-hspencer@group1\r\nRESERVATION\tr-3b27ba91\t439629811643\tdefault\r\nINSTANCE\ti-1a62d40f\temi-1a7c64f8\teuca-10-111-52-18.eucalyptus.h-12.autoqa.qa1.eucalyptus-systems.com\teuca-10-111-52-145.eucalyptus.internal\trunning\tadmin-hspencer1\t0\t\tm1.xlarge\t2015-01-20T16:23:58.399Z\tone\t\t\t\tmonitoring-disabled\t10.111.52.18\t10.111.52.145\t\t\tebs\t\t\t\t\thvm\t\t\tsg-1dab229a\t\t\t\tx86_64\r\nBLOCKDEVICE\t/dev/sda\tvol-d311ba05\t2015-01-20T16:23:58.564Z\ttrue\r\nRESERVATION\tr-a0d0510b\t439629811643\tdefault\r\nINSTANCE\ti-a21b5b04\temi-1a7c64f8\teuca-10-111-52-8.eucalyptus.h-12.autoqa.qa1.eucalyptus-systems.com\teuca-10-111-52-129.eucalyptus.internal\trunning\tadmin-hspencer1\t0\t\tm1.xlarge\t2015-01-20T18:01:14.389Z\tone\t\t\t\tmonitoring-disabled\t10.111.52.8\t10.111.52.129\t\t\tebs\t\t\t\t\thvm\t\t\tsg-1dab229a\t\t\t\tx86_64\r\nBLOCKDEVICE\t/dev/sda\tvol-6a0a1e79\t2015-01-20T18:01:14.569Z\ttrue\r\n\r\n# euca-describe-instances --filter root-device-type=ebs --filter availability-zone=two --region admin-hspencer@group1\r\nRESERVATION\tr-87c53042\t439629811643\tdefault\r\nINSTANCE\ti-eee5f988\temi-1a7c64f8\teuca-10-111-52-36.eucalyptus.h-12.autoqa.qa1.eucalyptus-systems.com\teuca-10-111-52-131.eucalyptus.internal\trunning\tadmin-hspencer1\t0\t\tm1.xlarge\t2015-01-20T16:15:52.771Z\ttwo\t\t\t\tmonitoring-disabled\t10.111.52.36\t10.111.52.131\t\t\tebs\t\t\t\t\thvm\t\t\tsg-1dab229a\t\t\t\tx86_64\r\nBLOCKDEVICE\t/dev/sda\tvol-001608ed\t2015-01-20T16:15:52.943Z\ttrue\r\nRESERVATION\tr-c7cc9cd5\t439629811643\tdefault\r\nINSTANCE\ti-b47106b8\temi-1a7c64f8\teuca-10-111-52-10.eucalyptus.h-12.autoqa.qa1.eucalyptus-systems.com\teuca-10-111-52-120.eucalyptus.internal\trunning\tadmin-hspencer1\t0\t\tm1.xlarge\t2015-01-20T18:00:53.379Z\ttwo\t\t\t\tmonitoring-disabled\t10.111.52.10\t10.111.52.120\t\t\tebs\t\t\t\t\thvm\t\t\tsg-1dab229a\t\t\t\tx86_64\r\nBLOCKDEVICE\t/dev/sda\tvol-13bdaedd\t2015-01-20T18:00:53.570Z\ttrue\r\n{code}\r\n# Check block devices used for EBS-backed instances on NCs.\r\n_EMC SC cluster_\r\n{code}\r\n# virsh domblklist i-eee5f988\r\nTarget     Source\r\n------------------------------------------------\r\nvda        /dev/disk/by-id/scsi-36006016098b030003032ce86c1a0e411\r\n\r\n# iscsiadm -m session\r\ntcp: [1] 10.107.5.1:3260,1 iqn.1992-04.com.emc:cx.apm00121200804.a6 (non-flash)\r\n{code}\r\n{code}\r\n# virsh domblklist i-b47106b8\r\nTarget     Source\r\n------------------------------------------------\r\nvda        /dev/disk/by-id/scsi-36006016098b03000900cc4d4cfa0e411\r\nvdb        /var/lib/eucalyptus/instances/work/AIDMZX2SWFVUMIXBTRYPG/i-b47106b8/link-to-vdb\r\n\r\n# iscsiadm -m session\r\ntcp: [1] 10.107.5.1:3260,1 iqn.1992-04.com.emc:cx.apm00121200804.a6 (non-flash)\r\n\r\n# dmsetup status | grep AIDMZX2SWFVUMIXBTRYPG\r\neuca-AIDMZX2SWFVUMIXBTRYPG-i-b47106b8-prt-10240none-38c6e1fc-p0-back: 0 20971520 linear\r\neuca-AIDMZX2SWFVUMIXBTRYPG-i-b47106b8-prt-10240none-38c6e1fc-p0-snap: 0 20971520 snapshot 0/20971520 0\r\neuca-AIDMZX2SWFVUMIXBTRYPG-i-b47106b8-prt-10240none-38c6e1fc: 0 20971520 linear\r\n{code}\r\n_Ceph SC Cluster_\r\n{code}\r\n# virsh domblklist i-a21b5b04\r\nTarget     Source\r\n------------------------------------------------\r\nvda        qavolumes/vol-6a0a1e79\r\n\r\n# virsh dumpxml i-a21b5b04\r\n<domain type='kvm' id='7'>\r\n  <name>i-a21b5b04</name>\r\n  <uuid>aa83496c-d05e-443f-e3d9-86d228cf7379</uuid>\r\n  <description>Eucalyptus instance i-a21b5b04</description>\r\n  <memory unit='KiB'>1048576</memory>\r\n  <currentMemory unit='KiB'>1048576</currentMemory>\r\n  <vcpu placement='static'>2</vcpu>\r\n  <os>\r\n    <type arch='x86_64' machine='rhel6.6.0'>hvm</type>\r\n    <boot dev='hd'/>\r\n  </os>\r\n  <features>\r\n    <acpi/>\r\n  </features>\r\n  <cpu>\r\n    <topology sockets='2' cores='2' threads='2'/>\r\n  </cpu>\r\n  <clock offset='localtime'/>\r\n  <on_poweroff>destroy</on_poweroff>\r\n  <on_reboot>restart</on_reboot>\r\n  <on_crash>destroy</on_crash>\r\n  <devices>\r\n    <emulator>/usr/libexec/qemu-kvm</emulator>\r\n    <disk type='network' device='disk'>\r\n      <driver name='qemu'/>\r\n      <auth username='qauser'>\r\n        <secret type='ceph' uuid='03a4b2b8-990f-41df-a418-a5f3c6a57d90'/>\r\n      </auth>\r\n      <source protocol='rbd' name='qavolumes/vol-6a0a1e79'>\r\n        <host name='10.111.5.185' port='6789'/>\r\n        <host name='10.111.5.188' port='6789'/>\r\n        <host name='10.111.5.189' port='6789'/>\r\n      </source>\r\n      <target dev='vda' bus='virtio'/>\r\n      <serial>euca-bdm-ebs1-dev-vda</serial>\r\n      <alias name='virtio-disk0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\r\n    </disk>\r\n    <controller type='usb' index='0'>\r\n      <alias name='usb0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\r\n    </controller>\r\n    <interface type='bridge'>\r\n      <mac address='d0:0d:a2:1b:5b:04'/>\r\n      <source bridge='br0'/>\r\n      <target dev='vn_i-a21b5b04'/>\r\n      <model type='virtio'/>\r\n      <alias name='net0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\r\n    </interface>\r\n    <serial type='file'>\r\n      <source path='/var/lib/eucalyptus/instances/work/AIDMZX2SWFVUMIXBTRYPG/i-a21b5b04/console.log'/>\r\n      <target port='1'/>\r\n      <alias name='serial0'/>\r\n    </serial>\r\n    <console type='file'>\r\n      <source path='/var/lib/eucalyptus/instances/work/AIDMZX2SWFVUMIXBTRYPG/i-a21b5b04/console.log'/>\r\n      <target type='serial' port='1'/>\r\n      <alias name='serial0'/>\r\n    </console>\r\n    <memballoon model='virtio'>\r\n      <alias name='balloon0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\r\n    </memballoon>\r\n  </devices>\r\n</domain>\r\n{code}\r\n{code}\r\n# virsh domblklist i-1a62d40f\r\nTarget     Source\r\n------------------------------------------------\r\nvda        rbd/vol-d311ba05\r\nvdb        /var/lib/eucalyptus/instances/work/AIDMZX2SWFVUMIXBTRYPG/i-1a62d40f/link-to-vdb\r\n\r\n# virsh dumpxml i-1a62d40f\r\n<domain type='kvm' id='2'>\r\n  <name>i-1a62d40f</name>\r\n  <uuid>9359a7cd-b112-3f90-3e21-ae3fe65b7bd7</uuid>\r\n  <description>Eucalyptus instance i-1a62d40f</description>\r\n  <memory unit='KiB'>1048576</memory>\r\n  <currentMemory unit='KiB'>1048576</currentMemory>\r\n  <vcpu placement='static'>2</vcpu>\r\n  <os>\r\n    <type arch='x86_64' machine='rhel6.6.0'>hvm</type>\r\n    <boot dev='hd'/>\r\n  </os>\r\n  <features>\r\n    <acpi/>\r\n  </features>\r\n  <cpu>\r\n    <topology sockets='2' cores='2' threads='2'/>\r\n  </cpu>\r\n  <clock offset='localtime'/>\r\n  <on_poweroff>destroy</on_poweroff>\r\n  <on_reboot>restart</on_reboot>\r\n  <on_crash>destroy</on_crash>\r\n  <devices>\r\n    <emulator>/usr/libexec/qemu-kvm</emulator>\r\n    <disk type='network' device='disk'>\r\n      <driver name='qemu'/>\r\n      <auth username='qauser'>\r\n        <secret type='ceph' uuid='03a4b2b8-990f-41df-a418-a5f3c6a57d90'/>\r\n      </auth>\r\n      <source protocol='rbd' name='rbd/vol-d311ba05'>\r\n        <host name='10.111.5.185' port='6789'/>\r\n        <host name='10.111.5.188' port='6789'/>\r\n        <host name='10.111.5.189' port='6789'/>\r\n      </source>\r\n      <target dev='vda' bus='virtio'/>\r\n      <serial>euca-bdm-ebs1-dev-vda</serial>\r\n      <alias name='virtio-disk0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>\r\n    </disk>\r\n    <disk type='block' device='disk'>\r\n      <driver name='qemu' type='raw' cache='none'/>\r\n      <source dev='/var/lib/eucalyptus/instances/work/AIDMZX2SWFVUMIXBTRYPG/i-1a62d40f/link-to-vdb'/>\r\n      <target dev='vdb' bus='virtio'/>\r\n      <serial>euca-bdm-ephemeral0-dev-vdb</serial>\r\n      <alias name='virtio-disk1'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\r\n    </disk>\r\n    <controller type='usb' index='0'>\r\n      <alias name='usb0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>\r\n    </controller>\r\n    <interface type='bridge'>\r\n      <mac address='d0:0d:1a:62:d4:0f'/>\r\n      <source bridge='br0'/>\r\n      <target dev='vn_i-1a62d40f'/>\r\n      <model type='virtio'/>\r\n      <alias name='net0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\r\n    </interface>\r\n    <serial type='file'>\r\n      <source path='/var/lib/eucalyptus/instances/work/AIDMZX2SWFVUMIXBTRYPG/i-1a62d40f/console.log'/>\r\n      <target port='1'/>\r\n      <alias name='serial0'/>\r\n    </serial>\r\n    <console type='file'>\r\n      <source path='/var/lib/eucalyptus/instances/work/AIDMZX2SWFVUMIXBTRYPG/i-1a62d40f/console.log'/>\r\n      <target type='serial' port='1'/>\r\n      <alias name='serial0'/>\r\n    </console>\r\n    <memballoon model='virtio'>\r\n      <alias name='balloon0'/>\r\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0'/>\r\n    </memballoon>\r\n  </devices>\r\n</domain>\r\n\r\n# dmsetup status | grep AIDMZX2SWFVUMIXBTRYPG\r\neuca-AIDMZX2SWFVUMIXBTRYPG-i-1a62d40f-prt-10240none-38c6e1fc-p0-snap: 0 20971520 snapshot 0/20971520 0\r\neuca-AIDMZX2SWFVUMIXBTRYPG-i-1a62d40f-prt-10240none-38c6e1fc: 0 20971520 linear\r\neuca-AIDMZX2SWFVUMIXBTRYPG-i-1a62d40f-prt-10240none-38c6e1fc-p0-back: 0 20971520 linear\r\n{code}\r\n\r\nBased upon the output on both clusters, the following has been verified:\r\n# NC storage isn't used with an EBS-backed instance when a block device mapping for ephemeral isn't present\r\n# NC storage is used with an EBS-backed instance when a block device mapping for ephemeral is present\r\n# This behavior matches AWS behavior (with regards to ephemeral devices not being present - unless specifically defined in block device mapping - for EBS-backed instances)","updateAuthor":{"self":"https://eucalyptus.atlassian.net/rest/api/2/user?username=hspencer","name":"hspencer","key":"hspencer","accountId":"557058:4a3a93bc-21f8-4658-9f5b-9cb484c910a7","avatarUrls":{"48x48":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=48&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3FownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","24x24":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=24&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","16x16":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=16&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dxsmall%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue","32x32":"https://avatar-cdn.atlassian.com/ea43d7b9d5b27468a749f9bd25650176?s=32&d=https%3A%2F%2Feucalyptus.atlassian.net%2Fsecure%2Fuseravatar%3Fsize%3Dmedium%26ownerId%3Dhspencer%26avatarId%3D10407%26noRedirect%3Dtrue"},"displayName":"Harold Spencer Jr.","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-01-20T13:02:41.237-0600","updated":"2015-01-20T13:02:41.237-0600"}],"maxResults":3,"total":3,"startAt":0},"votes":{"self":"https://eucalyptus.atlassian.net/rest/api/2/issue/EUCA-9452/votes","votes":0,"hasVoted":false},"customfield_11808":null,"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}}