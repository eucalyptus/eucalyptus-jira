{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters": {
        "ImageId": {
          "Type": "String",
          "Description": "Image ID for web instances"
        },
        "KeyPair2DefaultKP": {
            "Type": "String",
            "Description": "KeyPair to use for instances"
        }
    },
    "Description": "Cloudformation generated by VisualOps",
    "Resources": {
        "SecurityGroup2elbsgloadbalancer02IpPermissions22": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Properties": {
                "ToPort": "22",
                "FromPort": "22",
                "CidrIp": "0.0.0.0/0",
                "GroupId": {
                    "Ref": "SecurityGroup2elbsgloadbalancer0"
                },
                "IpProtocol": "tcp"
            }
        },
        "SecurityGroup2DefaultSG2Ingress20": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Properties": {
                "ToPort": "22",
                "FromPort": "22",
                "CidrIp": "0.0.0.0/0",
                "GroupId": {
                    "Ref": "SecurityGroup2DefaultSG"
                },
                "IpProtocol": "tcp"
            }
        },
        "SecurityGroup2DefaultSG2Ingress21": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Properties": {
                "SourceSecurityGroupId": {
                    "Ref": "SecurityGroup2elbsgloadbalancer0"
                },
                "FromPort": "80",
                "ToPort": "80",
                "GroupId": {
                    "Ref": "SecurityGroup2DefaultSG"
                },
                "IpProtocol": "tcp"
            }
        },
        "VPC2vpc": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": "10.0.0.0/16",
                "EnableDnsSupport": true,
                "InstanceTenancy": "default",
                "EnableDnsHostnames": false
            }
        },
        "SecurityGroup2DefaultSG2IpPermissionsEgress20": {
            "Type": "AWS::EC2::SecurityGroupEgress",
            "Properties": {
                "ToPort": "65535",
                "FromPort": "0",
                "GroupId": {
                    "Ref": "SecurityGroup2DefaultSG"
                },
                "IpProtocol": "-1",
                "CidrIp": "0.0.0.0/0"
            }
        },
        "SecurityGroup2DefaultSG": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC2vpc"
                },
                "GroupDescription": "default VPC security group",
                "Tags": [
                    {
                        "Value": "true",
                        "Key": "visops_default"
                    }
                ]
            }
        },
        "RouteTable2RT02RouteSet21": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "GatewayId": {
                    "Ref": "InternetGateway2Internetgateway"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "RouteTableId": {
                    "Ref": "RouteTable2RT0"
                }
            }
        },
        "SecurityGroup2DefaultSG2IpPermissions22": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Properties": {
                "SourceSecurityGroupId": {
                    "Ref": "SecurityGroup2elbsgloadbalancer0"
                },
                "FromPort": "80",
                "ToPort": "80",
                "GroupId": {
                    "Ref": "SecurityGroup2DefaultSG"
                },
                "IpProtocol": "tcp"
            }
        },
        "Subnet2subnet0": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "Tags": [],
                "VpcId": {
                    "Ref": "VPC2vpc"
                },
                "CidrBlock": "10.0.0.0/24",
                "AvailabilityZone": "one"
            }
        },
        "Subnet2subnet1": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "Tags": [],
                "VpcId": {
                    "Ref": "VPC2vpc"
                },
                "CidrBlock": "10.0.1.0/24",
                "AvailabilityZone": "one"
            }
        },
        "NetworkAcl2DefaultACL2AssociationSet20": {
            "Type": "AWS::EC2::SubnetNetworkAclAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Subnet2subnet0"
                },
                "NetworkAclId": {
                    "Ref": "NetworkAcl2DefaultACL"
                }
            }
        },
        "NetworkAcl2DefaultACL2AssociationSet21": {
            "Type": "AWS::EC2::SubnetNetworkAclAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Subnet2subnet1"
                },
                "NetworkAclId": {
                    "Ref": "NetworkAcl2DefaultACL"
                }
            }
        },
        "NetworkAcl2DefaultACL": {
            "Type": "AWS::EC2::NetworkAcl",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC2vpc"
                },
                "Tags": [
                    {
                        "Value": "true",
                        "Key": "visops_default"
                    }
                ]
            }
        },
        "AttachInternetGateway": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC2vpc"
                },
                "InternetGatewayId": {
                    "Ref": "InternetGateway2Internetgateway"
                }
            }
        },
        "SecurityGroup2elbsgloadbalancer02Ingress20": {
            "Type": "AWS::EC2::SecurityGroupIngress",
            "Properties": {
                "ToPort": "22",
                "FromPort": "22",
                "CidrIp": "0.0.0.0/0",
                "GroupId": {
                    "Ref": "SecurityGroup2elbsgloadbalancer0"
                },
                "IpProtocol": "tcp"
            }
        },
        "SecurityGroup2elbsgloadbalancer02Egress20": {
            "Type": "AWS::EC2::SecurityGroupEgress",
            "Properties": {
                "ToPort": "80",
                "FromPort": "80",
                "GroupId": {
                    "Ref": "SecurityGroup2elbsgloadbalancer0"
                },
                "DestinationSecurityGroupId": {
                    "Ref": "SecurityGroup2DefaultSG"
                },
                "IpProtocol": "tcp"
            }
        },
        "SecurityGroup2elbsgloadbalancer02IpPermissionsEgress20": {
            "Type": "AWS::EC2::SecurityGroupEgress",
            "Properties": {
                "ToPort": "80",
                "FromPort": "80",
                "GroupId": {
                    "Ref": "SecurityGroup2elbsgloadbalancer0"
                },
                "DestinationSecurityGroupId": {
                    "Ref": "SecurityGroup2DefaultSG"
                },
                "IpProtocol": "tcp"
            }
        },
        "RouteTable2RT02AssociationSet23": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Subnet2subnet0"
                },
                "RouteTableId": {
                    "Ref": "RouteTable2RT0"
                }
            }
        },
        "SecurityGroup2DefaultSG2Egress20": {
            "Type": "AWS::EC2::SecurityGroupEgress",
            "Properties": {
                "ToPort": "65535",
                "FromPort": "0",
                "GroupId": {
                    "Ref": "SecurityGroup2DefaultSG"
                },
                "IpProtocol": "-1",
                "CidrIp": "0.0.0.0/0"
            }
        },
        "Group2asg0": {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": {
                "AvailabilityZones": [
                    "one"
                ],
                "DesiredCapacity": "1",
                "VPCZoneIdentifier": [
                    {
                        "Ref": "Subnet2subnet1"
                    }
                ],
                "LoadBalancerNames": [
                    {
                        "Ref": "ELB2loadbalancer0"
                    }
                ],
                "MinSize": "1",
                "MaxSize": "2",
                "Cooldown": "300",
                "LaunchConfigurationName": {
                    "Ref": "LaunchConfiguration2launchconfig2"
                },
                "HealthCheckGracePeriod": 300,
                "HealthCheckType": "ELB"
            }
        },
        "Group2asg1": {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": {
                "AvailabilityZones": [
                    "one"
                ],
                "DesiredCapacity": "1",
                "VPCZoneIdentifier": [
                    {
                        "Ref": "Subnet2subnet0"
                    }
                ],
                "LoadBalancerNames": [
                    {
                        "Ref": "ELB2loadbalancer0"
                    }
                ],
                "MinSize": "1",
                "MaxSize": "2",
                "Cooldown": "300",
                "LaunchConfigurationName": {
                    "Ref": "LaunchConfiguration2launchconfig1"
                },
                "HealthCheckGracePeriod": 300,
                "HealthCheckType": "ELB"
            }
        },
        "RouteTable2RT0": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC2vpc"
                },
                "Tags": [
                    {
                        "Value": "true",
                        "Key": "visops_default"
                    }
                ]
            }
        },
        "ELB2loadbalancer0": {
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {
                "Subnets": [
                    {
                        "Ref": "Subnet2subnet1"
                    }
                ],
                "HealthCheck": {
                    "HealthyThreshold": "9",
                    "Interval": "30",
                    "Target": "HTTP:80/index.html",
                    "Timeout": "5",
                    "UnhealthyThreshold": "4"
                },
                "Instances": [],
                "Listeners": [
                    {
                        "InstancePort": "80",
                        "LoadBalancerPort": "80",
                        "Protocol": "HTTP",
                        "InstanceProtocol": "HTTP"
                    }
                ],
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroup2elbsgloadbalancer0"
                    }
                ],
                "Scheme": "internet-facing"
            }
        },
        "NetworkAcl2DefaultACL2EntrySet20": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "NetworkAcl2DefaultACL"
                },
                "RuleNumber": 100,
                "Protocol": -1,
                "PortRange": {
                    "To": "",
                    "From": ""
                },
                "Egress": true,
                "RuleAction": "allow",
                "Icmp": {
                    "Code": "",
                    "Type": ""
                },
                "CidrBlock": "0.0.0.0/0"
            }
        },
        "LaunchConfiguration2launchconfig2": {
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": {
                "UserData": "Q29udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSI9PT09PT09PT09PT09PT01\nNDIzNjE4MjU2NDA5Mjc1MjAxPT0iCk1JTUUtVmVyc2lvbjogMS4wCgotLT09PT09PT09PT09PT09\nPTU0MjM2MTgyNTY0MDkyNzUyMDE9PQpDb250ZW50LVR5cGU6IHRleHQveC1zaGVsbHNjcmlwdDsg\nY2hhcnNldD0idXMtYXNjaWkiCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRlbnQtVHJhbnNmZXItRW5j\nb2Rpbmc6IDdiaXQKQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVudDsgZmlsZW5hbWU9InNj\ncmlwdC5zaCIKCiMhL2Jpbi9iYXNoCmV4cG9ydCBFQzJfVVJMPWh0dHA6Ly8xMC4wLjEuOTA6ODc3\nMy9zZXJ2aWNlcy9FdWNhbHlwdHVzCmV4cG9ydCBFQzJfQUNDRVNTX0tFWT0nWDZOWVZBQU0yREFD\nVkYxS1hDV1AyJwpleHBvcnQgRUMyX1NFQ1JFVF9LRVk9J3doQXd1cVI4ekNTM2dSTFQ5YnYwNHhI\nZGF2OFFNZGtINnJ2MmthUlUnCmluc3RhbmNlX2lkPWBjdXJsIGh0dHA6Ly8xNjkuMjU0LjE2OS4y\nNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZGAKaW5zdGFuY2VfaXA9YGN1cmwgaHR0cDov\nLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjRgCgphcHQtZ2V0IGlu\nc3RhbGwgLXkgYXBhY2hlMgplY2hvICRpbnN0YW5jZV9pZCA+IC92YXIvd3d3L2luZGV4Lmh0bWwK\nLS09PT09PT09PT09PT09PT01NDIzNjE4MjU2NDA5Mjc1MjAxPT0KQ29udGVudC1UeXBlOiB0ZXh0\nL2Nsb3VkLWNvbmZpZzsgY2hhcnNldD0idXMtYXNjaWkiCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRl\nbnQtVHJhbnNmZXItRW5jb2Rpbmc6IDdiaXQKQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVu\ndDsgZmlsZW5hbWU9ImNsb3VkLWNvbmZpZy50eHQiCgojY2xvdWQtY29uZmlnCmRpc2FibGVfcm9v\ndDogZmFsc2UKYXB0X21pcnJvcjogaHR0cDovL3VzLmFyY2hpdmUudWJ1bnR1LmNvbS91YnVudHUv\nCmJ5b2J1X2J5X2RlZmF1bHQ6IHN5c3RlbQpyZXNpemVfcm9vdGZzOiBUcnVlCm1vdW50czoKLSBb\nIHN3YXAsIG51bGwgXQoKLS09PT09PT09PT09PT09PT01NDIzNjE4MjU2NDA5Mjc1MjAxPT0tLQo=\n",
                "InstanceMonitoring": true,
                "ImageId": "ami-3241234",
                "KeyName": {
                    "Ref": "KeyPair2DefaultKP"
                },
                "EbsOptimized": false,
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroup2DefaultSG"
                    }
                ],
                "InstanceType": "m1.medium",
                "AssociatePublicIpAddress": true
            }
        },
        "LaunchConfiguration2launchconfig1": {
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": {
                "UserData": "Q29udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSI9PT09PT09PT09PT09PT01\nNDIzNjE4MjU2NDA5Mjc1MjAxPT0iCk1JTUUtVmVyc2lvbjogMS4wCgotLT09PT09PT09PT09PT09\nPTU0MjM2MTgyNTY0MDkyNzUyMDE9PQpDb250ZW50LVR5cGU6IHRleHQveC1zaGVsbHNjcmlwdDsg\nY2hhcnNldD0idXMtYXNjaWkiCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRlbnQtVHJhbnNmZXItRW5j\nb2Rpbmc6IDdiaXQKQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVudDsgZmlsZW5hbWU9InNj\ncmlwdC5zaCIKCiMhL2Jpbi9iYXNoCmV4cG9ydCBFQzJfVVJMPWh0dHA6Ly8xMC4wLjEuOTA6ODc3\nMy9zZXJ2aWNlcy9FdWNhbHlwdHVzCmV4cG9ydCBFQzJfQUNDRVNTX0tFWT0nWDZOWVZBQU0yREFD\nVkYxS1hDV1AyJwpleHBvcnQgRUMyX1NFQ1JFVF9LRVk9J3doQXd1cVI4ekNTM2dSTFQ5YnYwNHhI\nZGF2OFFNZGtINnJ2MmthUlUnCmluc3RhbmNlX2lkPWBjdXJsIGh0dHA6Ly8xNjkuMjU0LjE2OS4y\nNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZGAKaW5zdGFuY2VfaXA9YGN1cmwgaHR0cDov\nLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjRgCgphcHQtZ2V0IGlu\nc3RhbGwgLXkgYXBhY2hlMgplY2hvICRpbnN0YW5jZV9pZCA+IC92YXIvd3d3L2luZGV4Lmh0bWwK\nLS09PT09PT09PT09PT09PT01NDIzNjE4MjU2NDA5Mjc1MjAxPT0KQ29udGVudC1UeXBlOiB0ZXh0\nL2Nsb3VkLWNvbmZpZzsgY2hhcnNldD0idXMtYXNjaWkiCk1JTUUtVmVyc2lvbjogMS4wCkNvbnRl\nbnQtVHJhbnNmZXItRW5jb2Rpbmc6IDdiaXQKQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVu\ndDsgZmlsZW5hbWU9ImNsb3VkLWNvbmZpZy50eHQiCgojY2xvdWQtY29uZmlnCmRpc2FibGVfcm9v\ndDogZmFsc2UKYXB0X21pcnJvcjogaHR0cDovL3VzLmFyY2hpdmUudWJ1bnR1LmNvbS91YnVudHUv\nCmJ5b2J1X2J5X2RlZmF1bHQ6IHN5c3RlbQpyZXNpemVfcm9vdGZzOiBUcnVlCm1vdW50czoKLSBb\nIHN3YXAsIG51bGwgXQoKLS09PT09PT09PT09PT09PT01NDIzNjE4MjU2NDA5Mjc1MjAxPT0tLQo=\n",
                "InstanceMonitoring": true,
                "ImageId": { "Ref": "ImageId" },
                "KeyName": {
                    "Ref": "KeyPair2DefaultKP"
                },
                "EbsOptimized": false,
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroup2DefaultSG"
                    }
                ],
                "InstanceType": "m1.medium",
                "AssociatePublicIpAddress": true
            }
        },
        "NetworkAcl2DefaultACL2EntrySet21": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "NetworkAcl2DefaultACL"
                },
                "RuleNumber": 100,
                "Protocol": -1,
                "PortRange": {
                    "To": "",
                    "From": ""
                },
                "Egress": false,
                "RuleAction": "allow",
                "Icmp": {
                    "Code": "",
                    "Type": ""
                },
                "CidrBlock": "0.0.0.0/0"
            }
        },
        "SecurityGroup2elbsgloadbalancer0": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC2vpc"
                },
                "GroupDescription": "Automatically created SG for load-balancer",
                "Tags": [
                    {
                        "Value": "false",
                        "Key": "visops_default"
                    }
                ]
            }
        },
        "InternetGateway2Internetgateway": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {}
        }
    }
}

